var HANDJS=HANDJS||{};
(function(){function c(){v=!0;clearTimeout(w);w=setTimeout(function(){v=!1},700)}function f(a){var b=[];if(a)for(b.unshift(a);a.parentNode;)b.unshift(a.parentNode),a=a.parentNode;return b}function e(a,b){for(var c=f(a),d=f(b),h=null;0<c.length&&c[0]==d.shift();)h=c.shift();return h}function a(a,b,c){b=e(a,b);for(var d=[];a&&a!=b;)a.__handjsGlobalRegisteredEvents&&a.__handjsGlobalRegisteredEvents.pointerenter&&d.push(a),a=a.parentNode;for(;0<d.length;)c(d.pop())}function b(a,b,c){for(b=e(a,b);a&&a!=
b;)a.__handjsGlobalRegisteredEvents&&a.__handjsGlobalRegisteredEvents.pointerleave&&c(a),a=a.parentNode}function d(c,d){["pointerdown","pointermove","pointerup","pointerover","pointerout"].forEach(function(a){window.addEventListener(c(a),function(b){!v&&n(b.target,a)&&d(b,a,!0)})});void 0===window["on"+c("pointerenter").toLowerCase()]&&window.addEventListener(c("pointerover"),function(b){if(!v){var c=n(b.target,"pointerenter");c&&c!==window&&(c.contains(b.relatedTarget)||a(c,b.relatedTarget,function(a){d(b,
"pointerenter",!1,a)}))}});void 0===window["on"+c("pointerleave").toLowerCase()]&&window.addEventListener(c("pointerout"),function(a){if(!v){var c=n(a.target,"pointerleave");c&&c!==window&&(c.contains(a.relatedTarget)||b(c,a.relatedTarget,function(b){d(a,"pointerleave",!1,b)}))}})}if(!window.PointerEvent){Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;0<arguments.length&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&(Infinity!=d&&
-Infinity!=d)&&(d=(0<d||-1)*Math.floor(Math.abs(d))));if(d>=c)return-1;for(d=0<=d?d:Math.max(c-Math.abs(d),0);d<c;d++)if(d in b&&b[d]===a)return d;return-1});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/,"")});var j="pointerdown pointerup pointermove pointerover pointerout pointercancel pointerenter pointerleave".split(" "),g="PointerDown PointerUp PointerMove PointerOver PointerOut PointerCancel PointerEnter PointerLeave".split(" "),h={},m=function(a,b,
d,c){var h;document.createEvent?(h=document.createEvent("MouseEvents"),h.initMouseEvent(b,d,!0,window,1,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,null)):(h=document.createEventObject(),h.screenX=a.screenX,h.screenY=a.screenY,h.clientX=a.clientX,h.clientY=a.clientY,h.ctrlKey=a.ctrlKey,h.altKey=a.altKey,h.shiftKey=a.shiftKey,h.metaKey=a.metaKey,h.button=a.button);void 0===h.offsetX&&(void 0!==a.offsetX?(Object&&void 0!==Object.defineProperty&&(Object.defineProperty(h,
"offsetX",{writable:!0}),Object.defineProperty(h,"offsetY",{writable:!0})),h.offsetX=a.offsetX,h.offsetY=a.offsetY):Object&&void 0!==Object.defineProperty?(Object.defineProperty(h,"offsetX",{get:function(){return this.currentTarget&&this.currentTarget.offsetLeft?a.clientX-this.currentTarget.offsetLeft:a.clientX}}),Object.defineProperty(h,"offsetY",{get:function(){return this.currentTarget&&this.currentTarget.offsetTop?a.clientY-this.currentTarget.offsetTop:a.clientY}})):void 0!==a.layerX&&(h.offsetX=
a.layerX-a.currentTarget.offsetLeft,h.offsetY=a.layerY-a.currentTarget.offsetTop));h.isPrimary=void 0!==a.isPrimary?a.isPrimary:!0;a.pressure?h.pressure=a.pressure:(d=0,void 0!==a.which?d=a.which:void 0!==a.button&&(d=a.button),h.pressure=0==d?0:0.5);h.rotation=a.rotation?a.rotation:0;h.hwTimestamp=a.hwTimestamp?a.hwTimestamp:0;h.tiltX=a.tiltX?a.tiltX:0;h.tiltY=a.tiltY?a.tiltY:0;h.height=a.height?a.height:0;h.width=a.width?a.width:0;h.preventDefault=function(){void 0!==a.preventDefault&&a.preventDefault()};
if(void 0!==h.stopPropagation){var g=h.stopPropagation;h.stopPropagation=function(){void 0!==a.stopPropagation&&a.stopPropagation();g.call(this)}}h.pointerId=a.pointerId;h.pointerType=a.pointerType;switch(h.pointerType){case 2:h.pointerType="touch";break;case 3:h.pointerType="pen";break;case 4:h.pointerType="mouse"}c?c.dispatchEvent(h):a.target?a.target.dispatchEvent(h):a.srcElement.fireEvent("on"+p(b),h)},l=function(a,b,d,c){a.pointerId=1;a.pointerType="mouse";m(a,b,d,c)},k=function(a,b,d,c,h){b.pointerId=
b.identifier+2;b.pointerType="touch";b.currentTarget=d;void 0!==c.preventDefault&&(b.preventDefault=function(){c.preventDefault()});m(b,a,h,d)},n=function(a,b){for(;a&&(!a.__handjsGlobalRegisteredEvents||!a.__handjsGlobalRegisteredEvents[b]);)a=a.parentNode;if(a)return a;if(window.__handjsGlobalRegisteredEvents&&window.__handjsGlobalRegisteredEvents[b])return window},q=function(a,b,d,c,h){n(d,a)&&k(a,b,d,c,h)},p=function(a){return a.toLowerCase().replace("pointer","mouse")},r=function(a,b,d,c){void 0===
a.__handjsRegisteredEvents&&(a.__handjsRegisteredEvents=[]);if(c)void 0!==a.__handjsRegisteredEvents[b]?a.__handjsRegisteredEvents[b]++:(a.__handjsRegisteredEvents[b]=1,a.addEventListener(b,d,!1));else{if(-1!==a.__handjsRegisteredEvents.indexOf(b)&&(a.__handjsRegisteredEvents[b]--,0!=a.__handjsRegisteredEvents[b]))return;a.removeEventListener(b,d);a.__handjsRegisteredEvents[b]=0}},t=function(a,b,d){a.__handjsGlobalRegisteredEvents||(a.__handjsGlobalRegisteredEvents=[]);if(d){if(void 0!==a.__handjsGlobalRegisteredEvents[b]){a.__handjsGlobalRegisteredEvents[b]++;
return}a.__handjsGlobalRegisteredEvents[b]=1}else void 0!==a.__handjsGlobalRegisteredEvents[b]&&(a.__handjsGlobalRegisteredEvents[b]--,0>a.__handjsGlobalRegisteredEvents[b]&&(a.__handjsGlobalRegisteredEvents[b]=0));if(!window.MSPointerEvent)switch(b){case "pointerenter":void 0!==a.onmouseenter&&r(a,"mouseenter",function(a){l(a,b)},d);break;case "pointerleave":void 0!==a.onmouseleave&&r(a,"mouseleave",function(a){l(a,b)},d)}},s=function(a){var b=a.prototype?a.prototype.addEventListener:a.addEventListener,
d=function(a,d,c){-1!=j.indexOf(a)&&t(this,a,!0);void 0===b?this.attachEvent("on"+p(a),d):b.call(this,a,d,c)};a.prototype?a.prototype.addEventListener=d:a.addEventListener=d},u=function(a){var b=a.prototype?a.prototype.removeEventListener:a.removeEventListener,d=function(a,d,c){-1!=j.indexOf(a)&&t(this,a,!1);void 0===b?this.detachEvent(p(a),d):b.call(this,a,d,c)};a.prototype?a.prototype.removeEventListener=d:a.removeEventListener=d};s(window);s(window.HTMLElement||window.Element);s(document);s(HTMLBodyElement);
s(HTMLDivElement);s(HTMLImageElement);s(HTMLUListElement);s(HTMLAnchorElement);s(HTMLLIElement);s(HTMLTableElement);window.HTMLSpanElement&&s(HTMLSpanElement);window.HTMLCanvasElement&&s(HTMLCanvasElement);window.SVGElement&&s(SVGElement);u(window);u(window.HTMLElement||window.Element);u(document);u(HTMLBodyElement);u(HTMLDivElement);u(HTMLImageElement);u(HTMLUListElement);u(HTMLAnchorElement);u(HTMLLIElement);u(HTMLTableElement);window.HTMLSpanElement&&u(HTMLSpanElement);window.HTMLCanvasElement&&
u(HTMLCanvasElement);window.SVGElement&&u(SVGElement);var v=!1,w=-1;window.MSPointerEvent?d(function(a){a=j.indexOf(a);return"MS"+g[a]},m):(d(p,l),void 0!==window.ontouchstart&&(window.addEventListener("touchstart",function(b){for(var d=0;d<b.changedTouches.length;++d){var g=b.changedTouches[d];h[g.identifier]=g.target;q("pointerover",g,g.target,b,!0);a(g.target,null,function(a){k("pointerenter",g,a,b,!1)});q("pointerdown",g,g.target,b,!0)}c()}),window.addEventListener("touchend",function(a){for(var d=
0;d<a.changedTouches.length;++d){var g=a.changedTouches[d],j=h[g.identifier];q("pointerup",g,j,a,!0);q("pointerout",g,j,a,!0);b(j,null,function(b){k("pointerleave",g,b,a,!1)})}c()}),window.addEventListener("touchmove",function(d){for(var g=0;g<d.changedTouches.length;++g){var j=d.changedTouches[g],m=document.elementFromPoint(j.clientX,j.clientY),e=h[j.identifier],l;if(l=e){for(l=e;l&&!l.handjs_forcePreventDefault;)l=l.parentNode;l=!0===(!!l||window.handjs_forcePreventDefault)}l&&d.preventDefault();
q("pointermove",j,e,d,!0);e!==m&&(e&&(q("pointerout",j,e,d,!0),e.contains(m)||b(e,m,function(a){k("pointerleave",j,a,d,!1)})),m&&(q("pointerover",j,m,d,!0),m.contains(e)||a(m,e,function(a){k("pointerenter",j,a,d,!1)})),h[j.identifier]=m)}c()}),window.addEventListener("touchcancel",function(a){for(var b=0;b<a.changedTouches.length;++b){var d=a.changedTouches[b];q("pointercancel",d,h[d.identifier],a,!0)}})));void 0===navigator.pointerEnabled&&(navigator.pointerEnabled=!0,navigator.msPointerEnabled&&
(navigator.maxTouchPoints=navigator.msMaxTouchPoints));document.styleSheets&&document.addEventListener&&document.addEventListener("DOMContentLoaded",function(){if(!(HANDJS.doNotProcessCSS||void 0!==document.body.style.touchAction)){var a=/.+?{.*?}/m,b=/.+?{/m,d=function(d){var c=a.exec(d);if(c){c=c[0];d=d.replace(c,"").trim();var h=b.exec(c)[0].replace("{","").trim();if(-1!=c.replace(/\s/g,"").indexOf("touch-action:none")){c=document.querySelectorAll(h);for(h=0;h<c.length;h++){var g=c[h];void 0!==
g.style.msTouchAction?g.style.msTouchAction="none":g.handjs_forcePreventDefault=!0}}return d}},c=function(a){if(window.setImmediate)a&&setImmediate(c,d(a));else for(;a;)a=d(a)};try{for(var h=0;h<document.styleSheets.length;h++){var g=document.styleSheets[h];if(void 0!=g.href){var j=new XMLHttpRequest;j.open("get",g.href,!1);j.send();var m=j.responseText.replace(/(\n|\r)/g,"");c(m)}}}catch(e){}g=document.getElementsByTagName("style");for(h=0;h<g.length;h++)j=g[h].innerHTML.replace(/(\n|\r)/g,"").trim(),
c(j)}},!1)}})();window.wgl={modules:{}};var __decorate=this&&this.__decorate||function(c,f,e,a){var b,d=arguments.length,j=3>d?f:null===a?a=Object.getOwnPropertyDescriptor(f,e):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)j=Reflect.decorate(c,f,e,a);else for(var g=c.length-1;0<=g;g--)(b=c[g])&&(j=(3>d?b(j):3<d?b(f,e,j):b(f,e))||j);return 3<d&&j&&Object.defineProperty(f,e,j),j},__extends=this&&this.__extends||function(c,f){function e(){this.constructor=c}for(var a in f)f.hasOwnProperty(a)&&(c[a]=f[a]);e.prototype=f.prototype;
c.prototype=new e},BABYLON;
!function(c){c.ToGammaSpace=1/2.2;c.ToLinearSpace=2.2;c.Epsilon=0.001;var f,e=function(){};f=(e.WithinEpsilon=function(a,b,d){void 0===d&&(d=1.401298E-45);a-=b;return a>=-d&&d>=a},e.ToHex=function(a){var b=a.toString(16);return 15>=a?("0"+b).toUpperCase():b.toUpperCase()},e.Sign=function(a){return a=+a,0===a||isNaN(a)?a:0<a?1:-1},e.Clamp=function(a,b,d){return void 0===b&&(b=0),void 0===d&&(d=1),Math.min(d,Math.max(b,a))},e);c.MathTools=f;var a=function(a,b,d){void 0===a&&(a=0);void 0===b&&(b=0);
void 0===d&&(d=0);this.r=a;this.g=b;this.b=d},e=(a.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},a.prototype.getClassName=function(){return"Color3"},a.prototype.getHashCode=function(){var a=this.r||0;return a=397*a^(this.g||0),397*a^(this.b||0)},a.prototype.toArray=function(a,b){return void 0===b&&(b=0),a[b]=this.r,a[b+1]=this.g,a[b+2]=this.b,this},a.prototype.toColor4=function(a){return void 0===a&&(a=1),new b(this.r,this.g,this.b,a)},a.prototype.asArray=function(){var a=
[];return this.toArray(a,0),a},a.prototype.toLuminance=function(){return 0.3*this.r+0.59*this.g+0.11*this.b},a.prototype.multiply=function(b){return new a(this.r*b.r,this.g*b.g,this.b*b.b)},a.prototype.multiplyToRef=function(a,b){return b.r=this.r*a.r,b.g=this.g*a.g,b.b=this.b*a.b,this},a.prototype.equals=function(a){return a&&this.r===a.r&&this.g===a.g&&this.b===a.b},a.prototype.equalsFloats=function(a,b,d){return this.r===a&&this.g===b&&this.b===d},a.prototype.scale=function(b){return new a(this.r*
b,this.g*b,this.b*b)},a.prototype.scaleToRef=function(a,b){return b.r=this.r*a,b.g=this.g*a,b.b=this.b*a,this},a.prototype.add=function(b){return new a(this.r+b.r,this.g+b.g,this.b+b.b)},a.prototype.addToRef=function(a,b){return b.r=this.r+a.r,b.g=this.g+a.g,b.b=this.b+a.b,this},a.prototype.subtract=function(b){return new a(this.r-b.r,this.g-b.g,this.b-b.b)},a.prototype.subtractToRef=function(a,b){return b.r=this.r-a.r,b.g=this.g-a.g,b.b=this.b-a.b,this},a.prototype.clone=function(){return new a(this.r,
this.g,this.b)},a.prototype.copyFrom=function(a){return this.r=a.r,this.g=a.g,this.b=a.b,this},a.prototype.copyFromFloats=function(a,b,d){return this.r=a,this.g=b,this.b=d,this},a.prototype.toHexString=function(){var a=255*this.g|0,b=255*this.b|0;return"#"+f.ToHex(255*this.r|0)+f.ToHex(a)+f.ToHex(b)},a.prototype.toLinearSpace=function(){var b=new a;return this.toLinearSpaceToRef(b),b},a.prototype.toLinearSpaceToRef=function(a){return a.r=Math.pow(this.r,c.ToLinearSpace),a.g=Math.pow(this.g,c.ToLinearSpace),
a.b=Math.pow(this.b,c.ToLinearSpace),this},a.prototype.toGammaSpace=function(){var b=new a;return this.toGammaSpaceToRef(b),b},a.prototype.toGammaSpaceToRef=function(a){return a.r=Math.pow(this.r,c.ToGammaSpace),a.g=Math.pow(this.g,c.ToGammaSpace),a.b=Math.pow(this.b,c.ToGammaSpace),this},a.FromHexString=function(b){if("#"!==b.substring(0,1)||7!==b.length)return new a(0,0,0);var d=parseInt(b.substring(1,3),16),c=parseInt(b.substring(3,5),16);b=parseInt(b.substring(5,7),16);return a.FromInts(d,c,b)},
a.FromArray=function(b,d){return void 0===d&&(d=0),new a(b[d],b[d+1],b[d+2])},a.FromInts=function(b,d,c){return new a(b/255,d/255,c/255)},a.Lerp=function(b,d,c){return new a(b.r+(d.r-b.r)*c,b.g+(d.g-b.g)*c,b.b+(d.b-b.b)*c)},a.Red=function(){return new a(1,0,0)},a.Green=function(){return new a(0,1,0)},a.Blue=function(){return new a(0,0,1)},a.Black=function(){return new a(0,0,0)},a.White=function(){return new a(1,1,1)},a.Purple=function(){return new a(0.5,0,0.5)},a.Magenta=function(){return new a(1,
0,1)},a.Yellow=function(){return new a(1,1,0)},a.Gray=function(){return new a(0.5,0.5,0.5)},a);c.Color3=e;var b,d=function(a,b,d,c){this.r=a;this.g=b;this.b=d;this.a=c};b=(d.prototype.addInPlace=function(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this.a+=a.a,this},d.prototype.asArray=function(){var a=[];return this.toArray(a,0),a},d.prototype.toArray=function(a,b){return void 0===b&&(b=0),a[b]=this.r,a[b+1]=this.g,a[b+2]=this.b,a[b+3]=this.a,this},d.prototype.add=function(a){return new d(this.r+
a.r,this.g+a.g,this.b+a.b,this.a+a.a)},d.prototype.subtract=function(a){return new d(this.r-a.r,this.g-a.g,this.b-a.b,this.a-a.a)},d.prototype.subtractToRef=function(a,b){return b.r=this.r-a.r,b.g=this.g-a.g,b.b=this.b-a.b,b.a=this.a-a.a,this},d.prototype.scale=function(a){return new d(this.r*a,this.g*a,this.b*a,this.a*a)},d.prototype.scaleToRef=function(a,b){return b.r=this.r*a,b.g=this.g*a,b.b=this.b*a,b.a=this.a*a,this},d.prototype.multiply=function(a){return new d(this.r*a.r,this.g*a.g,this.b*
a.b,this.a*a.a)},d.prototype.multiplyToRef=function(a,b){return b.r=this.r*a.r,b.g=this.g*a.g,b.b=this.b*a.b,b.a=this.a*a.a,b},d.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},d.prototype.getClassName=function(){return"Color4"},d.prototype.getHashCode=function(){var a=this.r||0;return a=397*a^(this.g||0),a=397*a^(this.b||0),397*a^(this.a||0)},d.prototype.clone=function(){return new d(this.r,this.g,this.b,this.a)},d.prototype.copyFrom=function(a){return this.r=
a.r,this.g=a.g,this.b=a.b,this.a=a.a,this},d.prototype.toHexString=function(){var a=255*this.g|0,b=255*this.b|0,d=255*this.a|0;return"#"+f.ToHex(255*this.r|0)+f.ToHex(a)+f.ToHex(b)+f.ToHex(d)},d.FromHexString=function(a){if("#"!==a.substring(0,1)||9!==a.length)return new d(0,0,0,0);var b=parseInt(a.substring(1,3),16),c=parseInt(a.substring(3,5),16),h=parseInt(a.substring(5,7),16);a=parseInt(a.substring(7,9),16);return d.FromInts(b,c,h,a)},d.Lerp=function(a,b,c){var h=new d(0,0,0,0);return d.LerpToRef(a,
b,c,h),h},d.LerpToRef=function(a,b,d,c){c.r=a.r+(b.r-a.r)*d;c.g=a.g+(b.g-a.g)*d;c.b=a.b+(b.b-a.b)*d;c.a=a.a+(b.a-a.a)*d},d.FromArray=function(a,b){return void 0===b&&(b=0),new d(a[b],a[b+1],a[b+2],a[b+3])},d.FromInts=function(a,b,c,h){return new d(a/255,b/255,c/255,h/255)},d.CheckColors4=function(a,b){if(a.length===3*b){for(var d=[],c=0;c<a.length;c+=3){var h=4*(c/3);d[h]=a[c];d[h+1]=a[c+1];d[h+2]=a[c+2];d[h+3]=1}return d}return a},d);c.Color4=b;var j,g=function(a,b){this.x=a;this.y=b};j=(g.prototype.toString=
function(){return"{X: "+this.x+" Y:"+this.y+"}"},g.prototype.getClassName=function(){return"Vector2"},g.prototype.getHashCode=function(){return 397*(this.x||0)^(this.y||0)},g.prototype.toArray=function(a,b){return void 0===b&&(b=0),a[b]=this.x,a[b+1]=this.y,this},g.prototype.asArray=function(){var a=[];return this.toArray(a,0),a},g.prototype.copyFrom=function(a){return this.x=a.x,this.y=a.y,this},g.prototype.copyFromFloats=function(a,b){return this.x=a,this.y=b,this},g.prototype.add=function(a){return new g(this.x+
a.x,this.y+a.y)},g.prototype.addToRef=function(a,b){return b.x=this.x+a.x,b.y=this.y+a.y,this},g.prototype.addVector3=function(a){return new g(this.x+a.x,this.y+a.y)},g.prototype.subtract=function(a){return new g(this.x-a.x,this.y-a.y)},g.prototype.subtractToRef=function(a,b){return b.x=this.x-a.x,b.y=this.y-a.y,this},g.prototype.subtractInPlace=function(a){return this.x-=a.x,this.y-=a.y,this},g.prototype.multiplyInPlace=function(a){return this.x*=a.x,this.y*=a.y,this},g.prototype.multiply=function(a){return new g(this.x*
a.x,this.y*a.y)},g.prototype.multiplyToRef=function(a,b){return b.x=this.x*a.x,b.y=this.y*a.y,this},g.prototype.multiplyByFloats=function(a,b){return new g(this.x*a,this.y*b)},g.prototype.divide=function(a){return new g(this.x/a.x,this.y/a.y)},g.prototype.divideToRef=function(a,b){return b.x=this.x/a.x,b.y=this.y/a.y,this},g.prototype.negate=function(){return new g(-this.x,-this.y)},g.prototype.scaleInPlace=function(a){return this.x*=a,this.y*=a,this},g.prototype.scale=function(a){return new g(this.x*
a,this.y*a)},g.prototype.equals=function(a){return a&&this.x===a.x&&this.y===a.y},g.prototype.equalsWithEpsilon=function(a,b){return void 0===b&&(b=c.Epsilon),a&&f.WithinEpsilon(this.x,a.x,b)&&f.WithinEpsilon(this.y,a.y,b)},g.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},g.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},g.prototype.normalize=function(){var a=this.length();if(0===a)return this;a=1/a;return this.x*=a,this.y*=a,this},g.prototype.clone=
function(){return new g(this.x,this.y)},g.Zero=function(){return new g(0,0)},g.FromArray=function(a,b){return void 0===b&&(b=0),new g(a[b],a[b+1])},g.FromArrayToRef=function(a,b,d){d.x=a[b];d.y=a[b+1]},g.CatmullRom=function(a,b,d,c,h){var j=h*h,m=h*j;return new g(0.5*(2*b.x+(-a.x+d.x)*h+(2*a.x-5*b.x+4*d.x-c.x)*j+(-a.x+3*b.x-3*d.x+c.x)*m),0.5*(2*b.y+(-a.y+d.y)*h+(2*a.y-5*b.y+4*d.y-c.y)*j+(-a.y+3*b.y-3*d.y+c.y)*m))},g.Clamp=function(a,b,d){var c=a.x,c=c>d.x?d.x:c,c=c<b.x?b.x:c;a=a.y;return a=a>d.y?
d.y:a,a=a<b.y?b.y:a,new g(c,a)},g.Hermite=function(a,b,d,c,h){var j=h*h,m=h*j,e=2*m-3*j+1,k=-2*m+3*j;h=m-2*j+h;j=m-j;return new g(a.x*e+d.x*k+b.x*h+c.x*j,a.y*e+d.y*k+b.y*h+c.y*j)},g.Lerp=function(a,b,d){return new g(a.x+(b.x-a.x)*d,a.y+(b.y-a.y)*d)},g.Dot=function(a,b){return a.x*b.x+a.y*b.y},g.Normalize=function(a){a=a.clone();return a.normalize(),a},g.Minimize=function(a,b){return new g(a.x<b.x?a.x:b.x,a.y<b.y?a.y:b.y)},g.Maximize=function(a,b){return new g(a.x>b.x?a.x:b.x,a.y>b.y?a.y:b.y)},g.Transform=
function(a,b){var d=g.Zero();return g.TransformToRef(a,b,d),d},g.TransformToRef=function(a,b,d){var c=a.x*b.m[1]+a.y*b.m[5]+b.m[13];d.x=a.x*b.m[0]+a.y*b.m[4]+b.m[12];d.y=c},g.PointInTriangle=function(a,b,d,c){var h=0.5*(-d.y*c.x+b.y*(-d.x+c.x)+b.x*(d.y-c.y)+d.x*c.y),g=0>h?-1:1;c=(b.y*c.x-b.x*c.y+(c.y-b.y)*a.x+(b.x-c.x)*a.y)*g;a=(b.x*d.y-b.y*d.x+(b.y-d.y)*a.x+(d.x-b.x)*a.y)*g;return 0<c&&0<a&&2*h*g>c+a},g.Distance=function(a,b){return Math.sqrt(g.DistanceSquared(a,b))},g.DistanceSquared=function(a,
b){var d=a.x-b.x,c=a.y-b.y;return d*d+c*c},g.DistanceOfPointFromSegment=function(a,b,d){var c=g.DistanceSquared(b,d);if(0===c)return g.Distance(a,b);d=d.subtract(b);c=Math.max(0,Math.min(1,g.Dot(a.subtract(b),d)/c));b=b.add(d.multiplyByFloats(c,c));return g.Distance(a,b)},g);c.Vector2=j;var h,m=function(a,b,d){this.x=a;this.y=b;this.z=d};h=(m.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},m.prototype.getClassName=function(){return"Vector3"},m.prototype.getHashCode=
function(){var a=this.x||0;return a=397*a^(this.y||0),397*a^(this.z||0)},m.prototype.asArray=function(){var a=[];return this.toArray(a,0),a},m.prototype.toArray=function(a,b){return void 0===b&&(b=0),a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,this},m.prototype.toQuaternion=function(){var a=new p(0,0,0,1),b=Math.cos(0.5*(this.x+this.z)),d=Math.sin(0.5*(this.x+this.z)),c=Math.cos(0.5*(this.z-this.x)),h=Math.sin(0.5*(this.z-this.x)),g=Math.cos(0.5*this.y),j=Math.sin(0.5*this.y);return a.x=c*j,a.y=-h*j,
a.z=d*g,a.w=b*g,a},m.prototype.addInPlace=function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this},m.prototype.add=function(a){return new m(this.x+a.x,this.y+a.y,this.z+a.z)},m.prototype.addToRef=function(a,b){return b.x=this.x+a.x,b.y=this.y+a.y,b.z=this.z+a.z,this},m.prototype.subtractInPlace=function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this},m.prototype.subtract=function(a){return new m(this.x-a.x,this.y-a.y,this.z-a.z)},m.prototype.subtractToRef=function(a,b){return b.x=this.x-a.x,
b.y=this.y-a.y,b.z=this.z-a.z,this},m.prototype.subtractFromFloats=function(a,b,d){return new m(this.x-a,this.y-b,this.z-d)},m.prototype.subtractFromFloatsToRef=function(a,b,d,c){return c.x=this.x-a,c.y=this.y-b,c.z=this.z-d,this},m.prototype.negate=function(){return new m(-this.x,-this.y,-this.z)},m.prototype.scaleInPlace=function(a){return this.x*=a,this.y*=a,this.z*=a,this},m.prototype.scale=function(a){return new m(this.x*a,this.y*a,this.z*a)},m.prototype.scaleToRef=function(a,b){b.x=this.x*a;
b.y=this.y*a;b.z=this.z*a},m.prototype.equals=function(a){return a&&this.x===a.x&&this.y===a.y&&this.z===a.z},m.prototype.equalsWithEpsilon=function(a,b){return void 0===b&&(b=c.Epsilon),a&&f.WithinEpsilon(this.x,a.x,b)&&f.WithinEpsilon(this.y,a.y,b)&&f.WithinEpsilon(this.z,a.z,b)},m.prototype.equalsToFloats=function(a,b,d){return this.x===a&&this.y===b&&this.z===d},m.prototype.multiplyInPlace=function(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this},m.prototype.multiply=function(a){return new m(this.x*
a.x,this.y*a.y,this.z*a.z)},m.prototype.multiplyToRef=function(a,b){return b.x=this.x*a.x,b.y=this.y*a.y,b.z=this.z*a.z,this},m.prototype.multiplyByFloats=function(a,b,d){return new m(this.x*a,this.y*b,this.z*d)},m.prototype.divide=function(a){return new m(this.x/a.x,this.y/a.y,this.z/a.z)},m.prototype.divideToRef=function(a,b){return b.x=this.x/a.x,b.y=this.y/a.y,b.z=this.z/a.z,this},m.prototype.MinimizeInPlace=function(a){return a.x<this.x&&(this.x=a.x),a.y<this.y&&(this.y=a.y),a.z<this.z&&(this.z=
a.z),this},m.prototype.MaximizeInPlace=function(a){return a.x>this.x&&(this.x=a.x),a.y>this.y&&(this.y=a.y),a.z>this.z&&(this.z=a.z),this},m.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},m.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},m.prototype.normalize=function(){var a=this.length();if(0===a||1===a)return this;a=1/a;return this.x*=a,this.y*=a,this.z*=a,this},m.prototype.clone=function(){return new m(this.x,this.y,
this.z)},m.prototype.copyFrom=function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},m.prototype.copyFromFloats=function(a,b,d){return this.x=a,this.y=b,this.z=d,this},m.GetClipFactor=function(a,b,d,c){a=m.Dot(a,d)-c;b=m.Dot(b,d)-c;return a/(a-b)},m.FromArray=function(a,b){return b||(b=0),new m(a[b],a[b+1],a[b+2])},m.FromFloatArray=function(a,b){return b||(b=0),new m(a[b],a[b+1],a[b+2])},m.FromArrayToRef=function(a,b,d){d.x=a[b];d.y=a[b+1];d.z=a[b+2]},m.FromFloatArrayToRef=function(a,b,d){d.x=
a[b];d.y=a[b+1];d.z=a[b+2]},m.FromFloatsToRef=function(a,b,d,c){c.x=a;c.y=b;c.z=d},m.Zero=function(){return new m(0,0,0)},m.Up=function(){return new m(0,1,0)},m.TransformCoordinates=function(a,b){var d=m.Zero();return m.TransformCoordinatesToRef(a,b,d),d},m.TransformCoordinatesToRef=function(a,b,d){var c=a.x*b.m[1]+a.y*b.m[5]+a.z*b.m[9]+b.m[13],h=a.x*b.m[2]+a.y*b.m[6]+a.z*b.m[10]+b.m[14],g=a.x*b.m[3]+a.y*b.m[7]+a.z*b.m[11]+b.m[15];d.x=(a.x*b.m[0]+a.y*b.m[4]+a.z*b.m[8]+b.m[12])/g;d.y=c/g;d.z=h/g},
m.TransformCoordinatesFromFloatsToRef=function(a,b,d,c,h){var g=a*c.m[1]+b*c.m[5]+d*c.m[9]+c.m[13],j=a*c.m[2]+b*c.m[6]+d*c.m[10]+c.m[14],m=a*c.m[3]+b*c.m[7]+d*c.m[11]+c.m[15];h.x=(a*c.m[0]+b*c.m[4]+d*c.m[8]+c.m[12])/m;h.y=g/m;h.z=j/m},m.TransformNormal=function(a,b){var d=m.Zero();return m.TransformNormalToRef(a,b,d),d},m.TransformNormalToRef=function(a,b,d){d.x=a.x*b.m[0]+a.y*b.m[4]+a.z*b.m[8];d.y=a.x*b.m[1]+a.y*b.m[5]+a.z*b.m[9];d.z=a.x*b.m[2]+a.y*b.m[6]+a.z*b.m[10]},m.TransformNormalFromFloatsToRef=
function(a,b,d,c,h){h.x=a*c.m[0]+b*c.m[4]+d*c.m[8];h.y=a*c.m[1]+b*c.m[5]+d*c.m[9];h.z=a*c.m[2]+b*c.m[6]+d*c.m[10]},m.CatmullRom=function(a,b,d,c,h){var g=h*h,j=h*g;return new m(0.5*(2*b.x+(-a.x+d.x)*h+(2*a.x-5*b.x+4*d.x-c.x)*g+(-a.x+3*b.x-3*d.x+c.x)*j),0.5*(2*b.y+(-a.y+d.y)*h+(2*a.y-5*b.y+4*d.y-c.y)*g+(-a.y+3*b.y-3*d.y+c.y)*j),0.5*(2*b.z+(-a.z+d.z)*h+(2*a.z-5*b.z+4*d.z-c.z)*g+(-a.z+3*b.z-3*d.z+c.z)*j))},m.Clamp=function(a,b,d){var c=a.x,c=c>d.x?d.x:c,c=c<b.x?b.x:c,h=a.y,h=h>d.y?d.y:h,h=h<b.y?b.y:
h;a=a.z;return a=a>d.z?d.z:a,a=a<b.z?b.z:a,new m(c,h,a)},m.Hermite=function(a,b,d,c,h){var g=h*h,j=h*g,e=2*j-3*g+1,k=-2*j+3*g;h=j-2*g+h;g=j-g;return new m(a.x*e+d.x*k+b.x*h+c.x*g,a.y*e+d.y*k+b.y*h+c.y*g,a.z*e+d.z*k+b.z*h+c.z*g)},m.Lerp=function(a,b,d){return new m(a.x+(b.x-a.x)*d,a.y+(b.y-a.y)*d,a.z+(b.z-a.z)*d)},m.Dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},m.Cross=function(a,b){var d=m.Zero();return m.CrossToRef(a,b,d),d},m.CrossToRef=function(a,b,d){G.Vector3[0].x=a.y*b.z-a.z*b.y;G.Vector3[0].y=
a.z*b.x-a.x*b.z;G.Vector3[0].z=a.x*b.y-a.y*b.x;d.copyFrom(G.Vector3[0])},m.Normalize=function(a){var b=m.Zero();return m.NormalizeToRef(a,b),b},m.NormalizeToRef=function(a,b){b.copyFrom(a);b.normalize()},m.Project=function(a,b,d,c){var h=c.width,g=c.height;c=t.FromValues(h/2,0,0,0,0,-g/2,0,0,0,0,1,0,c.x+h/2,g/2+c.y,0,1);b=b.multiply(d).multiply(c);return m.TransformCoordinates(a,b)},m.UnprojectFromTransform=function(a,b,d,c,h){c=c.multiply(h);c.invert();a.x=2*(a.x/b)-1;a.y=-(2*(a.y/d)-1);b=m.TransformCoordinates(a,
c);a=a.x*c.m[3]+a.y*c.m[7]+a.z*c.m[11]+c.m[15];return f.WithinEpsilon(a,1)&&(b=b.scale(1/a)),b},m.Unproject=function(a,b,d,c,h,g){c=c.multiply(h).multiply(g);c.invert();b=new m(2*(a.x/b)-1,-(2*(a.y/d)-1),a.z);a=m.TransformCoordinates(b,c);b=b.x*c.m[3]+b.y*c.m[7]+b.z*c.m[11]+c.m[15];return f.WithinEpsilon(b,1)&&(a=a.scale(1/b)),a},m.Minimize=function(a,b){var d=a.clone();return d.MinimizeInPlace(b),d},m.Maximize=function(a,b){var d=a.clone();return d.MaximizeInPlace(b),d},m.Distance=function(a,b){return Math.sqrt(m.DistanceSquared(a,
b))},m.DistanceSquared=function(a,b){var d=a.x-b.x,c=a.y-b.y,h=a.z-b.z;return d*d+c*c+h*h},m.Center=function(a,b){var d=a.add(b);return d.scaleInPlace(0.5),d},m.RotationFromAxis=function(a,b,d){var c=m.Zero();return m.RotationFromAxisToRef(a,b,d,c),c},m.RotationFromAxisToRef=function(a,b,d,h){var g=a.normalize();d=d.normalize();a=B.X;b=B.Y;var j=0,e=0,k=0,l=e=0,n=0,q=0,j=-1,p=0,t=G.Vector3[0],r=0,s=G.Vector3[1];f.WithinEpsilon(d.z,0,c.Epsilon)?n=1:f.WithinEpsilon(d.x,0,c.Epsilon)?e=1:(q=d.z/d.x,e=
-q*Math.sqrt(1/(1+q*q)),n=Math.sqrt(1/(1+q*q)));s.x=e;s.y=l;s.z=n;s.normalize();m.CrossToRef(g,s,t);t.normalize();0>m.Dot(d,t)&&(j=1);r=m.Dot(g,s);r=Math.min(1,Math.max(-1,r));k=Math.acos(r)*j;0>m.Dot(s,a)&&(k=Math.PI+k,s=s.scaleInPlace(-1),p++);r=G.Vector3[2];g=G.Vector3[3];n=l=0;j=-1;f.WithinEpsilon(d.z,0,c.Epsilon)?e=1:(q=s.z/s.x,e=-q*Math.sqrt(1/(1+q*q)),n=Math.sqrt(1/(1+q*q)));r.x=e;r.y=l;r.z=n;r.normalize();m.CrossToRef(r,s,g);g.normalize();m.CrossToRef(d,r,t);t.normalize();0>m.Dot(s,t)&&(j=
1);r=m.Dot(d,r);r=Math.min(1,Math.max(-1,r));e=Math.acos(r)*j;0>m.Dot(g,b)&&(e=Math.PI+e,p++);j=-1;m.CrossToRef(a,s,t);t.normalize();0>m.Dot(t,b)&&(j=1);r=m.Dot(s,a);r=Math.min(1,Math.max(-1,r));j*=-Math.acos(r);0>r&&2>p&&(j=Math.PI+j);h.x=e;h.y=j;h.z=k},m);c.Vector3=h;var l,k=function(a,b,d,c){this.x=a;this.y=b;this.z=d;this.w=c};l=(k.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"W:"+this.w+"}"},k.prototype.getClassName=function(){return"Vector4"},k.prototype.getHashCode=
function(){var a=this.x||0;return a=397*a^(this.y||0),a=397*a^(this.z||0),397*a^(this.w||0)},k.prototype.asArray=function(){var a=[];return this.toArray(a,0),a},k.prototype.toArray=function(a,b){return void 0===b&&(b=0),a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a[b+3]=this.w,this},k.prototype.addInPlace=function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this},k.prototype.add=function(a){return new k(this.x+a.x,this.y+a.y,this.z+a.z,this.w+a.w)},k.prototype.addToRef=function(a,b){return b.x=
this.x+a.x,b.y=this.y+a.y,b.z=this.z+a.z,b.w=this.w+a.w,this},k.prototype.subtractInPlace=function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this},k.prototype.subtract=function(a){return new k(this.x-a.x,this.y-a.y,this.z-a.z,this.w-a.w)},k.prototype.subtractToRef=function(a,b){return b.x=this.x-a.x,b.y=this.y-a.y,b.z=this.z-a.z,b.w=this.w-a.w,this},k.prototype.subtractFromFloats=function(a,b,d,c){return new k(this.x-a,this.y-b,this.z-d,this.w-c)},k.prototype.subtractFromFloatsToRef=
function(a,b,d,c,h){return h.x=this.x-a,h.y=this.y-b,h.z=this.z-d,h.w=this.w-c,this},k.prototype.negate=function(){return new k(-this.x,-this.y,-this.z,-this.w)},k.prototype.scaleInPlace=function(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this},k.prototype.scale=function(a){return new k(this.x*a,this.y*a,this.z*a,this.w*a)},k.prototype.scaleToRef=function(a,b){b.x=this.x*a;b.y=this.y*a;b.z=this.z*a;b.w=this.w*a},k.prototype.equals=function(a){return a&&this.x===a.x&&this.y===a.y&&this.z===
a.z&&this.w===a.w},k.prototype.equalsWithEpsilon=function(a,b){return void 0===b&&(b=c.Epsilon),a&&f.WithinEpsilon(this.x,a.x,b)&&f.WithinEpsilon(this.y,a.y,b)&&f.WithinEpsilon(this.z,a.z,b)&&f.WithinEpsilon(this.w,a.w,b)},k.prototype.equalsToFloats=function(a,b,d,c){return this.x===a&&this.y===b&&this.z===d&&this.w===c},k.prototype.multiplyInPlace=function(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this.w*=a.w,this},k.prototype.multiply=function(a){return new k(this.x*a.x,this.y*a.y,this.z*a.z,
this.w*a.w)},k.prototype.multiplyToRef=function(a,b){return b.x=this.x*a.x,b.y=this.y*a.y,b.z=this.z*a.z,b.w=this.w*a.w,this},k.prototype.multiplyByFloats=function(a,b,d,c){return new k(this.x*a,this.y*b,this.z*d,this.w*c)},k.prototype.divide=function(a){return new k(this.x/a.x,this.y/a.y,this.z/a.z,this.w/a.w)},k.prototype.divideToRef=function(a,b){return b.x=this.x/a.x,b.y=this.y/a.y,b.z=this.z/a.z,b.w=this.w/a.w,this},k.prototype.MinimizeInPlace=function(a){return a.x<this.x&&(this.x=a.x),a.y<
this.y&&(this.y=a.y),a.z<this.z&&(this.z=a.z),a.w<this.w&&(this.w=a.w),this},k.prototype.MaximizeInPlace=function(a){return a.x>this.x&&(this.x=a.x),a.y>this.y&&(this.y=a.y),a.z>this.z&&(this.z=a.z),a.w>this.w&&(this.w=a.w),this},k.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},k.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},k.prototype.normalize=function(){var a=this.length();if(0===a)return this;
a=1/a;return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this},k.prototype.toVector3=function(){return new h(this.x,this.y,this.z)},k.prototype.clone=function(){return new k(this.x,this.y,this.z,this.w)},k.prototype.copyFrom=function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w,this},k.prototype.copyFromFloats=function(a,b,d,c){return this.x=a,this.y=b,this.z=d,this.w=c,this},k.FromArray=function(a,b){return b||(b=0),new k(a[b],a[b+1],a[b+2],a[b+3])},k.FromArrayToRef=function(a,b,d){d.x=a[b];
d.y=a[b+1];d.z=a[b+2];d.w=a[b+3]},k.FromFloatArrayToRef=function(a,b,d){d.x=a[b];d.y=a[b+1];d.z=a[b+2];d.w=a[b+3]},k.FromFloatsToRef=function(a,b,d,c,h){h.x=a;h.y=b;h.z=d;h.w=c},k.Zero=function(){return new k(0,0,0,0)},k.Normalize=function(a){var b=k.Zero();return k.NormalizeToRef(a,b),b},k.NormalizeToRef=function(a,b){b.copyFrom(a);b.normalize()},k.Minimize=function(a,b){var d=a.clone();return d.MinimizeInPlace(b),d},k.Maximize=function(a,b){var d=a.clone();return d.MaximizeInPlace(b),d},k.Distance=
function(a,b){return Math.sqrt(k.DistanceSquared(a,b))},k.DistanceSquared=function(a,b){var d=a.x-b.x,c=a.y-b.y,h=a.z-b.z,g=a.w-b.w;return d*d+c*c+h*h+g*g},k.Center=function(a,b){var d=a.add(b);return d.scaleInPlace(0.5),d},k);c.Vector4=l;var n,q=function(a,b){this.width=a;this.height=b};n=(q.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},q.prototype.getClassName=function(){return"Size"},q.prototype.getHashCode=function(){return 397*(this.width||0)^(this.height||0)},
q.prototype.copyFrom=function(a){this.width=a.width;this.height=a.height},q.prototype.clone=function(){return new q(this.width,this.height)},q.prototype.equals=function(a){return a?this.width===a.width&&this.height===a.height:!1},Object.defineProperty(q.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),q.Zero=function(){return new q(0,0)},q.prototype.add=function(a){return new q(this.width+a.width,this.height+a.height)},q.prototype.substract=function(a){return new q(this.width-
a.width,this.height-a.height)},q.Lerp=function(a,b,d){return new q(a.width+(b.width-a.width)*d,a.height+(b.height-a.height)*d)},q);c.Size=n;var p,r=function(a,b,d,c){void 0===a&&(a=0);void 0===b&&(b=0);void 0===d&&(d=0);void 0===c&&(c=1);this.x=a;this.y=b;this.z=d;this.w=c};p=(r.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},r.prototype.getClassName=function(){return"Quaternion"},r.prototype.getHashCode=function(){var a=this.x||0;return a=397*a^(this.y||
0),a=397*a^(this.z||0),397*a^(this.w||0)},r.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},r.prototype.equals=function(a){return a&&this.x===a.x&&this.y===a.y&&this.z===a.z&&this.w===a.w},r.prototype.clone=function(){return new r(this.x,this.y,this.z,this.w)},r.prototype.copyFrom=function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w,this},r.prototype.copyFromFloats=function(a,b,d,c){return this.x=a,this.y=b,this.z=d,this.w=c,this},r.prototype.add=function(a){return new r(this.x+
a.x,this.y+a.y,this.z+a.z,this.w+a.w)},r.prototype.subtract=function(a){return new r(this.x-a.x,this.y-a.y,this.z-a.z,this.w-a.w)},r.prototype.scale=function(a){return new r(this.x*a,this.y*a,this.z*a,this.w*a)},r.prototype.multiply=function(a){var b=new r(0,0,0,1);return this.multiplyToRef(a,b),b},r.prototype.multiplyToRef=function(a,b){return b.copyFromFloats(this.x*a.w+this.y*a.z-this.z*a.y+this.w*a.x,-this.x*a.z+this.y*a.w+this.z*a.x+this.w*a.y,this.x*a.y-this.y*a.x+this.z*a.w+this.w*a.z,-this.x*
a.x-this.y*a.y-this.z*a.z+this.w*a.w),this},r.prototype.multiplyInPlace=function(a){return this.multiplyToRef(a,this),this},r.prototype.conjugateToRef=function(a){return a.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},r.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},r.prototype.conjugate=function(){return new r(-this.x,-this.y,-this.z,this.w)},r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},r.prototype.normalize=
function(){var a=1/this.length();return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this},r.prototype.toEulerAngles=function(a){void 0===a&&(a="YZX");var b=h.Zero();return this.toEulerAnglesToRef(b,a),b},r.prototype.toEulerAnglesToRef=function(a,b){void 0===b&&(b="YZX");var d,c,h,g=this.x,j=this.y,m=this.z,e=this.w;switch(b){case "YZX":var k=g*j+m*e;if(0.499<k&&(d=2*Math.atan2(g,e),c=Math.PI/2,h=0),-0.499>k&&(d=-2*Math.atan2(g,e),c=-Math.PI/2,h=0),isNaN(d)){h=g*g;var l=m*m;d=Math.atan2(2*j*e-2*g*m,1-
2*j*j-2*l);c=Math.asin(2*k);h=Math.atan2(2*g*e-2*j*m,1-2*h-2*l)}break;default:throw Error("Euler order "+b+" not supported yet.");}return a.y=d,a.z=c,a.x=h,this},r.prototype.toRotationMatrix=function(a){var b=this.x*this.x,d=this.y*this.y,c=this.z*this.z,h=this.x*this.y,g=this.z*this.w,j=this.z*this.x,m=this.y*this.w,e=this.y*this.z,k=this.x*this.w;return a.m[0]=1-2*(d+c),a.m[1]=2*(h+g),a.m[2]=2*(j-m),a.m[3]=0,a.m[4]=2*(h-g),a.m[5]=1-2*(c+b),a.m[6]=2*(e+k),a.m[7]=0,a.m[8]=2*(j+m),a.m[9]=2*(e-k),a.m[10]=
1-2*(d+b),a.m[11]=0,a.m[12]=0,a.m[13]=0,a.m[14]=0,a.m[15]=1,this},r.prototype.fromRotationMatrix=function(a){return r.FromRotationMatrixToRef(a,this),this},r.FromRotationMatrix=function(a){var b=new r;return r.FromRotationMatrixToRef(a,b),b},r.FromRotationMatrixToRef=function(a,b){var d,c=a.m,h=c[0],g=c[4],j=c[8],m=c[1],e=c[5],k=c[9],l=c[2],n=c[6],c=c[10],f=h+e+c;0<f?(d=0.5/Math.sqrt(f+1),b.w=0.25/d,b.x=(n-k)*d,b.y=(j-l)*d,b.z=(m-g)*d):h>e&&h>c?(d=2*Math.sqrt(1+h-e-c),b.w=(n-k)/d,b.x=0.25*d,b.y=(g+
m)/d,b.z=(j+l)/d):e>c?(d=2*Math.sqrt(1+e-h-c),b.w=(j-l)/d,b.x=(g+m)/d,b.y=0.25*d,b.z=(k+n)/d):(d=2*Math.sqrt(1+c-h-e),b.w=(m-g)/d,b.x=(j+l)/d,b.y=(k+n)/d,b.z=0.25*d)},r.Inverse=function(a){return new r(-a.x,-a.y,-a.z,a.w)},r.Identity=function(){return new r(0,0,0,1)},r.RotationAxis=function(a,b){var d=new r,c=Math.sin(b/2);return a.normalize(),d.w=Math.cos(b/2),d.x=a.x*c,d.y=a.y*c,d.z=a.z*c,d},r.FromArray=function(a,b){return b||(b=0),new r(a[b],a[b+1],a[b+2],a[b+3])},r.RotationYawPitchRoll=function(a,
b,d){var c=new r;return r.RotationYawPitchRollToRef(a,b,d,c),c},r.RotationYawPitchRollToRef=function(a,b,d,c){d*=0.5;var h=0.5*b;b=0.5*a;a=Math.sin(d);d=Math.cos(d);var g=Math.sin(h),h=Math.cos(h),j=Math.sin(b);b=Math.cos(b);c.x=b*g*d+j*h*a;c.y=j*h*d-b*g*a;c.z=b*h*a-j*g*d;c.w=b*h*d+j*g*a},r.RotationAlphaBetaGamma=function(a,b,d){var c=new r;return r.RotationAlphaBetaGammaToRef(a,b,d,c),c},r.RotationAlphaBetaGammaToRef=function(a,b,d,c){var h=0.5*(d+a);a=0.5*(d-a);b*=0.5;c.x=Math.cos(a)*Math.sin(b);
c.y=Math.sin(a)*Math.sin(b);c.z=Math.sin(h)*Math.cos(b);c.w=Math.cos(h)*Math.cos(b)},r.Slerp=function(a,b,d){var c;c=a.x*b.x+a.y*b.y+a.z*b.z+a.w*b.w;var h=!1;if(0>c&&(h=!0,c=-c),0.999999<c)c=1-d,d=h?-d:d;else{var g=Math.acos(c),j=1/Math.sin(g);c=Math.sin((1-d)*g)*j;d=h?-Math.sin(d*g)*j:Math.sin(d*g)*j}return new r(c*a.x+d*b.x,c*a.y+d*b.y,c*a.z+d*b.z,c*a.w+d*b.w)},r);c.Quaternion=p;var t,s=function(){this.m=new Float32Array(16)};t=(s.prototype.isIdentity=function(){return 1!==this.m[0]||1!==this.m[5]||
1!==this.m[10]||1!==this.m[15]?!1:0===this.m[1]&&0===this.m[2]&&0===this.m[3]&&0===this.m[4]&&0===this.m[6]&&0===this.m[7]&&0===this.m[8]&&0===this.m[9]&&0===this.m[11]&&0===this.m[12]&&0===this.m[13]&&0===this.m[14]},s.prototype.determinant=function(){var a=this.m[10]*this.m[15]-this.m[11]*this.m[14],b=this.m[9]*this.m[15]-this.m[11]*this.m[13],d=this.m[9]*this.m[14]-this.m[10]*this.m[13],c=this.m[8]*this.m[15]-this.m[11]*this.m[12],h=this.m[8]*this.m[14]-this.m[10]*this.m[12],g=this.m[8]*this.m[13]-
this.m[9]*this.m[12];return this.m[0]*(this.m[5]*a-this.m[6]*b+this.m[7]*d)-this.m[1]*(this.m[4]*a-this.m[6]*c+this.m[7]*h)+this.m[2]*(this.m[4]*b-this.m[5]*c+this.m[7]*g)-this.m[3]*(this.m[4]*d-this.m[5]*h+this.m[6]*g)},s.prototype.toArray=function(){return this.m},s.prototype.asArray=function(){return this.toArray()},s.prototype.invert=function(){return this.invertToRef(this),this},s.prototype.reset=function(){for(var a=0;16>a;a++)this.m[a]=0;return this},s.prototype.add=function(a){var b=new s;
return this.addToRef(a,b),b},s.prototype.addToRef=function(a,b){for(var d=0;16>d;d++)b.m[d]=this.m[d]+a.m[d];return this},s.prototype.addToSelf=function(a){for(var b=0;16>b;b++)this.m[b]+=a.m[b];return this},s.prototype.invertToRef=function(a){var b=this.m[0],d=this.m[1],c=this.m[2],h=this.m[3],g=this.m[4],j=this.m[5],m=this.m[6],e=this.m[7],k=this.m[8],l=this.m[9],n=this.m[10],f=this.m[11],q=this.m[12],p=this.m[13],t=this.m[14],r=this.m[15],s=n*r-f*t,u=l*r-f*p,v=l*t-n*p,w=k*r-f*q,x=k*t-n*q,B=k*p-
l*q,y=j*s-m*u+e*v,A=-(g*s-m*w+e*x),C=g*u-j*w+e*B,D=-(g*v-j*x+m*B),z=1/(b*y+d*A+c*C+h*D),I=m*r-e*t,E=j*r-e*p,F=j*t-m*p,r=g*r-e*q,t=g*t-m*q,q=g*p-j*q,p=m*f-e*n,J=j*f-e*l,G=j*n-m*l,e=g*f-e*k,m=g*n-m*k,g=g*l-j*k;return a.m[0]=y*z,a.m[4]=A*z,a.m[8]=C*z,a.m[12]=D*z,a.m[1]=-(d*s-c*u+h*v)*z,a.m[5]=(b*s-c*w+h*x)*z,a.m[9]=-(b*u-d*w+h*B)*z,a.m[13]=(b*v-d*x+c*B)*z,a.m[2]=(d*I-c*E+h*F)*z,a.m[6]=-(b*I-c*r+h*t)*z,a.m[10]=(b*E-d*r+h*q)*z,a.m[14]=-(b*F-d*t+c*q)*z,a.m[3]=-(d*p-c*J+h*G)*z,a.m[7]=(b*p-c*e+h*m)*z,a.m[11]=
-(b*J-d*e+h*g)*z,a.m[15]=(b*G-d*m+c*g)*z,this},s.prototype.setTranslation=function(a){return this.m[12]=a.x,this.m[13]=a.y,this.m[14]=a.z,this},s.prototype.getTranslation=function(){return new h(this.m[12],this.m[13],this.m[14])},s.prototype.multiply=function(a){var b=new s;return this.multiplyToRef(a,b),b},s.prototype.copyFrom=function(a){for(var b=0;16>b;b++)this.m[b]=a.m[b];return this},s.prototype.copyToArray=function(a,b){void 0===b&&(b=0);for(var d=0;16>d;d++)a[b+d]=this.m[d];return this},s.prototype.multiplyToRef=
function(a,b){return this.multiplyToArray(a,b.m,0),this},s.prototype.multiplyToArray=function(a,b,d){var c=this.m[0],h=this.m[1],g=this.m[2],j=this.m[3],m=this.m[4],e=this.m[5],k=this.m[6],l=this.m[7],n=this.m[8],f=this.m[9],q=this.m[10],p=this.m[11],t=this.m[12],r=this.m[13],s=this.m[14],u=this.m[15],v=a.m[0],w=a.m[1],x=a.m[2],B=a.m[3],y=a.m[4],A=a.m[5],C=a.m[6],D=a.m[7],z=a.m[8],I=a.m[9],E=a.m[10],F=a.m[11],J=a.m[12],G=a.m[13],Q=a.m[14];a=a.m[15];return b[d]=c*v+h*y+g*z+j*J,b[d+1]=c*w+h*A+g*I+j*
G,b[d+2]=c*x+h*C+g*E+j*Q,b[d+3]=c*B+h*D+g*F+j*a,b[d+4]=m*v+e*y+k*z+l*J,b[d+5]=m*w+e*A+k*I+l*G,b[d+6]=m*x+e*C+k*E+l*Q,b[d+7]=m*B+e*D+k*F+l*a,b[d+8]=n*v+f*y+q*z+p*J,b[d+9]=n*w+f*A+q*I+p*G,b[d+10]=n*x+f*C+q*E+p*Q,b[d+11]=n*B+f*D+q*F+p*a,b[d+12]=t*v+r*y+s*z+u*J,b[d+13]=t*w+r*A+s*I+u*G,b[d+14]=t*x+r*C+s*E+u*Q,b[d+15]=t*B+r*D+s*F+u*a,this},s.prototype.equals=function(a){return a&&this.m[0]===a.m[0]&&this.m[1]===a.m[1]&&this.m[2]===a.m[2]&&this.m[3]===a.m[3]&&this.m[4]===a.m[4]&&this.m[5]===a.m[5]&&this.m[6]===
a.m[6]&&this.m[7]===a.m[7]&&this.m[8]===a.m[8]&&this.m[9]===a.m[9]&&this.m[10]===a.m[10]&&this.m[11]===a.m[11]&&this.m[12]===a.m[12]&&this.m[13]===a.m[13]&&this.m[14]===a.m[14]&&this.m[15]===a.m[15]},s.prototype.clone=function(){return s.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},s.prototype.getClassName=function(){return"Matrix"},s.prototype.getHashCode=function(){for(var a=
this.m[0]||0,b=1;16>b;b++)a=397*a^(this.m[b]||0);return a},s.prototype.decompose=function(a,b,d){d.x=this.m[12];d.y=this.m[13];d.z=this.m[14];d=0>f.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])?-1:1;var c=0>f.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])?-1:1,h=0>f.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])?-1:1;if(a.x=d*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),a.y=c*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),a.z=h*Math.sqrt(this.m[8]*
this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===a.x||0===a.y||0===a.z)return b.x=0,b.y=0,b.z=0,b.w=1,!1;a=s.FromValues(this.m[0]/a.x,this.m[1]/a.x,this.m[2]/a.x,0,this.m[4]/a.y,this.m[5]/a.y,this.m[6]/a.y,0,this.m[8]/a.z,this.m[9]/a.z,this.m[10]/a.z,0,0,0,0,1);return p.FromRotationMatrixToRef(a,b),!0},s.FromArray=function(a,b){var d=new s;return b||(b=0),s.FromArrayToRef(a,b,d),d},s.FromArrayToRef=function(a,b,d){for(var c=0;16>c;c++)d.m[c]=a[c+b]},s.FromFloat32ArrayToRefScaled=function(a,
b,d,c){for(var h=0;16>h;h++)c.m[h]=a[h+b]*d},s.FromValuesToRef=function(a,b,d,c,h,g,j,m,e,k,l,n,f,q,p,t,r){r.m[0]=a;r.m[1]=b;r.m[2]=d;r.m[3]=c;r.m[4]=h;r.m[5]=g;r.m[6]=j;r.m[7]=m;r.m[8]=e;r.m[9]=k;r.m[10]=l;r.m[11]=n;r.m[12]=f;r.m[13]=q;r.m[14]=p;r.m[15]=t},s.prototype.getRow=function(a){if(0>a||3<a)return null;a*=4;return new l(this.m[a+0],this.m[a+1],this.m[a+2],this.m[a+3])},s.prototype.setRow=function(a,b){if(0>a||3<a)return this;var d=4*a;return this.m[d+0]=b.x,this.m[d+1]=b.y,this.m[d+2]=b.z,
this.m[d+3]=b.w,this},s.FromValues=function(a,b,d,c,h,g,j,m,e,k,l,n,f,q,p,t){var r=new s;return r.m[0]=a,r.m[1]=b,r.m[2]=d,r.m[3]=c,r.m[4]=h,r.m[5]=g,r.m[6]=j,r.m[7]=m,r.m[8]=e,r.m[9]=k,r.m[10]=l,r.m[11]=n,r.m[12]=f,r.m[13]=q,r.m[14]=p,r.m[15]=t,r},s.Compose=function(a,b,d){a=s.FromValues(a.x,0,0,0,0,a.y,0,0,0,0,a.z,0,0,0,0,1);var c=s.Identity();return b.toRotationMatrix(c),a=a.multiply(c),a.setTranslation(d),a},s.Identity=function(){return s.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},s.IdentityToRef=
function(a){s.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,a)},s.Zero=function(){return s.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},s.RotationX=function(a){var b=new s;return s.RotationXToRef(a,b),b},s.Invert=function(a){var b=new s;return a.invertToRef(b),b},s.RotationXToRef=function(a,b){var d=Math.sin(a),c=Math.cos(a);b.m[0]=1;b.m[15]=1;b.m[5]=c;b.m[10]=c;b.m[9]=-d;b.m[6]=d;b.m[1]=0;b.m[2]=0;b.m[3]=0;b.m[4]=0;b.m[7]=0;b.m[8]=0;b.m[11]=0;b.m[12]=0;b.m[13]=0;b.m[14]=0},s.RotationY=function(a){var b=
new s;return s.RotationYToRef(a,b),b},s.RotationYToRef=function(a,b){var d=Math.sin(a),c=Math.cos(a);b.m[5]=1;b.m[15]=1;b.m[0]=c;b.m[2]=-d;b.m[8]=d;b.m[10]=c;b.m[1]=0;b.m[3]=0;b.m[4]=0;b.m[6]=0;b.m[7]=0;b.m[9]=0;b.m[11]=0;b.m[12]=0;b.m[13]=0;b.m[14]=0},s.RotationZ=function(a){var b=new s;return s.RotationZToRef(a,b),b},s.RotationZToRef=function(a,b){var d=Math.sin(a),c=Math.cos(a);b.m[10]=1;b.m[15]=1;b.m[0]=c;b.m[1]=d;b.m[4]=-d;b.m[5]=c;b.m[2]=0;b.m[3]=0;b.m[6]=0;b.m[7]=0;b.m[8]=0;b.m[9]=0;b.m[11]=
0;b.m[12]=0;b.m[13]=0;b.m[14]=0},s.RotationAxis=function(a,b){var d=s.Zero();return s.RotationAxisToRef(a,b,d),d},s.RotationAxisToRef=function(a,b,d){var c=Math.sin(-b);b=Math.cos(-b);var h=1-b;a.normalize();d.m[0]=a.x*a.x*h+b;d.m[1]=a.x*a.y*h-a.z*c;d.m[2]=a.x*a.z*h+a.y*c;d.m[3]=0;d.m[4]=a.y*a.x*h+a.z*c;d.m[5]=a.y*a.y*h+b;d.m[6]=a.y*a.z*h-a.x*c;d.m[7]=0;d.m[8]=a.z*a.x*h-a.y*c;d.m[9]=a.z*a.y*h+a.x*c;d.m[10]=a.z*a.z*h+b;d.m[11]=0;d.m[15]=1},s.RotationYawPitchRoll=function(a,b,d){var c=new s;return s.RotationYawPitchRollToRef(a,
b,d,c),c},s.RotationYawPitchRollToRef=function(a,b,d,c){p.RotationYawPitchRollToRef(a,b,d,this._tempQuaternion);this._tempQuaternion.toRotationMatrix(c)},s.Scaling=function(a,b,d){var c=s.Zero();return s.ScalingToRef(a,b,d,c),c},s.ScalingToRef=function(a,b,d,c){c.m[0]=a;c.m[1]=0;c.m[2]=0;c.m[3]=0;c.m[4]=0;c.m[5]=b;c.m[6]=0;c.m[7]=0;c.m[8]=0;c.m[9]=0;c.m[10]=d;c.m[11]=0;c.m[12]=0;c.m[13]=0;c.m[14]=0;c.m[15]=1},s.Translation=function(a,b,d){var c=s.Identity();return s.TranslationToRef(a,b,d,c),c},s.TranslationToRef=
function(a,b,d,c){s.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,a,b,d,1,c)},s.Lerp=function(a,b,d){for(var c=s.Zero(),h=0;16>h;h++)c.m[h]=a.m[h]*(1-d)+b.m[h]*d;return c},s.DecomposeLerp=function(a,b,d){var c=new h(0,0,0),g=new p,j=new h(0,0,0);a.decompose(c,g,j);var m=new h(0,0,0),e=new p;a=new h(0,0,0);b.decompose(m,e,a);b=h.Lerp(c,m,d);g=p.Slerp(g,e,d);d=h.Lerp(j,a,d);return s.Compose(b,g,d)},s.LookAtLH=function(a,b,d){var c=s.Zero();return s.LookAtLHToRef(a,b,d,c),c},s.LookAtLHToRef=function(a,b,d,
c){b.subtractToRef(a,this._zAxis);this._zAxis.normalize();h.CrossToRef(d,this._zAxis,this._xAxis);0===this._xAxis.lengthSquared()?this._xAxis.x=1:this._xAxis.normalize();h.CrossToRef(this._zAxis,this._xAxis,this._yAxis);this._yAxis.normalize();b=-h.Dot(this._xAxis,a);d=-h.Dot(this._yAxis,a);a=-h.Dot(this._zAxis,a);return s.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,b,d,a,1,c)},s.OrthoLH=function(a,
b,d,c){var h=s.Zero();return s.OrthoLHToRef(a,b,d,c,h),h},s.OrthoLHToRef=function(a,b,d,c,h){s.FromValuesToRef(2/a,0,0,0,0,2/b,0,0,0,0,1/(c-d),0,0,0,d/(d-c),1,h)},s.OrthoOffCenterLH=function(a,b,d,c,h,g){var j=s.Zero();return s.OrthoOffCenterLHToRef(a,b,d,c,h,g,j),j},s.OrthoOffCenterLHToRef=function(a,b,d,c,h,g,j){j.m[0]=2/(b-a);j.m[1]=j.m[2]=j.m[3]=0;j.m[5]=2/(c-d);j.m[4]=j.m[6]=j.m[7]=0;j.m[10]=-1/(h-g);j.m[8]=j.m[9]=j.m[11]=0;j.m[12]=(a+b)/(a-b);j.m[13]=(c+d)/(d-c);j.m[14]=h/(h-g);j.m[15]=1},s.PerspectiveLH=
function(a,b,d,c){var h=s.Zero();return h.m[0]=2*d/a,h.m[1]=h.m[2]=h.m[3]=0,h.m[5]=2*d/b,h.m[4]=h.m[6]=h.m[7]=0,h.m[10]=-c/(d-c),h.m[8]=h.m[9]=0,h.m[11]=1,h.m[12]=h.m[13]=h.m[15]=0,h.m[14]=d*c/(d-c),h},s.PerspectiveFovLH=function(a,b,d,c){var h=s.Zero();return s.PerspectiveFovLHToRef(a,b,d,c,h),h},s.PerspectiveFovLHToRef=function(a,b,d,c,h,g){void 0===g&&(g=!0);a=1/Math.tan(0.5*a);g?h.m[0]=a/b:h.m[0]=a;h.m[1]=h.m[2]=h.m[3]=0;g?h.m[5]=a:h.m[5]=a*b;h.m[4]=h.m[6]=h.m[7]=0;h.m[8]=h.m[9]=0;h.m[10]=-c/
(d-c);h.m[11]=1;h.m[12]=h.m[13]=h.m[15]=0;h.m[14]=d*c/(d-c)},s.GetFinalMatrix=function(a,b,d,c,h,g){var j=a.width,m=a.height;a=s.FromValues(j/2,0,0,0,0,-m/2,0,0,0,0,g-h,0,a.x+j/2,m/2+a.y,h,1);return b.multiply(d).multiply(c).multiply(a)},s.GetAsMatrix2x2=function(a){return new Float32Array([a.m[0],a.m[1],a.m[4],a.m[5]])},s.GetAsMatrix3x3=function(a){return new Float32Array([a.m[0],a.m[1],a.m[2],a.m[4],a.m[5],a.m[6],a.m[8],a.m[9],a.m[10]])},s.Transpose=function(a){var b=new s;return b.m[0]=a.m[0],
b.m[1]=a.m[4],b.m[2]=a.m[8],b.m[3]=a.m[12],b.m[4]=a.m[1],b.m[5]=a.m[5],b.m[6]=a.m[9],b.m[7]=a.m[13],b.m[8]=a.m[2],b.m[9]=a.m[6],b.m[10]=a.m[10],b.m[11]=a.m[14],b.m[12]=a.m[3],b.m[13]=a.m[7],b.m[14]=a.m[11],b.m[15]=a.m[15],b},s.Reflection=function(a){var b=new s;return s.ReflectionToRef(a,b),b},s.ReflectionToRef=function(a,b){a.normalize();var d=a.normal.x,c=a.normal.y,h=a.normal.z,g=-2*d,j=-2*c,m=-2*h;b.m[0]=g*d+1;b.m[1]=j*d;b.m[2]=m*d;b.m[3]=0;b.m[4]=g*c;b.m[5]=j*c+1;b.m[6]=m*c;b.m[7]=0;b.m[8]=g*
h;b.m[9]=j*h;b.m[10]=m*h+1;b.m[11]=0;b.m[12]=g*a.d;b.m[13]=j*a.d;b.m[14]=m*a.d;b.m[15]=1},s._tempQuaternion=new p,s._xAxis=h.Zero(),s._yAxis=h.Zero(),s._zAxis=h.Zero(),s);c.Matrix=t;var u,v=function(a,b,d,c){this.normal=new h(a,b,d);this.d=c};u=(v.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},v.prototype.clone=function(){return new v(this.normal.x,this.normal.y,this.normal.z,this.d)},v.prototype.getClassName=function(){return"Plane"},v.prototype.getHashCode=
function(){return 397*this.normal.getHashCode()^(this.d||0)},v.prototype.normalize=function(){var a=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),b=0;return 0!==a&&(b=1/a),this.normal.x*=b,this.normal.y*=b,this.normal.z*=b,this.d*=b,this},v.prototype.transform=function(a){a=t.Transpose(a);var b=this.normal.x,d=this.normal.y,c=this.normal.z,h=this.d;return new v(b*a.m[0]+d*a.m[1]+c*a.m[2]+h*a.m[3],b*a.m[4]+d*a.m[5]+c*a.m[6]+h*a.m[7],b*a.m[8]+d*a.m[9]+
c*a.m[10]+h*a.m[11],b*a.m[12]+d*a.m[13]+c*a.m[14]+h*a.m[15])},v.prototype.dotCoordinate=function(a){return this.normal.x*a.x+this.normal.y*a.y+this.normal.z*a.z+this.d},v.prototype.copyFromPoints=function(a,b,d){var c,h=b.x-a.x,g=b.y-a.y,j=b.z-a.z;b=d.x-a.x;var m=d.y-a.y,e=d.z-a.z;d=g*e-j*m;j=j*b-h*e;h=h*m-g*b;g=Math.sqrt(d*d+j*j+h*h);return c=0!==g?1/g:0,this.normal.x=d*c,this.normal.y=j*c,this.normal.z=h*c,this.d=-(this.normal.x*a.x+this.normal.y*a.y+this.normal.z*a.z),this},v.prototype.isFrontFacingTo=
function(a,b){var d=h.Dot(this.normal,a);return b>=d},v.prototype.signedDistanceTo=function(a){return h.Dot(a,this.normal)+this.d},v.FromArray=function(a){return new v(a[0],a[1],a[2],a[3])},v.FromPoints=function(a,b,d){var c=new v(0,0,0,0);return c.copyFromPoints(a,b,d),c},v.FromPositionAndNormal=function(a,b){var d=new v(0,0,0,0);return b.normalize(),d.normal=b,d.d=-(b.x*a.x+b.y*a.y+b.z*a.z),d},v.SignedDistanceToPlaneFromPositionAndNormal=function(a,b,d){a=-(b.x*a.x+b.y*a.y+b.z*a.z);return h.Dot(d,
b)+a},v);c.Plane=u;var w=function(a,b,d,c){this.x=a;this.y=b;this.width=d;this.height=c};n=(w.prototype.toGlobal=function(a,b){return new w(this.x*a,this.y*b,this.width*a,this.height*b)},w);c.Viewport=n;var x=function(){};n=(x.GetPlanes=function(a){for(var b=[],d=0;6>d;d++)b.push(new u(0,0,0,0));return x.GetPlanesToRef(a,b),b},x.GetPlanesToRef=function(a,b){b[0].normal.x=a.m[3]+a.m[2];b[0].normal.y=a.m[7]+a.m[6];b[0].normal.z=a.m[11]+a.m[10];b[0].d=a.m[15]+a.m[14];b[0].normalize();b[1].normal.x=a.m[3]-
a.m[2];b[1].normal.y=a.m[7]-a.m[6];b[1].normal.z=a.m[11]-a.m[10];b[1].d=a.m[15]-a.m[14];b[1].normalize();b[2].normal.x=a.m[3]+a.m[0];b[2].normal.y=a.m[7]+a.m[4];b[2].normal.z=a.m[11]+a.m[8];b[2].d=a.m[15]+a.m[12];b[2].normalize();b[3].normal.x=a.m[3]-a.m[0];b[3].normal.y=a.m[7]-a.m[4];b[3].normal.z=a.m[11]-a.m[8];b[3].d=a.m[15]-a.m[12];b[3].normalize();b[4].normal.x=a.m[3]-a.m[1];b[4].normal.y=a.m[7]-a.m[5];b[4].normal.z=a.m[11]-a.m[9];b[4].d=a.m[15]-a.m[13];b[4].normalize();b[5].normal.x=a.m[3]+
a.m[1];b[5].normal.y=a.m[7]+a.m[5];b[5].normal.z=a.m[11]+a.m[9];b[5].d=a.m[15]+a.m[13];b[5].normalize()},x);c.Frustum=n;n=c.Space||(c.Space={});n[n.LOCAL=0]="LOCAL";n[n.WORLD=1]="WORLD";c.Space;n=function(){};var B=(n.X=new h(1,0,0),n.Y=new h(0,1,0),n.Z=new h(0,0,1),n);c.Axis=B;n=function(){};n=(n.interpolate=function(a,b,d,c,h){var g=1-3*c+3*b;c=3*c-6*b;b*=3;for(var j=a,m=0;5>m;m++)var e=j*j,j=j-(g*e*j+c*e+b*j-a)*(1/(3*g*e+2*c*j+b)),j=Math.min(1,Math.max(0,j));return 3*Math.pow(1-j,2)*j*d+3*(1-j)*
Math.pow(j,2)*h+Math.pow(j,3)},n);c.BezierCurve=n;n=c.Orientation||(c.Orientation={});n[n.CW=0]="CW";n[n.CCW=1]="CCW";var y=c.Orientation,C,D=function(a){var b=this;this.degrees=function(){return 180*b._radians/Math.PI};this.radians=function(){return b._radians};this._radians=a;0>this._radians&&(this._radians+=2*Math.PI)};C=(D.BetweenTwoPoints=function(a,b){var d=b.subtract(a),d=Math.atan2(d.y,d.x);return new D(d)},D.FromRadians=function(a){return new D(a)},D.FromDegrees=function(a){return new D(a*
Math.PI/180)},D);c.Angle=C;var A;A=function(a,b,d){this.startPoint=a;this.midPoint=b;this.endPoint=d;var c=Math.pow(b.x,2)+Math.pow(b.y,2),h=(Math.pow(a.x,2)+Math.pow(a.y,2)-c)/2,c=(c-Math.pow(d.x,2)-Math.pow(d.y,2))/2,g=(a.x-b.x)*(b.y-d.y)-(b.x-d.x)*(a.y-b.y);this.centerPoint=new j((h*(b.y-d.y)-c*(a.y-b.y))/g,((a.x-b.x)*c-(b.x-d.x)*h)/g);this.radius=this.centerPoint.subtract(this.startPoint).length();this.startAngle=C.BetweenTwoPoints(this.centerPoint,this.startPoint);a=this.startAngle.degrees();
b=C.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees();d=C.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();180<b-a&&(b-=360);-180>b-a&&(b+=360);180<d-b&&(d-=360);-180>d-b&&(d+=360);this.orientation=0>b-a?y.CW:y.CCW;this.angle=C.FromDegrees(this.orientation===y.CW?a-d:d-a)};c.Arc2=A;var I=function(a,b){this._points=[];this._length=0;this.closed=!1;this._points.push(new j(a,b))};n=(I.prototype.addLineTo=function(a,b){if(closed)return this;var d=new j(a,b),c=this._points[this._points.length-
1];return this._points.push(d),this._length+=d.subtract(c).length(),this},I.prototype.addArcTo=function(a,b,d,c,h){if(void 0===h&&(h=36),closed)return this;var g=this._points[this._points.length-1];a=new j(a,b);d=new j(d,c);g=new A(g,a,d);d=g.angle.radians()/h;g.orientation===y.CW&&(d*=-1);c=g.startAngle.radians()+d;for(a=0;h>a;a++){b=Math.cos(c)*g.radius+g.centerPoint.x;var m=Math.sin(c)*g.radius+g.centerPoint.y;this.addLineTo(b,m);c+=d}return this},I.prototype.close=function(){return this.closed=
!0,this},I.prototype.length=function(){var a=this._length;this.closed||(a+=this._points[0].subtract(this._points[this._points.length-1]).length());return a},I.prototype.getPoints=function(){return this._points},I.prototype.getPointAtLengthPosition=function(a){if(0>a||1<a)return j.Zero();for(var b=a*this.length(),d=0,c=0;c<this._points.length;c++){a=this._points[c];var h=this._points[(c+1)%this._points.length].subtract(a),g=h.length()+d;if(b>=d&&g>=b)return c=h.normalize(),b-=d,new j(a.x+c.x*b,a.y+
c.y*b);d=g}return j.Zero()},I.StartingAt=function(a,b){return new I(a,b)},I);c.Path2=n;n=function(a,b,d){this.path=a;this._curve=[];this._distances=[];this._tangents=[];this._normals=[];this._binormals=[];for(var c=0;c<a.length;c++)this._curve[c]=a[c].clone();this._raw=d||!1;this._compute(b)};n=(n.prototype.getCurve=function(){return this._curve},n.prototype.getTangents=function(){return this._tangents},n.prototype.getNormals=function(){return this._normals},n.prototype.getBinormals=function(){return this._binormals},
n.prototype.getDistances=function(){return this._distances},n.prototype.update=function(a,b){for(var d=0;d<a.length;d++)this._curve[d].x=a[d].x,this._curve[d].y=a[d].y,this._curve[d].z=a[d].z;return this._compute(b),this},n.prototype._compute=function(a){var b=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0);this._raw||this._tangents[0].normalize();this._tangents[b-1]=this._curve[b-1].subtract(this._curve[b-2]);this._raw||this._tangents[b-1].normalize();var d=this._tangents[0];
a=this._normalVector(this._curve[0],d,a);this._normals[0]=a;this._raw||this._normals[0].normalize();this._binormals[0]=h.Cross(d,this._normals[0]);this._raw||this._binormals[0].normalize();this._distances[0]=0;for(var c,g,d=1;b>d;d++)a=this._getLastNonNullVector(d),b-1>d&&(c=this._getFirstNonNullVector(d),this._tangents[d]=a.add(c),this._tangents[d].normalize()),this._distances[d]=this._distances[d-1]+a.length(),a=this._tangents[d],g=this._binormals[d-1],this._normals[d]=h.Cross(g,a),this._raw||this._normals[d].normalize(),
this._binormals[d]=h.Cross(a,this._normals[d]),this._raw||this._binormals[d].normalize()},n.prototype._getFirstNonNullVector=function(a){for(var b=1,d=this._curve[a+b].subtract(this._curve[a]);0===d.length()&&a+b+1<this._curve.length;)b++,d=this._curve[a+b].subtract(this._curve[a]);return d},n.prototype._getLastNonNullVector=function(a){for(var b=1,d=this._curve[a].subtract(this._curve[a-b]);0===d.length()&&a>b+1;)b++,d=this._curve[a].subtract(this._curve[a-b]);return d},n.prototype._normalVector=
function(a,b,d){if(void 0===d||null===d){var g;f.WithinEpsilon(b.y,1,c.Epsilon)?f.WithinEpsilon(b.x,1,c.Epsilon)?f.WithinEpsilon(b.z,1,c.Epsilon)||(g=new h(0,0,1)):g=new h(1,0,0):g=new h(0,-1,0);a=h.Cross(b,g)}else a=h.Cross(b,d),h.CrossToRef(a,b,a);return a.normalize(),a},n);c.Path3D=n;var z=function(a){this._length=0;this._points=a;this._length=this._computeLength(a)};n=(z.CreateQuadraticBezier=function(a,b,d,c){c=2<c?c:3;for(var g=[],j=0;c>=j;j++)g.push(new h((1-j/c)*(1-j/c)*a.x+2*(j/c)*(1-j/c)*
b.x+j/c*(j/c)*d.x,(1-j/c)*(1-j/c)*a.y+2*(j/c)*(1-j/c)*b.y+j/c*(j/c)*d.y,(1-j/c)*(1-j/c)*a.z+2*(j/c)*(1-j/c)*b.z+j/c*(j/c)*d.z));return new z(g)},z.CreateCubicBezier=function(a,b,d,c,g){g=3<g?g:4;for(var j=[],m=function(a,b,d,c,h){return(1-a)*(1-a)*(1-a)*b+3*a*(1-a)*(1-a)*d+3*a*a*(1-a)*c+a*a*a*h},e=0;g>=e;e++)j.push(new h(m(e/g,a.x,b.x,d.x,c.x),m(e/g,a.y,b.y,d.y,c.y),m(e/g,a.z,b.z,d.z,c.z)));return new z(j)},z.CreateHermiteSpline=function(a,b,d,c,g){for(var j=[],m=1/g,e=0;g>=e;e++)j.push(h.Hermite(a,
b,d,c,e*m));return new z(j)},z.prototype.getPoints=function(){return this._points},z.prototype.length=function(){return this._length},z.prototype["continue"]=function(a){var b=this._points[this._points.length-1],d=this._points.slice();a=a.getPoints();for(var c=1;c<a.length;c++)d.push(a[c].subtract(a[0]).add(b));return new z(d)},z.prototype._computeLength=function(a){for(var b=0,d=1;d<a.length;d++)b+=a[d].subtract(a[d-1]).length();return b},z);c.Curve3=n;n=function(){this.L00=h.Zero();this.L1_1=h.Zero();
this.L10=h.Zero();this.L11=h.Zero();this.L2_2=h.Zero();this.L2_1=h.Zero();this.L20=h.Zero();this.L21=h.Zero();this.L22=h.Zero()};n=(n.prototype.addLight=function(a,b,d){b=(new h(b.r,b.g,b.b)).scale(d);this.L00=this.L00.add(b.scale(0.282095));this.L1_1=this.L1_1.add(b.scale(0.488603*a.y));this.L10=this.L10.add(b.scale(0.488603*a.z));this.L11=this.L11.add(b.scale(0.488603*a.x));this.L2_2=this.L2_2.add(b.scale(1.092548*a.x*a.y));this.L2_1=this.L2_1.add(b.scale(1.092548*a.y*a.z));this.L21=this.L21.add(b.scale(1.092548*
a.x*a.z));this.L20=this.L20.add(b.scale(0.315392*(3*a.z*a.z-1)));this.L22=this.L22.add(b.scale(0.546274*(a.x*a.x-a.y*a.y)))},n.prototype.scale=function(a){this.L00=this.L00.scale(a);this.L1_1=this.L1_1.scale(a);this.L10=this.L10.scale(a);this.L11=this.L11.scale(a);this.L2_2=this.L2_2.scale(a);this.L2_1=this.L2_1.scale(a);this.L20=this.L20.scale(a);this.L21=this.L21.scale(a);this.L22=this.L22.scale(a)},n);c.SphericalHarmonics=n;var E=function(){this.x=h.Zero();this.y=h.Zero();this.z=h.Zero();this.xx=
h.Zero();this.yy=h.Zero();this.zz=h.Zero();this.xy=h.Zero();this.yz=h.Zero();this.zx=h.Zero()};n=(E.prototype.addAmbient=function(a){a=new h(a.r,a.g,a.b);this.xx=this.xx.add(a);this.yy=this.yy.add(a);this.zz=this.zz.add(a)},E.getSphericalPolynomialFromHarmonics=function(a){var b=new E;return b.x=a.L11.scale(1.02333),b.y=a.L1_1.scale(1.02333),b.z=a.L10.scale(1.02333),b.xx=a.L00.scale(0.886277).subtract(a.L20.scale(0.247708)).add(a.L22.scale(0.429043)),b.yy=a.L00.scale(0.886277).subtract(a.L20.scale(0.247708)).subtract(a.L22.scale(0.429043)),
b.zz=a.L00.scale(0.886277).add(a.L20.scale(0.495417)),b.yz=a.L2_1.scale(0.858086),b.zx=a.L21.scale(0.858086),b.xy=a.L2_2.scale(0.858086),b},E);c.SphericalPolynomial=n;var F=function(a,b){void 0===a&&(a=h.Zero());void 0===b&&(b=h.Up());this.position=a;this.normal=b};n=(F.prototype.clone=function(){return new F(this.position.clone(),this.normal.clone())},F);c.PositionNormalVertex=n;var J=function(a,b,d){void 0===a&&(a=h.Zero());void 0===b&&(b=h.Up());void 0===d&&(d=j.Zero());this.position=a;this.normal=
b;this.uv=d};n=(J.prototype.clone=function(){return new J(this.position.clone(),this.normal.clone(),this.uv.clone())},J);c.PositionNormalTextureVertex=n;var G;n=function(){};G=(n.Color3=[e.Black(),e.Black(),e.Black()],n.Vector2=[j.Zero(),j.Zero(),j.Zero()],n.Vector3=[h.Zero(),h.Zero(),h.Zero(),h.Zero(),h.Zero(),h.Zero(),h.Zero(),h.Zero(),h.Zero()],n.Vector4=[l.Zero(),l.Zero(),l.Zero()],n.Quaternion=[new p(0,0,0,0)],n.Matrix=[t.Zero(),t.Zero(),t.Zero(),t.Zero(),t.Zero(),t.Zero(),t.Zero(),t.Zero()],
n);c.Tmp=G}(BABYLON||(BABYLON={}));
!function(c){function f(a,b){return function(d,c){d.__serializableMembers||(d.__serializableMembers={});d.__serializableMembers[c]={type:a,sourceName:b}}}c.serialize=function(a){return f(0,a)};c.serializeAsTexture=function(a){return f(1,a)};c.serializeAsColor3=function(a){return f(2,a)};c.serializeAsFresnelParameters=function(a){return f(3,a)};c.serializeAsVector2=function(a){return f(4,a)};c.serializeAsVector3=function(a){return f(5,a)};c.serializeAsMeshReference=function(a){return f(6,a)};c.serializeAsColorCurves=
function(a){return f(7,a)};var e;e=function(){};e=(e.Serialize=function(a,b){b||(b={});b.tags=c.Tags.GetTags(a);for(var d in a.__serializableMembers){var j=a.__serializableMembers[d],g=j.sourceName||d,j=j.type,h=a[d];if(void 0!==h&&null!==h)switch(j){case 0:b[g]=h;break;case 1:b[g]=h.serialize();break;case 2:b[g]=h.asArray();break;case 3:b[g]=h.serialize();break;case 4:b[g]=h.asArray();break;case 5:b[g]=h.asArray();break;case 6:b[g]=h.id;break;case 7:b[g]=h.serialize()}}return b},e.Parse=function(a,
b,d,j){a=a();c.Tags.AddTagsTo(a,b.tags);for(var g in a.__serializableMembers){var h=a.__serializableMembers[g],m=b[h.sourceName||g],h=h.type;if(void 0!==m&&null!==m)switch(h){case 0:a[g]=m;break;case 1:a[g]=c.Texture.Parse(m,d,j);break;case 2:a[g]=c.Color3.FromArray(m);break;case 3:a[g]=c.FresnelParameters.Parse(m);break;case 4:a[g]=c.Vector2.FromArray(m);break;case 5:a[g]=c.Vector3.FromArray(m);break;case 6:a[g]=d.getLastMeshByID(m);break;case 7:a[g]=c.ColorCurves.Parse(m)}}return a},e.Clone=function(a,
b){var d=a();c.Tags.AddTagsTo(d,b.tags);for(var j in d.__serializableMembers){var g=b[j],h=d.__serializableMembers[j].type;if(void 0!==g&&null!==g)switch(h){case 0:case 6:d[j]=g;break;case 1:case 2:case 3:case 4:case 5:case 7:d[j]=g.clone()}}return d},e);c.SerializationHelper=e}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(a,b){void 0===b&&(b=!1);this.mask=a;this.skipNextObservers=b};c.EventState=f;var e;e=function(a,b){this.callback=a;this.mask=b};c.Observer=e;var a,b=function(){this._observers=[]};a=(b.prototype.add=function(a,b,c){if(void 0===b&&(b=-1),void 0===c&&(c=!1),!a)return null;a=new e(a,b);return c?this._observers.unshift(a):this._observers.push(a),a},b.prototype.remove=function(a){a=this._observers.indexOf(a);return-1!==a?(this._observers.splice(a,1),!0):!1},b.prototype.removeCallback=
function(a){for(var b=0;b<this._observers.length;b++)if(this._observers[b].callback===a)return this._observers.splice(b,1),!0;return!1},b.prototype.notifyObservers=function(a,b){void 0===b&&(b=-1);for(var c=new f(b),h=0,m=this._observers;h<m.length;h++){var e=m[h];if(e.mask&b&&e.callback(a,c),c.skipNextObservers)break}},b.prototype.hasObservers=function(){return 0<this._observers.length},b.prototype.clear=function(){this._observers=[]},b.prototype.clone=function(){var a=new b;return a._observers=
this._observers.slice(0),a},b);c.Observable=a}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,b){this.idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;this.callbackManifestChecked=b;this.currentSceneUrl=e.ReturnFullUrlLocation(a);this.db=null;this.enableTexturesOffline=this.enableSceneOffline=!1;this.manifestVersionFound=0;this.hasReachedQuota=this.mustUpdateRessources=!1;e.IDBStorageEnabled?this.checkManifestFile():this.callbackManifestChecked(!0)};f=(e.prototype.checkManifestFile=function(){function a(){d.enableSceneOffline=
!1;d.enableTexturesOffline=!1;d.callbackManifestChecked(!1)}var b=this,d=this,j=!1,g=this.currentSceneUrl+".manifest",h=new XMLHttpRequest;navigator.onLine&&(j=!0,g=g+(null==g.match(/\?/)?"?":"&")+(new Date).getTime());h.open("GET",g,!0);h.addEventListener("load",function(){if(200===h.status||c.Tools.ValidateXHRData(h,1))try{var d=JSON.parse(h.response);b.enableSceneOffline=d.enableSceneOffline;b.enableTexturesOffline=d.enableTexturesOffline;d.version&&!isNaN(parseInt(d.version))&&(b.manifestVersionFound=
d.version);b.callbackManifestChecked&&b.callbackManifestChecked(!0)}catch(g){a()}else a()},!1);h.addEventListener("error",function(){j?(j=!1,h.open("GET",b.currentSceneUrl+".manifest",!0),h.send()):a()},!1);try{h.send()}catch(m){c.Tools.Error("Error on XHR send request."),d.callbackManifestChecked(!1)}},e.prototype.openAsync=function(a,b){function d(){g.isSupported=!1;b&&b()}var j=this,g=this;if(this.idbFactory&&(this.enableSceneOffline||this.enableTexturesOffline))if(this.db)a&&a();else{this.hasReachedQuota=
!1;this.isSupported=!0;var h=this.idbFactory.open("babylonjs",1);h.onerror=function(){d()};h.onblocked=function(){c.Tools.Error("IDB request blocked. Please reload the page.");d()};h.onsuccess=function(){j.db=h.result;a()};h.onupgradeneeded=function(a){j.db=a.target.result;try{j.db.createObjectStore("scenes",{keyPath:"sceneUrl"}),j.db.createObjectStore("versions",{keyPath:"sceneUrl"}),j.db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(b){c.Tools.Error("Error while creating object stores. Exception: "+
b.message),d()}}}else this.isSupported=!1,b&&b()},e.prototype.loadImageFromDB=function(a,b){var d=this,c=e.ReturnFullUrlLocation(a),g=function(){d.hasReachedQuota||null===d.db?b.src=a:d._saveImageIntoDBAsync(c,b)};this.mustUpdateRessources?g():this._loadImageFromDBAsync(c,b,g)},e.prototype._loadImageFromDBAsync=function(a,b,d){if(this.isSupported&&null!==this.db){var j,g=this.db.transaction(["textures"]);g.onabort=function(){b.src=a};g.oncomplete=function(){var h;j?(h=(window.URL||window.webkitURL).createObjectURL(j.data,
{oneTimeOnly:!0}),b.onerror=function(){c.Tools.Error("Error loading image from blob URL: "+h+" switching back to web url: "+a);b.src=a},b.src=h):d()};g=g.objectStore("textures").get(a);g.onsuccess=function(a){j=a.target.result};g.onerror=function(){c.Tools.Error("Error loading texture "+a+" from DB.");b.src=a}}else c.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),b.src=a},e.prototype._saveImageIntoDBAsync=function(a,b){var d=this;if(this.isSupported){var j=
function(){var a;if(g){var d=window.URL||window.webkitURL;try{a=d.createObjectURL(g,{oneTimeOnly:!0})}catch(c){a=d.createObjectURL(g)}}b.src=a};if(e.IsUASupportingBlobStorage){var g,h=new XMLHttpRequest;h.open("GET",a,!0);h.responseType="blob";h.addEventListener("load",function(){if(200===h.status){g=h.response;var c=d.db.transaction(["textures"],"readwrite");c.onabort=function(a){try{a.srcElement.error&&"QuotaExceededError"===a.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(b){}j()};c.oncomplete=
function(){j()};var l={textureUrl:a,data:g};try{var k=c.objectStore("textures").put(l);k.onsuccess=function(){};k.onerror=function(){j()}}catch(n){25===n.code&&(e.IsUASupportingBlobStorage=!1),b.src=a}}else b.src=a},!1);h.addEventListener("error",function(){c.Tools.Error("Error in XHR request in BABYLON.Database.");b.src=a},!1);h.send()}else b.src=a}else c.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),b.src=a},e.prototype._checkVersionFromDB=function(a,
b){var d=this;this._loadVersionFromDBAsync(a,b,function(){d._saveVersionIntoDBAsync(a,b)})},e.prototype._loadVersionFromDBAsync=function(a,b,d){var j=this;if(this.isSupported){var g;try{var h=this.db.transaction(["versions"]);h.oncomplete=function(){g?j.manifestVersionFound>g.data?(j.mustUpdateRessources=!0,d()):b(g.data):(j.mustUpdateRessources=!0,d())};h.onabort=function(){b(-1)};var m=h.objectStore("versions").get(a);m.onsuccess=function(a){g=a.target.result};m.onerror=function(){c.Tools.Error("Error loading version for scene "+
a+" from DB.");b(-1)}}catch(e){c.Tools.Error("Error while accessing 'versions' object store (READ OP). Exception: "+e.message),b(-1)}}else c.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),b(-1)},e.prototype._saveVersionIntoDBAsync=function(a,b){var d=this;if(this.isSupported&&!this.hasReachedQuota)try{var j=this.db.transaction(["versions"],"readwrite");j.onabort=function(a){try{a.srcElement.error&&"QuotaExceededError"===a.srcElement.error.name&&(d.hasReachedQuota=
!0)}catch(c){}b(-1)};j.oncomplete=function(){b(d.manifestVersionFound)};var g={sceneUrl:a,data:this.manifestVersionFound},h=j.objectStore("versions").put(g);h.onsuccess=function(){};h.onerror=function(){c.Tools.Error("Error in DB add version request in BABYLON.Database.")}}catch(m){c.Tools.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+m.message),b(-1)}else b(-1)},e.prototype.loadFileFromDB=function(a,b,d,c,g){var h=this,m=e.ReturnFullUrlLocation(a),l=function(){h._saveFileIntoDBAsync(m,
b,d)};this._checkVersionFromDB(m,function(a){-1!==a?h.mustUpdateRessources?h._saveFileIntoDBAsync(m,b,d,g):h._loadFileFromDBAsync(m,b,l,g):c()})},e.prototype._loadFileFromDBAsync=function(a,b,d){if(this.isSupported){var j;j=-1!==a.indexOf(".babylon")?"scenes":"textures";var g,h=this.db.transaction([j]);h.oncomplete=function(){g?b(g.data):d()};h.onabort=function(){d()};j=h.objectStore(j).get(a);j.onsuccess=function(a){g=a.target.result};j.onerror=function(){c.Tools.Error("Error loading file "+a+" from DB.");
d()}}else c.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),b()},e.prototype._saveFileIntoDBAsync=function(a,b,d,j){var g=this;if(this.isSupported){var h;h=-1!==a.indexOf(".babylon")?"scenes":"textures";var m,e=new XMLHttpRequest;e.open("GET",a,!0);j&&(e.responseType="arraybuffer");e.onprogress=d;e.addEventListener("load",function(){if(200===e.status||c.Tools.ValidateXHRData(e,j?6:1))if(m=j?e.response:e.responseText,g.hasReachedQuota)b(m);else{var d=
g.db.transaction([h],"readwrite");d.onabort=function(a){try{a.srcElement.error&&"QuotaExceededError"===a.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(d){}b(m)};d.oncomplete=function(){b(m)};var n;n="scenes"===h?{sceneUrl:a,data:m,version:g.manifestVersionFound}:{textureUrl:a,data:m};try{var f=d.objectStore(h).put(n);f.onsuccess=function(){};f.onerror=function(){c.Tools.Error("Error in DB add file request in BABYLON.Database.")}}catch(p){b(m)}}else b()},!1);e.addEventListener("error",function(){c.Tools.Error("error on XHR request.");
b()},!1);e.send()}else c.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),b()},e.IsUASupportingBlobStorage=!0,e.IDBStorageEnabled=!0,e.parseURL=function(a){document.createElement("a").href=a;var b=a.substring(0,a.lastIndexOf("#")),b=a.substring(b.lastIndexOf("/")+1,a.length);return a.substring(0,a.indexOf(b,0))},e.ReturnFullUrlLocation=function(a){return-1===a.indexOf("http:/")?e.parseURL(window.location.href)+a:a},e);c.Database=f}(BABYLON||(BABYLON=
{}));
!function(c){var f=c.Internals||(c.Internals={}),e,a=function(){};e=(a.GetTGAHeader=function(a){var d=0;return{id_length:a[d++],colormap_type:a[d++],image_type:a[d++],colormap_index:a[d++]|a[d++]<<8,colormap_length:a[d++]|a[d++]<<8,colormap_size:a[d++],origin:[a[d++]|a[d++]<<8,a[d++]|a[d++]<<8],width:a[d++]|a[d++]<<8,height:a[d++]|a[d++]<<8,pixel_size:a[d++],flags:a[d++]}},a.UploadContent=function(b,d){if(19>d.length)return void c.Tools.Error("Unable to load TGA file - Not enough data to contain header");var j=
18,g=a.GetTGAHeader(d);if(g.id_length+j>d.length)return void c.Tools.Error("Unable to load TGA file - Not enough data");var j=j+g.id_length,h=!1,m=!1,e=!1;switch(g.image_type){case a._TYPE_RLE_INDEXED:h=!0;case a._TYPE_INDEXED:m=!0;break;case a._TYPE_RLE_RGB:h=!0;case a._TYPE_RGB:break;case a._TYPE_RLE_GREY:h=!0;case a._TYPE_GREY:e=!0}var k,n=(15&g.flags,g.pixel_size>>3),f=g.width*g.height*n;if(m&&(k=d.subarray(j,j+=g.colormap_length*(g.colormap_size>>3))),h)for(var h=new Uint8Array(f),p,r,t=0,s=
new Uint8Array(n);f>j&&f>t;)if(p=d[j++],m=(127&p)+1,128&p){for(r=0;n>r;++r)s[r]=d[j++];for(r=0;m>r;++r)h.set(s,t+r*n);t+=n*m}else{m*=n;for(r=0;m>r;++r)h[t+r]=d[j++];t+=m}else h=d.subarray(j,j+(m?g.width*g.height:f));switch((g.flags&a._ORIGIN_MASK)>>a._ORIGIN_SHIFT){default:case a._ORIGIN_UL:j=0;f=1;r=g.width;n=0;p=1;m=g.height;break;case a._ORIGIN_BL:j=0;f=1;r=g.width;n=g.height-1;m=p=-1;break;case a._ORIGIN_UR:j=g.width-1;r=f=-1;n=0;p=1;m=g.height;break;case a._ORIGIN_BR:j=g.width-1,r=f=-1,n=g.height-
1,m=p=-1}e=a["_getImageData"+(e?"Grey":"")+g.pixel_size+"bits"](g,k,h,n,p,m,j,f,r);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,g.width,g.height,0,b.RGBA,b.UNSIGNED_BYTE,e)},a._getImageData8bits=function(a,d,c,g,h,m,e,k,n){var f,p,r=a.width,t=0;a=new Uint8Array(4*r*a.height);for(p=g;p!==m;p+=h)for(f=e;f!==n;f+=k,t++)g=c[t],a[4*(f+r*p)+3]=255,a[4*(f+r*p)+2]=d[3*g+0],a[4*(f+r*p)+1]=d[3*g+1],a[4*(f+r*p)+0]=d[3*g+2];return a},a._getImageData16bits=function(a,d,c,g,h,m,e,k,n){var f,p;d=a.width;var r=0;a=new Uint8Array(4*
d*a.height);for(p=g;p!==m;p+=h)for(f=e;f!==n;f+=k,r+=2)g=c[r+0]+(c[r+1]<<8),a[4*(f+d*p)+0]=(31744&g)>>7,a[4*(f+d*p)+1]=(992&g)>>2,a[4*(f+d*p)+2]=(31&g)>>3,a[4*(f+d*p)+3]=32768&g?0:255;return a},a._getImageData24bits=function(a,d,c,g,h,m,e,k,n){var f;d=a.width;var p=0;a=new Uint8Array(4*d*a.height);for(f=g;f!==m;f+=h)for(g=e;g!==n;g+=k,p+=3)a[4*(g+d*f)+3]=255,a[4*(g+d*f)+2]=c[p+0],a[4*(g+d*f)+1]=c[p+1],a[4*(g+d*f)+0]=c[p+2];return a},a._getImageData32bits=function(a,d,c,g,h,m,e,k,n){var f;d=a.width;
var p=0;a=new Uint8Array(4*d*a.height);for(f=g;f!==m;f+=h)for(g=e;g!==n;g+=k,p+=4)a[4*(g+d*f)+2]=c[p+0],a[4*(g+d*f)+1]=c[p+1],a[4*(g+d*f)+0]=c[p+2],a[4*(g+d*f)+3]=c[p+3];return a},a._getImageDataGrey8bits=function(a,d,c,g,h,m,e,k,n){var f,p;d=a.width;var r=0;a=new Uint8Array(4*d*a.height);for(p=g;p!==m;p+=h)for(f=e;f!==n;f+=k,r++)g=c[r],a[4*(f+d*p)+0]=g,a[4*(f+d*p)+1]=g,a[4*(f+d*p)+2]=g,a[4*(f+d*p)+3]=255;return a},a._getImageDataGrey16bits=function(a,d,c,g,h,m,e,k,n){var f;d=a.width;var p=0;a=new Uint8Array(4*
d*a.height);for(f=g;f!==m;f+=h)for(g=e;g!==n;g+=k,p+=2)a[4*(g+d*f)+0]=c[p+0],a[4*(g+d*f)+1]=c[p+0],a[4*(g+d*f)+2]=c[p+0],a[4*(g+d*f)+3]=c[p+1];return a},a._TYPE_NO_DATA=0,a._TYPE_INDEXED=1,a._TYPE_RGB=2,a._TYPE_GREY=3,a._TYPE_RLE_INDEXED=9,a._TYPE_RLE_RGB=10,a._TYPE_RLE_GREY=11,a._ORIGIN_MASK=48,a._ORIGIN_SHIFT=4,a._ORIGIN_BL=0,a._ORIGIN_BR=1,a._ORIGIN_UL=2,a._ORIGIN_UR=3,a);f.TGATools=e;!0}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a){this._duplicateId=this.length=0;this.data=Array(a);this._id=e._GlobalId++};f=(e.prototype.push=function(a){this.data[this.length++]=a;this.length>this.data.length&&(this.data.length*=2);a.__smartArrayFlags||(a.__smartArrayFlags={});a.__smartArrayFlags[this._id]=this._duplicateId},e.prototype.pushNoDuplicate=function(a){return a.__smartArrayFlags&&a.__smartArrayFlags[this._id]===this._duplicateId?!1:(this.push(a),!0)},e.prototype.sort=function(a){this.data.sort(a)},
e.prototype.reset=function(){this.length=0;this._duplicateId++},e.prototype.concat=function(a){if(0!==a.length){this.length+a.length>this.data.length&&(this.data.length=2*(this.length+a.length));for(var b=0;b<a.length;b++)this.data[this.length++]=(a.data||a)[b]}},e.prototype.concatWithNoDuplicate=function(a){if(0!==a.length){this.length+a.length>this.data.length&&(this.data.length=2*(this.length+a.length));for(var b=0;b<a.length;b++)this.pushNoDuplicate((a.data||a)[b])}},e.prototype.indexOf=function(a){a=
this.data.indexOf(a);return a>=this.length?-1:a},e._GlobalId=0,e);c.SmartArray=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){this._count=0;this._data={}};f=(f.prototype.get=function(c){c=this._data[c];return void 0!==c?c:void 0},f.prototype.getOrAddWithFactory=function(c,a){var b=this.get(c);return void 0!==b?b:(b=a(c),b&&this.add(c,b),b)},f.prototype.getOrAdd=function(c,a){var b=this.get(c);return void 0!==b?b:(this.add(c,a),a)},f.prototype.contains=function(c){return void 0!==this._data[c]},f.prototype.add=function(c,a){return void 0!==this._data[c]?!1:(this._data[c]=a,++this._count,!0)},
f.prototype.set=function(c,a){return void 0===this._data[c]?!1:(this._data[c]=a,!0)},f.prototype.remove=function(c){return this.contains(c)?(delete this._data[c],--this._count,!0):!1},f.prototype.clear=function(){this._data={};this._count=0},Object.defineProperty(f.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),f.prototype.forEach=function(c){for(var a in this._data)c(a,this._data[a])},f.prototype.first=function(c){for(var a in this._data){var b=c(a,this._data[a]);
if(b)return b}return null},f);c.StringDictionary=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,b){return a?a instanceof c.Mesh?null:a instanceof c.SubMesh?a.clone(b):a.clone?a.clone():null:null},a,b=function(){};a=(b.Instantiate=function(a){a=a.split(".");for(var b=window||this,d=0,c=a.length;c>d;d++)b=b[a[d]];return"function"!=typeof b?null:b},b.SetImmediate=function(a){window.setImmediate?window.setImmediate(a):setTimeout(a,1)},b.IsExponentOfTwo=function(a){var b=1;do b*=2;while(a>b);return b===a},b.GetExponentOfTwo=function(a,b){var d=1;do d*=2;while(a>d);
return d>b&&(d=b),d},b.GetFilename=function(a){var b=a.lastIndexOf("/");return 0>b?a:a.substring(b+1)},b.GetDOMTextContent=function(a){var b="";for(a=a.firstChild;a;)3===a.nodeType&&(b+=a.textContent),a=a.nextSibling;return b},b.ToDegrees=function(a){return 180*a/Math.PI},b.ToRadians=function(a){return a*Math.PI/180},b.EncodeArrayBufferTobase64=function(a){for(var b,d,c,e,k,n="",f=0,p=new Uint8Array(a);f<p.length;)b=p[f++],a=f<p.length?p[f++]:Number.NaN,d=f<p.length?p[f++]:Number.NaN,c=b>>2,b=(3&
b)<<4|a>>4,e=(15&a)<<2|d>>6,k=63&d,isNaN(a)?e=k=64:isNaN(d)&&(k=64),n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k);return"data:image/png;base64,"+n},b.ExtractMinAndMaxIndexed=function(a,b,d,m,e){void 0===e&&(e=null);for(var k=new c.Vector3(Number.MAX_VALUE,
Number.MAX_VALUE,Number.MAX_VALUE),n=new c.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),f=d;d+m>f;f++)var p=new c.Vector3(a[3*b[f]],a[3*b[f]+1],a[3*b[f]+2]),k=c.Vector3.Minimize(p,k),n=c.Vector3.Maximize(p,n);return e&&(k.x-=k.x*e.x+e.y,k.y-=k.y*e.x+e.y,k.z-=k.z*e.x+e.y,n.x+=n.x*e.x+e.y,n.y+=n.y*e.x+e.y,n.z+=n.z*e.x+e.y),{minimum:k,maximum:n}},b.ExtractMinAndMax=function(a,b,d,m,e){void 0===m&&(m=null);var k=new c.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new c.Vector3(-Number.MAX_VALUE,
-Number.MAX_VALUE,-Number.MAX_VALUE);e||(e=3);for(var f=b;b+d>f;f++)var p=new c.Vector3(a[f*e],a[f*e+1],a[f*e+2]),k=c.Vector3.Minimize(p,k),n=c.Vector3.Maximize(p,n);return m&&(k.x-=k.x*m.x+m.y,k.y-=k.y*m.x+m.y,k.z-=k.z*m.x+m.y,n.x+=n.x*m.x+m.y,n.y+=n.y*m.x+m.y,n.z+=n.z*m.x+m.y),{minimum:k,maximum:n}},b.Vector2ArrayFeeder=function(a){return function(b){var d=void 0!==a.BYTES_PER_ELEMENT;return b>=(d?a.length/2:a.length)?null:d?new c.Vector2(a[2*b+0],a[2*b+1]):a[b]}},b.ExtractMinAndMaxVector2=function(a,
b){void 0===b&&(b=null);for(var d=new c.Vector2(Number.MAX_VALUE,Number.MAX_VALUE),m=new c.Vector2(-Number.MAX_VALUE,-Number.MAX_VALUE),e=0,k=a(e++);k;)d=c.Vector2.Minimize(k,d),m=c.Vector2.Maximize(k,m),k=a(e++);return b&&(d.x-=d.x*b.x+b.y,d.y-=d.y*b.x+b.y,m.x+=m.x*b.x+b.y,m.y+=m.y*b.x+b.y),{minimum:d,maximum:m}},b.MakeArray=function(a,b){return!0===b||void 0!==a&&null!=a?Array.isArray(a)?a:[a]:void 0},b.GetPointerPrefix=function(){return"pointer"},b.QueueNewFrame=function(a){window.requestAnimationFrame?
window.requestAnimationFrame(a):window.msRequestAnimationFrame?window.msRequestAnimationFrame(a):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(a):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(a):window.oRequestAnimationFrame?window.oRequestAnimationFrame(a):window.setTimeout(a,16)},b.RequestFullscreen=function(a,b){var d=a.requestFullscreen||a.msRequestFullscreen||a.webkitRequestFullscreen||a.mozRequestFullScreen;d&&d.call(a,b)},b.ExitFullscreen=function(){document.exitFullscreen?
document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen()},b.CleanUrl=function(a){return a.replace(/#/gm,"%23")},b.LoadImage=function(a,d,h,m){a instanceof ArrayBuffer&&(a=b.EncodeArrayBufferTobase64(a));a=b.CleanUrl(a);var e=new Image;if("data:"!==a.substr(0,5)&&b.CorsBehavior)switch(typeof b.CorsBehavior){case "function":var k=b.CorsBehavior(a);
k&&(e.crossOrigin=k);break;default:e.crossOrigin=b.CorsBehavior}e.onload=function(){d(e)};e.onerror=function(){b.Error("Error while trying to load texture: "+a);b.UseFallbackTexture?(e.src="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",
d(e)):h()};var k=function(){e.src=a},n=function(){m.loadImageFromDB(a,e)};if("data:"!==a.substr(0,5)&&m&&m.enableTexturesOffline&&c.Database.IsUASupportingBlobStorage)m.openAsync(n,k);else if(-1===a.indexOf("file:"))k();else try{var f,p=a.substring(5).toLowerCase();try{f=URL.createObjectURL(c.FilesInput.FilesTextures[p],{oneTimeOnly:!0})}catch(r){f=URL.createObjectURL(c.FilesInput.FilesTextures[p])}e.src=f}catch(t){e.src=null}return e},b.LoadFile=function(a,d,h,m,e,k){a=b.CleanUrl(a);var n=function(){var c=
new XMLHttpRequest,m=b.BaseUrl+a;c.open("GET",m,!0);e&&(c.responseType="arraybuffer");c.onprogress=h;c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status||b.ValidateXHRData(c,e?6:1))d(e?c.response:c.responseText);else{if(!k)throw Error("Error status: "+c.status+" - Unable to load "+m);k()}};c.send(null)},f=function(){m.loadFileFromDB(a,d,h,n,e)};-1!==a.indexOf("file:")?(f=a.substring(5).toLowerCase(),b.ReadFile(c.FilesInput.FilesToLoad[f],d,h,e)):m&&m.enableSceneOffline?m.openAsync(f,
n):n()},b.ReadFileAsDataURL=function(a,b,d){var c=new FileReader;c.onload=function(a){b(a.target.result)};c.onprogress=d;c.readAsDataURL(a)},b.ReadFile=function(a,d,c,m){var e=new FileReader;e.onerror=function(){b.Log("Error while reading file: "+a.name);d(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))};e.onload=function(a){d(a.target.result)};e.onprogress=c;m?e.readAsArrayBuffer(a):e.readAsText(a)},b.FileAsURL=function(a){a=
new Blob([a]);return(window.URL||window.webkitURL).createObjectURL(a)},b.Format=function(a,b){return void 0===b&&(b=2),a.toFixed(b)},b.CheckExtends=function(a,b,d){a.x<b.x&&(b.x=a.x);a.y<b.y&&(b.y=a.y);a.z<b.z&&(b.z=a.z);a.x>d.x&&(d.x=a.x);a.y>d.y&&(d.y=a.y);a.z>d.z&&(d.z=a.z)},b.DeepCopy=function(a,b,d,c){for(var l in a)if(("_"!==l[0]||c&&-1!==c.indexOf(l))&&(!d||-1===d.indexOf(l))){var k=a[l],n=typeof k;if("function"!==n)if("object"===n)if(k instanceof Array){if(b[l]=[],0<k.length)if("object"==
typeof k[0])for(n=0;n<k.length;n++){var f=e(k[n],b);-1===b[l].indexOf(f)&&b[l].push(f)}else b[l]=k.slice(0)}else b[l]=e(k,b);else b[l]=k}},b.IsEmpty=function(a){for(var b in a)return!1;return!0},b.RegisterTopRootEvents=function(a){for(var b=0;b<a.length;b++){var d=a[b];window.addEventListener(d.name,d.handler,!1);try{window.parent&&window.parent.addEventListener(d.name,d.handler,!1)}catch(c){}}},b.UnregisterTopRootEvents=function(a){for(var b=0;b<a.length;b++){var d=a[b];window.removeEventListener(d.name,
d.handler);try{window.parent&&window.parent.removeEventListener(d.name,d.handler)}catch(c){}}},b.DumpFramebuffer=function(a,b,d,c){var e=4*a,k=b/2;d=d.readPixels(0,0,a,b);for(var n=0;k>n;n++)for(var q=0;e>q;q++){var p=q+n*e,r=q+(b-n-1)*e,t=d[p];d[p]=d[r];d[r]=t}f||(f=document.createElement("canvas"));f.width=a;f.height=b;e=f.getContext("2d");a=e.createImageData(a,b);a.data.set(d);e.putImageData(a,0,0);a=f.toDataURL();if(c)c(a);else if("download"in document.createElement("a")){var s=window.document.createElement("a");
s.href=a;c=new Date;c=(c.getFullYear()+"-"+(c.getMonth()+1)).slice(-2)+"-"+c.getDate()+"_"+c.getHours()+"-"+("0"+c.getMinutes()).slice(-2);s.setAttribute("download","screenshot_"+c+".png");window.document.body.appendChild(s);s.addEventListener("click",function(){s.parentElement.removeChild(s)});s.click()}else c=window.open(""),b=c.document.createElement("img"),b.src=a,c.document.body.appendChild(b)},b.CreateScreenshot=function(a,d,h,m){var e,k;if(h.precision)e=Math.round(a.getRenderWidth()*h.precision),
k=Math.round(e/a.getAspectRatio(d)),h={width:e,height:k};else if(h.width&&h.height)e=h.width,k=h.height;else if(h.width&&!h.height)e=h.width,k=Math.round(e/a.getAspectRatio(d)),h={width:e,height:k};else if(h.height&&!h.width)k=h.height,e=Math.round(k*a.getAspectRatio(d)),h={width:e,height:k};else{if(isNaN(h))return void b.Error("Invalid 'size' parameter !");e=k=h}var f=d.getScene(),q=null;f.activeCamera!==d&&(q=f.activeCamera,f.activeCamera=d);h=new c.RenderTargetTexture("screenShot",h,f,!1,!1);h.renderList=
f.meshes;h.onAfterRenderObservable.add(function(){b.DumpFramebuffer(e,k,a,m)});f.incrementRenderId();f.resetCachedMaterial();h.render(!0);h.dispose();q&&(f.activeCamera=q);d.getProjectionMatrix(!0)},b.ValidateXHRData=function(a,b){void 0===b&&(b=7);try{if(1&b){if(a.responseText&&0<a.responseText.length)return!0;if(1===b)return!1}if(2&b){var d=c.Internals.TGATools.GetTGAHeader(a.response);if(d.width&&d.height&&0<d.width&&0<d.height)return!0;if(2===b)return!1}if(4&b){var m=new Uint8Array(a.response,
0,3);return 68===m[0]&&68===m[1]&&83===m[2]}}catch(e){}return!1},Object.defineProperty(b,"NoneLogLevel",{get:function(){return b._NoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(b,"MessageLogLevel",{get:function(){return b._MessageLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(b,"WarningLogLevel",{get:function(){return b._WarningLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ErrorLogLevel",{get:function(){return b._ErrorLogLevel},enumerable:!0,
configurable:!0}),Object.defineProperty(b,"AllLogLevel",{get:function(){return b._MessageLogLevel|b._WarningLogLevel|b._ErrorLogLevel},enumerable:!0,configurable:!0}),b._AddLogEntry=function(a){b._LogCache=a+b._LogCache;b.OnNewCacheEntry&&b.OnNewCacheEntry(a)},b._FormatMessage=function(a){var b=function(a){return 10>a?"0"+a:""+a},d=new Date;return"["+b(d.getHours())+":"+b(d.getMinutes())+":"+b(d.getSeconds())+"]: "+a},b._LogDisabled=function(){},b._LogEnabled=function(a){a=b._FormatMessage(a);console.log("BJS - "+
a);b._AddLogEntry("<div style='color:white'>"+a+"</div><br>")},b._WarnDisabled=function(){},b._WarnEnabled=function(a){a=b._FormatMessage(a);console.warn("BJS - "+a);b._AddLogEntry("<div style='color:orange'>"+a+"</div><br>")},b._ErrorDisabled=function(){},b._ErrorEnabled=function(a){b.errorsCount++;a=b._FormatMessage(a);console.error("BJS - "+a);b._AddLogEntry("<div style='color:red'>"+a+"</div><br>")},Object.defineProperty(b,"LogCache",{get:function(){return b._LogCache},enumerable:!0,configurable:!0}),
b.ClearLogCache=function(){b._LogCache="";b.errorsCount=0},Object.defineProperty(b,"LogLevels",{set:function(a){(a&b.MessageLogLevel)===b.MessageLogLevel?b.Log=b._LogEnabled:b.Log=b._LogDisabled;(a&b.WarningLogLevel)===b.WarningLogLevel?b.Warn=b._WarnEnabled:b.Warn=b._WarnDisabled;(a&b.ErrorLogLevel)===b.ErrorLogLevel?b.Error=b._ErrorEnabled:b.Error=b._ErrorDisabled},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PerformanceNoneLogLevel",{get:function(){return b._PerformanceNoneLogLevel},
enumerable:!0,configurable:!0}),Object.defineProperty(b,"PerformanceUserMarkLogLevel",{get:function(){return b._PerformanceUserMarkLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PerformanceConsoleLogLevel",{get:function(){return b._PerformanceConsoleLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PerformanceLogLevel",{set:function(a){return(a&b.PerformanceUserMarkLogLevel)===b.PerformanceUserMarkLogLevel?(b.StartPerformanceCounter=b._StartUserMark,void(b.EndPerformanceCounter=
b._EndUserMark)):(a&b.PerformanceConsoleLogLevel)===b.PerformanceConsoleLogLevel?(b.StartPerformanceCounter=b._StartPerformanceConsole,void(b.EndPerformanceCounter=b._EndPerformanceConsole)):(b.StartPerformanceCounter=b._StartPerformanceCounterDisabled,void(b.EndPerformanceCounter=b._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),b._StartPerformanceCounterDisabled=function(){},b._EndPerformanceCounterDisabled=function(){},b._StartUserMark=function(a,d){void 0===d&&(d=!0);d&&b._performance.mark&&
b._performance.mark(a+"-Begin")},b._EndUserMark=function(a,d){void 0===d&&(d=!0);d&&b._performance.mark&&(b._performance.mark(a+"-End"),b._performance.measure(a,a+"-Begin",a+"-End"))},b._StartPerformanceConsole=function(a,d){void 0===d&&(d=!0);d&&(b._StartUserMark(a,d),console.time&&console.time(a))},b._EndPerformanceConsole=function(a,d){void 0===d&&(d=!0);d&&(b._EndUserMark(a,d),console.time&&console.timeEnd(a))},Object.defineProperty(b,"Now",{get:function(){return window.performance&&window.performance.now?
window.performance.now():(new Date).getTime()},enumerable:!0,configurable:!0}),b.getClassName=function(a,b){void 0===b&&(b=!1);var d=null;!b&&a.getClassName?d=a.getClassName():(a instanceof Object&&(d=(b?a:Object.getPrototypeOf(a)).constructor.__bjsclassName__),d||(d=typeof a));return d},b.first=function(a,b){for(var d=0;d<a.length;d++){var c=a[d];if(b(c))return c}},b.arrayOrStringFeeder=function(a){return function(d){if(d>=a.length)return null;d=a.charCodeAt?a.charCodeAt(d):a[d];return d&&d.getHashCode&&
(d=d.getHashCode()),"string"==typeof d?b.hashCodeFromStream(b.arrayOrStringFeeder(d)):d}},b.hashCodeFromStream=function(a){for(var b=0,d=0,c=a(d++);null!=c;)b=(b<<5)-b+c,b|=0,c=a(d++);return b},b.BaseUrl="",b.CorsBehavior="anonymous",b.UseFallbackTexture=!0,b._NoneLogLevel=0,b._MessageLogLevel=1,b._WarningLogLevel=2,b._ErrorLogLevel=4,b._LogCache="",b.errorsCount=0,b.Log=b._LogEnabled,b.Warn=b._WarnEnabled,b.Error=b._ErrorEnabled,b._PerformanceNoneLogLevel=0,b._PerformanceUserMarkLogLevel=1,b._PerformanceConsoleLogLevel=
2,b._performance=window.performance,b.StartPerformanceCounter=b._StartPerformanceCounterDisabled,b.EndPerformanceCounter=b._EndPerformanceCounterDisabled,b);c.Tools=a;c.className=function(a){return function(b){b.__bjsclassName__=a}};var d=function(a,b,d,c){void 0===c&&(c=0);this.iterations=a;this._fn=b;this._successCallback=d;this.index=c-1;this._done=!1};a=(d.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},d.prototype.breakLoop=
function(){this._done=!0;this._successCallback()},d.Run=function(a,b,c,m){void 0===m&&(m=0);a=new d(a,b,c,m);return a.executeNext(),a},d.SyncAsyncForLoop=function(a,b,c,m,e,k){void 0===k&&(k=0);d.Run(Math.ceil(a/b),function(d){e&&e()?d.breakLoop():setTimeout(function(){for(var m=0;b>m;++m){var k=d.index*b+m;if(k>=a)break;if(c(k),e&&e()){d.breakLoop();break}}d.executeNext()},k)},m)},d);c.AsyncLoop=a}(BABYLON||(BABYLON={}));
!function(c){c=c.Internals||(c.Internals={});var f;f=function(){this._alphaBlend=this._isBlendFunctionParametersDirty=this._isAlphaBlendDirty=!1;this._blendFunctionParameters=Array(4)};f=(Object.defineProperty(f.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(c){this._alphaBlend!==c&&(this._alphaBlend=c,this._isAlphaBlendDirty=
!0)},enumerable:!0,configurable:!0}),f.prototype.setAlphaBlendFunctionParameters=function(c,a,b,d){this._blendFunctionParameters[0]===c&&this._blendFunctionParameters[1]===a&&this._blendFunctionParameters[2]===b&&this._blendFunctionParameters[3]===d||(this._blendFunctionParameters[0]=c,this._blendFunctionParameters[1]=a,this._blendFunctionParameters[2]=b,this._blendFunctionParameters[3]=d,this._isBlendFunctionParametersDirty=!0)},f.prototype.reset=function(){this._alphaBlend=!1;this._blendFunctionParameters[0]=
null;this._blendFunctionParameters[1]=null;this._blendFunctionParameters[2]=null;this._blendFunctionParameters[3]=null;this._isAlphaBlendDirty=!0;this._isBlendFunctionParametersDirty=!1},f.prototype.apply=function(c){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?c.enable(c.BLEND):c.disable(c.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(c.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),
this._isBlendFunctionParametersDirty=!1))},f);c._AlphaState=f;!0}(BABYLON||(BABYLON={}));
!function(c){c=c.Internals||(c.Internals={});var f;f=function(){this._isZOffsetDirty=this._isCullDirty=this._isCullFaceDirty=this._isDepthFuncDirty=this._isDepthMaskDirty=this._isDepthTestDirty=!1};f=(Object.defineProperty(f.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"zOffset",{get:function(){return this._zOffset},
set:function(c){this._zOffset!==c&&(this._zOffset=c,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"cullFace",{get:function(){return this._cullFace},set:function(c){this._cullFace!==c&&(this._cullFace=c,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"cull",{get:function(){return this._cull},set:function(c){this._cull!==c&&(this._cull=c,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,
"depthFunc",{get:function(){return this._depthFunc},set:function(c){this._depthFunc!==c&&(this._depthFunc=c,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"depthMask",{get:function(){return this._depthMask},set:function(c){this._depthMask!==c&&(this._depthMask=c,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"depthTest",{get:function(){return this._depthTest},set:function(c){this._depthTest!==c&&(this._depthTest=
c,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),f.prototype.reset=function(){this._depthTest=this._depthMask=!0;this._cull=this._cullFace=this._depthFunc=null;this._zOffset=0;this._isDepthMaskDirty=this._isDepthTestDirty=!0;this._isZOffsetDirty=this._isCullDirty=this._isCullFaceDirty=this._isDepthFuncDirty=!1},f.prototype.apply=function(c){this.isDirty&&(this._isCullDirty&&(this.cull?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(c.cullFace(this.cullFace),
this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(c.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(c.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(c.enable(c.POLYGON_OFFSET_FILL),c.polygonOffset(this.zOffset,0)):c.disable(c.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1))},f);c._DepthCullingState=f;!0}(BABYLON||
(BABYLON={}));
!function(c){var f=function(a,b,d,c){d=a.createShader("vertex"===d?a.VERTEX_SHADER:a.FRAGMENT_SHADER);if(a.shaderSource(d,(c?c+"\n":"")+b),a.compileShader(d),!a.getShaderParameter(d,a.COMPILE_STATUS))throw Error(a.getShaderInfoLog(d));return d},e=function(a,b){var d=a.UNSIGNED_BYTE;return b===g.TEXTURETYPE_FLOAT&&(d=a.FLOAT),d},a=function(a,b,d){var h=d.NEAREST,g=d.NEAREST;return a===c.Texture.BILINEAR_SAMPLINGMODE?(h=d.LINEAR,g=b?d.LINEAR_MIPMAP_NEAREST:d.LINEAR):a===c.Texture.TRILINEAR_SAMPLINGMODE?(h=
d.LINEAR,g=b?d.LINEAR_MIPMAP_LINEAR:d.LINEAR):a===c.Texture.NEAREST_SAMPLINGMODE&&(h=d.NEAREST,g=b?d.NEAREST_MIPMAP_LINEAR:d.NEAREST),{min:g,mag:h}},b=function(b,d,h,g,j,e,f,t,s,u,v){void 0===v&&(v=c.Texture.TRILINEAR_SAMPLINGMODE);var w=h.getEngine(),x=c.Tools.GetExponentOfTwo(g,w.getCaps().maxTextureSize),B=c.Tools.GetExponentOfTwo(j,w.getCaps().maxTextureSize);d.bindTexture(d.TEXTURE_2D,b);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,void 0===e?1:e?1:0);b._baseWidth=g;b._baseHeight=j;b._width=x;b._height=
B;b.isReady=!0;s(x,B);g=a(v,!f,d);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,g.mag);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,g.min);f||t||d.generateMipmap(d.TEXTURE_2D);d.bindTexture(d.TEXTURE_2D,null);w.resetTextureCache();h._removePendingData(b);u&&u()},d=function(a,b,d,h,g){var j;j=c.Tools.LoadImage(a,function(){d[b]=j;d._internalCount++;h._removePendingData(j);6===d._internalCount&&g(d)},function(){h._removePendingData(j)},h.database);h._addPendingData(j)};c.InstancingAttributeInfo=
function(){};var j;j=function(){};c.EngineCapabilities=j;var g,h=function(a,b,d,g){var e=this;if(void 0===g&&(g=!0),this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.enableOfflineSupport=!0,this.scenes=[],this._windowIsBackground=!1,this._webGLVersion="1.0",this._drawCalls=0,this._renderingQueueLaunched=!1,this._activeRenderLoops=[],this.fpsRange=60,this.previousFramesDuration=[],this.fps=60,this.deltaTime=0,this._depthCullingState=new c.Internals._DepthCullingState,
this._alphaState=new c.Internals._AlphaState,this._alphaMode=h.ALPHA_DISABLE,this._loadedTexturesCache=[],this._maxTextureChannels=16,this._activeTexturesCache=Array(this._maxTextureChannels),this._compiledEffects={},this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=[],this._currentInstanceLocations=[],this._currentInstanceBuffers=[],this._renderingCanvas=a,this._externalData=new c.StringDictionary,d=d||{},d.antialias=b,void 0===d.preserveDrawingBuffer&&(d.preserveDrawingBuffer=!1),!this._gl)try{this._gl=
a.getContext("webgl",d)||a.getContext("experimental-webgl",d)}catch(f){throw Error("WebGL not supported");}if(!this._gl)throw Error("WebGL not supported");this._onBlur=function(){e._windowIsBackground=!0};this._onFocus=function(){e._windowIsBackground=!1};window.addEventListener("blur",this._onBlur);window.addEventListener("focus",this._onFocus);b=d.limitDeviceRatio||window.devicePixelRatio||1;this._hardwareScalingLevel=g?1/Math.min(b,window.devicePixelRatio||1):1;this.resize();this._caps=new j;this._caps.maxTexturesImageUnits=
this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS);this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE);this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE);this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE);this._glVersion=this._gl.getParameter(this._gl.VERSION);g=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=g&&(this._glRenderer=this._gl.getParameter(g.UNMASKED_RENDERER_WEBGL),this._glVendor=
this._gl.getParameter(g.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._caps.standardDerivatives=null!==this._gl.getExtension("OES_standard_derivatives"),this._caps.s3tc=this._gl.getExtension("WEBGL_compressed_texture_s3tc"),this._caps.textureFloat=null!==this._gl.getExtension("OES_texture_float"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||
this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.instancedArrays=this._gl.getExtension("ANGLE_instanced_arrays"),this._caps.uintIndices=null!==this._gl.getExtension("OES_element_index_uint"),this._caps.fragmentDepthSupported=null!==this._gl.getExtension("EXT_frag_depth"),this._caps.highPrecisionShaderSupported=
!0,this._caps.drawBuffersExtension=this._gl.getExtension("WEBGL_draw_buffers"),this._caps.textureFloatLinearFiltering=this._gl.getExtension("OES_texture_float_linear"),this._caps.textureLOD=this._gl.getExtension("EXT_shader_texture_lod"),this._gl.getShaderPrecisionFormat)g=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT),this._caps.highPrecisionShaderSupported=0!==g.precision;this.setDepthBuffer(!0);this.setDepthFunctionToLessOrEqual();this.setDepthWrite(!0);this._onFullscreenChange=
function(){void 0!==document.fullscreen?e.isFullscreen=document.fullscreen:void 0!==document.mozFullScreen?e.isFullscreen=document.mozFullScreen:void 0!==document.webkitIsFullScreen?e.isFullscreen=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(e.isFullscreen=document.msIsFullScreen);e.isFullscreen&&e._pointerLockRequested&&(a.requestPointerLock=a.requestPointerLock||a.msRequestPointerLock||a.mozRequestPointerLock||a.webkitRequestPointerLock,a.requestPointerLock&&a.requestPointerLock())};
document.addEventListener("fullscreenchange",this._onFullscreenChange,!1);document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1);document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1);document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1);this._onPointerLockChange=function(){e.isPointerLock=document.mozPointerLockElement===a||document.webkitPointerLockElement===a||document.msPointerLockElement===a||document.pointerLockElement===a};
document.addEventListener("pointerlockchange",this._onPointerLockChange,!1);document.addEventListener("mspointerlockchange",this._onPointerLockChange,!1);document.addEventListener("mozpointerlockchange",this._onPointerLockChange,!1);document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,!1);c.AudioEngine&&!h.audioEngine&&(h.audioEngine=new c.AudioEngine);this._loadingScreen=new c.DefaultLoadingScreen(this._renderingCanvas);c.Tools.Log("Babylon.js engine (v"+h.Version+") launched")};
g=(Object.defineProperty(h,"ALPHA_DISABLE",{get:function(){return h._ALPHA_DISABLE},enumerable:!0,configurable:!0}),Object.defineProperty(h,"ALPHA_ONEONE",{get:function(){return h._ALPHA_ONEONE},enumerable:!0,configurable:!0}),Object.defineProperty(h,"ALPHA_ADD",{get:function(){return h._ALPHA_ADD},enumerable:!0,configurable:!0}),Object.defineProperty(h,"ALPHA_COMBINE",{get:function(){return h._ALPHA_COMBINE},enumerable:!0,configurable:!0}),Object.defineProperty(h,"ALPHA_SUBTRACT",{get:function(){return h._ALPHA_SUBTRACT},
enumerable:!0,configurable:!0}),Object.defineProperty(h,"ALPHA_MULTIPLY",{get:function(){return h._ALPHA_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(h,"ALPHA_MAXIMIZED",{get:function(){return h._ALPHA_MAXIMIZED},enumerable:!0,configurable:!0}),Object.defineProperty(h,"DELAYLOADSTATE_NONE",{get:function(){return h._DELAYLOADSTATE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(h,"DELAYLOADSTATE_LOADED",{get:function(){return h._DELAYLOADSTATE_LOADED},enumerable:!0,configurable:!0}),
Object.defineProperty(h,"DELAYLOADSTATE_LOADING",{get:function(){return h._DELAYLOADSTATE_LOADING},enumerable:!0,configurable:!0}),Object.defineProperty(h,"DELAYLOADSTATE_NOTLOADED",{get:function(){return h._DELAYLOADSTATE_NOTLOADED},enumerable:!0,configurable:!0}),Object.defineProperty(h,"TEXTUREFORMAT_ALPHA",{get:function(){return h._TEXTUREFORMAT_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(h,"TEXTUREFORMAT_LUMINANCE",{get:function(){return h._TEXTUREFORMAT_LUMINANCE},enumerable:!0,
configurable:!0}),Object.defineProperty(h,"TEXTUREFORMAT_LUMINANCE_ALPHA",{get:function(){return h._TEXTUREFORMAT_LUMINANCE_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(h,"TEXTUREFORMAT_RGB",{get:function(){return h._TEXTUREFORMAT_RGB},enumerable:!0,configurable:!0}),Object.defineProperty(h,"TEXTUREFORMAT_RGBA",{get:function(){return h._TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),Object.defineProperty(h,"TEXTURETYPE_UNSIGNED_INT",{get:function(){return h._TEXTURETYPE_UNSIGNED_INT},
enumerable:!0,configurable:!0}),Object.defineProperty(h,"TEXTURETYPE_FLOAT",{get:function(){return h._TEXTURETYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(h,"Version",{get:function(){return"2.4.0"},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),h.prototype._prepareWorkingCanvas=function(){this._workingCanvas||(this._workingCanvas=document.createElement("canvas"),this._workingContext=
this._workingCanvas.getContext("2d"))},h.prototype.resetTextureCache=function(){for(var a=0;a<this._maxTextureChannels;a++)this._activeTexturesCache[a]=null},h.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},h.prototype.getAspectRatio=function(a,b){void 0===b&&(b=!1);var d=a.viewport;return this.getRenderWidth(b)*d.width/(this.getRenderHeight(b)*d.height)},h.prototype.getRenderWidth=function(a){return void 0===a&&(a=!1),!a&&this._currentRenderTarget?
this._currentRenderTarget._width:this._renderingCanvas.width},h.prototype.getRenderHeight=function(a){return void 0===a&&(a=!1),!a&&this._currentRenderTarget?this._currentRenderTarget._height:this._renderingCanvas.height},h.prototype.getRenderingCanvas=function(){return this._renderingCanvas},h.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas.getBoundingClientRect()},h.prototype.setHardwareScalingLevel=function(a){this._hardwareScalingLevel=a;this.resize()},h.prototype.getHardwareScalingLevel=
function(){return this._hardwareScalingLevel},h.prototype.getLoadedTexturesCache=function(){return this._loadedTexturesCache},h.prototype.getCaps=function(){return this._caps},Object.defineProperty(h.prototype,"drawCalls",{get:function(){return this._drawCalls},enumerable:!0,configurable:!0}),h.prototype.resetDrawCalls=function(){this._drawCalls=0},h.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},h.prototype.setDepthFunction=function(a){this._depthCullingState.depthFunc=
a},h.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},h.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},h.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},h.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},h.prototype.stopRenderLoop=function(a){if(!a)return void(this._activeRenderLoops=[]);a=this._activeRenderLoops.indexOf(a);
0<=a&&this._activeRenderLoops.splice(a,1)},h.prototype._renderLoop=function(){this.beginFrame();for(var a=0;a<this._activeRenderLoops.length;a++)(0,this._activeRenderLoops[a])();this.endFrame();0<this._activeRenderLoops.length?c.Tools.QueueNewFrame(this._bindedRenderFunction):this._renderingQueueLaunched=!1},h.prototype.runRenderLoop=function(a){-1===this._activeRenderLoops.indexOf(a)&&(this._activeRenderLoops.push(a),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._bindedRenderFunction=
this._renderLoop.bind(this),c.Tools.QueueNewFrame(this._bindedRenderFunction)))},h.prototype.switchFullscreen=function(a,b){this.isFullscreen?c.Tools.ExitFullscreen():(this._pointerLockRequested=a,c.Tools.RequestFullscreen(this._renderingCanvas,b))},h.prototype.clear=function(a,b,d){this.applyStates();b&&this._gl.clearColor(a.r,a.g,a.b,void 0!==a.a?a.a:1);d&&this._depthCullingState.depthMask&&this._gl.clearDepth(1);a=0;b&&(a|=this._gl.COLOR_BUFFER_BIT);d&&this._depthCullingState.depthMask&&(a|=this._gl.DEPTH_BUFFER_BIT);
this._gl.clear(a)},h.prototype.scissorClear=function(a,b,d,c,h){var g=this._gl,j=g.getParameter(g.SCISSOR_TEST),e=g.getParameter(g.SCISSOR_BOX);g.enable(g.SCISSOR_TEST);g.scissor(a,b,d,c);this.clear(h,!0,!0);g.scissor(e[0],e[1],e[2],e[3]);!0===j?g.enable(g.SCISSOR_TEST):g.disable(g.SCISSOR_TEST)},h.prototype.setViewport=function(a,b,d){b=b||(navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.width);d=d||(navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.height);var c=a.x||0,
h=a.y||0;this._cachedViewport=a;this._gl.viewport(c*b,h*d,b*a.width,d*a.height)},h.prototype.setDirectViewport=function(a,b,d,c){var h=this._cachedViewport;return this._cachedViewport=null,this._gl.viewport(a,b,d,c),h},h.prototype.beginFrame=function(){this._measureFps()},h.prototype.endFrame=function(){},h.prototype.resize=function(){this.setSize((navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.clientWidth)/this._hardwareScalingLevel,(navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.clientHeight)/
this._hardwareScalingLevel);for(var a=0;a<this.scenes.length;a++){var b=this.scenes[a];b.debugLayer.isVisible()&&b.debugLayer._syncPositions()}},h.prototype.setSize=function(a,b){this._renderingCanvas.width=a;this._renderingCanvas.height=b;for(var d=0;d<this.scenes.length;d++)for(var c=this.scenes[d],h=0;h<c.cameras.length;h++)c.cameras[h]._currentRenderId=0},h.prototype.bindFramebuffer=function(a,b,d,c){this._currentRenderTarget=a;var h=this._gl;h.bindFramebuffer(h.FRAMEBUFFER,a._framebuffer);a.isCube?
h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_CUBE_MAP_POSITIVE_X+b,a,0):h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0);this._gl.viewport(0,0,d||a._width,c||a._height);this.wipeCaches()},h.prototype.unBindFramebuffer=function(a,b){if(void 0===b&&(b=!1),this._currentRenderTarget=null,a.generateMipMaps&&!b){var d=this._gl;d.bindTexture(d.TEXTURE_2D,a);d.generateMipmap(d.TEXTURE_2D);d.bindTexture(d.TEXTURE_2D,null)}this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,
null)},h.prototype.generateMipMapsForCubemap=function(a){if(a.generateMipMaps){var b=this._gl;b.bindTexture(b.TEXTURE_CUBE_MAP,a);b.generateMipmap(b.TEXTURE_CUBE_MAP);b.bindTexture(b.TEXTURE_CUBE_MAP,null)}},h.prototype.flushFramebuffer=function(){this._gl.flush()},h.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget=null;this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null);this.setViewport(this._cachedViewport);this.wipeCaches()},h.prototype._resetVertexBufferBinding=function(){this.bindBuffer(null,
this._gl.ARRAY_BUFFER);this._cachedVertexBuffers=null},h.prototype.createVertexBuffer=function(a){var b=this._gl.createBuffer();return this.bindBuffer(b,this._gl.ARRAY_BUFFER),a instanceof Float32Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,a,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(a),this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),b.references=1,b},h.prototype.createDynamicVertexBuffer=function(a){var b=this._gl.createBuffer();return this.bindBuffer(b,
this._gl.ARRAY_BUFFER),a instanceof Float32Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,a,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(a),this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),b.references=1,b},h.prototype.updateDynamicVertexBuffer=function(a,b,d,c){this.bindBuffer(a,this._gl.ARRAY_BUFFER);void 0===d&&(d=0);void 0===c?b instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,d,b):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,d,
new Float32Array(b)):b instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,b.subarray(d,d+c)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,(new Float32Array(b)).subarray(d,d+c));this._resetVertexBufferBinding()},h.prototype._resetIndexBufferBinding=function(){this.bindBuffer(null,this._gl.ELEMENT_ARRAY_BUFFER);this._cachedIndexBuffer=null},h.prototype.createIndexBuffer=function(a){var b=this._gl.createBuffer();this.bindBuffer(b,this._gl.ELEMENT_ARRAY_BUFFER);var d=!1;if(this._caps.uintIndices){for(var c=
0;c<a.length;c++)if(65535<a[c]){d=!0;break}a=d?new Uint32Array(a):new Uint16Array(a)}else a=new Uint16Array(a);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,a,this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),b.references=1,b.is32Bits=d,b},h.prototype.bindArrayBuffer=function(a){this.bindBuffer(a,this._gl.ARRAY_BUFFER)},h.prototype.updateArrayBuffer=function(a){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,a)},h.prototype.bindBuffer=function(a,b){this._currentBoundBuffer[b]!==a&&(this._gl.bindBuffer(b,
a),this._currentBoundBuffer[b]=a)},h.prototype.bindBuffersDirectly=function(a,b,d,c,h){if(this._cachedVertexBuffers!==a||this._cachedEffectForVertexBuffers!==h){this._cachedVertexBuffers=a;this._cachedEffectForVertexBuffers=h;this.bindBuffer(a,this._gl.ARRAY_BUFFER);for(var g=a=0;g<d.length;g++){var j=h.getAttributeLocation(g);0<=j&&this._gl.vertexAttribPointer(j,d[g],this._gl.FLOAT,!1,c,a);a+=4*d[g]}}this._cachedIndexBuffer!==b&&(this._cachedIndexBuffer=b,this.bindBuffer(b,this._gl.ELEMENT_ARRAY_BUFFER),
this._uintIndicesCurrentlySet=b.is32Bits)},h.prototype.bindBuffers=function(a,b,d){if(this._cachedVertexBuffers!==a||this._cachedEffectForVertexBuffers!==d){this._cachedVertexBuffers=a;this._cachedEffectForVertexBuffers=d;for(var c=d.getAttributesNames(),h=0;h<c.length;h++){var g=d.getAttributeLocation(h);if(0<=g){var j=a[c[h]];if(j){var e=j.getBuffer();this.bindBuffer(e,this._gl.ARRAY_BUFFER);this._gl.vertexAttribPointer(g,j.getSize(),this._gl.FLOAT,!1,4*j.getStrideSize(),4*j.getOffset());j.getIsInstanced()&&
(this._caps.instancedArrays.vertexAttribDivisorANGLE(g,1),this._currentInstanceLocations.push(g),this._currentInstanceBuffers.push(e))}}}}null!=b&&this._cachedIndexBuffer!==b&&(this._cachedIndexBuffer=b,this.bindBuffer(b,this._gl.ELEMENT_ARRAY_BUFFER),this._uintIndicesCurrentlySet=b.is32Bits)},h.prototype.unbindInstanceAttributes=function(){for(var a,b=0,d=this._currentInstanceLocations.length;d>b;b++){var c=this._currentInstanceBuffers[b];a!=c&&(a=c,this.bindBuffer(c,this._gl.ARRAY_BUFFER));this._caps.instancedArrays.vertexAttribDivisorANGLE(this._currentInstanceLocations[b],
0)}this._currentInstanceBuffers.length=0;this._currentInstanceLocations.length=0},h.prototype._releaseBuffer=function(a){return a.references--,0===a.references?(this._gl.deleteBuffer(a),!0):!1},h.prototype.createInstancesBuffer=function(a){var b=this._gl.createBuffer();return b.capacity=a,this.bindBuffer(b,this._gl.ARRAY_BUFFER),this._gl.bufferData(this._gl.ARRAY_BUFFER,a,this._gl.DYNAMIC_DRAW),b},h.prototype.deleteInstancesBuffer=function(a){this._gl.deleteBuffer(a)},h.prototype.updateAndBindInstancesBuffer=
function(a,b,d){if(this.bindBuffer(a,this._gl.ARRAY_BUFFER),b&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,b),void 0!==d[0].index){for(var c=b=0;c<d.length;c++){var h=d[c];b+=4*h.attributeSize}for(c=0;c<d.length;c++)h=d[c],this._gl.enableVertexAttribArray(h.index),this._gl.vertexAttribPointer(h.index,h.attributeSize,h.attribyteType||this._gl.FLOAT,h.normalized||!1,b,h.offset),this._caps.instancedArrays.vertexAttribDivisorANGLE(h.index,1),this._currentInstanceLocations.push(h.index),this._currentInstanceBuffers.push(a)}else for(b=
0;4>b;b++)c=d[b],this._gl.enableVertexAttribArray(c),this._gl.vertexAttribPointer(c,4,this._gl.FLOAT,!1,64,16*b),this._caps.instancedArrays.vertexAttribDivisorANGLE(c,1),this._currentInstanceLocations.push(c),this._currentInstanceBuffers.push(a)},h.prototype.applyStates=function(){this._depthCullingState.apply(this._gl);this._alphaState.apply(this._gl)},h.prototype.draw=function(a,b,d,c){this.applyStates();this._drawCalls++;var h=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,
g=this._uintIndicesCurrentlySet?4:2;return c?void this._caps.instancedArrays.drawElementsInstancedANGLE(a?this._gl.TRIANGLES:this._gl.LINES,d,h,b*g,c):void this._gl.drawElements(a?this._gl.TRIANGLES:this._gl.LINES,d,h,b*g)},h.prototype.drawPointClouds=function(a,b,d){return this.applyStates(),this._drawCalls++,d?void this._caps.instancedArrays.drawArraysInstancedANGLE(this._gl.POINTS,a,b,d):void this._gl.drawArrays(this._gl.POINTS,a,b)},h.prototype.drawUnIndexed=function(a,b,d,c){return this.applyStates(),
this._drawCalls++,c?void this._caps.instancedArrays.drawArraysInstancedANGLE(a?this._gl.TRIANGLES:this._gl.LINES,b,d,c):void this._gl.drawArrays(a?this._gl.TRIANGLES:this._gl.LINES,b,d)},h.prototype._releaseEffect=function(a){this._compiledEffects[a._key]&&(delete this._compiledEffects[a._key],a.getProgram()&&this._gl.deleteProgram(a.getProgram()))},h.prototype.createEffect=function(a,b,d,h,g,j,e,f,s){var u=(a.vertexElement||a.vertex||a)+"+"+(a.fragmentElement||a.fragment||a)+"@"+g;if(this._compiledEffects[u])return this._compiledEffects[u];
a=new c.Effect(a,b,d,h,this,g,j,e,f,s);return a._key=u,this._compiledEffects[u]=a,a},h.prototype.createEffectForParticles=function(a,b,d,c,h,g,j){return void 0===b&&(b=[]),void 0===d&&(d=[]),void 0===c&&(c=""),this.createEffect({vertex:"particles",fragmentElement:a},["position","color","options"],["view","projection"].concat(b),["diffuseSampler"].concat(d),c,h,g,j)},h.prototype.createShaderProgram=function(a,b,d){a=f(this._gl,a,"vertex",d);b=f(this._gl,b,"fragment",d);d=this._gl.createProgram();this._gl.attachShader(d,
a);this._gl.attachShader(d,b);this._gl.linkProgram(d);if(!this._gl.getProgramParameter(d,this._gl.LINK_STATUS)){var c=this._gl.getProgramInfoLog(d);if(c)throw Error(c);}return this._gl.deleteShader(a),this._gl.deleteShader(b),d},h.prototype.getUniforms=function(a,b){for(var d=[],c=0;c<b.length;c++)d.push(this._gl.getUniformLocation(a,b[c]));return d},h.prototype.getAttributes=function(a,b){for(var d=[],c=0;c<b.length;c++)try{d.push(this._gl.getAttribLocation(a,b[c]))}catch(h){d.push(-1)}return d},
h.prototype.enableEffect=function(a){if(!a||!a.getAttributesCount()||this._currentEffect===a)return void(a&&a.onBind&&a.onBind(a));this._vertexAttribArraysToUse=this._vertexAttribArraysToUse||[];this._vertexAttribArraysEnabled=this._vertexAttribArraysEnabled||[];this._gl.useProgram(a.getProgram());var b,d;b=0;for(d=this._vertexAttribArraysToUse.length;d>b;b++)this._vertexAttribArraysToUse[b]=!1;d=a.getAttributesCount();for(b=0;d>b;b++){var c=a.getAttributeLocation(b);0<=c&&(this._vertexAttribArraysToUse[c]=
!0)}b=0;for(d=this._vertexAttribArraysEnabled.length;d>b;b++)b>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArraysEnabled[b]||this._vertexAttribArraysToUse[b]||(this._vertexAttribArraysEnabled[b]=!1,this._gl.disableVertexAttribArray(b));b=0;for(d=this._vertexAttribArraysToUse.length;d>b;b++)this._vertexAttribArraysToUse[b]&&!this._vertexAttribArraysEnabled[b]&&(this._vertexAttribArraysEnabled[b]=!0,this._gl.enableVertexAttribArray(b));this._currentEffect=a;a.onBind&&a.onBind(a)},h.prototype.setArray=
function(a,b){a&&this._gl.uniform1fv(a,b)},h.prototype.setArray2=function(a,b){a&&0===b.length%2&&this._gl.uniform2fv(a,b)},h.prototype.setArray3=function(a,b){a&&0===b.length%3&&this._gl.uniform3fv(a,b)},h.prototype.setArray4=function(a,b){a&&0===b.length%4&&this._gl.uniform4fv(a,b)},h.prototype.setMatrices=function(a,b){a&&this._gl.uniformMatrix4fv(a,!1,b)},h.prototype.setMatrix=function(a,b){a&&this._gl.uniformMatrix4fv(a,!1,b.toArray())},h.prototype.setMatrix3x3=function(a,b){a&&this._gl.uniformMatrix3fv(a,
!1,b)},h.prototype.setMatrix2x2=function(a,b){a&&this._gl.uniformMatrix2fv(a,!1,b)},h.prototype.setFloat=function(a,b){a&&this._gl.uniform1f(a,b)},h.prototype.setFloat2=function(a,b,d){a&&this._gl.uniform2f(a,b,d)},h.prototype.setFloat3=function(a,b,d,c){a&&this._gl.uniform3f(a,b,d,c)},h.prototype.setBool=function(a,b){a&&this._gl.uniform1i(a,b)},h.prototype.setFloat4=function(a,b,d,c,h){a&&this._gl.uniform4f(a,b,d,c,h)},h.prototype.setColor3=function(a,b){a&&this._gl.uniform3f(a,b.r,b.g,b.b)},h.prototype.setColor4=
function(a,b,d){a&&this._gl.uniform4f(a,b.r,b.g,b.b,d)},h.prototype.setState=function(a,b,d,c){void 0===b&&(b=0);void 0===c&&(c=!1);var h=c?this._gl.FRONT:this._gl.BACK;c=c?this._gl.BACK:this._gl.FRONT;h=this.cullBackFaces?h:c;(this._depthCullingState.cull!==a||d||this._depthCullingState.cullFace!==h)&&(a?(this._depthCullingState.cullFace=h,this._depthCullingState.cull=!0):this._depthCullingState.cull=!1);this._depthCullingState.zOffset=b},h.prototype.setDepthBuffer=function(a){this._depthCullingState.depthTest=
a},h.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},h.prototype.setDepthWrite=function(a){this._depthCullingState.depthMask=a},h.prototype.setColorWrite=function(a){this._gl.colorMask(a,a,a,a)},h.prototype.setAlphaMode=function(a,b){if(void 0===b&&(b=!1),this._alphaMode!==a){switch(a){case h.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case h.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,
this._gl.ONE);this._alphaState.alphaBlend=!0;break;case h.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE);this._alphaState.alphaBlend=!0;break;case h.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE);this._alphaState.alphaBlend=!0;break;case h.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,
this._gl.ONE);this._alphaState.alphaBlend=!0;break;case h.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE);this._alphaState.alphaBlend=!0;break;case h.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0}b||this.setDepthWrite(a===h.ALPHA_DISABLE);this._alphaMode=a}},h.prototype.getAlphaMode=function(){return this._alphaMode},
h.prototype.setAlphaTesting=function(a){this._alphaTest=a},h.prototype.getAlphaTesting=function(){return this._alphaTest},h.prototype.wipeCaches=function(){this.resetTextureCache();this._currentEffect=null;this._depthCullingState.reset();this.setDepthFunctionToLessOrEqual();this._alphaState.reset();this._cachedEffectForVertexBuffers=this._cachedIndexBuffer=this._cachedVertexBuffers=null},h.prototype.setSamplingMode=function(a,b){var d=this._gl;d.bindTexture(d.TEXTURE_2D,a);var h=d.NEAREST,g=d.NEAREST;
b===c.Texture.BILINEAR_SAMPLINGMODE?(h=d.LINEAR,g=d.LINEAR):b===c.Texture.TRILINEAR_SAMPLINGMODE&&(h=d.LINEAR,g=d.LINEAR_MIPMAP_LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,h);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,g);d.bindTexture(d.TEXTURE_2D,null);a.samplingMode=b},h.prototype.createTexture=function(a,d,h,g,j,e,f,t){var s=this;void 0===j&&(j=c.Texture.TRILINEAR_SAMPLINGMODE);void 0===e&&(e=null);void 0===f&&(f=null);void 0===t&&(t=null);var u,v=this._gl.createTexture(),
w=!1;("data:"===a.substr(0,5)&&(w=!0),w)?(w=a.split(":"),u=w[1].substr(w[1].length-4,4).toLowerCase()):u=a.substr(a.length-4,4).toLowerCase();var x=this.getCaps().s3tc&&".dds"===u,B=".tga"===u;g._addPendingData(v);v.url=a;v.noMipmap=d;v.references=1;v.samplingMode=j;this._loadedTexturesCache.push(v);var y;u=function(){g._removePendingData(v);f&&f()};B?(y=function(a){var m=new Uint8Array(a);a=c.Internals.TGATools.GetTGAHeader(m);b(v,s._gl,g,a.width,a.height,h,d,!1,function(){c.Internals.TGATools.UploadContent(s._gl,
m)},e,j)},w instanceof Array?y(t):c.Tools.LoadFile(a,function(a){y(a)},u,g.database,!0)):x?(y=function(a){var m=c.Internals.DDSTools.GetDDSInfo(a),f=(m.isRGB||m.isLuminance||1<m.mipmapCount)&&!d&&1===m.width>>m.mipmapCount-1;b(v,s._gl,g,m.width,m.height,h,!f,m.isFourCC,function(){c.Internals.DDSTools.UploadDDSLevels(s._gl,s.getCaps().s3tc,a,m,f,1)},e,j)},w instanceof Array?y(t):c.Tools.LoadFile(a,function(a){y(a)},u,g.database,!0)):(x=function(a){b(v,s._gl,g,a.width,a.height,h,d,!1,function(b,d){var h=
a.width===b&&a.height===d;h||(s._prepareWorkingCanvas(),s._workingCanvas.width=b,s._workingCanvas.height=d,j===c.Texture.NEAREST_SAMPLINGMODE&&(s._workingContext.imageSmoothingEnabled=!1,s._workingContext.mozImageSmoothingEnabled=!1,s._workingContext.oImageSmoothingEnabled=!1,s._workingContext.webkitImageSmoothingEnabled=!1,s._workingContext.msImageSmoothingEnabled=!1),s._workingContext.drawImage(a,0,0,a.width,a.height,0,0,b,d),j===c.Texture.NEAREST_SAMPLINGMODE&&(s._workingContext.imageSmoothingEnabled=
!0,s._workingContext.mozImageSmoothingEnabled=!0,s._workingContext.oImageSmoothingEnabled=!0,s._workingContext.webkitImageSmoothingEnabled=!0,s._workingContext.msImageSmoothingEnabled=!0));s._gl.texImage2D(s._gl.TEXTURE_2D,0,s._gl.RGBA,s._gl.RGBA,s._gl.UNSIGNED_BYTE,h?a:s._workingCanvas)},e,j)},w instanceof Array?c.Tools.LoadImage(t,x,u,g.database):c.Tools.LoadImage(a,x,u,g.database));return v},h.prototype._getInternalFormat=function(a){var b=this._gl.RGBA;switch(a){case h.TEXTUREFORMAT_ALPHA:b=this._gl.ALPHA;
break;case h.TEXTUREFORMAT_LUMINANCE:b=this._gl.LUMINANCE;break;case h.TEXTUREFORMAT_LUMINANCE_ALPHA:b=this._gl.LUMINANCE_ALPHA;break;case h.TEXTUREFORMAT_RGB:b=this._gl.RGB;break;case h.TEXTUREFORMAT_RGBA:b=this._gl.RGBA}return b},h.prototype.updateRawTexture=function(a,b,d,c,h){void 0===h&&(h=null);d=this._getInternalFormat(d);this._gl.bindTexture(this._gl.TEXTURE_2D,a);this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,void 0===c?1:c?1:0);0!==a._width%4&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,
1);h?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[h],a._width,a._height,0,b):this._gl.texImage2D(this._gl.TEXTURE_2D,0,d,a._width,a._height,0,d,this._gl.UNSIGNED_BYTE,b);a.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D);this._gl.bindTexture(this._gl.TEXTURE_2D,null);this.resetTextureCache();a.isReady=!0},h.prototype.createRawTexture=function(b,d,c,h,g,j,e,f){void 0===f&&(f=null);var s=this._gl.createTexture();s._baseWidth=d;s._baseHeight=c;s._width=d;s._height=
c;s.references=1;this.updateRawTexture(s,b,h,j,f);this._gl.bindTexture(this._gl.TEXTURE_2D,s);b=a(e,g,this._gl);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,b.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,b.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null),s.samplingMode=e,this._loadedTexturesCache.push(s),s},h.prototype.createDynamicTexture=function(a,b,d,h){var g=this._gl.createTexture();return g._baseWidth=a,g._baseHeight=b,d&&(a=
c.Tools.GetExponentOfTwo(a,this._caps.maxTextureSize),b=c.Tools.GetExponentOfTwo(b,this._caps.maxTextureSize)),this.resetTextureCache(),g._width=a,g._height=b,g.isReady=!1,g.generateMipMaps=d,g.references=1,g.samplingMode=h,this.updateTextureSamplingMode(h,g),this._loadedTexturesCache.push(g),g},h.prototype.updateTextureSamplingMode=function(b,d){var c=a(b,d.generateMipMaps,this._gl);d.isCube?(this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,d),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MAG_FILTER,
c.mag),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MIN_FILTER,c.min),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null)):(this._gl.bindTexture(this._gl.TEXTURE_2D,d),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,c.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,c.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null))},h.prototype.updateDynamicTexture=function(a,b,d,c){void 0===c&&(c=!1);this._gl.bindTexture(this._gl.TEXTURE_2D,
a);this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,d?1:0);c&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,b);a.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D);this._gl.bindTexture(this._gl.TEXTURE_2D,null);this.resetTextureCache();a.isReady=!0},h.prototype.updateVideoTexture=function(a,b,d){if(!a._isDisabled){this._gl.bindTexture(this._gl.TEXTURE_2D,a);this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,
d?0:1);try{void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,b),0!==this._gl.getError()?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported?this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,b):(a._workingCanvas||(a._workingCanvas=document.createElement("canvas"),a._workingContext=a._workingCanvas.getContext("2d"),a._workingCanvas.width=
a._width,a._workingCanvas.height=a._height),a._workingContext.drawImage(b,0,0,b.videoWidth,b.videoHeight,0,0,a._width,a._height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,a._workingCanvas)),a.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this.resetTextureCache(),a.isReady=!0}catch(c){a._isDisabled=!0}}},h.prototype.createRenderTargetTexture=function(b,d){var g=!1,j=!0,f=h.TEXTURETYPE_UNSIGNED_INT,
p=c.Texture.TRILINEAR_SAMPLINGMODE;void 0!==d&&(g=void 0===d.generateMipMaps?d:d.generateMipMaps,j=void 0===d.generateDepthBuffer?!0:d.generateDepthBuffer,f=void 0===d.type?f:d.type,void 0!==d.samplingMode&&(p=d.samplingMode),f===h.TEXTURETYPE_FLOAT&&(p=c.Texture.NEAREST_SAMPLINGMODE));var r=this._gl,t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t);var s=b.width||b,u=b.height||b,v=a(p,g,r);f!==h.TEXTURETYPE_FLOAT||this._caps.textureFloat||(f=h.TEXTURETYPE_UNSIGNED_INT,c.Tools.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));
r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,v.mag);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,v.min);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);r.texImage2D(r.TEXTURE_2D,0,r.RGBA,s,u,0,r.RGBA,e(r,f),null);var w;j&&(w=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,w),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,s,u));f=r.createFramebuffer();return r.bindFramebuffer(r.FRAMEBUFFER,f),
j&&r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,w),g&&this._gl.generateMipmap(this._gl.TEXTURE_2D),r.bindTexture(r.TEXTURE_2D,null),r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),t._framebuffer=f,j&&(t._depthBuffer=w),t._baseWidth=s,t._baseHeight=u,t._width=s,t._height=u,t.isReady=!0,t.generateMipMaps=g,t.references=1,t.samplingMode=p,this.resetTextureCache(),this._loadedTexturesCache.push(t),t},h.prototype.createRenderTargetCubeTexture=
function(b,d){var h=this._gl,g=h.createTexture(),j=!0,e=c.Texture.TRILINEAR_SAMPLINGMODE;void 0!==d&&(j=void 0===d.generateMipMaps?d:d.generateMipMaps,void 0!==d.samplingMode&&(e=d.samplingMode));g.isCube=!0;g.references=1;g.generateMipMaps=j;g.references=1;g.samplingMode=e;j=a(e,j,h);h.bindTexture(h.TEXTURE_CUBE_MAP,g);for(e=0;6>e;e++)h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,h.RGBA,b,b,0,h.RGBA,h.UNSIGNED_BYTE,null);h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAG_FILTER,j.mag);h.texParameteri(h.TEXTURE_CUBE_MAP,
h.TEXTURE_MIN_FILTER,j.min);h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE);h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE);j=h.createRenderbuffer();h.bindRenderbuffer(h.RENDERBUFFER,j);h.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_COMPONENT16,b,b);e=h.createFramebuffer();return h.bindFramebuffer(h.FRAMEBUFFER,e),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,j),g.generateMipMaps&&(h.bindTexture(h.TEXTURE_CUBE_MAP,g),h.generateMipmap(h.TEXTURE_CUBE_MAP)),
h.bindTexture(h.TEXTURE_CUBE_MAP,null),h.bindRenderbuffer(h.RENDERBUFFER,null),h.bindFramebuffer(h.FRAMEBUFFER,null),g._framebuffer=e,g._depthBuffer=j,this.resetTextureCache(),g._width=b,g._height=b,g.isReady=!0,g},h.prototype.createCubeTexture=function(a,b,h,g){var j=this,e=this._gl,f=e.createTexture();f.isCube=!0;f.url=a;f.references=1;var t=a.substr(a.length-4,4).toLowerCase();if(this.getCaps().s3tc&&".dds"===t)c.Tools.LoadFile(a,function(a){var b=c.Internals.DDSTools.GetDDSInfo(a),d=(b.isRGB||
b.isLuminance||1<b.mipmapCount)&&!g;e.bindTexture(e.TEXTURE_CUBE_MAP,f);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1);c.Internals.DDSTools.UploadDDSLevels(j._gl,j.getCaps().s3tc,a,b,d,6);g||b.isFourCC||1!==b.mipmapCount||e.generateMipmap(e.TEXTURE_CUBE_MAP);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,d?e.LINEAR_MIPMAP_LINEAR:e.LINEAR);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_CUBE_MAP,
e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.bindTexture(e.TEXTURE_CUBE_MAP,null);j.resetTextureCache();f._width=b.width;f._height=b.height;f.isReady=!0},null,null,!0);else{a=function(a){var b=c.Tools.GetExponentOfTwo(a[0].width,j._caps.maxCubemapTextureSize);j._prepareWorkingCanvas();j._workingCanvas.width=b;j._workingCanvas.height=b;var d=[e.TEXTURE_CUBE_MAP_POSITIVE_X,e.TEXTURE_CUBE_MAP_POSITIVE_Y,e.TEXTURE_CUBE_MAP_POSITIVE_Z,e.TEXTURE_CUBE_MAP_NEGATIVE_X,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.TEXTURE_CUBE_MAP_NEGATIVE_Z];
e.bindTexture(e.TEXTURE_CUBE_MAP,f);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0);for(var h=0;h<d.length;h++)j._workingContext.drawImage(a[h],0,0,a[h].width,a[h].height,0,0,b,b),e.texImage2D(d[h],0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,j._workingCanvas);g||e.generateMipmap(e.TEXTURE_CUBE_MAP);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,g?e.LINEAR:e.LINEAR_MIPMAP_LINEAR);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);
e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.bindTexture(e.TEXTURE_CUBE_MAP,null);j.resetTextureCache();f._width=b;f._height=b;f.isReady=!0};for(var t=[],s=t._internalCount=0;6>s;s++)d(h[s],s,t,b,a)}return f},h.prototype.updateTextureSize=function(a,b,d){a._width=b;a._height=d;a._size=b*d;a._baseWidth=b;a._baseHeight=d},h.prototype.createRawCubeTexture=function(a,b,d,g,j,e,f,t){var s=this,u=this._gl,v=u.createTexture();b._addPendingData(v);v.isCube=!0;v.references=1;v.url=
a;var w=this._getInternalFormat(g),x=u.UNSIGNED_BYTE;j===h.TEXTURETYPE_FLOAT&&(x=u.FLOAT);var B=d,y=B,C=c.Tools.IsExponentOfTwo(B)&&c.Tools.IsExponentOfTwo(y);v._width=B;v._height=y;return c.Tools.LoadFile(a,function(a){var d=f(a);a=[u.TEXTURE_CUBE_MAP_POSITIVE_X,u.TEXTURE_CUBE_MAP_POSITIVE_Y,u.TEXTURE_CUBE_MAP_POSITIVE_Z,u.TEXTURE_CUBE_MAP_NEGATIVE_X,u.TEXTURE_CUBE_MAP_NEGATIVE_Y,u.TEXTURE_CUBE_MAP_NEGATIVE_Z];if(B=v._width,y=v._height,C=c.Tools.IsExponentOfTwo(B)&&c.Tools.IsExponentOfTwo(y),u.bindTexture(u.TEXTURE_CUBE_MAP,
v),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,0),!e&&C)if(t){var h=[];h.push(d[0]);h.push(d[3]);h.push(d[1]);h.push(d[4]);h.push(d[2]);h.push(d[5]);d=t(h);for(h=0;h<d.length;h++){var g=B>>h;u.texImage2D(a[0],h,w,g,g,0,w,x,d[h][0]);u.texImage2D(a[1],h,w,g,g,0,w,x,d[h][2]);u.texImage2D(a[2],h,w,g,g,0,w,x,d[h][4]);u.texImage2D(a[3],h,w,g,g,0,w,x,d[h][1]);u.texImage2D(a[4],h,w,g,g,0,w,x,d[h][3]);u.texImage2D(a[5],h,w,g,g,0,w,x,d[h][5])}}else{for(h=0;h<a.length;h++)g=d[h],u.texImage2D(a[h],0,w,B,y,0,w,x,g);if(u.generateMipmap(u.TEXTURE_CUBE_MAP),
x===u.FLOAT&&w===u.RGB&&1282===u.getError()){c.Tools.Log("RGB32F not renderable on Firefox, trying fallback to RGBA32F.");for(h=0;h<a.length;h++){for(var g=d[h],j=new Float32Array(4*B*y),m=0;B>m;m++)for(var k=0;y>k;k++){var n=3*(k*B+m),q=4*(k*B+m);j[q+0]=g[n+0];j[q+1]=g[n+1];j[q+2]=g[n+2];j[q+3]=1}u.texImage2D(a[h],0,u.RGBA,B,y,0,u.RGBA,x,j)}u.generateMipmap(u.TEXTURE_CUBE_MAP)}}else e=!0;x!==u.FLOAT||s._caps.textureFloatLinearFiltering?(u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_MAG_FILTER,u.LINEAR),
u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_MIN_FILTER,e?u.LINEAR:u.LINEAR_MIPMAP_LINEAR)):(u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_MIN_FILTER,u.NEAREST));u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE);u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE);u.bindTexture(u.TEXTURE_CUBE_MAP,null);v.isReady=!0;s.resetTextureCache();b._removePendingData(v)},function(){b._removePendingData(v)},
b.database,!0),v},h.prototype._releaseTexture=function(a){var b=this._gl;a._framebuffer&&b.deleteFramebuffer(a._framebuffer);a._depthBuffer&&b.deleteRenderbuffer(a._depthBuffer);b.deleteTexture(a);this.unbindAllTextures();a=this._loadedTexturesCache.indexOf(a);-1!==a&&this._loadedTexturesCache.splice(a,1)},h.prototype.bindSamplers=function(a){this._gl.useProgram(a.getProgram());for(var b=a.getSamplers(),d=0;d<b.length;d++){var c=a.getUniform(b[d]);this._gl.uniform1i(c,d)}this._currentEffect=null},
h.prototype._bindTexture=function(a,b){0>a||(this._gl.activeTexture(this._gl["TEXTURE"+a]),this._gl.bindTexture(this._gl.TEXTURE_2D,b),this._activeTexturesCache[a]=null)},h.prototype.setTextureFromPostProcess=function(a,b){this._bindTexture(a,b._textures.data[b._currentRenderTextureInd])},h.prototype.unbindAllTextures=function(){for(var a=0;a<this._caps.maxTexturesImageUnits;a++)this._gl.activeTexture(this._gl["TEXTURE"+a]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,
null),this._activeTexturesCache[a]=null},h.prototype.setTexture=function(a,b){if(!(0>a)){if(!b||!b.isReady())return void(null!=this._activeTexturesCache[a]&&(this._gl.activeTexture(this._gl["TEXTURE"+a]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[a]=null));var d=!1;if(b instanceof c.VideoTexture)this._gl.activeTexture(this._gl["TEXTURE"+a]),d=!0,b.update();else if(b.delayLoadState===h.DELAYLOADSTATE_NOTLOADED)return void b.delayLoad();
if(this._activeTexturesCache[a]!==b){this._activeTexturesCache[a]=b;var g=b.getInternalTexture();if(d||this._gl.activeTexture(this._gl["TEXTURE"+a]),g.isCube){if(this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,g),g._cachedCoordinatesMode!==b.coordinatesMode)g._cachedCoordinatesMode=b.coordinatesMode,d=b.coordinatesMode!==c.Texture.CUBIC_MODE&&b.coordinatesMode!==c.Texture.SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE,this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,d),
this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,d);this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,b)}else{if(this._gl.bindTexture(this._gl.TEXTURE_2D,g),g._cachedWrapU!==b.wrapU)switch(g._cachedWrapU=b.wrapU,b.wrapU){case c.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.REPEAT);break;case c.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);break;case c.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,
this._gl.TEXTURE_WRAP_S,this._gl.MIRRORED_REPEAT)}if(g._cachedWrapV!==b.wrapV)switch(g._cachedWrapV=b.wrapV,b.wrapV){case c.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.REPEAT);break;case c.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);break;case c.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.MIRRORED_REPEAT)}this._setAnisotropicLevel(this._gl.TEXTURE_2D,
b)}}}},h.prototype._setAnisotropicLevel=function(a,b){var d=this._caps.textureAnisotropicFilterExtension,h=b.anisotropicFilteringLevel;b.getInternalTexture().samplingMode===c.Texture.NEAREST_SAMPLINGMODE&&(h=1);d&&b._cachedAnisotropicFilteringLevel!==h&&(this._gl.texParameterf(a,d.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(h,this._caps.maxAnisotropy)),b._cachedAnisotropicFilteringLevel=h)},h.prototype.readPixels=function(a,b,d,c){var h=new Uint8Array(4*c*d);return this._gl.readPixels(a,b,d,c,this._gl.RGBA,
this._gl.UNSIGNED_BYTE,h),h},h.prototype.addExternalData=function(a,b){return this._externalData.add(a,b)},h.prototype.getExternalData=function(a){return this._externalData.get(a)},h.prototype.getOrAddExternalDataWithFactory=function(a,b){return this._externalData.getOrAddWithFactory(a,b)},h.prototype.removeExternalData=function(a){return this._externalData.remove(a)},h.prototype.releaseInternalTexture=function(a){if(a&&(a.references--,0===a.references)){var b=this.getLoadedTexturesCache(),d=b.indexOf(a);
-1<d&&b.splice(d,1);this._releaseTexture(a)}},h.prototype.dispose=function(){this.hideLoadingUI();for(this.stopRenderLoop();this.scenes.length;)this.scenes[0].dispose();h.audioEngine.dispose();for(var a in this._compiledEffects)this._gl.deleteProgram(this._compiledEffects[a]._program);if(this._vertexAttribArraysEnabled){a=0;for(var b=this._vertexAttribArraysEnabled.length;b>a;a++)a>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArraysEnabled[a]||this._gl.disableVertexAttribArray(a)}this._gl=
null;window.removeEventListener("blur",this._onBlur);window.removeEventListener("focus",this._onFocus);document.removeEventListener("fullscreenchange",this._onFullscreenChange);document.removeEventListener("mozfullscreenchange",this._onFullscreenChange);document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange);document.removeEventListener("msfullscreenchange",this._onFullscreenChange);document.removeEventListener("pointerlockchange",this._onPointerLockChange);document.removeEventListener("mspointerlockchange",
this._onPointerLockChange);document.removeEventListener("mozpointerlockchange",this._onPointerLockChange);document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange)},h.prototype.displayLoadingUI=function(){this._loadingScreen.displayLoadingUI()},h.prototype.hideLoadingUI=function(){this._loadingScreen.hideLoadingUI()},Object.defineProperty(h.prototype,"loadingScreen",{get:function(){return this._loadingScreen},set:function(a){this._loadingScreen=a},enumerable:!0,configurable:!0}),
Object.defineProperty(h.prototype,"loadingUIText",{set:function(a){this._loadingScreen.loadingUIText=a},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"loadingUIBackgroundColor",{set:function(a){this._loadingScreen.loadingUIBackgroundColor=a},enumerable:!0,configurable:!0}),h.prototype.getFps=function(){return this.fps},h.prototype.getDeltaTime=function(){return this.deltaTime},h.prototype._measureFps=function(){this.previousFramesDuration.push(c.Tools.Now);var a=this.previousFramesDuration.length;
if(2<=a&&(this.deltaTime=this.previousFramesDuration[a-1]-this.previousFramesDuration[a-2]),a>=this.fpsRange){a>this.fpsRange&&(this.previousFramesDuration.splice(0,1),a=this.previousFramesDuration.length);for(var b=0,d=0;a-1>d;d++)b+=this.previousFramesDuration[d+1]-this.previousFramesDuration[d];this.fps=1E3/(b/(a-1))}},h.isSupported=function(){try{if(navigator.isCocoonJS)return!0;var a=document.createElement("canvas");return null!=(a.getContext("webgl")||a.getContext("experimental-webgl"))&&!!window.WebGLRenderingContext}catch(b){return!1}},
h._ALPHA_DISABLE=0,h._ALPHA_ADD=1,h._ALPHA_COMBINE=2,h._ALPHA_SUBTRACT=3,h._ALPHA_MULTIPLY=4,h._ALPHA_MAXIMIZED=5,h._ALPHA_ONEONE=6,h._DELAYLOADSTATE_NONE=0,h._DELAYLOADSTATE_LOADED=1,h._DELAYLOADSTATE_LOADING=2,h._DELAYLOADSTATE_NOTLOADED=4,h._TEXTUREFORMAT_ALPHA=0,h._TEXTUREFORMAT_LUMINANCE=1,h._TEXTUREFORMAT_LUMINANCE_ALPHA=2,h._TEXTUREFORMAT_RGB=4,h._TEXTUREFORMAT_RGBA=5,h._TEXTURETYPE_UNSIGNED_INT=0,h._TEXTURETYPE_FLOAT=1,h.CollisionsEpsilon=0.001,h.CodeRepository="src/",h.ShadersRepository=
"src/Shaders/",h);c.Engine=g}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(c,a){this.state="";this.animations=[];this._ranges={};this._childrenFlag=-1;this._isReady=this._isEnabled=!0;this._parentRenderId=this._currentRenderId=-1;this.id=this.name=c;this._scene=a;this._initCache()};f=(Object.defineProperty(f.prototype,"parent",{get:function(){return this._parentNode},set:function(c){if(this._parentNode!==c){if(this._parentNode){var a=this._parentNode._children.indexOf(this);-1!==a&&this._parentNode._children.splice(a,1)}(this._parentNode=c)&&
(this._parentNode._children||(this._parentNode._children=[]),this._parentNode._children.push(this))}},enumerable:!0,configurable:!0}),f.prototype.getScene=function(){return this._scene},f.prototype.getEngine=function(){return this._scene.getEngine()},f.prototype.getWorldMatrix=function(){return c.Matrix.Identity()},f.prototype._initCache=function(){this._cache={};this._cache.parent=void 0},f.prototype.updateCache=function(c){!c&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},
f.prototype._updateCache=function(){},f.prototype._isSynchronized=function(){return!0},f.prototype._markSyncedWithParent=function(){this._parentRenderId=this.parent._currentRenderId},f.prototype.isSynchronizedWithParent=function(){return this.parent?this._parentRenderId!==this.parent._currentRenderId?!1:this.parent.isSynchronized():!0},f.prototype.isSynchronized=function(c){var a=this.hasNewParent();return a=a||!this.isSynchronizedWithParent(),a=a||!this._isSynchronized(),c&&this.updateCache(!0),
!a},f.prototype.hasNewParent=function(c){return this._cache.parent===this.parent?!1:(c&&(this._cache.parent=this.parent),!0)},f.prototype.isReady=function(){return this._isReady},f.prototype.isEnabled=function(){return this._isEnabled?this.parent?this.parent.isEnabled():!0:!1},f.prototype.setEnabled=function(c){this._isEnabled=c},f.prototype.isDescendantOf=function(c){return this.parent?this.parent===c?!0:this.parent.isDescendantOf(c):!1},f.prototype._getDescendants=function(c,a,b){if(void 0===a&&
(a=!1),this._children)for(var d=0;d<this._children.length;d++){var j=this._children[d];b&&!b(j)||c.push(j);a||j._getDescendants(c,!1,b)}},f.prototype.getDescendants=function(c,a){var b=[];return this._getDescendants(b,c,a),b},f.prototype.getChildren=function(c){return this.getDescendants(!0,c)},f.prototype.getChildMeshes=function(e,a){var b=[];return this._getDescendants(b,e,function(b){return(!a||a(b))&&b instanceof c.AbstractMesh}),b},f.prototype._setReady=function(c){if(c!==this._isReady){if(!c)return void(this._isReady=
!1);this._isReady=!0;this.onReady&&this.onReady(this)}},f.prototype.getAnimationByName=function(c){for(var a=0;a<this.animations.length;a++){var b=this.animations[a];if(b.name===c)return b}return null},f.prototype.createAnimationRange=function(e,a,b){if(!this._ranges[e]){this._ranges[e]=new c.AnimationRange(e,a,b);for(var d=0,j=this.animations.length;j>d;d++)this.animations[d]&&this.animations[d].createRange(e,a,b)}},f.prototype.deleteAnimationRange=function(c,a){void 0===a&&(a=!0);for(var b=0,d=
this.animations.length;d>b;b++)this.animations[b]&&this.animations[b].deleteRange(c,a);this._ranges[c]=void 0},f.prototype.getAnimationRange=function(c){return this._ranges[c]},f.prototype.beginAnimation=function(c,a,b,d){return(c=this.getAnimationRange(c))?void this._scene.beginAnimation(this,c.from,c.to,a,b,d):null},f.prototype.serializeAnimationRanges=function(){var c=[],a;for(a in this._ranges){var b={};b.name=a;b.from=this._ranges[a].from;b.to=this._ranges[a].to;c.push(b)}return c},f.prototype.dispose=
function(){this.parent=null},f.ParseAnimationRanges=function(c,a){if(a.ranges)for(var b=0;b<a.ranges.length;b++){var d=a.ranges[b];c.createAnimationRange(d.name,d.from,d.to)}},__decorate([c.serialize()],f.prototype,"name",void 0),__decorate([c.serialize()],f.prototype,"id",void 0),__decorate([c.serialize()],f.prototype,"uniqueId",void 0),__decorate([c.serialize()],f.prototype,"state",void 0),f);c.Node=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,b,d,c,g,h,e,l){this._engine=a;this._canvas=d;this._currentScene=b;this._sceneLoadedCallback=c;this._progressCallback=g;this._additionnalRenderLoopLogicCallback=h;this._textureLoadingCallback=e;this._startingProcessingFilesCallback=l};f=(e.prototype.monitorElementForDragNDrop=function(a){var b=this;a&&(this._elementToMonitor=a,this._elementToMonitor.addEventListener("dragenter",function(a){b.drag(a)},!1),this._elementToMonitor.addEventListener("dragover",function(a){b.drag(a)},
!1),this._elementToMonitor.addEventListener("drop",function(a){b.drop(a)},!1))},e.prototype.renderFunction=function(){if(this._additionnalRenderLoopLogicCallback&&this._additionnalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var a=this._currentScene.getWaitingItemsCount();0<a&&this._textureLoadingCallback(a)}this._currentScene.render()}},e.prototype.drag=function(a){a.stopPropagation();a.preventDefault()},e.prototype.drop=function(a){a.stopPropagation();a.preventDefault();
this.loadFiles(a)},e.prototype.loadFiles=function(a){if(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(),a&&a.dataTransfer&&a.dataTransfer.files&&(this._filesToLoad=a.dataTransfer.files),a&&a.target&&a.target.files&&(this._filesToLoad=a.target.files),this._filesToLoad&&0<this._filesToLoad.length){for(a=0;a<this._filesToLoad.length;a++)switch(this._filesToLoad[a].type){case "image/jpeg":case "image/png":case "image/bmp":e.FilesTextures[this._filesToLoad[a].name.toLowerCase()]=
this._filesToLoad[a];break;case "image/targa":case "image/vnd.ms-dds":case "audio/wav":case "audio/x-wav":case "audio/mp3":case "audio/mpeg":case "audio/mpeg3":case "audio/x-mpeg-3":case "audio/ogg":e.FilesToLoad[this._filesToLoad[a].name.toLowerCase()]=this._filesToLoad[a];break;default:-1!==this._filesToLoad[a].name.indexOf(".mtl")?e.FilesToLoad[this._filesToLoad[a].name.toLowerCase()]=this._filesToLoad[a]:-1===this._filesToLoad[a].name.indexOf(".babylon")&&-1===this._filesToLoad[a].name.indexOf(".stl")&&
-1===this._filesToLoad[a].name.indexOf(".obj")||-1!==this._filesToLoad[a].name.indexOf(".manifest")||-1!==this._filesToLoad[a].name.indexOf(".incremental")||-1!==this._filesToLoad[a].name.indexOf(".babylonmeshdata")||-1!==this._filesToLoad[a].name.indexOf(".babylongeometrydata")||-1!==this._filesToLoad[a].name.indexOf(".babylonbinarymeshdata")||-1!==this._filesToLoad[a].name.indexOf(".binary.babylon")||(this._sceneFileToLoad=this._filesToLoad[a])}this.reload()}},e.prototype.reload=function(){var a=
this,b=this;this._sceneFileToLoad?(this._currentScene&&(0<c.Tools.errorsCount&&(c.Tools.ClearLogCache(),c.Tools.Log("Babylon.js engine (v"+c.Engine.Version+") launched")),this._engine.stopRenderLoop(),this._currentScene.dispose()),c.SceneLoader.Load("file:",this._sceneFileToLoad,this._engine,function(d){b._currentScene=d;b._currentScene.executeWhenReady(function(){b._currentScene.activeCamera&&0!==b._currentScene.lights.length||b._currentScene.createDefaultCameraOrLight();b._currentScene.activeCamera.attachControl(b._canvas);
b._sceneLoadedCallback&&b._sceneLoadedCallback(a._sceneFileToLoad,b._currentScene);b._engine.runRenderLoop(function(){b.renderFunction()})})},function(b){a._progressCallback&&a._progressCallback(b)})):c.Tools.Error("Please provide a valid .babylon file.")},e.FilesTextures=[],e.FilesToLoad=[],e);c.FilesInput=f}(BABYLON||(BABYLON={}));
!function(c){c.IntersectionInfo=function(c,a,b){this.bu=c;this.bv=a;this.distance=b;this.subMeshId=this.faceId=0};var f;f=function(){this.hit=!1;this.distance=0;this.pickedMesh=this.pickedPoint=null;this.bv=this.bu=0;this.faceId=-1;this.subMeshId=0;this.pickedSprite=null};f=(f.prototype.getNormal=function(e,a){if(void 0===e&&(e=!1),void 0===a&&(a=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(c.VertexBuffer.NormalKind))return null;var b;b=this.pickedMesh.getIndices();if(a){var d=this.pickedMesh.getVerticesData(c.VertexBuffer.NormalKind),
j=c.Vector3.FromArray(d,3*b[3*this.faceId]),g=c.Vector3.FromArray(d,3*b[3*this.faceId+1]);b=c.Vector3.FromArray(d,3*b[3*this.faceId+2]);j=j.scale(this.bu);g=g.scale(this.bv);b=b.scale(1-this.bu-this.bv);b=new c.Vector3(j.x+g.x+b.x,j.y+g.y+b.y,j.z+g.z+b.z)}else d=this.pickedMesh.getVerticesData(c.VertexBuffer.PositionKind),g=c.Vector3.FromArray(d,3*b[3*this.faceId]),j=c.Vector3.FromArray(d,3*b[3*this.faceId+1]),b=c.Vector3.FromArray(d,3*b[3*this.faceId+2]),g=g.subtract(j),b=b.subtract(j),b=c.Vector3.Cross(g,
b);return e&&(b=c.Vector3.TransformNormal(b,this.pickedMesh.getWorldMatrix())),c.Vector3.Normalize(b)},f.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(c.VertexBuffer.UVKind))return null;var e=this.pickedMesh.getIndices(),a=this.pickedMesh.getVerticesData(c.VertexBuffer.UVKind),b=c.Vector2.FromArray(a,2*e[3*this.faceId]),d=c.Vector2.FromArray(a,2*e[3*this.faceId+1]),e=c.Vector2.FromArray(a,2*e[3*this.faceId+2]);return b=b.scale(1-this.bu-this.bv),
d=d.scale(this.bu),e=e.scale(this.bv),new c.Vector2(b.x+d.x+e.x,b.y+d.y+e.y)},f);c.PickingInfo=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(e,a){this.minimum=e;this.maximum=a;this._tempRadiusVector=c.Vector3.Zero();var b=c.Vector3.Distance(e,a);this.center=c.Vector3.Lerp(e,a,0.5);this.radius=0.5*b;this.centerWorld=c.Vector3.Zero();this._update(c.Matrix.Identity())};f=(f.prototype._update=function(e){c.Vector3.TransformCoordinatesToRef(this.center,e,this.centerWorld);c.Vector3.TransformNormalFromFloatsToRef(1,1,1,e,this._tempRadiusVector);this.radiusWorld=Math.max(Math.abs(this._tempRadiusVector.x),Math.abs(this._tempRadiusVector.y),
Math.abs(this._tempRadiusVector.z))*this.radius},f.prototype.isInFrustum=function(c){for(var a=0;6>a;a++)if(c[a].dotCoordinate(this.centerWorld)<=-this.radiusWorld)return!1;return!0},f.prototype.intersectsPoint=function(e){var a=this.centerWorld.x-e.x,b=this.centerWorld.y-e.y;e=this.centerWorld.z-e.z;a=Math.sqrt(a*a+b*b+e*e);return!(Math.abs(this.radiusWorld-a)<c.Epsilon)},f.Intersects=function(c,a){var b=c.centerWorld.x-a.centerWorld.x,d=c.centerWorld.y-a.centerWorld.y,j=c.centerWorld.z-a.centerWorld.z,
b=Math.sqrt(b*b+d*d+j*j);return!(c.radiusWorld+a.radiusWorld<b)},f);c.BoundingSphere=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,b){this.minimum=a;this.maximum=b;this.vectors=[];this.vectorsWorld=[];this.vectors.push(this.minimum.clone());this.vectors.push(this.maximum.clone());this.vectors.push(this.minimum.clone());this.vectors[2].x=this.maximum.x;this.vectors.push(this.minimum.clone());this.vectors[3].y=this.maximum.y;this.vectors.push(this.minimum.clone());this.vectors[4].z=this.maximum.z;this.vectors.push(this.maximum.clone());this.vectors[5].z=this.minimum.z;this.vectors.push(this.maximum.clone());
this.vectors[6].x=this.minimum.x;this.vectors.push(this.maximum.clone());this.vectors[7].y=this.minimum.y;this.center=this.maximum.add(this.minimum).scale(0.5);this.extendSize=this.maximum.subtract(this.minimum).scale(0.5);this.directions=[c.Vector3.Zero(),c.Vector3.Zero(),c.Vector3.Zero()];for(var d=0;d<this.vectors.length;d++)this.vectorsWorld[d]=c.Vector3.Zero();this.minimumWorld=c.Vector3.Zero();this.maximumWorld=c.Vector3.Zero();this._update(c.Matrix.Identity())};f=(e.prototype.getWorldMatrix=
function(){return this._worldMatrix},e.prototype.setWorldMatrix=function(a){return this._worldMatrix.copyFrom(a),this},e.prototype._update=function(a){c.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimumWorld);c.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximumWorld);for(var b=0;b<this.vectors.length;b++){var d=this.vectorsWorld[b];c.Vector3.TransformCoordinatesToRef(this.vectors[b],a,d);d.x<this.minimumWorld.x&&(this.minimumWorld.x=
d.x);d.y<this.minimumWorld.y&&(this.minimumWorld.y=d.y);d.z<this.minimumWorld.z&&(this.minimumWorld.z=d.z);d.x>this.maximumWorld.x&&(this.maximumWorld.x=d.x);d.y>this.maximumWorld.y&&(this.maximumWorld.y=d.y);d.z>this.maximumWorld.z&&(this.maximumWorld.z=d.z)}this.maximumWorld.addToRef(this.minimumWorld,this.center);this.center.scaleInPlace(0.5);c.Vector3.FromFloatArrayToRef(a.m,0,this.directions[0]);c.Vector3.FromFloatArrayToRef(a.m,4,this.directions[1]);c.Vector3.FromFloatArrayToRef(a.m,8,this.directions[2]);
this._worldMatrix=a},e.prototype.isInFrustum=function(a){return e.IsInFrustum(this.vectorsWorld,a)},e.prototype.isCompletelyInFrustum=function(a){return e.IsCompletelyInFrustum(this.vectorsWorld,a)},e.prototype.intersectsPoint=function(a){var b=-c.Epsilon;return this.maximumWorld.x-a.x<b||b>a.x-this.minimumWorld.x?!1:this.maximumWorld.y-a.y<b||b>a.y-this.minimumWorld.y?!1:!(this.maximumWorld.z-a.z<b||b>a.z-this.minimumWorld.z)},e.prototype.intersectsSphere=function(a){return e.IntersectsSphere(this.minimumWorld,
this.maximumWorld,a.centerWorld,a.radiusWorld)},e.prototype.intersectsMinMax=function(a,b){return this.maximumWorld.x<a.x||this.minimumWorld.x>b.x?!1:this.maximumWorld.y<a.y||this.minimumWorld.y>b.y?!1:!(this.maximumWorld.z<a.z||this.minimumWorld.z>b.z)},e.Intersects=function(a,b){return a.maximumWorld.x<b.minimumWorld.x||a.minimumWorld.x>b.maximumWorld.x?!1:a.maximumWorld.y<b.minimumWorld.y||a.minimumWorld.y>b.maximumWorld.y?!1:!(a.maximumWorld.z<b.minimumWorld.z||a.minimumWorld.z>b.maximumWorld.z)},
e.IntersectsSphere=function(a,b,d,j){a=c.Vector3.Clamp(d,a,b);d=c.Vector3.DistanceSquared(d,a);return j*j>=d},e.IsCompletelyInFrustum=function(a,b){for(var d=0;6>d;d++)for(var c=0;8>c;c++)if(0>b[d].dotCoordinate(a[c]))return!1;return!0},e.IsInFrustum=function(a,b){for(var d=0;6>d;d++){for(var c=8,g=0;8>g&&0>b[d].dotCoordinate(a[g]);g++)--c;if(0===c)return!1}return!0},e);c.BoundingBox=f}(BABYLON||(BABYLON={}));
!function(c){var f=function(a,d){var j=c.Vector3.Dot(d.center,a),g=Math.abs(c.Vector3.Dot(d.directions[0],a))*d.extendSize.x,h=Math.abs(c.Vector3.Dot(d.directions[1],a))*d.extendSize.y,e=Math.abs(c.Vector3.Dot(d.directions[2],a))*d.extendSize.z,g=g+h+e;return{min:j-g,max:j+g}},e=function(a,d,c){d=f(a,d);a=f(a,c);return!(d.min>a.max||a.min>d.max)},a;a=function(a,d){this.minimum=a;this.maximum=d;this._isLocked=!1;this.boundingBox=new c.BoundingBox(a,d);this.boundingSphere=new c.BoundingSphere(a,d)};
a=(Object.defineProperty(a.prototype,"isLocked",{get:function(){return this._isLocked},set:function(a){this._isLocked=a},enumerable:!0,configurable:!0}),a.prototype.update=function(a){this._isLocked||(this.boundingBox._update(a),this.boundingSphere._update(a))},a.prototype.isInFrustum=function(a){return this.boundingSphere.isInFrustum(a)?this.boundingBox.isInFrustum(a):!1},a.prototype.isCompletelyInFrustum=function(a){return this.boundingBox.isCompletelyInFrustum(a)},a.prototype._checkCollision=function(a){return a._canDoCollision(this.boundingSphere.centerWorld,
this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},a.prototype.intersectsPoint=function(a){return this.boundingSphere.centerWorld&&this.boundingSphere.intersectsPoint(a)?!!this.boundingBox.intersectsPoint(a):!1},a.prototype.intersects=function(a,d){if(!this.boundingSphere.centerWorld||!a.boundingSphere.centerWorld||!c.BoundingSphere.Intersects(this.boundingSphere,a.boundingSphere)||!c.BoundingBox.Intersects(this.boundingBox,a.boundingBox))return!1;if(!d)return!0;
var j=this.boundingBox,g=a.boundingBox;return e(j.directions[0],j,g)&&e(j.directions[1],j,g)&&e(j.directions[2],j,g)&&e(g.directions[0],j,g)&&e(g.directions[1],j,g)&&e(g.directions[2],j,g)&&e(c.Vector3.Cross(j.directions[0],g.directions[0]),j,g)&&e(c.Vector3.Cross(j.directions[0],g.directions[1]),j,g)&&e(c.Vector3.Cross(j.directions[0],g.directions[2]),j,g)&&e(c.Vector3.Cross(j.directions[1],g.directions[0]),j,g)&&e(c.Vector3.Cross(j.directions[1],g.directions[1]),j,g)&&e(c.Vector3.Cross(j.directions[1],
g.directions[2]),j,g)&&e(c.Vector3.Cross(j.directions[2],g.directions[0]),j,g)&&e(c.Vector3.Cross(j.directions[2],g.directions[1]),j,g)?!!e(c.Vector3.Cross(j.directions[2],g.directions[2]),j,g):!1},a);c.BoundingInfo=a}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,b,d){void 0===d&&(d=Number.MAX_VALUE);this.origin=a;this.direction=b;this.length=d};f=(e.prototype.intersectsBoxMinMax=function(a,b){var d,c,g,h,e=0,l=Number.MAX_VALUE;if(1E-7>Math.abs(this.direction.x)){if(this.origin.x<a.x||this.origin.x>b.x)return!1}else if(d=1/this.direction.x,c=(a.x-this.origin.x)*d,g=(b.x-this.origin.x)*d,g===-(1/0)&&(g=1/0),c>g&&(h=c,c=g,g=h),e=Math.max(c,e),l=Math.min(g,l),e>l)return!1;if(1E-7>Math.abs(this.direction.y)){if(this.origin.y<a.y||
this.origin.y>b.y)return!1}else if(d=1/this.direction.y,c=(a.y-this.origin.y)*d,g=(b.y-this.origin.y)*d,g===-(1/0)&&(g=1/0),c>g&&(h=c,c=g,g=h),e=Math.max(c,e),l=Math.min(g,l),e>l)return!1;if(1E-7>Math.abs(this.direction.z)){if(this.origin.z<a.z||this.origin.z>b.z)return!1}else if(d=1/this.direction.z,c=(a.z-this.origin.z)*d,g=(b.z-this.origin.z)*d,g===-(1/0)&&(g=1/0),c>g&&(h=c,c=g,g=h),e=Math.max(c,e),l=Math.min(g,l),e>l)return!1;return!0},e.prototype.intersectsBox=function(a){return this.intersectsBoxMinMax(a.minimum,
a.maximum)},e.prototype.intersectsSphere=function(a){var b=a.center.x-this.origin.x,d=a.center.y-this.origin.y,c=a.center.z-this.origin.z,g=b*b+d*d+c*c;a=a.radius*a.radius;if(a>=g)return!0;b=b*this.direction.x+d*this.direction.y+c*this.direction.z;return 0>b?!1:a>=g-b*b},e.prototype.intersectsTriangle=function(a,b,d){this._edge1||(this._edge1=c.Vector3.Zero(),this._edge2=c.Vector3.Zero(),this._pvec=c.Vector3.Zero(),this._tvec=c.Vector3.Zero(),this._qvec=c.Vector3.Zero());b.subtractToRef(a,this._edge1);
d.subtractToRef(a,this._edge2);c.Vector3.CrossToRef(this.direction,this._edge2,this._pvec);b=c.Vector3.Dot(this._edge1,this._pvec);if(0===b)return null;b=1/b;this.origin.subtractToRef(a,this._tvec);a=c.Vector3.Dot(this._tvec,this._pvec)*b;if(0>a||1<a)return null;c.Vector3.CrossToRef(this._tvec,this._edge1,this._qvec);d=c.Vector3.Dot(this.direction,this._qvec)*b;if(0>d||1<a+d)return null;b*=c.Vector3.Dot(this._edge2,this._qvec);return b>this.length?null:new c.IntersectionInfo(a,d,b)},e.prototype.intersectsPlane=
function(a){var b,d=c.Vector3.Dot(a.normal,this.direction);if(9.99999997475243E-7>Math.abs(d))return null;var j=c.Vector3.Dot(a.normal,this.origin);return b=(-a.d-j)/d,0>b?-9.99999997475243E-7>b?null:0:b},e.prototype.intersectionSegment=function(a,b,d){var j,g,h=this.origin.add(this.direction.multiplyByFloats(e.rayl,e.rayl,e.rayl));b=b.subtract(a);h=h.subtract(this.origin);a=a.subtract(this.origin);var m=c.Vector3.Dot(b,b),l=c.Vector3.Dot(b,h),k=c.Vector3.Dot(h,h),f=c.Vector3.Dot(b,a),q=c.Vector3.Dot(h,
a),p=m*k-l*l,r=p,t=p;p<e.smallnum?(j=0,r=1,g=q,t=k):(j=l*q-k*f,g=m*q-l*f,0>j?(j=0,g=q,t=k):j>r&&(j=r,g=q+l,t=k));0>g?(g=0,0>-f?j=0:-f>m?j=r:(j=-f,r=m)):g>t&&(g=t,0>-f+l?j=0:-f+l>m?j=r:(j=-f+l,r=m));j=Math.abs(j)<e.smallnum?0:j/r;g=Math.abs(g)<e.smallnum?0:g/t;h=h.multiplyByFloats(g,g,g);b=a.add(b.multiplyByFloats(j,j,j)).subtract(h);return 0<g&&g<=this.length&&b.lengthSquared()<d*d?h.length():-1},e.CreateNew=function(a,b,d,j,g,h,m){var l=c.Vector3.Unproject(new c.Vector3(a,b,0),d,j,g,h,m);a=c.Vector3.Unproject(new c.Vector3(a,
b,1),d,j,g,h,m).subtract(l);return a.normalize(),new e(l,a)},e.CreateNewFromTo=function(a,b,d){void 0===d&&(d=c.Matrix.Identity());b=b.subtract(a);var j=Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z);return b.normalize(),e.Transform(new e(a,b,j),d)},e.Transform=function(a,b){var d=c.Vector3.TransformCoordinates(a.origin,b),j=c.Vector3.TransformNormal(a.direction,b);return j.normalize(),new e(d,j,a.length)},e.smallnum=1E-8,e.rayl=1E9,e);c.Ray=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Node,a=function(b,d){var j=this;e.call(this,b,d);this.onDisposeObservable=new c.Observable;this.onCollideObservable=new c.Observable;this.onCollisionPositionChangeObservable=new c.Observable;this.onAfterWorldMatrixUpdateObservable=new c.Observable;this.definedFacingForward=!0;this.position=new c.Vector3(0,0,0);this._rotation=new c.Vector3(0,0,0);this._scaling=new c.Vector3(1,1,1);this.billboardMode=a.BILLBOARDMODE_NONE;this.visibility=1;this.alphaIndex=Number.MAX_VALUE;this.infiniteDistance=
!1;this.isPickable=this.isVisible=!0;this.isBlocker=this.showSubMeshesBoundingBox=this.showBoundingBox=!1;this.renderingGroupId=0;this.renderOutline=this.receiveShadows=!1;this.outlineColor=c.Color3.Red();this.outlineWidth=0.02;this.renderOverlay=!1;this.overlayColor=c.Color3.Red();this.overlayAlpha=0.5;this.hasVertexAlpha=!1;this.computeBonesUsingShaders=this.applyFog=this.useVertexColors=!0;this.scalingDeterminant=1;this.numBoneInfluencers=4;this.useOctreeForCollisions=this.useOctreeForPicking=
this.useOctreeForRenderingSelection=!0;this.layerMask=268435455;this._checkCollisions=this.alwaysSelectAsActiveMesh=!1;this.ellipsoid=new c.Vector3(0.5,1,0.5);this.ellipsoidOffset=new c.Vector3(0,0,0);this._collider=new c.Collider;this._oldPositionForCollisions=new c.Vector3(0,0,0);this._diffPositionForCollisions=new c.Vector3(0,0,0);this._newPositionForCollisions=new c.Vector3(0,0,0);this.edgesWidth=1;this.edgesColor=new c.Color4(1,0,0,1);this._localWorld=c.Matrix.Zero();this._worldMatrix=c.Matrix.Zero();
this._rotateYByPI=c.Matrix.RotationY(Math.PI);this._absolutePosition=c.Vector3.Zero();this._collisionsTransformMatrix=c.Matrix.Zero();this._collisionsScalingMatrix=c.Matrix.Zero();this._isDirty=!1;this._pivotMatrix=c.Matrix.Identity();this._isDisposed=!1;this._renderId=0;this._intersectionsInProgress=[];this._unIndexed=this._isWorldMatrixFrozen=!1;this._onCollisionPositionChange=function(a,b,d){void 0===d&&(d=null);j.getScene().workerCollisions&&b.multiplyInPlace(j._collider.radius);b.subtractToRef(j._oldPositionForCollisions,
j._diffPositionForCollisions);j._diffPositionForCollisions.length()>c.Engine.CollisionsEpsilon&&j.position.addInPlace(j._diffPositionForCollisions);d&&j.onCollideObservable.notifyObservers(d);j.onCollisionPositionChangeObservable.notifyObservers(j.position)};d.addMesh(this)};f=(__extends(a,e),Object.defineProperty(a,"BILLBOARDMODE_NONE",{get:function(){return a._BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(a,"BILLBOARDMODE_X",{get:function(){return a._BILLBOARDMODE_X},
enumerable:!0,configurable:!0}),Object.defineProperty(a,"BILLBOARDMODE_Y",{get:function(){return a._BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(a,"BILLBOARDMODE_Z",{get:function(){return a._BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(a,"BILLBOARDMODE_ALL",{get:function(){return a._BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onDispose",{set:function(a){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);
this._onDisposeObserver=this.onDisposeObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onCollide",{set:function(a){this._onCollideObserver&&this.onCollideObservable.remove(this._onCollideObserver);this._onCollideObserver=this.onCollideObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onCollisionPositionChange",{set:function(a){this._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._onCollisionPositionChangeObserver);
this._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"skeleton",{get:function(){return this._skeleton},set:function(a){this._skeleton&&this._skeleton.needInitialSkinMatrix&&this._skeleton._unregisterMeshWithPoseMatrix(this);a&&a.needInitialSkinMatrix&&a._registerMeshWithPoseMatrix(this);(this._skeleton=a)||(this._bonesTransformMatrices=null)},enumerable:!0,configurable:!0}),a.prototype.toString=function(a){var d=
"Name: "+this.name+", isInstance: "+(this instanceof c.InstancedMesh?"YES":"NO");return d+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0),this._skeleton&&(d+=", skeleton: "+this._skeleton.name),a&&(d+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],d+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingFreezeWorldMatrix?"YES":"NO")),d},Object.defineProperty(a.prototype,"rotation",{get:function(){return this._rotation},set:function(a){this._rotation=
a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"scaling",{get:function(){return this._scaling},set:function(a){this._scaling=a;this.physicsImpostor&&this.physicsImpostor.forceUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(a){(this._rotationQuaternion=a)&&this.rotation.length()&&this.rotation.copyFromFloats(0,0,0)},enumerable:!0,configurable:!0}),a.prototype.updatePoseMatrix=
function(a){this._poseMatrix.copyFrom(a)},a.prototype.getPoseMatrix=function(){return this._poseMatrix},a.prototype.disableEdgesRendering=function(){void 0!==this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=void 0)},a.prototype.enableEdgesRendering=function(a,d){void 0===a&&(a=0.95);void 0===d&&(d=!1);this.disableEdgesRendering();this._edgesRenderer=new c.EdgesRenderer(this,a,d)},Object.defineProperty(a.prototype,"isBlocked",{get:function(){return!1},enumerable:!0,configurable:!0}),
a.prototype.getLOD=function(){return this},a.prototype.getTotalVertices=function(){return 0},a.prototype.getIndices=function(){return null},a.prototype.getVerticesData=function(){return null},a.prototype.isVerticesDataPresent=function(){return!1},a.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},Object.defineProperty(a.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&
this.isVerticesDataPresent(c.VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(c.VertexBuffer.MatricesWeightsKind)},enumerable:!0,configurable:!0}),a.prototype._preActivate=function(){},a.prototype._preActivateForIntermediateRendering=function(){},a.prototype._activate=function(a){this._renderId=a},a.prototype.getWorldMatrix=function(){return this._masterMesh?this._masterMesh.getWorldMatrix():(this._currentRenderId!==this.getScene().getRenderId()&&this.computeWorldMatrix(),this._worldMatrix)},
Object.defineProperty(a.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),a.prototype.freezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1;this.computeWorldMatrix(!0);this._isWorldMatrixFrozen=!0},a.prototype.unfreezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1;this.computeWorldMatrix(!0)},Object.defineProperty(a.prototype,
"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),a.prototype.rotate=function(a,d,j){a.normalize();this.rotationQuaternion||(this.rotationQuaternion=c.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation=c.Vector3.Zero());j&&j!==c.Space.LOCAL?(this.parent&&(j=this.parent.getWorldMatrix().clone(),j.invert(),a=c.Vector3.TransformNormal(a,j)),a=c.Quaternion.RotationAxis(a,d),this.rotationQuaternion=a.multiply(this.rotationQuaternion)):
(a=c.Quaternion.RotationAxis(a,d),this.rotationQuaternion=this.rotationQuaternion.multiply(a))},a.prototype.translate=function(a,d,j){a=a.scale(d);j&&j!==c.Space.LOCAL?this.setAbsolutePosition(this.getAbsolutePosition().add(a)):(j=this.getPositionExpressedInLocalSpace().add(a),this.setPositionWithLocalVector(j))},a.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},a.prototype.setAbsolutePosition=function(a){if(a){var d,j,g;if(void 0===a.x){if(3>arguments.length)return;
d=arguments[0];j=arguments[1];g=arguments[2]}else d=a.x,j=a.y,g=a.z;if(this.parent){var h=this.parent.getWorldMatrix().clone();h.invert();d=new c.Vector3(d,j,g);this.position=c.Vector3.TransformCoordinates(d,h)}else this.position.x=d,this.position.y=j,this.position.z=g}},a.prototype.movePOV=function(a,d,c){this.position.addInPlace(this.calcMovePOV(a,d,c))},a.prototype.calcMovePOV=function(a,d,j){var g=new c.Matrix;(this.rotationQuaternion?this.rotationQuaternion:c.Quaternion.RotationYawPitchRoll(this.rotation.y,
this.rotation.x,this.rotation.z)).toRotationMatrix(g);var h=c.Vector3.Zero(),e=this.definedFacingForward?-1:1;return c.Vector3.TransformCoordinatesFromFloatsToRef(a*e,d,j*e,g,h),h},a.prototype.rotatePOV=function(a,d,c){this.rotation.addInPlace(this.calcRotatePOV(a,d,c))},a.prototype.calcRotatePOV=function(a,d,j){var g=this.definedFacingForward?1:-1;return new c.Vector3(a*g,d,j*g)},a.prototype.setPivotMatrix=function(a){this._pivotMatrix=a;this._cache.pivotMatrixUpdated=!0},a.prototype.getPivotMatrix=
function(){return this._pivotMatrix},a.prototype._isSynchronized=function(){if(this._isDirty||(this.billboardMode!==this._cache.billboardMode||this.billboardMode!==a.BILLBOARDMODE_NONE)||this._cache.pivotMatrixUpdated||this.infiniteDistance||!this._cache.position.equals(this.position))return!1;if(this.rotationQuaternion){if(!this._cache.rotationQuaternion.equals(this.rotationQuaternion))return!1}else if(!this._cache.rotation.equals(this.rotation))return!1;return!!this._cache.scaling.equals(this.scaling)},
a.prototype._initCache=function(){e.prototype._initCache.call(this);this._cache.localMatrixUpdated=!1;this._cache.position=c.Vector3.Zero();this._cache.scaling=c.Vector3.Zero();this._cache.rotation=c.Vector3.Zero();this._cache.rotationQuaternion=new c.Quaternion(0,0,0,0);this._cache.billboardMode=-1},a.prototype.markAsDirty=function(a){"rotation"===a&&(this.rotationQuaternion=null);this._currentRenderId=Number.MAX_VALUE;this._isDirty=!0},a.prototype._updateBoundingInfo=function(){this._boundingInfo=
this._boundingInfo||new c.BoundingInfo(this.absolutePosition,this.absolutePosition);this._boundingInfo.update(this.worldMatrixFromCache);this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)},a.prototype._updateSubMeshesBoundingInfo=function(a){if(this.subMeshes)for(var d=0;d<this.subMeshes.length;d++){var c=this.subMeshes[d];c.IsGlobal||c.updateBoundingInfo(a)}},a.prototype.computeWorldMatrix=function(b){if(this._isWorldMatrixFrozen)return this._worldMatrix;if(!b&&(this._currentRenderId===
this.getScene().getRenderId()||this.isSynchronized(!0)))return this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix;if(this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._cache.billboardMode=this.billboardMode,this._currentRenderId=this.getScene().getRenderId(),this._isDirty=!1,c.Matrix.ScalingToRef(this.scaling.x*this.scalingDeterminant,this.scaling.y*this.scalingDeterminant,this.scaling.z*this.scalingDeterminant,
c.Tmp.Matrix[1]),this.rotationQuaternion)this.rotation.length()&&(this.rotationQuaternion.multiplyInPlace(c.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)),this.rotation.copyFromFloats(0,0,0));if(this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(c.Tmp.Matrix[0]),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(c.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,c.Tmp.Matrix[0]),this._cache.rotation.copyFrom(this.rotation)),
this.infiniteDistance&&!this.parent){if(b=this.getScene().activeCamera)b=b.getWorldMatrix(),b=new c.Vector3(b.m[12],b.m[13],b.m[14]),c.Matrix.TranslationToRef(this.position.x+b.x,this.position.y+b.y,this.position.z+b.z,c.Tmp.Matrix[2])}else c.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,c.Tmp.Matrix[2]);if(this._pivotMatrix.multiplyToRef(c.Tmp.Matrix[1],c.Tmp.Matrix[4]),c.Tmp.Matrix[4].multiplyToRef(c.Tmp.Matrix[0],c.Tmp.Matrix[5]),this.billboardMode!==a.BILLBOARDMODE_NONE&&
this.getScene().activeCamera){c.Tmp.Vector3[0].copyFrom(this.position);b=c.Tmp.Vector3[0];if(this.parent&&this.parent.getWorldMatrix){this._markSyncedWithParent();var d;this._meshToBoneReferal?(this.parent.getWorldMatrix().multiplyToRef(this._meshToBoneReferal.getWorldMatrix(),c.Tmp.Matrix[6]),d=c.Tmp.Matrix[6]):d=this.parent.getWorldMatrix();c.Vector3.TransformNormalToRef(b,d,c.Tmp.Vector3[1]);b=c.Tmp.Vector3[1]}d=this.getScene().activeCamera.globalPosition.clone();this.parent&&this.parent.position&&
(b.addInPlace(this.parent.position),c.Matrix.TranslationToRef(b.x,b.y,b.z,c.Tmp.Matrix[2]));(this.billboardMode&a.BILLBOARDMODE_ALL)!==a.BILLBOARDMODE_ALL&&(this.billboardMode&a.BILLBOARDMODE_X&&(d.x=b.x+c.Epsilon),this.billboardMode&a.BILLBOARDMODE_Y&&(d.y=b.y+c.Epsilon),this.billboardMode&a.BILLBOARDMODE_Z&&(d.z=b.z+c.Epsilon));c.Matrix.LookAtLHToRef(b,d,c.Vector3.Up(),c.Tmp.Matrix[3]);c.Tmp.Matrix[3].m[12]=c.Tmp.Matrix[3].m[13]=c.Tmp.Matrix[3].m[14]=0;c.Tmp.Matrix[3].invert();c.Tmp.Matrix[5].multiplyToRef(c.Tmp.Matrix[3],
this._localWorld);this._rotateYByPI.multiplyToRef(this._localWorld,c.Tmp.Matrix[5])}return c.Tmp.Matrix[5].multiplyToRef(c.Tmp.Matrix[2],this._localWorld),this.parent&&this.parent.getWorldMatrix&&this.billboardMode===a.BILLBOARDMODE_NONE?(this._markSyncedWithParent(),this._meshToBoneReferal?(this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),c.Tmp.Matrix[6]),c.Tmp.Matrix[6].multiplyToRef(this._meshToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),
this._worldMatrix)):this._worldMatrix.copyFrom(this._localWorld),this._updateBoundingInfo(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=c.Matrix.Invert(this._worldMatrix)),this._worldMatrix},a.prototype.registerAfterWorldMatrixUpdate=function(a){this.onAfterWorldMatrixUpdateObservable.add(a)},a.prototype.unregisterAfterWorldMatrixUpdate=
function(a){this.onAfterWorldMatrixUpdateObservable.removeCallback(a)},a.prototype.setPositionWithLocalVector=function(a){this.computeWorldMatrix();this.position=c.Vector3.TransformNormal(a,this._localWorld)},a.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var a=this._localWorld.clone();return a.invert(),c.Vector3.TransformNormal(this.position,a)},a.prototype.locallyTranslate=function(a){this.computeWorldMatrix(!0);this.position=c.Vector3.TransformCoordinates(a,this._localWorld)},
a.prototype.lookAt=function(a,d,j,g){d=d||0;j=j||0;g=g||0;var h=a.subtract(this.position);a=-Math.atan2(h.z,h.x)-Math.PI/2;var e=Math.sqrt(h.x*h.x+h.z*h.z),h=Math.atan2(h.y,e);this.rotationQuaternion=c.Quaternion.RotationYawPitchRoll(a+d,h+j,g)},a.prototype.attachToBone=function(a,d){this._meshToBoneReferal=d;this.parent=a;0>a.getWorldMatrix().determinant()&&(this.scalingDeterminant*=-1)},a.prototype.detachFromBone=function(){0>this.parent.getWorldMatrix().determinant()&&(this.scalingDeterminant*=
-1);this.parent=this._meshToBoneReferal=null},a.prototype.isInFrustum=function(a){return this._boundingInfo.isInFrustum(a)},a.prototype.isCompletelyInFrustum=function(a){a||(a=this.getScene().activeCamera);a=a.getViewMatrix().multiply(a.getProjectionMatrix());return!!this._boundingInfo.isCompletelyInFrustum(c.Frustum.GetPlanes(a))},a.prototype.intersectsMesh=function(a,d){return this._boundingInfo&&a._boundingInfo?this._boundingInfo.intersects(a._boundingInfo,d):!1},a.prototype.intersectsPoint=function(a){return this._boundingInfo?
this._boundingInfo.intersectsPoint(a):!1},a.prototype.setPhysicsState=function(a,d){return a.impostor&&(d=a,a=a.impostor),this.physicsImpostor=new c.PhysicsImpostor(this,a,d,this.getScene()),this.physicsImpostor.physicsBody},a.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},a.prototype.getPhysicsMass=function(){return this.physicsImpostor.getParam("mass")},a.prototype.getPhysicsFriction=function(){return this.physicsImpostor.getParam("friction")},a.prototype.getPhysicsRestitution=
function(){return this.physicsImpostor.getParam("resitution")},a.prototype.getPositionInCameraSpace=function(a){return a||(a=this.getScene().activeCamera),c.Vector3.TransformCoordinates(this.absolutePosition,a.getViewMatrix())},a.prototype.getDistanceToCamera=function(a){return a||(a=this.getScene().activeCamera),this.absolutePosition.subtract(a.position).length()},a.prototype.applyImpulse=function(a,d){this.physicsImpostor&&this.physicsImpostor.applyImpulse(a,d)},a.prototype.setPhysicsLinkWith=function(a,
d,j,g){this.physicsImpostor&&a.physicsImpostor&&this.physicsImpostor.createJoint(a.physicsImpostor,c.PhysicsJoint.HingeJoint,{mainPivot:d,connectedPivot:j,nativeParams:g})},a.prototype.updatePhysicsBodyPosition=function(){c.Tools.Warn("updatePhysicsBodyPosition() is deprecated, please use updatePhysicsBody()");this.updatePhysicsBody()},a.prototype.updatePhysicsBody=function(){},Object.defineProperty(a.prototype,"checkCollisions",{get:function(){return this._checkCollisions},set:function(a){this._checkCollisions=
a;this.getScene().workerCollisions&&this.getScene().collisionCoordinator.onMeshUpdated(this)},enumerable:!0,configurable:!0}),a.prototype.moveWithCollisions=function(a){this.getAbsolutePosition().subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPositionForCollisions);this._oldPositionForCollisions.addInPlace(this.ellipsoidOffset);this._collider.radius=this.ellipsoid;this.getScene().collisionCoordinator.getNewPosition(this._oldPositionForCollisions,a,this._collider,3,this,this._onCollisionPositionChange,
this.uniqueId)},a.prototype.createOrUpdateSubmeshesOctree=function(a,d){void 0===a&&(a=64);void 0===d&&(d=2);this._submeshesOctree||(this._submeshesOctree=new c.Octree(c.Octree.CreationFuncForSubMeshes,a,d));this.computeWorldMatrix(!0);var j=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(j.minimumWorld,j.maximumWorld,this.subMeshes),this._submeshesOctree},a.prototype._collideForSubMesh=function(a,d,j){if(this._generatePointsArray(),!a._lastColliderWorldVertices||!a._lastColliderTransformMatrix.equals(d)){a._lastColliderTransformMatrix=
d.clone();a._lastColliderWorldVertices=[];a._trianglePlanes=[];for(var g=a.verticesStart+a.verticesCount,h=a.verticesStart;g>h;h++)a._lastColliderWorldVertices.push(c.Vector3.TransformCoordinates(this._positions[h],d))}j._collide(a._trianglePlanes,a._lastColliderWorldVertices,this.getIndices(),a.indexStart,a.indexStart+a.indexCount,a.verticesStart,!!a.getMaterial());j.collisionFound&&(j.collidedMesh=this)},a.prototype._processCollisionsForSubMeshes=function(a,d){var c,g;this._submeshesOctree&&this.useOctreeForCollisions?
(g=a.velocityWorldLength+Math.max(a.radius.x,a.radius.y,a.radius.z),c=this._submeshesOctree.intersects(a.basePointWorld,g),g=c.length,c=c.data):(c=this.subMeshes,g=c.length);for(var h=0;g>h;h++){var e=c[h];1<g&&!e._checkCollision(a)||this._collideForSubMesh(e,d,a)}},a.prototype._checkCollision=function(a){this._boundingInfo._checkCollision(a)&&(c.Matrix.ScalingToRef(1/a.radius.x,1/a.radius.y,1/a.radius.z,this._collisionsScalingMatrix),this.worldMatrixFromCache.multiplyToRef(this._collisionsScalingMatrix,
this._collisionsTransformMatrix),this._processCollisionsForSubMeshes(a,this._collisionsTransformMatrix))},a.prototype._generatePointsArray=function(){return!1},a.prototype.intersects=function(a,d){var j=new c.PickingInfo;if(!this.subMeshes||(!this._boundingInfo||!a.intersectsSphere(this._boundingInfo.boundingSphere)||!a.intersectsBox(this._boundingInfo.boundingBox))||!this._generatePointsArray())return j;var g,h,e=null;this._submeshesOctree&&this.useOctreeForPicking?(h=c.Ray.Transform(a,this.getWorldMatrix()),
g=this._submeshesOctree.intersectsRay(h),h=g.length,g=g.data):(g=this.subMeshes,h=g.length);for(var l=0;h>l;l++){var k=g[l];if(!(1<h)||k.canIntersects(a))if((k=k.intersects(a,this._positions,this.getIndices(),d))&&(d||!e||k.distance<e.distance)&&(e=k,e.subMeshId=l,d))break}return e?(g=this.getWorldMatrix(),h=c.Vector3.TransformCoordinates(a.origin,g),l=a.direction.clone(),l=l.scale(e.distance),g=c.Vector3.TransformNormal(l,g),g=h.add(g),j.hit=!0,j.distance=c.Vector3.Distance(h,g),j.pickedPoint=g,
j.pickedMesh=this,j.bu=e.bu,j.bv=e.bv,j.faceId=e.faceId,j.subMeshId=e.subMeshId,j):j},a.prototype.clone=function(){return null},a.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=[]},a.prototype.dispose=function(a){var d,c=this;this.actionManager&&(this.actionManager.dispose(),this.actionManager=null);this.skeleton=null;this.getScene().stopAnimation(this);this.physicsImpostor&&this.physicsImpostor.dispose();for(d=0;d<
this._intersectionsInProgress.length;d++){var g=this._intersectionsInProgress[d],h=g._intersectionsInProgress.indexOf(this);g._intersectionsInProgress.splice(h,1)}this._intersectionsInProgress=[];if(this.getScene().lights.forEach(function(a){var b=a.includedOnlyMeshes.indexOf(c);-1!==b&&a.includedOnlyMeshes.splice(b,1);b=a.excludedMeshes.indexOf(c);-1!==b&&a.excludedMeshes.splice(b,1)}),this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this.releaseSubMeshes(),this.getScene().removeMesh(this),
a){a=this.getChildMeshes(!0);for(d=0;d<a.length;d++)g=a[d],g.parent=null,g.computeWorldMatrix(!0)}else{for(d=0;d<this.getScene().particleSystems.length;d++)this.getScene().particleSystems[d].emitter===this&&(this.getScene().particleSystems[d].dispose(),d--);a=this.getDescendants(!0);for(d=0;d<a.length;d++)a[d].dispose()}e.prototype.dispose.call(this);this.onAfterWorldMatrixUpdateObservable.clear();this.onCollideObservable.clear();this.onCollisionPositionChangeObservable.clear();this._isDisposed=!0;
this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear()},a._BILLBOARDMODE_NONE=0,a._BILLBOARDMODE_X=1,a._BILLBOARDMODE_Y=2,a._BILLBOARDMODE_Z=4,a._BILLBOARDMODE_ALL=7,a);c.AbstractMesh=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Node,a=function(a,d){e.call(this,a,d);this.diffuse=new c.Color3(1,1,1);this.specular=new c.Color3(1,1,1);this.intensity=1;this.range=Number.MAX_VALUE;this.includeOnlyWithLayerMask=0;this.includedOnlyMeshes=[];this.excludedMeshes=[];this.excludeWithLayerMask=0;this.radius=1E-5;this._excludedMeshesIds=[];this._includedOnlyMeshesIds=[];d.addLight(this)};f=(__extends(a,e),a.prototype.toString=function(a){var d="Name: "+this.name;if(d+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],
this.animations)for(var c=0;c<this.animations.length;c++)d+=", animation[0]: "+this.animations[c].toString(a);return d},a.prototype.getShadowGenerator=function(){return this._shadowGenerator},a.prototype.getAbsolutePosition=function(){return c.Vector3.Zero()},a.prototype.transferToEffect=function(){},a.prototype._getWorldMatrix=function(){return c.Matrix.Identity()},a.prototype.canAffectMesh=function(a){return a?0<this.includedOnlyMeshes.length&&-1===this.includedOnlyMeshes.indexOf(a)?!1:0<this.excludedMeshes.length&&
-1!==this.excludedMeshes.indexOf(a)?!1:0!==this.includeOnlyWithLayerMask&&0===(this.includeOnlyWithLayerMask&a.layerMask)?!1:!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&a.layerMask):!0},a.prototype.getWorldMatrix=function(){this._currentRenderId=this.getScene().getRenderId();var a=this._getWorldMatrix();return this.parent&&this.parent.getWorldMatrix?(this._parentedWorldMatrix||(this._parentedWorldMatrix=c.Matrix.Identity()),a.multiplyToRef(this.parent.getWorldMatrix(),this._parentedWorldMatrix),
this._markSyncedWithParent(),this._parentedWorldMatrix):a},a.prototype.dispose=function(){this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null);this.getScene().stopAnimation(this);this.getScene().removeLight(this);e.prototype.dispose.call(this)},a.prototype.getTypeID=function(){return 0},a.prototype.clone=function(b){return c.SerializationHelper.Clone(a.GetConstructorFromName(this.getTypeID(),b,this.getScene()),this)},a.prototype.serialize=function(){var a=c.SerializationHelper.Serialize(this);
return a.type=this.getTypeID(),this.parent&&(a.parentId=this.parent.id),0<this.excludedMeshes.length&&(a.excludedMeshesIds=[],this.excludedMeshes.forEach(function(d){a.excludedMeshesIds.push(d.id)})),0<this.includedOnlyMeshes.length&&(a.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(d){a.includedOnlyMeshesIds.push(d.id)})),c.Animation.AppendSerializedAnimations(this,a),a.ranges=this.serializeAnimationRanges(),a},a.GetConstructorFromName=function(a,d,j){switch(a){case 0:return function(){return new c.PointLight(d,
c.Vector3.Zero(),j)};case 1:return function(){return new c.DirectionalLight(d,c.Vector3.Zero(),j)};case 2:return function(){return new c.SpotLight(d,c.Vector3.Zero(),c.Vector3.Zero(),0,0,j)};case 3:return function(){return new c.HemisphericLight(d,c.Vector3.Zero(),j)}}},a.Parse=function(b,d){var j=c.SerializationHelper.Parse(a.GetConstructorFromName(b.type,b.name,d),b,d);if(b.excludedMeshesIds&&(j._excludedMeshesIds=b.excludedMeshesIds),b.includedOnlyMeshesIds&&(j._includedOnlyMeshesIds=b.includedOnlyMeshesIds),
b.parentId&&(j._waitingParentId=b.parentId),b.animations){for(var g=0;g<b.animations.length;g++)j.animations.push(c.Animation.Parse(b.animations[g]));c.Node.ParseAnimationRanges(j,b,d)}return b.autoAnimate&&d.beginAnimation(j,b.autoAnimateFrom,b.autoAnimateTo,b.autoAnimateLoop,b.autoAnimateSpeed||1),j},__decorate([c.serializeAsColor3()],a.prototype,"diffuse",void 0),__decorate([c.serializeAsColor3()],a.prototype,"specular",void 0),__decorate([c.serialize()],a.prototype,"intensity",void 0),__decorate([c.serialize()],
a.prototype,"range",void 0),__decorate([c.serialize()],a.prototype,"includeOnlyWithLayerMask",void 0),__decorate([c.serialize()],a.prototype,"excludeWithLayerMask",void 0),__decorate([c.serialize()],a.prototype,"radius",void 0),a);c.Light=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Light;f=function(a,b,d){e.call(this,a,d);this.position=b};f=(__extends(f,e),f.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},f.prototype.computeTransformedPosition=function(){return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=c.Vector3.Zero()),c.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1},f.prototype.transferToEffect=
function(a,b){return this.parent&&this.parent.getWorldMatrix?(this.computeTransformedPosition(),void a.setFloat4(b,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0)):void a.setFloat4(b,this.position.x,this.position.y,this.position.z,0)},f.prototype.needCube=function(){return!0},f.prototype.supportsVSM=function(){return!1},f.prototype.needRefreshPerFrame=function(){return!1},f.prototype.getShadowDirection=function(a){switch(a){case 0:return new c.Vector3(1,0,0);case 1:return new c.Vector3(-1,
0,0);case 2:return new c.Vector3(0,-1,0);case 3:return new c.Vector3(0,1,0);case 4:return new c.Vector3(0,0,1);case 5:return new c.Vector3(0,0,-1)}return c.Vector3.Zero()},f.prototype.setShadowProjectionMatrix=function(a){var b=this.getScene().activeCamera;c.Matrix.PerspectiveFovLHToRef(Math.PI/2,1,b.minZ,b.maxZ,a)},f.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=c.Matrix.Identity()),c.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),
this._worldMatrix},f.prototype.getTypeID=function(){return 0},__decorate([c.serializeAsVector3()],f.prototype,"position",void 0),f);c.PointLight=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Light;f=function(a,b,d,c,g,h){e.call(this,a,h);this.position=b;this.direction=d;this.angle=c;this.exponent=g};f=(__extends(f,e),f.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},f.prototype.setShadowProjectionMatrix=function(a){var b=this.getScene().activeCamera;c.Matrix.PerspectiveFovLHToRef(this.angle,1,b.minZ,b.maxZ,a)},f.prototype.needCube=function(){return!1},f.prototype.supportsVSM=function(){return!0},f.prototype.needRefreshPerFrame=
function(){return!1},f.prototype.getShadowDirection=function(){return this.direction},f.prototype.setDirectionToTarget=function(a){return this.direction=c.Vector3.Normalize(a.subtract(this.position)),this.direction},f.prototype.computeTransformedPosition=function(){return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=c.Vector3.Zero()),c.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1},f.prototype.transferToEffect=
function(a,b,d){var j;this.parent&&this.parent.getWorldMatrix?(this._transformedDirection||(this._transformedDirection=c.Vector3.Zero()),this.computeTransformedPosition(),c.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this._transformedDirection),a.setFloat4(b,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent),j=c.Vector3.Normalize(this._transformedDirection)):(a.setFloat4(b,this.position.x,this.position.y,this.position.z,this.exponent),
j=c.Vector3.Normalize(this.direction));a.setFloat4(d,j.x,j.y,j.z,Math.cos(0.5*this.angle))},f.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=c.Matrix.Identity()),c.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},f.prototype.getTypeID=function(){return 2},__decorate([c.serializeAsVector3()],f.prototype,"position",void 0),__decorate([c.serializeAsVector3()],f.prototype,"direction",void 0),__decorate([c.serialize()],
f.prototype,"angle",void 0),__decorate([c.serialize()],f.prototype,"exponent",void 0),f);c.SpotLight=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Light;f=function(a,b,d){e.call(this,a,d);this.groundColor=new c.Color3(0,0,0);this.direction=b};f=(__extends(f,e),f.prototype.setDirectionToTarget=function(a){return this.direction=c.Vector3.Normalize(a.subtract(c.Vector3.Zero())),this.direction},f.prototype.getShadowGenerator=function(){return null},f.prototype.transferToEffect=function(a,b,d){var j=c.Vector3.Normalize(this.direction);a.setFloat4(b,j.x,j.y,j.z,0);a.setColor3(d,this.groundColor.scale(this.intensity))},f.prototype._getWorldMatrix=
function(){return this._worldMatrix||(this._worldMatrix=c.Matrix.Identity()),this._worldMatrix},f.prototype.getTypeID=function(){return 3},__decorate([c.serializeAsColor3()],f.prototype,"groundColor",void 0),__decorate([c.serializeAsVector3()],f.prototype,"direction",void 0),f);c.HemisphericLight=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Light;f=function(a,b,d){e.call(this,a,d);this.shadowOrthoScale=0.5;this.autoUpdateExtends=!0;this._orthoLeft=Number.MAX_VALUE;this._orthoTop=this._orthoRight=Number.MIN_VALUE;this._orthoBottom=Number.MAX_VALUE;this.position=b.scale(-1);this.direction=b};f=(__extends(f,e),f.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},f.prototype.setDirectionToTarget=function(a){return this.direction=c.Vector3.Normalize(a.subtract(this.position)),
this.direction},f.prototype.setShadowProjectionMatrix=function(a,b,d){var j=this.getScene().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var g=c.Vector3.Zero();this._orthoLeft=Number.MAX_VALUE;this._orthoTop=this._orthoRight=Number.MIN_VALUE;this._orthoBottom=Number.MAX_VALUE;for(var h=0;h<d.length;h++){var e=d[h];if(e&&(e=e.getBoundingInfo()))for(var e=e.boundingBox,l=0;l<e.vectorsWorld.length;l++)c.Vector3.TransformCoordinatesToRef(e.vectorsWorld[l],b,g),g.x<this._orthoLeft&&
(this._orthoLeft=g.x),g.y<this._orthoBottom&&(this._orthoBottom=g.y),g.x>this._orthoRight&&(this._orthoRight=g.x),g.y>this._orthoTop&&(this._orthoTop=g.y)}}b=this._orthoRight-this._orthoLeft;d=this._orthoTop-this._orthoBottom;c.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-b*this.shadowOrthoScale,this._orthoRight+b*this.shadowOrthoScale,this._orthoBottom-d*this.shadowOrthoScale,this._orthoTop+d*this.shadowOrthoScale,-j.maxZ,j.maxZ,a)},f.prototype.supportsVSM=function(){return!0},f.prototype.needRefreshPerFrame=
function(){return!0},f.prototype.needCube=function(){return!1},f.prototype.getShadowDirection=function(){return this.direction},f.prototype.computeTransformedPosition=function(){return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=c.Vector3.Zero()),c.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1},f.prototype.transferToEffect=function(a,b){return this.parent&&this.parent.getWorldMatrix?(this._transformedDirection||
(this._transformedDirection=c.Vector3.Zero()),c.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this._transformedDirection),void a.setFloat4(b,this._transformedDirection.x,this._transformedDirection.y,this._transformedDirection.z,1)):void a.setFloat4(b,this.direction.x,this.direction.y,this.direction.z,1)},f.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=c.Matrix.Identity()),c.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,
this._worldMatrix),this._worldMatrix},f.prototype.getTypeID=function(){return 1},__decorate([c.serializeAsVector3()],f.prototype,"position",void 0),__decorate([c.serializeAsVector3()],f.prototype,"direction",void 0),__decorate([c.serialize()],f.prototype,"shadowOrthoScale",void 0),__decorate([c.serialize()],f.prototype,"autoUpdateExtends",void 0),f);c.DirectionalLight=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,b){var d=this;this._filter=e.FILTER_NONE;this.blurScale=2;this._blurBoxOffset=0;this._bias=5E-5;this._lightDirection=c.Vector3.Zero();this.forceBackFacesOnly=!1;this._darkness=0;this._transparencyShadow=!1;this._viewMatrix=c.Matrix.Zero();this._projectionMatrix=c.Matrix.Zero();this._transformMatrix=c.Matrix.Zero();this._worldViewProjection=c.Matrix.Zero();this._currentFaceIndexCache=this._currentFaceIndex=0;this._light=b;this._scene=b.getScene();this._mapSize=a;b._shadowGenerator=
this;this._shadowMap=new c.RenderTargetTexture(b.name+"_shadowMap",a,this._scene,!1,!0,c.Engine.TEXTURETYPE_UNSIGNED_INT,b.needCube());this._shadowMap.wrapU=c.Texture.CLAMP_ADDRESSMODE;this._shadowMap.wrapV=c.Texture.CLAMP_ADDRESSMODE;this._shadowMap.anisotropicFilteringLevel=1;this._shadowMap.updateSamplingMode(c.Texture.NEAREST_SAMPLINGMODE);this._shadowMap.renderParticles=!1;this._shadowMap.onBeforeRenderObservable.add(function(a){d._currentFaceIndex=a});this._shadowMap.onAfterUnbindObservable.add(function(){d.useBlurVarianceShadowMap&&
(d._shadowMap2||(d._shadowMap2=new c.RenderTargetTexture(b.name+"_shadowMap",a,d._scene,!1),d._shadowMap2.wrapU=c.Texture.CLAMP_ADDRESSMODE,d._shadowMap2.wrapV=c.Texture.CLAMP_ADDRESSMODE,d._shadowMap2.updateSamplingMode(c.Texture.TRILINEAR_SAMPLINGMODE),d._downSamplePostprocess=new c.PassPostProcess("downScale",1/d.blurScale,null,c.Texture.BILINEAR_SAMPLINGMODE,d._scene.getEngine()),d._downSamplePostprocess.onApplyObservable.add(function(a){a.setTexture("textureSampler",d._shadowMap)}),d.blurBoxOffset=
1),d._scene.postProcessManager.directRender([d._downSamplePostprocess,d._boxBlurPostprocess],d._shadowMap2.getInternalTexture()))});var j=function(a){var b=a.getRenderingMesh(),j=d._scene,e=j.getEngine();e.setState(a.getMaterial().backFaceCulling);var k=b._getInstancesRenderList(a._id);if(!k.mustReturn){var f=null!==e.getCaps().instancedArrays&&null!==k.visibleInstances[a._id]&&void 0!==k.visibleInstances[a._id];if(d.isReady(a,f)){e.enableEffect(d._effect);b._bind(a,d._effect,c.Material.TriangleFillMode);
var q=a.getMaterial();if(d._effect.setMatrix("viewProjection",d.getTransformMatrix()),d._effect.setVector3("lightPosition",d.getLight().position),d.getLight().needCube()&&d._effect.setFloat2("depthValues",j.activeCamera.minZ,j.activeCamera.maxZ),q&&q.needAlphaTesting())j=q.getAlphaTestTexture(),d._effect.setTexture("diffuseSampler",j),d._effect.setMatrix("diffuseMatrix",j.getTextureMatrix());b.useBones&&b.computeBonesUsingShaders&&d._effect.setMatrices("mBones",b.skeleton.getTransformMatrices(b));
d.forceBackFacesOnly&&e.setState(!0,0,!1,!0);b._processRendering(a,d._effect,c.Material.TriangleFillMode,k,f,function(a,b){return d._effect.setMatrix("world",b)});d.forceBackFacesOnly&&e.setState(!0,0,!1,!1)}else d._shadowMap.resetRefreshCounter()}};this._shadowMap.customRenderFunction=function(a,b,c){var e;for(e=0;e<a.length;e++)j(a.data[e]);for(e=0;e<b.length;e++)j(b.data[e]);if(d._transparencyShadow)for(e=0;e<c.length;e++)j(c.data[e])};this._shadowMap.onClearObservable.add(function(a){d.useBlurVarianceShadowMap||
d.useVarianceShadowMap?a.clear(new c.Color4(0,0,0,0),!0,!0):a.clear(new c.Color4(1,1,1,1),!0,!0)})};f=(Object.defineProperty(e,"FILTER_NONE",{get:function(){return e._FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FILTER_VARIANCESHADOWMAP",{get:function(){return e._FILTER_VARIANCESHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FILTER_POISSONSAMPLING",{get:function(){return e._FILTER_POISSONSAMPLING},enumerable:!0,configurable:!0}),Object.defineProperty(e,
"FILTER_BLURVARIANCESHADOWMAP",{get:function(){return e._FILTER_BLURVARIANCESHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bias",{get:function(){return this._bias},set:function(a){this._bias=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(a){var b=this;this._blurBoxOffset!==a&&(this._blurBoxOffset=a,this._boxBlurPostprocess&&this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=
new c.PostProcess("DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1/this.blurScale,null,c.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define OFFSET "+a),this._boxBlurPostprocess.onApplyObservable.add(function(a){a.setFloat2("screenSize",b._mapSize/b.blurScale,b._mapSize/b.blurScale)}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},set:function(a){this._filter!==a&&(this._filter=a,this.useVarianceShadowMap||
this.useBlurVarianceShadowMap||this.usePoissonSampling?(this._shadowMap.anisotropicFilteringLevel=16,this._shadowMap.updateSamplingMode(c.Texture.BILINEAR_SAMPLINGMODE)):(this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(c.Texture.NEAREST_SAMPLINGMODE)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useVarianceShadowMap",{get:function(){return this.filter===e.FILTER_VARIANCESHADOWMAP&&this._light.supportsVSM()},set:function(a){this.filter=a?e.FILTER_VARIANCESHADOWMAP:
e.FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usePoissonSampling",{get:function(){return this.filter===e.FILTER_POISSONSAMPLING||!this._light.supportsVSM()&&(this.filter===e.FILTER_VARIANCESHADOWMAP||this.filter===e.FILTER_BLURVARIANCESHADOWMAP)},set:function(a){this.filter=a?e.FILTER_POISSONSAMPLING:e.FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBlurVarianceShadowMap",{get:function(){return this.filter===e.FILTER_BLURVARIANCESHADOWMAP&&
this._light.supportsVSM()},set:function(a){this.filter=a?e.FILTER_BLURVARIANCESHADOWMAP:e.FILTER_NONE},enumerable:!0,configurable:!0}),e.prototype.isReady=function(a,b){var d=[];(this.useVarianceShadowMap||this.useBlurVarianceShadowMap)&&d.push("#define VSM");this.getLight().needCube()&&d.push("#define CUBEMAP");var j=[c.VertexBuffer.PositionKind],g=a.getMesh(),h=a.getMaterial();h&&h.needAlphaTesting()&&(d.push("#define ALPHATEST"),g.isVerticesDataPresent(c.VertexBuffer.UVKind)&&(j.push(c.VertexBuffer.UVKind),
d.push("#define UV1")),g.isVerticesDataPresent(c.VertexBuffer.UV2Kind)&&(j.push(c.VertexBuffer.UV2Kind),d.push("#define UV2")));g.useBones&&g.computeBonesUsingShaders?(j.push(c.VertexBuffer.MatricesIndicesKind),j.push(c.VertexBuffer.MatricesWeightsKind),4<g.numBoneInfluencers&&(j.push(c.VertexBuffer.MatricesIndicesExtraKind),j.push(c.VertexBuffer.MatricesWeightsExtraKind)),d.push("#define NUM_BONE_INFLUENCERS "+g.numBoneInfluencers),d.push("#define BonesPerMesh "+(g.skeleton.bones.length+1))):d.push("#define NUM_BONE_INFLUENCERS 0");
b&&(d.push("#define INSTANCES"),j.push("world0"),j.push("world1"),j.push("world2"),j.push("world3"));d=d.join("\n");return this._cachedDefines!==d&&(this._cachedDefines=d,this._effect=this._scene.getEngine().createEffect("shadowMap",j,"world mBones viewProjection diffuseMatrix lightPosition depthValues".split(" "),["diffuseSampler"],d)),this._effect.isReady()},e.prototype.getShadowMap=function(){return this._shadowMap},e.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:
this._shadowMap},e.prototype.getLight=function(){return this._light},e.prototype.getTransformMatrix=function(){var a=this._scene;if(this._currentRenderID===a.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=a.getRenderId();this._currentFaceIndexCache=this._currentFaceIndex;a=this._light.position;return c.Vector3.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(c.Vector3.Dot(this._lightDirection,
c.Vector3.Up()))&&(this._lightDirection.z=1E-13),this._light.computeTransformedPosition()&&(a=this._light.transformedPosition),!this._light.needRefreshPerFrame()&&this._cachedPosition&&this._cachedDirection&&a.equals(this._cachedPosition)&&this._lightDirection.equals(this._cachedDirection)||(this._cachedPosition=a.clone(),this._cachedDirection=this._lightDirection.clone(),c.Matrix.LookAtLHToRef(a,a.add(this._lightDirection),c.Vector3.Up(),this._viewMatrix),this._light.setShadowProjectionMatrix(this._projectionMatrix,
this._viewMatrix,this.getShadowMap().renderList),this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)),this._transformMatrix},e.prototype.getDarkness=function(){return this._darkness},e.prototype.setDarkness=function(a){1<=a?this._darkness=1:0>=a?this._darkness=0:this._darkness=a},e.prototype.setTransparencyShadow=function(a){this._transparencyShadow=a},e.prototype._packHalf=function(a){var b=255*a,b=b-Math.floor(b);return new c.Vector2(a-b/255,b)},e.prototype.dispose=function(){this._shadowMap.dispose();
this._shadowMap2&&this._shadowMap2.dispose();this._downSamplePostprocess&&this._downSamplePostprocess.dispose();this._boxBlurPostprocess&&this._boxBlurPostprocess.dispose()},e.prototype.serialize=function(){var a={};a.lightId=this._light.id;a.mapSize=this.getShadowMap().getRenderSize();a.useVarianceShadowMap=this.useVarianceShadowMap;a.usePoissonSampling=this.usePoissonSampling;a.forceBackFacesOnly=this.forceBackFacesOnly;a.renderList=[];for(var b=0;b<this.getShadowMap().renderList.length;b++){var d=
this.getShadowMap().renderList[b];a.renderList.push(d.id)}return a},e.Parse=function(a,b){for(var d=b.getLightByID(a.lightId),c=new e(a.mapSize,d),d=0;d<a.renderList.length;d++)b.getMeshesByID(a.renderList[d]).forEach(function(a){c.getShadowMap().renderList.push(a)});return a.usePoissonSampling?c.usePoissonSampling=!0:a.useVarianceShadowMap?c.useVarianceShadowMap=!0:a.useBlurVarianceShadowMap&&(c.useBlurVarianceShadowMap=!0,a.blurScale&&(c.blurScale=a.blurScale),a.blurBoxOffset&&(c.blurBoxOffset=
a.blurBoxOffset)),void 0!==a.bias&&(c.bias=a.bias),c.forceBackFacesOnly=a.forceBackFacesOnly,c},e._FILTER_NONE=0,e._FILTER_VARIANCESHADOWMAP=1,e._FILTER_POISSONSAMPLING=2,e._FILTER_BLURVARIANCESHADOWMAP=3,e);c.ShadowGenerator=f}(BABYLON||(BABYLON={}));
!function(c){var f=function(a,b,d,c){var g=b*b-4*a*d;d={root:0,found:!1};if(0>g)return d;var h=Math.sqrt(g),g=(-b-h)/(2*a);a=(-b+h)/(2*a);g>a&&(b=a,a=g,g=b);return 0<g&&c>g?(d.root=g,d.found=!0,d):0<a&&c>a?(d.root=a,d.found=!0,d):d},e;e=function(){this.radius=new c.Vector3(1,1,1);this.retry=0;this.basePointWorld=c.Vector3.Zero();this.velocityWorld=c.Vector3.Zero();this.normalizedVelocity=c.Vector3.Zero();this._collisionPoint=c.Vector3.Zero();this._planeIntersectionPoint=c.Vector3.Zero();this._tempVector=
c.Vector3.Zero();this._tempVector2=c.Vector3.Zero();this._tempVector3=c.Vector3.Zero();this._tempVector4=c.Vector3.Zero();this._edge=c.Vector3.Zero();this._baseToVertex=c.Vector3.Zero();this._destinationPoint=c.Vector3.Zero();this._slidePlaneNormal=c.Vector3.Zero();this._displacementVector=c.Vector3.Zero()};e=(e.prototype._initialize=function(a,b,d){this.velocity=b;c.Vector3.NormalizeToRef(b,this.normalizedVelocity);this.basePoint=a;a.multiplyToRef(this.radius,this.basePointWorld);b.multiplyToRef(this.radius,
this.velocityWorld);this.velocityWorldLength=this.velocityWorld.length();this.epsilon=d;this.collisionFound=!1},e.prototype._checkPointInTriangle=function(a,b,d,j,g){b.subtractToRef(a,this._tempVector);d.subtractToRef(a,this._tempVector2);c.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);b=c.Vector3.Dot(this._tempVector4,g);return 0>b?!1:(j.subtractToRef(a,this._tempVector3),c.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),b=c.Vector3.Dot(this._tempVector4,
g),0>b?!1:(c.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),b=c.Vector3.Dot(this._tempVector4,g),0<=b))},e.prototype._canDoCollision=function(a,b,d,j){a=c.Vector3.Distance(this.basePointWorld,a);var g=Math.max(this.radius.x,this.radius.y,this.radius.z);return a>this.velocityWorldLength+g+b?!1:!!(d.x>this.basePointWorld.x+(this.velocityWorldLength+g)?0:this.basePointWorld.x-(this.velocityWorldLength+g)>j.x?0:d.y>this.basePointWorld.y+(this.velocityWorldLength+g)?0:this.basePointWorld.y-
(this.velocityWorldLength+g)>j.y?0:d.z>this.basePointWorld.z+(this.velocityWorldLength+g)?0:!(this.basePointWorld.z-(this.velocityWorldLength+g)>j.z))},e.prototype._testTriangle=function(a,b,d,j,g,h){var e,l=!1;b||(b=[]);b[a]||(b[a]=new c.Plane(0,0,0,0),b[a].copyFromPoints(d,j,g));b=b[a];if(h||b.isFrontFacingTo(this.normalizedVelocity,0)){h=b.signedDistanceTo(this.basePoint);a=c.Vector3.Dot(b.normal,this.velocity);if(0==a){if(1<=Math.abs(h))return;l=!0;e=0}else{e=(-1-h)/a;h=(1-h)/a;e>h&&(a=h,h=e,
e=a);if(1<e||0>h)return;0>e&&(e=0);1<e&&(e=1)}this._collisionPoint.copyFromFloats(0,0,0);h=!1;a=1;if(l||(this.basePoint.subtractToRef(b.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(e,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,d,j,g,b.normal)&&(h=!0,a=e,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!h){b=l=this.velocity.lengthSquared();this.basePoint.subtractToRef(d,this._tempVector);
e=2*c.Vector3.Dot(this.velocity,this._tempVector);var k=this._tempVector.lengthSquared()-1,n=f(b,e,k,a);n.found&&(a=n.root,h=!0,this._collisionPoint.copyFrom(d));this.basePoint.subtractToRef(j,this._tempVector);e=2*c.Vector3.Dot(this.velocity,this._tempVector);k=this._tempVector.lengthSquared()-1;n=f(b,e,k,a);n.found&&(a=n.root,h=!0,this._collisionPoint.copyFrom(j));this.basePoint.subtractToRef(g,this._tempVector);e=2*c.Vector3.Dot(this.velocity,this._tempVector);k=this._tempVector.lengthSquared()-
1;n=f(b,e,k,a);n.found&&(a=n.root,h=!0,this._collisionPoint.copyFrom(g));j.subtractToRef(d,this._edge);d.subtractToRef(this.basePoint,this._baseToVertex);var q=this._edge.lengthSquared(),p=c.Vector3.Dot(this._edge,this.velocity),r=c.Vector3.Dot(this._edge,this._baseToVertex);if(b=q*-l+p*p,e=q*2*c.Vector3.Dot(this.velocity,this._baseToVertex)-2*p*r,k=q*(1-this._baseToVertex.lengthSquared())+r*r,n=f(b,e,k,a),n.found){var t=(p*n.root-r)/q;0<=t&&1>=t&&(a=n.root,h=!0,this._edge.scaleInPlace(t),d.addToRef(this._edge,
this._collisionPoint))}g.subtractToRef(j,this._edge);j.subtractToRef(this.basePoint,this._baseToVertex);q=this._edge.lengthSquared();p=c.Vector3.Dot(this._edge,this.velocity);r=c.Vector3.Dot(this._edge,this._baseToVertex);b=q*-l+p*p;e=q*2*c.Vector3.Dot(this.velocity,this._baseToVertex)-2*p*r;k=q*(1-this._baseToVertex.lengthSquared())+r*r;n=f(b,e,k,a);n.found&&(t=(p*n.root-r)/q,0<=t&&1>=t&&(a=n.root,h=!0,this._edge.scaleInPlace(t),j.addToRef(this._edge,this._collisionPoint)));d.subtractToRef(g,this._edge);
g.subtractToRef(this.basePoint,this._baseToVertex);q=this._edge.lengthSquared();p=c.Vector3.Dot(this._edge,this.velocity);r=c.Vector3.Dot(this._edge,this._baseToVertex);b=q*-l+p*p;e=q*2*c.Vector3.Dot(this.velocity,this._baseToVertex)-2*p*r;k=q*(1-this._baseToVertex.lengthSquared())+r*r;n=f(b,e,k,a);n.found&&(t=(p*n.root-r)/q,0<=t&&1>=t&&(a=n.root,h=!0,this._edge.scaleInPlace(t),g.addToRef(this._edge,this._collisionPoint)))}h&&(d=a*this.velocity.length(),(!this.collisionFound||d<this.nearestDistance)&&
(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=d,this.collisionFound=!0))}},e.prototype._collide=function(a,b,d,c,g,h,e){for(;g>c;c+=3)this._testTriangle(c,a,b[d[c+2]-h],b[d[c+1]-h],b[d[c]-h],e)},e.prototype._getResponse=function(a,b){a.addToRef(b,this._destinationPoint);b.scaleInPlace(this.nearestDistance/b.length());this.basePoint.addToRef(b,a);a.subtractToRef(this.intersectionPoint,this._slidePlaneNormal);
this._slidePlaneNormal.normalize();this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector);a.addInPlace(this._displacementVector);this.intersectionPoint.addInPlace(this._displacementVector);this._slidePlaneNormal.scaleInPlace(c.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint));this._destinationPoint.subtractInPlace(this._slidePlaneNormal);this._destinationPoint.subtractToRef(this.intersectionPoint,b)},e);c.Collider=
e}(BABYLON||(BABYLON={}));
!function(c){c.CollisionWorker="";var f=c.WorkerTaskType||(c.WorkerTaskType={});f[f.INIT=0]="INIT";f[f.UPDATE=1]="UPDATE";f[f.COLLIDE=2]="COLLIDE";var e=c.WorkerTaskType,f=c.WorkerReplyType||(c.WorkerReplyType={});f[f.SUCCESS=0]="SUCCESS";f[f.UNKNOWN_ERROR=1]="UNKNOWN_ERROR";!0;var a=c.WorkerReplyType,b=function(){var d=this;this._scaledPosition=c.Vector3.Zero();this._scaledVelocity=c.Vector3.Zero();this.onMeshUpdated=function(a){d._addUpdateMeshesList[a.uniqueId]=b.SerializeMesh(a)};this.onGeometryUpdated=
function(a){d._addUpdateGeometriesList[a.id]=b.SerializeGeometry(a)};this._afterRender=function(){if(d._init&&!(0==d._toRemoveGeometryArray.length&&0==d._toRemoveMeshesArray.length&&0==Object.keys(d._addUpdateGeometriesList).length&&0==Object.keys(d._addUpdateMeshesList).length||4<d._runningUpdated)){++d._runningUpdated;var a={updatedMeshes:d._addUpdateMeshesList,updatedGeometries:d._addUpdateGeometriesList,removedGeometries:d._toRemoveGeometryArray,removedMeshes:d._toRemoveMeshesArray},b={payload:a,
taskType:e.UPDATE},c=[],m;for(m in a.updatedGeometries)a.updatedGeometries.hasOwnProperty(m)&&(c.push(b.payload.updatedGeometries[m].indices.buffer),c.push(b.payload.updatedGeometries[m].normals.buffer),c.push(b.payload.updatedGeometries[m].positions.buffer));d._worker.postMessage(b,c);d._addUpdateMeshesList={};d._addUpdateGeometriesList={};d._toRemoveGeometryArray=[];d._toRemoveMeshesArray=[]}};this._onMessageFromWorker=function(b){b=b.data;if(b.error!=a.SUCCESS)return void c.Tools.Warn("error returned from worker!");
switch(b.taskType){case e.INIT:d._init=!0;d._scene.meshes.forEach(function(a){d.onMeshAdded(a)});d._scene.getGeometries().forEach(function(a){d.onGeometryAdded(a)});break;case e.UPDATE:d._runningUpdated--;break;case e.COLLIDE:d._runningCollisionTask=!1;b=b.payload;if(!d._collisionsCallbackArray[b.collisionId])break;d._collisionsCallbackArray[b.collisionId](b.collisionId,c.Vector3.FromArray(b.newPosition),d._scene.getMeshByUniqueID(b.collidedMeshUniqueId));d._collisionsCallbackArray[b.collisionId]=
void 0}};this._collisionsCallbackArray=[];this._init=!1;this._runningUpdated=0;this._runningCollisionTask=!1;this._addUpdateMeshesList={};this._addUpdateGeometriesList={};this._toRemoveGeometryArray=[];this._toRemoveMeshesArray=[]},f=(b.prototype.getNewPosition=function(a,b,c,h,m,l,k){this._init&&(!this._collisionsCallbackArray[k]&&!this._collisionsCallbackArray[k+1E5])&&(a.divideToRef(c.radius,this._scaledPosition),b.divideToRef(c.radius,this._scaledVelocity),this._collisionsCallbackArray[k]=l,a=
{payload:{collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:c.radius.asArray()},collisionId:k,excludedMeshUniqueId:m?m.uniqueId:null,maximumRetry:h},taskType:e.COLLIDE},this._worker.postMessage(a))},b.prototype.init=function(a){this._scene=a;this._scene.registerAfterRender(this._afterRender);a=c.WorkerIncluded?c.Engine.CodeRepository+"Collisions/babylon.collisionWorker.js":URL.createObjectURL(new Blob([c.CollisionWorker],{type:"application/javascript"}));
this._worker=new Worker(a);this._worker.onmessage=this._onMessageFromWorker;this._worker.postMessage({payload:{},taskType:e.INIT})},b.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender);this._worker.terminate()},b.prototype.onMeshAdded=function(a){a.registerAfterWorldMatrixUpdate(this.onMeshUpdated);this.onMeshUpdated(a)},b.prototype.onMeshRemoved=function(a){this._toRemoveMeshesArray.push(a.uniqueId)},b.prototype.onGeometryAdded=function(a){a.onGeometryUpdated=this.onGeometryUpdated;
this.onGeometryUpdated(a)},b.prototype.onGeometryDeleted=function(a){this._toRemoveGeometryArray.push(a.id)},b.SerializeMesh=function(a){var b=[];a.subMeshes&&(b=a.subMeshes.map(function(a,b){return{position:b,verticesStart:a.verticesStart,verticesCount:a.verticesCount,indexStart:a.indexStart,indexCount:a.indexCount,hasMaterial:!!a.getMaterial(),sphereCenter:a.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:a.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:a.getBoundingInfo().boundingBox.minimumWorld.asArray(),
boxMaximum:a.getBoundingInfo().boundingBox.maximumWorld.asArray()}}));return{uniqueId:a.uniqueId,id:a.id,name:a.name,geometryId:null,sphereCenter:a.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:a.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:a.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:a.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:a.worldMatrixFromCache.asArray(),subMeshes:b,checkCollisions:a.checkCollisions}},b.SerializeGeometry=
function(a){return{id:a.id,positions:new Float32Array(a.getVerticesData(c.VertexBuffer.PositionKind)||[]),normals:new Float32Array(a.getVerticesData(c.VertexBuffer.NormalKind)||[]),indices:new Int32Array(a.getIndices()||[])}},b);c.CollisionCoordinatorWorker=f;f=function(){this._scaledPosition=c.Vector3.Zero();this._scaledVelocity=c.Vector3.Zero();this._finalPosition=c.Vector3.Zero()};f=(f.prototype.getNewPosition=function(a,b,c,h,e,l,k){a.divideToRef(c.radius,this._scaledPosition);b.divideToRef(c.radius,
this._scaledVelocity);c.collidedMesh=null;c.retry=0;c.initialVelocity=this._scaledVelocity;c.initialPosition=this._scaledPosition;this._collideWithWorld(this._scaledPosition,this._scaledVelocity,c,h,this._finalPosition,e);this._finalPosition.multiplyInPlace(c.radius);l(k,this._finalPosition,c.collidedMesh)},f.prototype.init=function(a){this._scene=a},f.prototype.destroy=function(){},f.prototype.onMeshAdded=function(){},f.prototype.onMeshUpdated=function(){},f.prototype.onMeshRemoved=function(){},
f.prototype.onGeometryAdded=function(){},f.prototype.onGeometryUpdated=function(){},f.prototype.onGeometryDeleted=function(){},f.prototype._collideWithWorld=function(a,b,g,h,e,l){void 0===l&&(l=null);var k=10*c.Engine.CollisionsEpsilon;if(g.retry>=h)return void e.copyFrom(a);g._initialize(a,b,k);for(var f=0;f<this._scene.meshes.length;f++){var q=this._scene.meshes[f];q.isEnabled()&&q.checkCollisions&&q.subMeshes&&q!==l&&q._checkCollision(g)}return g.collisionFound?(0===b.x&&0===b.y&&0===b.z||g._getResponse(a,
b),b.length()<=k?void e.copyFrom(a):(g.retry++,void this._collideWithWorld(a,b,g,h,e,l))):void a.addToRef(b,e)},f);c.CollisionCoordinatorLegacy=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Node,a=function(b,d,j){e.call(this,b,j);this.upVector=c.Vector3.Up();this.orthoTop=this.orthoBottom=this.orthoRight=this.orthoLeft=null;this.fov=0.8;this.minZ=1;this.maxZ=1E4;this.inertia=0.9;this.mode=a.PERSPECTIVE_CAMERA;this.isIntermediate=!1;this.viewport=new c.Viewport(0,0,1,1);this.layerMask=268435455;this.fovMode=a.FOVMODE_VERTICAL_FIXED;this.cameraRigMode=a.RIG_MODE_NONE;this._rigCameras=[];this._computedViewMatrix=c.Matrix.Identity();this._projectionMatrix=new c.Matrix;
this._postProcesses=[];this._activeMeshes=new c.SmartArray(256);this._globalPosition=c.Vector3.Zero();j.addCamera(this);j.activeCamera||(j.activeCamera=this);this.position=d};f=(__extends(a,e),Object.defineProperty(a,"PERSPECTIVE_CAMERA",{get:function(){return a._PERSPECTIVE_CAMERA},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ORTHOGRAPHIC_CAMERA",{get:function(){return a._ORTHOGRAPHIC_CAMERA},enumerable:!0,configurable:!0}),Object.defineProperty(a,"FOVMODE_VERTICAL_FIXED",{get:function(){return a._FOVMODE_VERTICAL_FIXED},
enumerable:!0,configurable:!0}),Object.defineProperty(a,"FOVMODE_HORIZONTAL_FIXED",{get:function(){return a._FOVMODE_HORIZONTAL_FIXED},enumerable:!0,configurable:!0}),Object.defineProperty(a,"RIG_MODE_NONE",{get:function(){return a._RIG_MODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(a,"RIG_MODE_STEREOSCOPIC_ANAGLYPH",{get:function(){return a._RIG_MODE_STEREOSCOPIC_ANAGLYPH},enumerable:!0,configurable:!0}),Object.defineProperty(a,"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL",{get:function(){return a._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL},
enumerable:!0,configurable:!0}),Object.defineProperty(a,"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED",{get:function(){return a._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED},enumerable:!0,configurable:!0}),Object.defineProperty(a,"RIG_MODE_STEREOSCOPIC_OVERUNDER",{get:function(){return a._RIG_MODE_STEREOSCOPIC_OVERUNDER},enumerable:!0,configurable:!0}),Object.defineProperty(a,"RIG_MODE_VR",{get:function(){return a._RIG_MODE_VR},enumerable:!0,configurable:!0}),a.prototype.toString=function(a){var d="Name: "+
this.name;if(d+=", type: "+this.getTypeName(),this.animations)for(var c=0;c<this.animations.length;c++)d+=", animation[0]: "+this.animations[c].toString(a);return d},Object.defineProperty(a.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),a.prototype.getActiveMeshes=function(){return this._activeMeshes},a.prototype.isActiveMesh=function(a){return-1!==this._activeMeshes.indexOf(a)},a.prototype._initCache=function(){e.prototype._initCache.call(this);
this._cache.position=new c.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.upVector=new c.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.mode=void 0;this._cache.minZ=void 0;this._cache.maxZ=void 0;this._cache.fov=void 0;this._cache.aspectRatio=void 0;this._cache.orthoLeft=void 0;this._cache.orthoRight=void 0;this._cache.orthoBottom=void 0;this._cache.orthoTop=void 0;this._cache.renderWidth=void 0;this._cache.renderHeight=void 0},a.prototype._updateCache=
function(a){a||e.prototype._updateCache.call(this);a=this.getEngine();this._cache.position.copyFrom(this.position);this._cache.upVector.copyFrom(this.upVector);this._cache.mode=this.mode;this._cache.minZ=this.minZ;this._cache.maxZ=this.maxZ;this._cache.fov=this.fov;this._cache.aspectRatio=a.getAspectRatio(this);this._cache.orthoLeft=this.orthoLeft;this._cache.orthoRight=this.orthoRight;this._cache.orthoBottom=this.orthoBottom;this._cache.orthoTop=this.orthoTop;this._cache.renderWidth=a.getRenderWidth();
this._cache.renderHeight=a.getRenderHeight()},a.prototype._updateFromScene=function(){this.updateCache();this._update()},a.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},a.prototype._isSynchronizedViewMatrix=function(){return e.prototype._isSynchronized.call(this)?this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent():!1},a.prototype._isSynchronizedProjectionMatrix=
function(){if(!(this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ))return!1;var b=this.getEngine();return this.mode===a.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.aspectRatio===b.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===b.getRenderWidth()&&this._cache.renderHeight===b.getRenderHeight()},
a.prototype.attachControl=function(){},a.prototype.detachControl=function(){},a.prototype._update=function(){this.cameraRigMode!==a.RIG_MODE_NONE&&this._updateRigCameras();this._checkInputs()},a.prototype._checkInputs=function(){},a.prototype._cascadePostProcessesToRigCams=function(){0<this._postProcesses.length&&this._postProcesses[0].markTextureDirty();for(var a=0,d=this._rigCameras.length;d>a;a++){var j=this._rigCameras[a],g=j._rigPostProcess;g?(g instanceof c.PassPostProcess&&(j.isIntermediate=
0===this._postProcesses.length),j._postProcesses=this._postProcesses.slice(0).concat(g),g.markTextureDirty()):j._postProcesses=this._postProcesses.slice(0)}},a.prototype.attachPostProcess=function(a,d){return void 0===d&&(d=null),!a.isReusable()&&-1<this._postProcesses.indexOf(a)?(c.Tools.Error("You're trying to reuse a post process not defined as reusable."),0):(null==d||0>d?this._postProcesses.push(a):this._postProcesses.splice(d,0,a),this._cascadePostProcessesToRigCams(),this._postProcesses.indexOf(a))},
a.prototype.detachPostProcess=function(a,d){void 0===d&&(d=null);var c,g=[];if(d){d=d instanceof Array?d:[d];for(c=d.length-1;0<=c;c--)this._postProcesses[d[c]]===a?this._postProcesses.splice(void 0,1):g.push(c)}else c=this._postProcesses.indexOf(a),-1!==c&&this._postProcesses.splice(c,1);return this._cascadePostProcessesToRigCams(),g},a.prototype.getWorldMatrix=function(){this._worldMatrix||(this._worldMatrix=c.Matrix.Identity());return this.getViewMatrix().invertToRef(this._worldMatrix),this._worldMatrix},
a.prototype._getViewMatrix=function(){return c.Matrix.Identity()},a.prototype.getViewMatrix=function(a){return this._computedViewMatrix=this._computeViewMatrix(a),!a&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.parent&&this.parent.getWorldMatrix?(this._worldMatrix||(this._worldMatrix=c.Matrix.Identity()),this._computedViewMatrix.invertToRef(this._worldMatrix),this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._computedViewMatrix),this._globalPosition.copyFromFloats(this._computedViewMatrix.m[12],
this._computedViewMatrix.m[13],this._computedViewMatrix.m[14]),this._computedViewMatrix.invert(),this._markSyncedWithParent()):this._globalPosition.copyFrom(this.position),this._currentRenderId=this.getScene().getRenderId(),this._computedViewMatrix)},a.prototype._computeViewMatrix=function(a){return!a&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._computedViewMatrix)},a.prototype.getProjectionMatrix=
function(b){if(!b&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;var d=this.getEngine();if(this.mode===a.PERSPECTIVE_CAMERA)return 0>=this.minZ&&(this.minZ=0.1),c.Matrix.PerspectiveFovLHToRef(this.fov,d.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===a.FOVMODE_VERTICAL_FIXED),this._projectionMatrix;b=d.getRenderWidth()/2;d=d.getRenderHeight()/2;return c.Matrix.OrthoOffCenterLHToRef(this.orthoLeft||-b,this.orthoRight||b,this.orthoBottom||-d,this.orthoTop||
d,this.minZ,this.maxZ,this._projectionMatrix),this._projectionMatrix},a.prototype.dispose=function(){this.getScene().stopAnimation(this);for(this.getScene().removeCamera(this);0<this._rigCameras.length;)this._rigCameras.pop().dispose();for(var a=0;a<this._postProcesses.length;++a)this._postProcesses[a].dispose(this);e.prototype.dispose.call(this)},a.prototype.setCameraRigMode=function(b,d){for(;0<this._rigCameras.length;)this._rigCameras.pop().dispose();switch(this.cameraRigMode=b,this._cameraRigParams=
{},this._cameraRigParams.interaxialDistance=d.interaxialDistance||0.0637,this._cameraRigParams.stereoHalfAngle=c.Tools.ToRadians(this._cameraRigParams.interaxialDistance/0.0637),this.cameraRigMode!==a.RIG_MODE_NONE&&(this._rigCameras.push(this.createRigCamera(this.name+"_L",0)),this._rigCameras.push(this.createRigCamera(this.name+"_R",1))),this.cameraRigMode){case a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:this._rigCameras[0]._rigPostProcess=new c.PassPostProcess(this.name+"_passthru",1,this._rigCameras[0]);
this._rigCameras[1]._rigPostProcess=new c.AnaglyphPostProcess(this.name+"_anaglyph",1,this._rigCameras);break;case a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case a.RIG_MODE_STEREOSCOPIC_OVERUNDER:var j=this.cameraRigMode===a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||this.cameraRigMode===a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;this._rigCameras[0]._rigPostProcess=new c.PassPostProcess(this.name+"_passthru",1,this._rigCameras[0]);this._rigCameras[1]._rigPostProcess=
new c.StereoscopicInterlacePostProcess(this.name+"_stereoInterlace",this._rigCameras,j);break;case a.RIG_MODE_VR:j=d.vrCameraMetrics||c.VRCameraMetrics.GetDefault(),this._rigCameras[0]._cameraRigParams.vrMetrics=j,this._rigCameras[0].viewport=new c.Viewport(0,0,0.5,1),this._rigCameras[0]._cameraRigParams.vrWorkMatrix=new c.Matrix,this._rigCameras[0]._cameraRigParams.vrHMatrix=j.leftHMatrix,this._rigCameras[0]._cameraRigParams.vrPreViewMatrix=j.leftPreViewMatrix,this._rigCameras[0].getProjectionMatrix=
this._rigCameras[0]._getVRProjectionMatrix,this._rigCameras[1]._cameraRigParams.vrMetrics=j,this._rigCameras[1].viewport=new c.Viewport(0.5,0,0.5,1),this._rigCameras[1]._cameraRigParams.vrWorkMatrix=new c.Matrix,this._rigCameras[1]._cameraRigParams.vrHMatrix=j.rightHMatrix,this._rigCameras[1]._cameraRigParams.vrPreViewMatrix=j.rightPreViewMatrix,this._rigCameras[1].getProjectionMatrix=this._rigCameras[1]._getVRProjectionMatrix,j.compensateDistortion&&(this._rigCameras[0]._rigPostProcess=new c.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Left",
this._rigCameras[0],!1,j),this._rigCameras[1]._rigPostProcess=new c.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Right",this._rigCameras[1],!0,j))}this._cascadePostProcessesToRigCams();this._update()},a.prototype._getVRProjectionMatrix=function(){return c.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,
this._projectionMatrix),this._projectionMatrix},a.prototype.setCameraRigParameter=function(a,d){this._cameraRigParams||(this._cameraRigParams={});this._cameraRigParams[a]=d;"interaxialDistance"===a&&(this._cameraRigParams.stereoHalfAngle=c.Tools.ToRadians(d/0.0637))},a.prototype.createRigCamera=function(){return null},a.prototype._updateRigCameras=function(){for(var b=0;b<this._rigCameras.length;b++)this._rigCameras[b].minZ=this.minZ,this._rigCameras[b].maxZ=this.maxZ,this._rigCameras[b].fov=this.fov;
this.cameraRigMode===a.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},a.prototype._setupInputs=function(){},a.prototype.serialize=function(){var a=c.SerializationHelper.Serialize(this);return a.type=this.getTypeName(),this.parent&&(a.parentId=this.parent.id),this.inputs&&this.inputs.serialize(a),c.Animation.AppendSerializedAnimations(this,a),a.ranges=this.serializeAnimationRanges(),a},a.prototype.getTypeName=function(){return"Camera"},a.prototype.clone=
function(b){return c.SerializationHelper.Clone(a.GetConstructorFromName(this.getTypeName(),b,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},a.GetConstructorFromName=function(a,d,j,g,h){switch(void 0===g&&(g=0),void 0===h&&(h=!0),a){case "ArcRotateCamera":return function(){return new c.ArcRotateCamera(d,0,0,1,c.Vector3.Zero(),j)};case "DeviceOrientationCamera":return function(){return new c.DeviceOrientationCamera(d,c.Vector3.Zero(),j)};case "FollowCamera":return function(){return new c.FollowCamera(d,
c.Vector3.Zero(),j)};case "ArcFollowCamera":return function(){return new c.ArcFollowCamera(d,0,0,1,null,j)};case "GamepadCamera":return function(){return new c.GamepadCamera(d,c.Vector3.Zero(),j)};case "TouchCamera":return function(){return new c.TouchCamera(d,c.Vector3.Zero(),j)};case "VirtualJoysticksCamera":return function(){return new c.VirtualJoysticksCamera(d,c.Vector3.Zero(),j)};case "WebVRFreeCamera":return function(){return new c.WebVRFreeCamera(d,c.Vector3.Zero(),j)};case "VRDeviceOrientationFreeCamera":return function(){return new c.VRDeviceOrientationFreeCamera(d,
c.Vector3.Zero(),j)};case "AnaglyphArcRotateCamera":return function(){return new c.AnaglyphArcRotateCamera(d,0,0,1,c.Vector3.Zero(),g,j)};case "AnaglyphFreeCamera":return function(){return new c.AnaglyphFreeCamera(d,c.Vector3.Zero(),g,j)};case "AnaglyphGamepadCamera":return function(){return new c.AnaglyphGamepadCamera(d,c.Vector3.Zero(),g,j)};case "AnaglyphUniversalCamera":return function(){return new c.AnaglyphUniversalCamera(d,c.Vector3.Zero(),g,j)};case "StereoscopicArcRotateCamera":return function(){return new c.StereoscopicArcRotateCamera(d,
0,0,1,c.Vector3.Zero(),g,h,j)};case "StereoscopicFreeCamera":return function(){return new c.StereoscopicFreeCamera(d,c.Vector3.Zero(),g,h,j)};case "StereoscopicGamepadCamera":return function(){return new c.StereoscopicGamepadCamera(d,c.Vector3.Zero(),g,h,j)};case "StereoscopicUniversalCamera":return function(){return new c.StereoscopicUniversalCamera(d,c.Vector3.Zero(),g,h,j)};case "FreeCamera":return function(){return new c.UniversalCamera(d,c.Vector3.Zero(),j)};default:return function(){return new c.UniversalCamera(d,
c.Vector3.Zero(),j)}}},a.Parse=function(b,d){var j=a.GetConstructorFromName(b.type,b.name,d,b.interaxial_distance,b.isStereoscopicSideBySide),j=c.SerializationHelper.Parse(j,b,d);if(b.parentId&&(j._waitingParentId=b.parentId),j.inputs&&(j.inputs.parse(b),j._setupInputs()),b.target&&j.setTarget&&j.setTarget(c.Vector3.FromArray(b.target)),b.cameraRigMode)j.setCameraRigMode(b.cameraRigMode,b.interaxial_distance?{interaxialDistance:b.interaxial_distance}:{});if(b.animations){for(var g=0;g<b.animations.length;g++)j.animations.push(c.Animation.Parse(b.animations[g]));
c.Node.ParseAnimationRanges(j,b,d)}return b.autoAnimate&&d.beginAnimation(j,b.autoAnimateFrom,b.autoAnimateTo,b.autoAnimateLoop,b.autoAnimateSpeed||1),j},a._PERSPECTIVE_CAMERA=0,a._ORTHOGRAPHIC_CAMERA=1,a._FOVMODE_VERTICAL_FIXED=0,a._FOVMODE_HORIZONTAL_FIXED=1,a._RIG_MODE_NONE=0,a._RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,a._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,a._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,a._RIG_MODE_STEREOSCOPIC_OVERUNDER=13,a._RIG_MODE_VR=20,a.ForceAttachControlToAlwaysPreventDefault=
!1,__decorate([c.serializeAsVector3()],a.prototype,"position",void 0),__decorate([c.serializeAsVector3()],a.prototype,"upVector",void 0),__decorate([c.serialize()],a.prototype,"orthoLeft",void 0),__decorate([c.serialize()],a.prototype,"orthoRight",void 0),__decorate([c.serialize()],a.prototype,"orthoBottom",void 0),__decorate([c.serialize()],a.prototype,"orthoTop",void 0),__decorate([c.serialize()],a.prototype,"fov",void 0),__decorate([c.serialize()],a.prototype,"minZ",void 0),__decorate([c.serialize()],
a.prototype,"maxZ",void 0),__decorate([c.serialize()],a.prototype,"inertia",void 0),__decorate([c.serialize()],a.prototype,"mode",void 0),__decorate([c.serialize()],a.prototype,"layerMask",void 0),__decorate([c.serialize()],a.prototype,"fovMode",void 0),__decorate([c.serialize()],a.prototype,"cameraRigMode",void 0),__decorate([c.serialize()],a.prototype,"interaxialDistance",void 0),__decorate([c.serialize()],a.prototype,"isStereoscopicSideBySide",void 0),a);c.Camera=f}(BABYLON||(BABYLON={}));
!function(c){c.CameraInputTypes={};var f;f=function(c){this.attached={};this.camera=c;this.checkInputs=function(){}};f=(f.prototype.add=function(e){var a=e.getSimpleName();return this.attached[a]?void c.Tools.Warn("camera input of type "+a+" already exists on camera"):(this.attached[a]=e,e.camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),void(this.attachedElement&&e.attachControl(this.attachedElement)))},f.prototype.remove=function(c){for(var a in this.attached){var b=
this.attached[a];b===c&&(b.detachControl(this.attachedElement),delete this.attached[a],this.rebuildInputCheck())}},f.prototype.removeByType=function(c){for(var a in this.attached){var b=this.attached[a];b.getTypeName()===c&&(b.detachControl(this.attachedElement),delete this.attached[a],this.rebuildInputCheck())}},f.prototype._addCheckInputs=function(c){var a=this.checkInputs;return function(){a();c()}},f.prototype.attachInput=function(c){c.attachControl(this.attachedElement,this.noPreventDefault)},
f.prototype.attachElement=function(e,a){if(!this.attachedElement){a=c.Camera.ForceAttachControlToAlwaysPreventDefault?!1:a;this.attachedElement=e;this.noPreventDefault=a;for(var b in this.attached)this.attached[b],this.attached[b].attachControl(e,a)}},f.prototype.detachElement=function(c){if(this.attachedElement===c){for(var a in this.attached)this.attached[a],this.attached[a].detachControl(c);this.attachedElement=null}},f.prototype.rebuildInputCheck=function(){this.checkInputs=function(){};for(var c in this.attached){var a=
this.attached[c];a.checkInputs&&(this.checkInputs=this._addCheckInputs(a.checkInputs.bind(a)))}},f.prototype.clear=function(){this.attachedElement&&this.detachElement(this.attachedElement);this.attached={};this.attachedElement=null;this.checkInputs=function(){}},f.prototype.serialize=function(e){var a={},b;for(b in this.attached){var d=this.attached[b],j=c.SerializationHelper.Serialize(d);a[d.getTypeName()]=j}e.inputsmgr=a},f.prototype.parse=function(e){var a=e.inputsmgr;if(a){this.clear();for(var b in a){var d=
c.CameraInputTypes[b];if(d){var j=c.SerializationHelper.Parse(function(){return new d},a[b],null);this.add(j)}}}else for(b in this.attached)if(d=c.CameraInputTypes[this.attached[b].getTypeName()])j=c.SerializationHelper.Parse(function(){return new d},e,null),this.remove(this.attached[b]),this.add(j)},f);c.CameraInputsManager=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(c){void 0===c&&(c=!0);this.touchEnabled=c;this.angularSensibility=2E3};f=(f.prototype.attachControl=function(e,a){var b=this;if(!this._pointerInput){var d=this.camera,j=this.camera.getEngine();this._pointerInput=function(g){var h=g.event;if(b.touchEnabled||"touch"!==h.pointerType)if(g.type===c.PointerEventTypes.POINTERDOWN){try{h.srcElement.setPointerCapture(h.pointerId)}catch(e){}b.previousPosition={x:h.clientX,y:h.clientY};a||h.preventDefault()}else if(g.type===c.PointerEventTypes.POINTERUP){try{h.srcElement.releasePointerCapture(h.pointerId)}catch(l){}b.previousPosition=
null;a||h.preventDefault()}else if(g.type===c.PointerEventTypes.POINTERMOVE&&(b.previousPosition||j.isPointerLock)){var k,f;j.isPointerLock?(k=h.movementX||h.mozMovementX||h.webkitMovementX||h.msMovementX||0,f=h.movementY||h.mozMovementY||h.webkitMovementY||h.msMovementY||0):(k=h.clientX-b.previousPosition.x,f=h.clientY-b.previousPosition.y);d.cameraRotation.y+=k/b.angularSensibility;d.cameraRotation.x+=f/b.angularSensibility;b.previousPosition={x:h.clientX,y:h.clientY};a||h.preventDefault()}}}this._observer=
this.camera.getScene().onPointerObservable.add(this._pointerInput,c.PointerEventTypes.POINTERDOWN|c.PointerEventTypes.POINTERUP|c.PointerEventTypes.POINTERMOVE)},f.prototype.detachControl=function(c){this._observer&&c&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this.previousPosition=null)},f.prototype.getTypeName=function(){return"FreeCameraMouseInput"},f.prototype.getSimpleName=function(){return"mouse"},__decorate([c.serialize()],f.prototype,"angularSensibility",
void 0),f);c.FreeCameraMouseInput=f;c.CameraInputTypes.FreeCameraMouseInput=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){this._keys=[];this.keysUp=[38];this.keysDown=[40];this.keysLeft=[37];this.keysRight=[39]};f=(f.prototype.attachControl=function(e,a){var b=this;this._onKeyDown||(this._onKeyDown=function(d){if(-1!==b.keysUp.indexOf(d.keyCode)||-1!==b.keysDown.indexOf(d.keyCode)||-1!==b.keysLeft.indexOf(d.keyCode)||-1!==b.keysRight.indexOf(d.keyCode))-1===b._keys.indexOf(d.keyCode)&&b._keys.push(d.keyCode),a||d.preventDefault()},this._onKeyUp=function(d){if(-1!==b.keysUp.indexOf(d.keyCode)||
-1!==b.keysDown.indexOf(d.keyCode)||-1!==b.keysLeft.indexOf(d.keyCode)||-1!==b.keysRight.indexOf(d.keyCode)){var c=b._keys.indexOf(d.keyCode);0<=c&&b._keys.splice(c,1);a||d.preventDefault()}},c.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]))},f.prototype.detachControl=function(){this._onKeyDown&&(c.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},
{name:"blur",handler:this._onLostFocus}]),this._keys=[],this._onKeyDown=null,this._onKeyUp=null)},f.prototype.checkInputs=function(){if(this._onKeyDown)for(var e=this.camera,a=0;a<this._keys.length;a++){var b=this._keys[a],d=e._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(b)?e._localDirection.copyFromFloats(-d,0,0):-1!==this.keysUp.indexOf(b)?e._localDirection.copyFromFloats(0,0,d):-1!==this.keysRight.indexOf(b)?e._localDirection.copyFromFloats(d,0,0):-1!==this.keysDown.indexOf(b)&&e._localDirection.copyFromFloats(0,
0,-d);e.getViewMatrix().invertToRef(e._cameraTransformMatrix);c.Vector3.TransformNormalToRef(e._localDirection,e._cameraTransformMatrix,e._transformedDirection);e.cameraDirection.addInPlace(e._transformedDirection)}},f.prototype.getTypeName=function(){return"FreeCameraKeyboardMoveInput"},f.prototype._onLostFocus=function(){this._keys=[]},f.prototype.getSimpleName=function(){return"keyboard"},__decorate([c.serialize()],f.prototype,"keysUp",void 0),__decorate([c.serialize()],f.prototype,"keysDown",
void 0),__decorate([c.serialize()],f.prototype,"keysLeft",void 0),__decorate([c.serialize()],f.prototype,"keysRight",void 0),f);c.FreeCameraKeyboardMoveInput=f;c.CameraInputTypes.FreeCameraKeyboardMoveInput=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){this._offsetY=this._offsetX=null;this._pointerCount=0;this._pointerPressed=[];this.touchAngularSensibility=2E5;this.touchMoveSensibility=250};f=(f.prototype.attachControl=function(e,a){var b,d=this;void 0===this._pointerInput&&(this._onLostFocus=function(){d._offsetX=null;d._offsetY=null},this._pointerInput=function(j){var g=j.event;if("mouse"!==g.pointerType)if(j.type===c.PointerEventTypes.POINTERDOWN){if(!(a||g.preventDefault(),d._pointerPressed.push(g.pointerId),
1!==d._pointerPressed.length))b={x:g.clientX,y:g.clientY}}else if(j.type===c.PointerEventTypes.POINTERUP){if(a||g.preventDefault(),j=d._pointerPressed.indexOf(g.pointerId),-1!==j&&!(d._pointerPressed.splice(j,1),0!=j))b=null,d._offsetX=null,d._offsetY=null}else if(j.type===c.PointerEventTypes.POINTERMOVE&&!(a||g.preventDefault(),!b))j=d._pointerPressed.indexOf(g.pointerId),0==j&&(d._offsetX=g.clientX-b.x,d._offsetY=-(g.clientY-b.y))});this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,
c.PointerEventTypes.POINTERDOWN|c.PointerEventTypes.POINTERUP|c.PointerEventTypes.POINTERMOVE);e.addEventListener("blur",this._onLostFocus)},f.prototype.detachControl=function(c){this._pointerInput&&c&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,c.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null,this._pointerPressed=[],this._offsetX=null,this._offsetY=null,this._pointerCount=0)},f.prototype.checkInputs=function(){if(this._offsetX){var e=
this.camera;if(e.cameraRotation.y+=this._offsetX/this.touchAngularSensibility,1<this._pointerPressed.length)e.cameraRotation.x+=-this._offsetY/this.touchAngularSensibility;else{var a=e._computeLocalCameraSpeed(),a=new c.Vector3(0,0,a*this._offsetY/this.touchMoveSensibility);c.Matrix.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,e._cameraRotationMatrix);e.cameraDirection.addInPlace(c.Vector3.TransformCoordinates(a,e._cameraRotationMatrix))}}},f.prototype.getTypeName=function(){return"FreeCameraTouchInput"},
f.prototype.getSimpleName=function(){return"touch"},__decorate([c.serialize()],f.prototype,"touchAngularSensibility",void 0),__decorate([c.serialize()],f.prototype,"touchMoveSensibility",void 0),f);c.FreeCameraTouchInput=f;c.CameraInputTypes.FreeCameraTouchInput=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){var e=this;this._screenOrientationAngle=0;this._screenQuaternion=new c.Quaternion;this._gamma=this._beta=this._alpha=0;this._orientationChanged=function(){e._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0;e._screenOrientationAngle=-c.Tools.ToRadians(e._screenOrientationAngle/2);e._screenQuaternion.copyFromFloats(0,Math.sin(e._screenOrientationAngle),
0,Math.cos(e._screenOrientationAngle))};this._deviceOrientation=function(a){e._alpha=a.alpha;e._beta=a.beta;e._gamma=a.gamma};this._constantTranform=new c.Quaternion(-Math.sqrt(0.5),0,0,Math.sqrt(0.5));this._orientationChanged()};f=(Object.defineProperty(f.prototype,"camera",{get:function(){return this._camera},set:function(e){this._camera=e;this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new c.Quaternion)},enumerable:!0,configurable:!0}),f.prototype.attachControl=function(){window.addEventListener("orientationchange",
this._orientationChanged);window.addEventListener("deviceorientation",this._deviceOrientation)},f.prototype.detachControl=function(){window.removeEventListener("orientationchange",this._orientationChanged);window.removeEventListener("deviceorientation",this._deviceOrientation)},f.prototype.checkInputs=function(){c.Quaternion.RotationYawPitchRollToRef(c.Tools.ToRadians(this._alpha),c.Tools.ToRadians(this._beta),-c.Tools.ToRadians(this._gamma),this.camera.rotationQuaternion);this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion);
this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform);this._camera.rotationQuaternion.z*=-1;this._camera.rotationQuaternion.w*=-1},f.prototype.getTypeName=function(){return"FreeCameraDeviceOrientationInput"},f.prototype.getSimpleName=function(){return"deviceOrientation"},f);c.FreeCameraDeviceOrientationInput=f;c.CameraInputTypes.FreeCameraDeviceOrientationInput=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){this.gammaCorrection=this.betaCorrection=this.alphaCorrection=1;this._gamma=this._beta=this._alpha=0;this._dirty=!1;this._deviceOrientationHandler=this._onOrientationEvent.bind(this)};f=(f.prototype.attachControl=function(){window.addEventListener("deviceorientation",this._deviceOrientationHandler)},f.prototype._onOrientationEvent=function(c){this.camera;this._alpha=c.alpha;this._beta=c.beta;this._gamma=c.gamma;this._dirty=!0},f.prototype.checkInputs=function(){if(this._dirty){this._dirty=
!1;var c=this._gamma;this.camera.rotation.x=this.gammaCorrection*(0>c?90+c:270-c)/180*Math.PI;this.camera.rotation.y=this.alphaCorrection*-this._alpha/180*Math.PI;this.camera.rotation.z=this.betaCorrection*this._beta/180*Math.PI}},f.prototype.detachControl=function(){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},f.prototype.getTypeName=function(){return"FreeCameraVRDeviceOrientationInput"},f.prototype.getSimpleName=function(){return"VRDeviceOrientation"},f);c.FreeCameraVRDeviceOrientationInput=
f;c.CameraInputTypes.FreeCameraVRDeviceOrientationInput=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){this.gamepadAngularSensibility=200;this.gamepadMoveSensibility=40};f=(f.prototype.attachControl=function(){var e=this;this._gamepads=new c.Gamepads(function(a){e._onNewGameConnected(a)})},f.prototype.detachControl=function(){this._gamepads&&this._gamepads.dispose();this.gamepad=null},f.prototype.checkInputs=function(){if(this.gamepad){var e=this.camera,a=this.gamepad.leftStick,b=a.x/this.gamepadMoveSensibility,d=a.y/this.gamepadMoveSensibility;a.x=0.005<Math.abs(b)?
0+b:0;a.y=0.005<Math.abs(d)?0+d:0;var b=this.gamepad.rightStick,d=b.x/this.gamepadAngularSensibility,j=b.y/this.gamepadAngularSensibility;b.x=0.001<Math.abs(d)?0+d:0;b.y=0.001<Math.abs(j)?0+j:0;d=c.Matrix.RotationYawPitchRoll(e.rotation.y,e.rotation.x,0);j=50*e._computeLocalCameraSpeed();a=c.Vector3.TransformCoordinates(new c.Vector3(a.x*j,0,-a.y*j),d);e.cameraDirection=e.cameraDirection.add(a);e.cameraRotation=e.cameraRotation.add(new c.Vector2(b.y,b.x))}},f.prototype._onNewGameConnected=function(c){0===
c.index&&(this.gamepad=c)},f.prototype.getTypeName=function(){return"FreeCameraGamepadInput"},f.prototype.getSimpleName=function(){return"gamepad"},__decorate([c.serialize()],f.prototype,"gamepadAngularSensibility",void 0),__decorate([c.serialize()],f.prototype,"gamepadMoveSensibility",void 0),f);c.FreeCameraGamepadInput=f;c.CameraInputTypes.FreeCameraGamepadInput=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){this._keys=[];this.keysUp=[38];this.keysDown=[40];this.keysLeft=[37];this.keysRight=[39]};f=(f.prototype.attachControl=function(e,a){var b=this;this._onKeyDown=function(d){if(-1!==b.keysUp.indexOf(d.keyCode)||-1!==b.keysDown.indexOf(d.keyCode)||-1!==b.keysLeft.indexOf(d.keyCode)||-1!==b.keysRight.indexOf(d.keyCode))-1===b._keys.indexOf(d.keyCode)&&b._keys.push(d.keyCode),d.preventDefault&&(a||d.preventDefault())};this._onKeyUp=function(d){if(-1!==b.keysUp.indexOf(d.keyCode)||
-1!==b.keysDown.indexOf(d.keyCode)||-1!==b.keysLeft.indexOf(d.keyCode)||-1!==b.keysRight.indexOf(d.keyCode)){var c=b._keys.indexOf(d.keyCode);0<=c&&b._keys.splice(c,1);d.preventDefault&&(a||d.preventDefault())}};this._onLostFocus=function(){b._keys=[]};c.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}])},f.prototype.detachControl=function(){c.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},
{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]);this._keys=[];this._onLostFocus=this._onKeyUp=this._onKeyDown=null},f.prototype.checkInputs=function(){if(this._onKeyDown)for(var c=this.camera,a=0;a<this._keys.length;a++){var b=this._keys[a];-1!==this.keysLeft.indexOf(b)?c.inertialAlphaOffset-=0.01:-1!==this.keysUp.indexOf(b)?c.inertialBetaOffset-=0.01:-1!==this.keysRight.indexOf(b)?c.inertialAlphaOffset+=0.01:-1!==this.keysDown.indexOf(b)&&(c.inertialBetaOffset+=0.01)}},
f.prototype.getTypeName=function(){return"ArcRotateCameraKeyboardMoveInput"},f.prototype.getSimpleName=function(){return"keyboard"},__decorate([c.serialize()],f.prototype,"keysUp",void 0),__decorate([c.serialize()],f.prototype,"keysDown",void 0),__decorate([c.serialize()],f.prototype,"keysLeft",void 0),__decorate([c.serialize()],f.prototype,"keysRight",void 0),f);c.ArcRotateCameraKeyboardMoveInput=f;c.CameraInputTypes.ArcRotateCameraKeyboardMoveInput=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){this.wheelPrecision=3};f=(f.prototype.attachControl=function(e,a){var b=this;this._wheel=function(d){if(d.type===c.PointerEventTypes.POINTERWHEEL){d=d.event;var j=0;d.wheelDelta?j=d.wheelDelta/(40*b.wheelPrecision):d.detail&&(j=-d.detail/b.wheelPrecision);j&&(b.camera.inertialRadiusOffset+=j);d.preventDefault&&(a||d.preventDefault())}};this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,c.PointerEventTypes.POINTERWHEEL)},f.prototype.detachControl=
function(c){this._observer&&c&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},f.prototype.getTypeName=function(){return"ArcRotateCameraMouseWheelInput"},f.prototype.getSimpleName=function(){return"mousewheel"},__decorate([c.serialize()],f.prototype,"wheelPrecision",void 0),f);c.ArcRotateCameraMouseWheelInput=f;c.CameraInputTypes.ArcRotateCameraMouseWheelInput=f}(BABYLON||(BABYLON={}));
!function(c){c.Tools.GetPointerPrefix();var f=function(){this.angularSensibilityY=this.angularSensibilityX=1E3;this.pinchPrecision=6;this.panningSensibility=50;this._isCtrlPushed=this._isRightClick=!1;this.pinchInwards=!0},f=(f.prototype.attachControl=function(e,a){var b,d,j,g=this,h=this.camera.getEngine(),m=0;this._pointerInput=function(h){var e=h.event;if(h.type===c.PointerEventTypes.POINTERDOWN){try{e.srcElement.setPointerCapture(e.pointerId)}catch(f){}g._isRightClick=2===e.button;b={x:e.clientX,
y:e.clientY,pointerId:e.pointerId,type:e.pointerType};void 0===d?d=b:void 0===j&&(j=b);a||e.preventDefault()}else if(h.type===c.PointerEventTypes.POINTERUP){try{e.srcElement.releasePointerCapture(e.pointerId)}catch(q){}b=null;m=0;d=j=void 0;a||e.preventDefault()}else if(h.type===c.PointerEventTypes.POINTERMOVE)if(a||e.preventDefault(),d&&void 0===j)0!==g.panningSensibility&&(g._isCtrlPushed&&g.camera._useCtrlForPanning||!g.camera._useCtrlForPanning&&g._isRightClick)?(g.camera.inertialPanningX+=-(e.clientX-
b.x)/g.panningSensibility,g.camera.inertialPanningY+=(e.clientY-b.y)/g.panningSensibility):(h=e.clientY-b.y,g.camera.inertialAlphaOffset-=(e.clientX-b.x)/g.angularSensibilityX,g.camera.inertialBetaOffset-=h/g.angularSensibilityY),b.x=e.clientX,b.y=e.clientY;else if(d&&j){h=d.pointerId===e.pointerId?d:j;h.x=e.clientX;h.y=e.clientY;e=g.pinchInwards?1:-1;h=d.x-j.x;var p=d.y-j.y;h=h*h+p*p;if(0===m)return void(m=h);h!==m&&(g.camera.inertialRadiusOffset+=(h-m)/(g.pinchPrecision*((g.angularSensibilityX+
g.angularSensibilityY)/2)*e),m=h)}};this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,c.PointerEventTypes.POINTERDOWN|c.PointerEventTypes.POINTERUP|c.PointerEventTypes.POINTERMOVE);this._onContextMenu=function(a){a.preventDefault()};this.camera._useCtrlForPanning||e.addEventListener("contextmenu",this._onContextMenu,!1);this._onLostFocus=function(){d=j=void 0;m=0;b=null};this._onKeyDown=function(a){g._isCtrlPushed=a.ctrlKey};this._onKeyUp=function(a){g._isCtrlPushed=
a.ctrlKey};this._onMouseMove=function(b){if(h.isPointerLock){var d=b.movementY||b.mozMovementY||b.webkitMovementY||b.msMovementY||0;g.camera.inertialAlphaOffset-=(b.movementX||b.mozMovementX||b.webkitMovementX||b.msMovementX||0)/g.angularSensibilityX;g.camera.inertialBetaOffset-=d/g.angularSensibilityY;a||b.preventDefault()}};this._onGestureStart=function(a){void 0!==window.MSGesture&&(g._MSGestureHandler||(g._MSGestureHandler=new MSGesture,g._MSGestureHandler.target=e),g._MSGestureHandler.addPointer(a.pointerId))};
this._onGesture=function(b){g.camera.radius*=b.scale;b.preventDefault&&(a||(b.stopPropagation(),b.preventDefault()))};e.addEventListener("mousemove",this._onMouseMove,!1);e.addEventListener("MSPointerDown",this._onGestureStart,!1);e.addEventListener("MSGestureChange",this._onGesture,!1);c.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}])},f.prototype.detachControl=function(e){e&&this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),
this._observer=null,e.removeEventListener("contextmenu",this._onContextMenu),e.removeEventListener("mousemove",this._onMouseMove),e.removeEventListener("MSPointerDown",this._onGestureStart),e.removeEventListener("MSGestureChange",this._onGesture),this._isRightClick=!1,this._isCtrlPushed=!1,this.pinchInwards=!0,this._onKeyDown=null,this._onKeyUp=null,this._onMouseMove=null,this._onGestureStart=null,this._onGesture=null,this._MSGestureHandler=null,this._onLostFocus=null,this._onContextMenu=null);c.Tools.UnregisterTopRootEvents([{name:"keydown",
handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}])},f.prototype.getTypeName=function(){return"ArcRotateCameraPointersInput"},f.prototype.getSimpleName=function(){return"pointers"},__decorate([c.serialize()],f.prototype,"angularSensibilityX",void 0),__decorate([c.serialize()],f.prototype,"angularSensibilityY",void 0),__decorate([c.serialize()],f.prototype,"pinchPrecision",void 0),__decorate([c.serialize()],f.prototype,"panningSensibility",void 0),
f);c.ArcRotateCameraPointersInput=f;c.CameraInputTypes.ArcRotateCameraPointersInput=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){this.gamepadRotationSensibility=80;this.gamepadMoveSensibility=40};f=(f.prototype.attachControl=function(){var e=this;this._gamepads=new c.Gamepads(function(a){e._onNewGameConnected(a)})},f.prototype.detachControl=function(){this._gamepads&&this._gamepads.dispose();this.gamepad=null},f.prototype.checkInputs=function(){if(this.gamepad){var c=this.camera,a=this.gamepad.rightStick;if(0!=a.x){var b=a.x/this.gamepadRotationSensibility;0!=b&&0.005<Math.abs(b)&&(c.inertialAlphaOffset+=
b)}0!=a.y&&(a=a.y/this.gamepadRotationSensibility,0!=a&&0.005<Math.abs(a)&&(c.inertialBetaOffset+=a));c=this.gamepad.leftStick;0!=c.y&&(c=c.y/this.gamepadMoveSensibility,0!=c&&0.005<Math.abs(c)&&(this.camera.inertialRadiusOffset-=c))}},f.prototype._onNewGameConnected=function(c){0===c.index&&(this.gamepad=c)},f.prototype.getTypeName=function(){return"ArcRotateCameraGamepadInput"},f.prototype.getSimpleName=function(){return"gamepad"},__decorate([c.serialize()],f.prototype,"gamepadRotationSensibility",
void 0),__decorate([c.serialize()],f.prototype,"gamepadMoveSensibility",void 0),f);c.ArcRotateCameraGamepadInput=f;c.CameraInputTypes.ArcRotateCameraGamepadInput=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){this.gammaCorrection=this.betaCorrection=this.alphaCorrection=1;this._gamma=this._beta=this._alpha=0;this._dirty=!1;this._deviceOrientationHandler=this._onOrientationEvent.bind(this)};f=(f.prototype.attachControl=function(c,a){this.camera.attachControl(c,a);window.addEventListener("deviceorientation",this._deviceOrientationHandler)},f.prototype._onOrientationEvent=function(c){this.camera;this._alpha=0|+c.alpha;this._beta=0|+c.beta;this._gamma=0|+c.gamma;this._dirty=
!0},f.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,0>this._gamma&&(this._gamma=180+this._gamma),this.camera.alpha=2*(-this._alpha/180*Math.PI%Math.PI),this.camera.beta=this._gamma/180*Math.PI)},f.prototype.detachControl=function(){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},f.prototype.getTypeName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},f.prototype.getSimpleName=function(){return"VRDeviceOrientation"},f);c.ArcRotateCameraVRDeviceOrientationInput=
f;c.CameraInputTypes.ArcRotateCameraVRDeviceOrientationInput=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Camera,a=function(a,d,j){e.call(this,a,d,j);this.cameraDirection=new c.Vector3(0,0,0);this.cameraRotation=new c.Vector2(0,0);this.rotation=new c.Vector3(0,0,0);this.speed=2;this.noRotationConstraint=!1;this.lockedTarget=null;this._currentTarget=c.Vector3.Zero();this._viewMatrix=c.Matrix.Zero();this._camMatrix=c.Matrix.Zero();this._cameraTransformMatrix=c.Matrix.Zero();this._cameraRotationMatrix=c.Matrix.Zero();this._referencePoint=new c.Vector3(0,0,1);this._defaultUpVector=
new c.Vector3(0,1,0);this._transformedReferencePoint=c.Vector3.Zero();this._lookAtTemp=c.Matrix.Zero();this._tempMatrix=c.Matrix.Zero()};f=(__extends(a,e),a.prototype.getFrontPosition=function(a){var d=this.getTarget().subtract(this.position);return d.normalize(),d.scaleInPlace(a),this.globalPosition.add(d)},a.prototype._getLockedTargetPosition=function(){return this.lockedTarget?this.lockedTarget.position||this.lockedTarget:null},a.prototype._initCache=function(){e.prototype._initCache.call(this);
this._cache.lockedTarget=new c.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.rotation=new c.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.rotationQuaternion=new c.Quaternion(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},a.prototype._updateCache=function(a){a||e.prototype._updateCache.call(this);(a=this._getLockedTargetPosition())?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(a):this._cache.lockedTarget=a.clone():
this._cache.lockedTarget=null;this._cache.rotation.copyFrom(this.rotation);this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},a.prototype._isSynchronizedViewMatrix=function(){if(!e.prototype._isSynchronizedViewMatrix.call(this))return!1;var a=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(a):!a)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},
a.prototype._computeLocalCameraSpeed=function(){var a=this.getEngine();return this.speed*(a.getDeltaTime()/(10*a.getFps()))},a.prototype.setTarget=function(a){this.upVector.normalize();c.Matrix.LookAtLHToRef(this.position,a,this._defaultUpVector,this._camMatrix);this._camMatrix.invert();this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);a=a.subtract(this.position);0<=a.x?this.rotation.y=-Math.atan(a.z/a.x)+Math.PI/2:this.rotation.y=-Math.atan(a.z/a.x)-Math.PI/2;this.rotation.z=
0;isNaN(this.rotation.x)&&(this.rotation.x=0);isNaN(this.rotation.y)&&(this.rotation.y=0);isNaN(this.rotation.z)&&(this.rotation.z=0);this.rotationQuaternion&&c.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},a.prototype.getTarget=function(){return this._currentTarget},a.prototype._decideIfNeedsToMove=function(){return 0<Math.abs(this.cameraDirection.x)||0<Math.abs(this.cameraDirection.y)||0<Math.abs(this.cameraDirection.z)},a.prototype._updatePosition=
function(){this.position.addInPlace(this.cameraDirection)},a.prototype._checkInputs=function(){var a=this._decideIfNeedsToMove(),d=0<Math.abs(this.cameraRotation.x)||0<Math.abs(this.cameraRotation.y);if(a&&this._updatePosition(),d&&(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,!this.noRotationConstraint)){var j=0.95*(Math.PI/2);this.rotation.x>j&&(this.rotation.x=j);this.rotation.x<-j&&(this.rotation.x=-j)}a&&(Math.abs(this.cameraDirection.x)<c.Epsilon&&(this.cameraDirection.x=
0),Math.abs(this.cameraDirection.y)<c.Epsilon&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<c.Epsilon&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia));d&&(Math.abs(this.cameraRotation.x)<c.Epsilon&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<c.Epsilon&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia));e.prototype._checkInputs.call(this)},a.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix),
c.Vector3.TransformNormalToRef(this._defaultUpVector,this._cameraRotationMatrix,this.upVector)):c.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},a.prototype._getViewMatrix=function(){return this.lockedTarget?this._currentTarget.copyFrom(this._getLockedTargetPosition()):(this._updateCameraRotationMatrix(),c.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,
this._currentTarget)),c.Matrix.LookAtLHToRef(this.position,this._currentTarget,this.upVector,this._viewMatrix),this._viewMatrix},a.prototype.createRigCamera=function(b){return this.cameraRigMode!==c.Camera.RIG_MODE_NONE?(b=new a(b,this.position.clone(),this.getScene()),this.cameraRigMode===c.Camera.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new c.Quaternion),b._cameraRigParams={},b.rotationQuaternion=new c.Quaternion),b):null},a.prototype._updateRigCameras=function(){var a=this._rigCameras[0],
d=this._rigCameras[1];switch(this.cameraRigMode){case c.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case c.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case c.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case c.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:var j=this.cameraRigMode===c.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle*(this.cameraRigMode===c.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1),a.position);this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle*
j,d.position);a.setTarget(this.getTarget());d.setTarget(this.getTarget());break;case c.Camera.RIG_MODE_VR:a.rotationQuaternion.copyFrom(this.rotationQuaternion),d.rotationQuaternion.copyFrom(this.rotationQuaternion),a.position.copyFrom(this.position),d.position.copyFrom(this.position)}e.prototype._updateRigCameras.call(this)},a.prototype._getRigCamPosition=function(a,d){this._rigCamTransformMatrix||(this._rigCamTransformMatrix=new c.Matrix);var j=this.getTarget();c.Matrix.Translation(-j.x,-j.y,-j.z).multiplyToRef(c.Matrix.RotationY(a),
this._rigCamTransformMatrix);this._rigCamTransformMatrix=this._rigCamTransformMatrix.multiply(c.Matrix.Translation(j.x,j.y,j.z));c.Vector3.TransformCoordinatesToRef(this.position,this._rigCamTransformMatrix,d)},a.prototype.getTypeName=function(){return"TargetCamera"},__decorate([c.serializeAsVector3()],a.prototype,"rotation",void 0),__decorate([c.serialize()],a.prototype,"speed",void 0),__decorate([c.serializeAsMeshReference("lockedTargetId")],a.prototype,"lockedTarget",void 0),a);c.TargetCamera=
f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.TargetCamera;f=function(a,b,d){var j=this;e.call(this,a,b,d);this.ellipsoid=new c.Vector3(0.5,1,0.5);this.applyGravity=this.checkCollisions=!1;this._collider=new c.Collider;this._needMoveForGravity=!1;this._oldPosition=c.Vector3.Zero();this._diffPosition=c.Vector3.Zero();this._newPosition=c.Vector3.Zero();this._onCollisionPositionChange=function(a,b,d){void 0===d&&(d=null);j.getScene().workerCollisions&&b.multiplyInPlace(j._collider.radius);j._newPosition.copyFrom(b);j._newPosition.subtractToRef(j._oldPosition,
j._diffPosition);j.position.clone();j._diffPosition.length()>c.Engine.CollisionsEpsilon&&(j.position.addInPlace(j._diffPosition),j.onCollide&&d&&j.onCollide(d))};this.inputs=new c.FreeCameraInputsManager(this);this.inputs.addKeyboard().addMouse()};f=(__extends(f,e),Object.defineProperty(f.prototype,"angularSensibility",{get:function(){var a=this.inputs.attached.mouse;return a?a.angularSensibility:void 0},set:function(a){var b=this.inputs.attached.mouse;b&&(b.angularSensibility=a)},enumerable:!0,configurable:!0}),
Object.defineProperty(f.prototype,"keysUp",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysUp:void 0},set:function(a){var b=this.inputs.attached.keyboard;b&&(b.keysUp=a)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"keysDown",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysDown:void 0},set:function(a){var b=this.inputs.attached.keyboard;b&&(b.keysDown=a)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"keysLeft",{get:function(){var a=
this.inputs.attached.keyboard;return a?a.keysLeft:void 0},set:function(a){var b=this.inputs.attached.keyboard;b&&(b.keysLeft=a)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"keysRight",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysRight:void 0},set:function(a){var b=this.inputs.attached.keyboard;b&&(b.keysRight=a)},enumerable:!0,configurable:!0}),f.prototype.attachControl=function(a,b){this.inputs.attachElement(a,b)},f.prototype.detachControl=function(a){this.inputs.detachElement(a);
this.cameraDirection=new c.Vector3(0,0,0);this.cameraRotation=new c.Vector2(0,0)},f.prototype._collideWithWorld=function(a){(this.parent?c.Vector3.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition);this._collider.radius=this.ellipsoid;var b=a;this.applyGravity&&(b=a.add(this.getScene().gravity));this.getScene().collisionCoordinator.getNewPosition(this._oldPosition,b,this._collider,3,null,this._onCollisionPositionChange,
this.uniqueId)},f.prototype._checkInputs=function(){this._localDirection||(this._localDirection=c.Vector3.Zero(),this._transformedDirection=c.Vector3.Zero());this.inputs.checkInputs();e.prototype._checkInputs.call(this)},f.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||0<Math.abs(this.cameraDirection.x)||0<Math.abs(this.cameraDirection.y)||0<Math.abs(this.cameraDirection.z)},f.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?
this._collideWithWorld(this.cameraDirection):this.position.addInPlace(this.cameraDirection)},f.prototype.dispose=function(){this.inputs.clear();e.prototype.dispose.call(this)},f.prototype.getTypeName=function(){return"FreeCamera"},__decorate([c.serializeAsVector3()],f.prototype,"ellipsoid",void 0),__decorate([c.serialize()],f.prototype,"checkCollisions",void 0),__decorate([c.serialize()],f.prototype,"applyGravity",void 0),f);c.FreeCamera=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.CameraInputsManager;f=function(a){e.call(this,a)};f=(__extends(f,e),f.prototype.addKeyboard=function(){return this.add(new c.FreeCameraKeyboardMoveInput),this},f.prototype.addMouse=function(a){return void 0===a&&(a=!0),this.add(new c.FreeCameraMouseInput(a)),this},f.prototype.addGamepad=function(){return this.add(new c.FreeCameraGamepadInput),this},f.prototype.addDeviceOrientation=function(){return this.add(new c.FreeCameraDeviceOrientationInput),this},f.prototype.addVRDeviceOrientation=
function(){return this.add(new c.FreeCameraVRDeviceOrientationInput),this},f.prototype.addTouch=function(){return this.add(new c.FreeCameraTouchInput),this},f.prototype.addVirtualJoystick=function(){return this.add(new c.FreeCameraVirtualJoystickInput),this},f);c.FreeCameraInputsManager=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.TargetCamera;f=function(a,d,c,g){e.call(this,a,d,c);this.radius=12;this.rotationOffset=0;this.heightOffset=4;this.cameraAcceleration=0.05;this.maxCameraSpeed=20;this.target=g};f=(__extends(f,e),f.prototype.getRadians=function(a){return a*Math.PI/180},f.prototype.follow=function(a){if(a){var d;a.rotationQuaternion?(d=new c.Matrix,a.rotationQuaternion.toRotationMatrix(d),d=Math.atan2(d.m[8],d.m[10])):d=a.rotation.y;d=this.getRadians(this.rotationOffset)+d;var j=a.position.x+Math.sin(d)*
this.radius;d=a.position.z+Math.cos(d)*this.radius;var j=2*(j-this.position.x)*this.cameraAcceleration,g=(a.position.y+this.heightOffset-this.position.y)*this.cameraAcceleration;d=2*(d-this.position.z)*this.cameraAcceleration;(j>this.maxCameraSpeed||j<-this.maxCameraSpeed)&&(j=1>j?-this.maxCameraSpeed:this.maxCameraSpeed);(g>this.maxCameraSpeed||g<-this.maxCameraSpeed)&&(g=1>g?-this.maxCameraSpeed:this.maxCameraSpeed);(d>this.maxCameraSpeed||d<-this.maxCameraSpeed)&&(d=1>d?-this.maxCameraSpeed:this.maxCameraSpeed);
this.position=new c.Vector3(this.position.x+j,this.position.y+g,this.position.z+d);this.setTarget(a.position)}},f.prototype._checkInputs=function(){e.prototype._checkInputs.call(this);this.follow(this.target)},f.prototype.getTypeName=function(){return"FollowCamera"},__decorate([c.serialize()],f.prototype,"radius",void 0),__decorate([c.serialize()],f.prototype,"rotationOffset",void 0),__decorate([c.serialize()],f.prototype,"heightOffset",void 0),__decorate([c.serialize()],f.prototype,"cameraAcceleration",
void 0),__decorate([c.serialize()],f.prototype,"maxCameraSpeed",void 0),__decorate([c.serializeAsMeshReference("lockedTargetId")],f.prototype,"target",void 0),f);c.FollowCamera=f;var a=c.TargetCamera;f=function(b,d,j,g,h,e){a.call(this,b,c.Vector3.Zero(),e);this.alpha=d;this.beta=j;this.radius=g;this.target=h;this._cartesianCoordinates=c.Vector3.Zero();this.follow()};f=(__extends(f,a),f.prototype.follow=function(){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta);this._cartesianCoordinates.y=
this.radius*Math.sin(this.beta);this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta);this.position=this.target.position.add(this._cartesianCoordinates);this.setTarget(this.target.position)},f.prototype._checkInputs=function(){a.prototype._checkInputs.call(this);this.follow()},f.prototype.getTypeName=function(){return"ArcFollowCamera"},f);c.ArcFollowCamera=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.FreeCamera;f=function(a,b,d){e.call(this,a,b,d);this.inputs.addTouch();this._setupInputs()};f=(__extends(f,e),Object.defineProperty(f.prototype,"touchAngularSensibility",{get:function(){var a=this.inputs.attached.touch;return a?a.touchAngularSensibility:void 0},set:function(a){var b=this.inputs.attached.touch;b&&(b.touchAngularSensibility=a)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"touchMoveSensibility",{get:function(){var a=this.inputs.attached.touch;
return a?a.touchMoveSensibility:void 0},set:function(a){var b=this.inputs.attached.touch;b&&(b.touchMoveSensibility=a)},enumerable:!0,configurable:!0}),f.prototype.getTypeName=function(){return"TouchCamera"},f.prototype._setupInputs=function(){var a=this.inputs.attached.mouse;a&&(a.touchEnabled=!1)},f);c.TouchCamera=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.TargetCamera,a=function(a,d,j,g,h,m){var l=this;e.call(this,a,c.Vector3.Zero(),m);this.inertialRadiusOffset=this.inertialBetaOffset=this.inertialAlphaOffset=0;this.upperAlphaLimit=this.lowerAlphaLimit=null;this.lowerBetaLimit=0.01;this.upperBetaLimit=Math.PI;this.upperRadiusLimit=this.lowerRadiusLimit=null;this.inertialPanningY=this.inertialPanningX=0;this.zoomOnFactor=1;this.targetScreenOffset=c.Vector2.Zero();this.allowUpsideDown=!0;this._viewMatrix=new c.Matrix;this.panningAxis=
new c.Vector3(1,1,0);this.checkCollisions=!1;this.collisionRadius=new c.Vector3(0.5,0.5,0.5);this._collider=new c.Collider;this._previousPosition=c.Vector3.Zero();this._collisionVelocity=c.Vector3.Zero();this._newPosition=c.Vector3.Zero();this._onCollisionPositionChange=function(a,b,d){void 0===d&&(d=null);l.getScene().workerCollisions&&l.checkCollisions&&b.multiplyInPlace(l._collider.radius);d?(l.setPosition(b),l.onCollide&&l.onCollide(d)):l._previousPosition.copyFrom(l.position);b=Math.cos(l.alpha);
d=Math.sin(l.alpha);var h=Math.cos(l.beta),g=Math.sin(l.beta);0===g&&(g=1E-4);a=l._getTargetPosition();a.addToRef(new c.Vector3(l.radius*b*g,l.radius*h,l.radius*d*g),l._newPosition);l.position.copyFrom(l._newPosition);b=l.upVector;l.allowUpsideDown&&0>l.beta&&(b=b.clone(),b=b.negate());c.Matrix.LookAtLHToRef(l.position,a,b,l._viewMatrix);l._viewMatrix.m[12]+=l.targetScreenOffset.x;l._viewMatrix.m[13]+=l.targetScreenOffset.y;l._collisionTriggered=!1};h?this.target=h:this.target=c.Vector3.Zero();this.alpha=
d;this.beta=j;this.radius=g;this.getViewMatrix();this.inputs=new c.ArcRotateCameraInputsManager(this);this.inputs.addKeyboard().addMouseWheel().addPointers().addGamepad()};f=(__extends(a,e),Object.defineProperty(a.prototype,"angularSensibilityX",{get:function(){var a=this.inputs.attached.pointers;return a?a.angularSensibilityX:void 0},set:function(a){var d=this.inputs.attached.pointers;d&&(d.angularSensibilityX=a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"angularSensibilityY",
{get:function(){var a=this.inputs.attached.pointers;return a?a.angularSensibilityY:void 0},set:function(a){var d=this.inputs.attached.pointers;d&&(d.angularSensibilityY=a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"pinchPrecision",{get:function(){var a=this.inputs.attached.pointers;return a?a.pinchPrecision:void 0},set:function(a){var d=this.inputs.attached.pointers;d&&(d.pinchPrecision=a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"panningSensibility",
{get:function(){var a=this.inputs.attached.pointers;return a?a.panningSensibility:void 0},set:function(a){var d=this.inputs.attached.pointers;d&&(d.panningSensibility=a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysUp",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysUp:void 0},set:function(a){var d=this.inputs.attached.keyboard;d&&(d.keysUp=a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysDown",{get:function(){var a=this.inputs.attached.keyboard;
return a?a.keysDown:void 0},set:function(a){var d=this.inputs.attached.keyboard;d&&(d.keysDown=a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysLeft",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysLeft:void 0},set:function(a){var d=this.inputs.attached.keyboard;d&&(d.keysLeft=a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"keysRight",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysRight:void 0},set:function(a){var d=
this.inputs.attached.keyboard;d&&(d.keysRight=a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"wheelPrecision",{get:function(){var a=this.inputs.attached.mousewheel;return a?a.wheelPrecision:void 0},set:function(a){var d=this.inputs.attached.mousewheel;d&&(d.wheelPrecision=a)},enumerable:!0,configurable:!0}),a.prototype._initCache=function(){e.prototype._initCache.call(this);this._cache.target=new c.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.alpha=
void 0;this._cache.beta=void 0;this._cache.radius=void 0;this._cache.targetScreenOffset=c.Vector2.Zero()},a.prototype._updateCache=function(a){a||e.prototype._updateCache.call(this);this._cache.target.copyFrom(this._getTargetPosition());this._cache.alpha=this.alpha;this._cache.beta=this.beta;this._cache.radius=this.radius;this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},a.prototype._getTargetPosition=function(){return this.target.getAbsolutePosition?this.target.getAbsolutePosition():
this.target},a.prototype._isSynchronizedViewMatrix=function(){return e.prototype._isSynchronizedViewMatrix.call(this)?this._cache.target.equals(this.target)&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset):!1},a.prototype.attachControl=function(a,d,c){var g=this;void 0===c&&(c=!0);this._useCtrlForPanning=c;this.inputs.attachElement(a,d);this._reset=function(){g.inertialAlphaOffset=0;g.inertialBetaOffset=
0;g.inertialRadiusOffset=0}},a.prototype.detachControl=function(a){this.inputs.detachElement(a);this._reset&&this._reset()},a.prototype._checkInputs=function(){this._collisionTriggered||(this.inputs.checkInputs(),0===this.inertialAlphaOffset&&0===this.inertialBetaOffset&&0===this.inertialRadiusOffset||(this.alpha+=0>=this.beta?-this.inertialAlphaOffset:this.inertialAlphaOffset,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=
this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<c.Epsilon&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<c.Epsilon&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<c.Epsilon&&(this.inertialRadiusOffset=0)),0===this.inertialPanningX&&0===this.inertialPanningY||(this._localDirection||(this._localDirection=c.Vector3.Zero(),this._transformedDirection=c.Vector3.Zero()),this.inertialPanningX*=this.inertia,this.inertialPanningY*=this.inertia,
Math.abs(this.inertialPanningX)<c.Epsilon&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<c.Epsilon&&(this.inertialPanningY=0),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),c.Vector3.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=
0),this.target.getAbsolutePosition||this.target.addInPlace(this._transformedDirection)),this._checkLimits(),e.prototype._checkInputs.call(this))},a.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta-=2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit);null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta+=2*Math.PI):this.beta>this.upperBetaLimit&&
(this.beta=this.upperBetaLimit);this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit);this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit);this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit);this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit)},a.prototype.rebuildAnglesAndRadius=function(){var a=this.position.subtract(this._getTargetPosition());
this.radius=a.length();this.alpha=Math.acos(a.x/Math.sqrt(Math.pow(a.x,2)+Math.pow(a.z,2)));0>a.z&&(this.alpha=2*Math.PI-this.alpha);this.beta=Math.acos(a.y/this.radius);this._checkLimits()},a.prototype.setPosition=function(a){this.position.equals(a)||(this.position=a,this.rebuildAnglesAndRadius())},a.prototype.setTarget=function(a){this._getTargetPosition().equals(a)||(this.target=a,this.rebuildAnglesAndRadius())},a.prototype._getViewMatrix=function(){var a=Math.cos(this.alpha),d=Math.sin(this.alpha),
j=Math.cos(this.beta),g=Math.sin(this.beta);0===g&&(g=1E-4);var h=this._getTargetPosition();(h.addToRef(new c.Vector3(this.radius*a*g,this.radius*j,this.radius*d*g),this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions)?(this._collider.radius=this.collisionRadius,this._newPosition.subtractToRef(this.position,this._collisionVelocity),this._collisionTriggered=!0,this.getScene().collisionCoordinator.getNewPosition(this.position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,
this.uniqueId)):(this.position.copyFrom(this._newPosition),a=this.upVector,this.allowUpsideDown&&0>this.beta&&(a=a.clone(),a=a.negate()),c.Matrix.LookAtLHToRef(this.position,h,a,this._viewMatrix),this._viewMatrix.m[12]+=this.targetScreenOffset.x,this._viewMatrix.m[13]+=this.targetScreenOffset.y);return this._viewMatrix},a.prototype.zoomOn=function(a,d){void 0===d&&(d=!1);a=a||this.getScene().meshes;var j=c.Mesh.MinMax(a),g=c.Vector3.Distance(j.min,j.max);this.radius=g*this.zoomOnFactor;this.focusOn({min:j.min,
max:j.max,distance:g},d)},a.prototype.focusOn=function(a,d){void 0===d&&(d=!1);var j,g;void 0===a.min?(j=a||this.getScene().meshes,j=c.Mesh.MinMax(j),g=c.Vector3.Distance(j.min,j.max)):(j=a,g=a.distance);this.target=c.Mesh.Center(j);d||(this.maxZ=2*g)},a.prototype.createRigCamera=function(b,d){var j;switch(this.cameraRigMode){case c.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case c.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case c.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case c.Camera.RIG_MODE_VR:j=
this._cameraRigParams.stereoHalfAngle*(0===d?1:-1);break;case c.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:j=this._cameraRigParams.stereoHalfAngle*(0===d?-1:1)}j=new a(b,this.alpha+j,this.beta,this.radius,this.target,this.getScene());return j._cameraRigParams={},j},a.prototype._updateRigCameras=function(){var a=this._rigCameras[0],d=this._rigCameras[1];switch(a.beta=d.beta=this.beta,a.radius=d.radius=this.radius,this.cameraRigMode){case c.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case c.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case c.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case c.Camera.RIG_MODE_VR:a.alpha=
this.alpha-this._cameraRigParams.stereoHalfAngle;d.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case c.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:a.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,d.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}e.prototype._updateRigCameras.call(this)},a.prototype.dispose=function(){this.inputs.clear();e.prototype.dispose.call(this)},a.prototype.getTypeName=function(){return"ArcRotateCamera"},__decorate([c.serialize()],a.prototype,
"alpha",void 0),__decorate([c.serialize()],a.prototype,"beta",void 0),__decorate([c.serialize()],a.prototype,"radius",void 0),__decorate([c.serializeAsVector3()],a.prototype,"target",void 0),__decorate([c.serialize()],a.prototype,"inertialAlphaOffset",void 0),__decorate([c.serialize()],a.prototype,"inertialBetaOffset",void 0),__decorate([c.serialize()],a.prototype,"inertialRadiusOffset",void 0),__decorate([c.serialize()],a.prototype,"lowerAlphaLimit",void 0),__decorate([c.serialize()],a.prototype,
"upperAlphaLimit",void 0),__decorate([c.serialize()],a.prototype,"lowerBetaLimit",void 0),__decorate([c.serialize()],a.prototype,"upperBetaLimit",void 0),__decorate([c.serialize()],a.prototype,"lowerRadiusLimit",void 0),__decorate([c.serialize()],a.prototype,"upperRadiusLimit",void 0),__decorate([c.serialize()],a.prototype,"inertialPanningX",void 0),__decorate([c.serialize()],a.prototype,"inertialPanningY",void 0),__decorate([c.serialize()],a.prototype,"zoomOnFactor",void 0),__decorate([c.serialize()],
a.prototype,"allowUpsideDown",void 0),a);c.ArcRotateCamera=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.CameraInputsManager;f=function(a){e.call(this,a)};f=(__extends(f,e),f.prototype.addMouseWheel=function(){return this.add(new c.ArcRotateCameraMouseWheelInput),this},f.prototype.addPointers=function(){return this.add(new c.ArcRotateCameraPointersInput),this},f.prototype.addKeyboard=function(){return this.add(new c.ArcRotateCameraKeyboardMoveInput),this},f.prototype.addGamepad=function(){return this.add(new c.ArcRotateCameraGamepadInput),this},f.prototype.addVRDeviceOrientation=
function(){return this.add(new c.ArcRotateCameraVRDeviceOrientationInput),this},f);c.ArcRotateCameraInputsManager=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a){this._renderingGroups=[];this._scene=a};f=(e.prototype._renderParticles=function(a,b){if(0!==this._scene._activeParticleSystems.length){for(var d=this._scene.activeCamera,j=c.Tools.Now,g=0;g<this._scene._activeParticleSystems.length;g++){var h=this._scene._activeParticleSystems.data[g];h.renderingGroupId===a&&0!==(d.layerMask&h.layerMask)&&(this._clearDepthBuffer(),h.emitter.position&&b&&-1===b.indexOf(h.emitter)||(this._scene._activeParticles+=h.render()))}this._scene._particlesDuration+=
c.Tools.Now-j}},e.prototype._renderSprites=function(a){if(this._scene.spritesEnabled&&0!==this._scene.spriteManagers.length){for(var b=this._scene.activeCamera,d=c.Tools.Now,j=0;j<this._scene.spriteManagers.length;j++){var g=this._scene.spriteManagers[j];g.renderingGroupId===a&&0!==(b.layerMask&g.layerMask)&&(this._clearDepthBuffer(),g.render())}this._scene._spritesDuration+=c.Tools.Now-d}},e.prototype._clearDepthBuffer=function(){this._depthBufferAlreadyCleaned||(this._scene.getEngine().clear(0,
!1,!0),this._depthBufferAlreadyCleaned=!0)},e.prototype._renderSpritesAndParticles=function(){this._currentRenderSprites&&this._renderSprites(this._currentIndex);this._currentRenderParticles&&this._renderParticles(this._currentIndex,this._currentActiveMeshes)},e.prototype.render=function(a,b,d,c){this._currentActiveMeshes=b;this._currentRenderParticles=d;this._currentRenderSprites=c;for(b=0;b<e.MAX_RENDERINGGROUPS;b++)this._depthBufferAlreadyCleaned=0==b,d=this._renderingGroups[b],c=!1,this._currentIndex=
b,d?(this._clearDepthBuffer(),d.onBeforeTransparentRendering||(d.onBeforeTransparentRendering=this._renderSpritesAndParticles.bind(this)),d.render(a)||(this._renderingGroups.splice(b,1),c=!0,this._renderSpritesAndParticles())):this._renderSpritesAndParticles(),c&&b--},e.prototype.reset=function(){this._renderingGroups.forEach(function(a){a&&a.prepare()})},e.prototype.dispatch=function(a){var b=a.getMesh().renderingGroupId||0;this._renderingGroups[b]||(this._renderingGroups[b]=new c.RenderingGroup(b,
this._scene));this._renderingGroups[b].dispatch(a)},e.MAX_RENDERINGGROUPS=4,e);c.RenderingManager=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(e,a){this.index=e;this._opaqueSubMeshes=new c.SmartArray(256);this._transparentSubMeshes=new c.SmartArray(256);this._alphaTestSubMeshes=new c.SmartArray(256);this._scene=a};f=(f.prototype.render=function(e){if(e)return e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes),!0;if(0===this._opaqueSubMeshes.length&&0===this._alphaTestSubMeshes.length&&0===this._transparentSubMeshes.length)return this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),
!1;var a,b=this._scene.getEngine();for(e=0;e<this._opaqueSubMeshes.length;e++)a=this._opaqueSubMeshes.data[e],a.render(!1);b.setAlphaTesting(!0);for(e=0;e<this._alphaTestSubMeshes.length;e++)a=this._alphaTestSubMeshes.data[e],a.render(!1);if(b.setAlphaTesting(!1),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),this._transparentSubMeshes.length){for(e=0;e<this._transparentSubMeshes.length;e++)a=this._transparentSubMeshes.data[e],a._alphaIndex=a.getMesh().alphaIndex,a._distanceToCamera=
a.getBoundingInfo().boundingSphere.centerWorld.subtract(this._scene.activeCamera.globalPosition).length();var d=this._transparentSubMeshes.data.slice(0,this._transparentSubMeshes.length);d.sort(function(a,b){return a._alphaIndex>b._alphaIndex?1:a._alphaIndex<b._alphaIndex?-1:a._distanceToCamera<b._distanceToCamera?1:a._distanceToCamera>b._distanceToCamera?-1:0});for(e=0;e<d.length;e++)a=d[e],a.render(!0);b.setAlphaMode(c.Engine.ALPHA_DISABLE)}return!0},f.prototype.prepare=function(){this._opaqueSubMeshes.reset();
this._transparentSubMeshes.reset();this._alphaTestSubMeshes.reset()},f.prototype.dispatch=function(c){var a=c.getMaterial(),b=c.getMesh();a.needAlphaBlending()||1>b.visibility||b.hasVertexAlpha?this._transparentSubMeshes.push(c):a.needAlphaTesting()?this._alphaTestSubMeshes.push(c):this._opaqueSubMeshes.push(c)},f);c.RenderingGroup=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(){};f=(Object.defineProperty(e,"POINTERDOWN",{get:function(){return e._POINTERDOWN},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERUP",{get:function(){return e._POINTERUP},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERMOVE",{get:function(){return e._POINTERMOVE},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERWHEEL",{get:function(){return e._POINTERWHEEL},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERPICK",
{get:function(){return e._POINTERPICK},enumerable:!0,configurable:!0}),e._POINTERDOWN=1,e._POINTERUP=2,e._POINTERMOVE=4,e._POINTERWHEEL=8,e._POINTERPICK=16,e);c.PointerEventTypes=f;var a;a=function(a,b){this.type=a;this.event=b};c.PointerInfoBase=a;var b,d=function(b,d,g,j){a.call(this,b,d);this.skipOnPointerObservable=!1;this.localPosition=new c.Vector2(g,j)};b=(__extends(d,a),d);c.PointerInfoPre=b;var j,d=function(b,d,c){a.call(this,b,d);this.pickInfo=c};j=(__extends(d,a),d);c.PointerInfo=j;var g=
function(a){this.autoClear=!0;this.clearColor=new c.Color3(0.2,0.2,0.3);this.ambientColor=new c.Color3(0,0,0);this.forceShowBoundingBoxes=this.forcePointsCloud=this.forceWireframe=!1;this.animationsEnabled=!0;this.constantlyUpdateMeshUnderPointer=!1;this.onDisposeObservable=new c.Observable;this.onBeforeRenderObservable=new c.Observable;this.onAfterRenderObservable=new c.Observable;this.onReadyObservable=new c.Observable;this.onBeforeCameraRenderObservable=new c.Observable;this.onAfterCameraRenderObservable=
new c.Observable;this.onNewCameraAddedObservable=new c.Observable;this.onCameraRemovedObservable=new c.Observable;this.onNewLightAddedObservable=new c.Observable;this.onLightRemovedObservable=new c.Observable;this.onNewGeometryAddedObservable=new c.Observable;this.onGeometryRemovedObservable=new c.Observable;this.onNewMeshAddedObservable=new c.Observable;this.onMeshRemovedObservable=new c.Observable;this.animations=[];this.onPrePointerObservable=new c.Observable;this.onPointerObservable=new c.Observable;
this.cameraToUseForPointers=null;this._startingPointerPosition=new c.Vector2(0,0);this._startingPointerTime=0;this.fogEnabled=!0;this.fogMode=g.FOGMODE_NONE;this.fogColor=new c.Color3(0.2,0.2,0.3);this.fogDensity=0.1;this.fogStart=0;this.fogEnd=1E3;this.lightsEnabled=this.shadowsEnabled=!0;this.lights=[];this.cameras=[];this.activeCameras=[];this.meshes=[];this._geometries=[];this.materials=[];this.multiMaterials=[];this.defaultMaterial=new c.StandardMaterial("default material",this);this.texturesEnabled=
!0;this.textures=[];this.particlesEnabled=!0;this.particleSystems=[];this.spritesEnabled=!0;this.spriteManagers=[];this.layers=[];this.skeletonsEnabled=!0;this.skeletons=[];this.lensFlaresEnabled=!0;this.lensFlareSystems=[];this.collisionsEnabled=!0;this.gravity=new c.Vector3(0,-9.807,0);this.renderTargetsEnabled=this.postProcessesEnabled=!0;this.dumpNextRenderTargets=!1;this.customRenderTargets=[];this.importedMeshesFiles=[];this.probesEnabled=!0;this.reflectionProbes=[];this._actionManagers=[];
this._meshesForIntersections=new c.SmartArray(256);this.proceduralTexturesEnabled=!0;this._proceduralTextures=[];this.soundTracks=[];this._audioEnabled=!0;this._headphone=!1;this._renderId=this._animationRatio=this._spritesDuration=this._renderDuration=this._particlesDuration=this._renderTargetsDuration=this._evaluateActiveMeshesDuration=this._lastFrameDuration=this._activeParticles=this._activeIndices=this._totalVertices=0;this._executeWhenReadyTimeoutId=-1;this._intermediateRendering=!1;this._toBeDisposed=
new c.SmartArray(256);this._pendingData=[];this._activeMeshes=new c.SmartArray(256);this._processedMaterials=new c.SmartArray(256);this._renderTargets=new c.SmartArray(256);this._activeParticleSystems=new c.SmartArray(256);this._activeSkeletons=new c.SmartArray(32);this._softwareSkinnedMeshes=new c.SmartArray(32);this._activeBones=0;this._activeAnimatables=[];this._transformMatrix=c.Matrix.Zero();this._edgesRenderers=new c.SmartArray(16);this._uniqueIdCounter=0;this._engine=a;a.scenes.push(this);
this._renderingManager=new c.RenderingManager(this);this.postProcessManager=new c.PostProcessManager(this);this.postProcessRenderPipelineManager=new c.PostProcessRenderPipelineManager;this._boundingBoxRenderer=new c.BoundingBoxRenderer(this);c.OutlineRenderer&&(this._outlineRenderer=new c.OutlineRenderer(this));this.attachControl();c.SoundTrack&&(this.mainSoundTrack=new c.SoundTrack(this,{mainTrack:!0}));c.SimplificationQueue&&(this.simplificationQueue=new c.SimplificationQueue);this.workerCollisions=
!1},d=(Object.defineProperty(g,"FOGMODE_NONE",{get:function(){return g._FOGMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(g,"FOGMODE_EXP",{get:function(){return g._FOGMODE_EXP},enumerable:!0,configurable:!0}),Object.defineProperty(g,"FOGMODE_EXP2",{get:function(){return g._FOGMODE_EXP2},enumerable:!0,configurable:!0}),Object.defineProperty(g,"FOGMODE_LINEAR",{get:function(){return g._FOGMODE_LINEAR},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"onDispose",{set:function(a){this._onDisposeObserver&&
this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"beforeRender",{set:function(a){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver);this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"afterRender",{set:function(a){this._onAfterRenderObserver&&
this.onAfterRenderObservable.remove(this._onAfterRenderObserver);this._onAfterRenderObserver=this.onAfterRenderObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"beforeCameraRender",{set:function(a){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver);this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"afterCameraRender",
{set:function(a){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver);this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"unTranslatedPointer",{get:function(){return new c.Vector2(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"debugLayer",{get:function(){return this._debugLayer||
(this._debugLayer=new c.DebugLayer(this)),this._debugLayer},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"workerCollisions",{get:function(){return this._workerCollisions},set:function(a){this._workerCollisions=a=a&&!!Worker;this.collisionCoordinator&&this.collisionCoordinator.destroy();this.collisionCoordinator=a?new c.CollisionCoordinatorWorker:new c.CollisionCoordinatorLegacy;this.collisionCoordinator.init(this)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,
"SelectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"pointerX",{get:function(){return this._pointerX},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"pointerY",{get:function(){return this._pointerY},enumerable:!0,configurable:!0}),g.prototype.getCachedMaterial=function(){return this._cachedMaterial},
g.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer},g.prototype.getOutlineRenderer=function(){return this._outlineRenderer},g.prototype.getEngine=function(){return this._engine},g.prototype.getTotalVertices=function(){return this._totalVertices},g.prototype.getActiveIndices=function(){return this._activeIndices},g.prototype.getActiveParticles=function(){return this._activeParticles},g.prototype.getActiveBones=function(){return this._activeBones},g.prototype.getLastFrameDuration=
function(){return this._lastFrameDuration},g.prototype.getEvaluateActiveMeshesDuration=function(){return this._evaluateActiveMeshesDuration},g.prototype.getActiveMeshes=function(){return this._activeMeshes},g.prototype.getRenderTargetsDuration=function(){return this._renderTargetsDuration},g.prototype.getRenderDuration=function(){return this._renderDuration},g.prototype.getParticlesDuration=function(){return this._particlesDuration},g.prototype.getSpritesDuration=function(){return this._spritesDuration},
g.prototype.getAnimationRatio=function(){return this._animationRatio},g.prototype.getRenderId=function(){return this._renderId},g.prototype.incrementRenderId=function(){this._renderId++},g.prototype._updatePointerPosition=function(a){var b=this._engine.getRenderingCanvasClientRect();this._pointerX=a.clientX-b.left;this._pointerY=a.clientY-b.top;this._unTranslatedPointerX=this._pointerX;this._unTranslatedPointerY=this._pointerY;this.cameraToUseForPointers&&(this._pointerX-=this.cameraToUseForPointers.viewport.x*
this._engine.getRenderWidth(),this._pointerY-=this.cameraToUseForPointers.viewport.y*this._engine.getRenderHeight())},g.prototype.attachControl=function(a,d,g){var e=this;void 0===a&&(a=!0);void 0===d&&(d=!0);void 0===g&&(g=!0);var n=function(a){return a.isPickable&&a.actionManager&&a.actionManager.hasPointerTriggers};this._onPointerMove=function(a){if(e._updatePointerPosition(a),e.onPrePointerObservable.hasObservers()){var d="mousewheel"===a.type||"DOMMouseScroll"===a.type?f.POINTERWHEEL:f.POINTERMOVE,
c=new b(d,a,e._unTranslatedPointerX,e._unTranslatedPointerY);if(e.onPrePointerObservable.notifyObservers(c,d),c.skipOnPointerObservable)return}if(e.cameraToUseForPointers||e.activeCamera)if(d=e._engine.getRenderingCanvas(),e.pointerMovePredicate||(e.pointerMovePredicate=function(a){return a.isPickable&&a.isVisible&&a.isReady()&&(e.constantlyUpdateMeshUnderPointer||null!==a.actionManager&&void 0!==a.actionManager)}),c=e.pick(e._unTranslatedPointerX,e._unTranslatedPointerY,e.pointerMovePredicate,!1,
e.cameraToUseForPointers),c.hit&&c.pickedMesh?(e.setPointerOverSprite(null),e.setPointerOverMesh(c.pickedMesh),e._pointerOverMesh.actionManager&&e._pointerOverMesh.actionManager.hasPointerTriggers?d.style.cursor="pointer":d.style.cursor=""):(e.setPointerOverMesh(null),c=e.pickSprite(e._unTranslatedPointerX,e._unTranslatedPointerY,n,!1,e.cameraToUseForPointers),c.hit&&c.pickedSprite?(d.style.cursor="pointer",e.setPointerOverSprite(c.pickedSprite)):(e.setPointerOverSprite(null),d.style.cursor="")),
e.onPointerMove&&e.onPointerMove(a,c),e.onPointerObservable.hasObservers())d="mousewheel"===a.type||"DOMMouseScroll"===a.type?f.POINTERWHEEL:f.POINTERMOVE,c=new j(d,a,c),e.onPointerObservable.notifyObservers(c,d)};this._onPointerDown=function(a){if(e._updatePointerPosition(a),e.onPrePointerObservable.hasObservers()){var d=f.POINTERDOWN,h=new b(d,a,e._unTranslatedPointerX,e._unTranslatedPointerY);if(e.onPrePointerObservable.notifyObservers(h,d),h.skipOnPointerObservable)return}if(e.cameraToUseForPointers||
e.activeCamera){e._startingPointerPosition.x=e._pointerX;e._startingPointerPosition.y=e._pointerY;e._startingPointerTime=(new Date).getTime();e.pointerDownPredicate||(e.pointerDownPredicate=function(a){return a.isPickable&&a.isVisible&&a.isReady()&&(!a.actionManager||a.actionManager.hasPointerTriggers)});e._pickedDownMesh=null;var g=e.pick(e._unTranslatedPointerX,e._unTranslatedPointerY,e.pointerDownPredicate,!1,e.cameraToUseForPointers);if(g.hit&&g.pickedMesh&&g.pickedMesh.actionManager){if(e._pickedDownMesh=
g.pickedMesh,g.pickedMesh.actionManager.hasPickTriggers){switch(a.button){case 0:g.pickedMesh.actionManager.processTrigger(c.ActionManager.OnLeftPickTrigger,c.ActionEvent.CreateNew(g.pickedMesh,a));break;case 1:g.pickedMesh.actionManager.processTrigger(c.ActionManager.OnCenterPickTrigger,c.ActionEvent.CreateNew(g.pickedMesh,a));break;case 2:g.pickedMesh.actionManager.processTrigger(c.ActionManager.OnRightPickTrigger,c.ActionEvent.CreateNew(g.pickedMesh,a))}g.pickedMesh.actionManager.processTrigger(c.ActionManager.OnPickDownTrigger,
c.ActionEvent.CreateNew(g.pickedMesh,a))}g.pickedMesh.actionManager.hasSpecificTrigger(c.ActionManager.OnLongPressTrigger)&&window.setTimeout(function(){var b=e.pick(e._unTranslatedPointerX,e._unTranslatedPointerY,function(a){return a.isPickable&&a.isVisible&&a.isReady()&&a.actionManager&&a.actionManager.hasSpecificTrigger(c.ActionManager.OnLongPressTrigger)},!1,e.cameraToUseForPointers);b.hit&&b.pickedMesh&&b.pickedMesh.actionManager&&0!==e._startingPointerTime&&(new Date).getTime()-e._startingPointerTime>
c.ActionManager.LongPressDelay&&Math.abs(e._startingPointerPosition.x-e._pointerX)<c.ActionManager.DragMovementThreshold&&Math.abs(e._startingPointerPosition.y-e._pointerY)<c.ActionManager.DragMovementThreshold&&(e._startingPointerTime=0,b.pickedMesh.actionManager.processTrigger(c.ActionManager.OnLongPressTrigger,c.ActionEvent.CreateNew(b.pickedMesh,a)))},c.ActionManager.LongPressDelay)}if(e.onPointerDown&&e.onPointerDown(a,g),e.onPointerObservable.hasObservers())d=f.POINTERDOWN,h=new j(d,a,g),e.onPointerObservable.notifyObservers(h,
d);if(e._pickedDownSprite=null,0<e.spriteManagers.length&&(g=e.pickSprite(e._unTranslatedPointerX,e._unTranslatedPointerY,n,!1,e.cameraToUseForPointers),g.hit&&g.pickedSprite&&g.pickedSprite.actionManager)){switch(e._pickedDownSprite=g.pickedSprite,a.button){case 0:g.pickedSprite.actionManager.processTrigger(c.ActionManager.OnLeftPickTrigger,c.ActionEvent.CreateNewFromSprite(g.pickedSprite,e,a));break;case 1:g.pickedSprite.actionManager.processTrigger(c.ActionManager.OnCenterPickTrigger,c.ActionEvent.CreateNewFromSprite(g.pickedSprite,
e,a));break;case 2:g.pickedSprite.actionManager.processTrigger(c.ActionManager.OnRightPickTrigger,c.ActionEvent.CreateNewFromSprite(g.pickedSprite,e,a))}g.pickedSprite.actionManager.processTrigger(c.ActionManager.OnPickDownTrigger,c.ActionEvent.CreateNewFromSprite(g.pickedSprite,e,a))}}};this._onPointerUp=function(a){if(e._updatePointerPosition(a),e.onPrePointerObservable.hasObservers()){var d=f.POINTERUP,h=new b(d,a,e._unTranslatedPointerX,e._unTranslatedPointerY);if(e.onPrePointerObservable.notifyObservers(h,
d),h.skipOnPointerObservable)return}if(e.cameraToUseForPointers||e.activeCamera){e.pointerUpPredicate||(e.pointerUpPredicate=function(a){return a.isPickable&&a.isVisible&&a.isReady()&&(!a.actionManager||a.actionManager.hasPickTriggers||a.actionManager.hasSpecificTrigger(c.ActionManager.OnLongPressTrigger))});var g=e.pick(e._unTranslatedPointerX,e._unTranslatedPointerY,e.pointerUpPredicate,!1,e.cameraToUseForPointers);if(g.hit&&g.pickedMesh){if(null!=e._pickedDownMesh&&g.pickedMesh==e._pickedDownMesh&&
(e.onPointerPick&&e.onPointerPick(a,g),e.onPointerObservable.hasObservers()))d=f.POINTERPICK,h=new j(d,a,g),e.onPointerObservable.notifyObservers(h,d);g.pickedMesh.actionManager&&(g.pickedMesh.actionManager.processTrigger(c.ActionManager.OnPickUpTrigger,c.ActionEvent.CreateNew(g.pickedMesh,a)),Math.abs(e._startingPointerPosition.x-e._pointerX)<c.ActionManager.DragMovementThreshold&&Math.abs(e._startingPointerPosition.y-e._pointerY)<c.ActionManager.DragMovementThreshold&&g.pickedMesh.actionManager.processTrigger(c.ActionManager.OnPickTrigger,
c.ActionEvent.CreateNew(g.pickedMesh,a)))}if(e._pickedDownMesh&&e._pickedDownMesh!==g.pickedMesh&&e._pickedDownMesh.actionManager.processTrigger(c.ActionManager.OnPickOutTrigger,c.ActionEvent.CreateNew(e._pickedDownMesh,a)),e.onPointerUp&&e.onPointerUp(a,g),e.onPointerObservable.hasObservers())d=f.POINTERUP,h=new j(d,a,g),e.onPointerObservable.notifyObservers(h,d);e._startingPointerTime=0;0<e.spriteManagers.length&&(g=e.pickSprite(e._unTranslatedPointerX,e._unTranslatedPointerY,n,!1,e.cameraToUseForPointers),
g.hit&&g.pickedSprite&&g.pickedSprite.actionManager&&(g.pickedSprite.actionManager.processTrigger(c.ActionManager.OnPickUpTrigger,c.ActionEvent.CreateNewFromSprite(g.pickedSprite,e,a)),Math.abs(e._startingPointerPosition.x-e._pointerX)<c.ActionManager.DragMovementThreshold&&Math.abs(e._startingPointerPosition.y-e._pointerY)<c.ActionManager.DragMovementThreshold&&g.pickedSprite.actionManager.processTrigger(c.ActionManager.OnPickTrigger,c.ActionEvent.CreateNewFromSprite(g.pickedSprite,e,a))),e._pickedDownSprite&&
e._pickedDownSprite!==g.pickedSprite&&e._pickedDownSprite.actionManager.processTrigger(c.ActionManager.OnPickOutTrigger,c.ActionEvent.CreateNewFromSprite(e._pickedDownSprite,e,a)))}};this._onKeyDown=function(a){e.actionManager&&e.actionManager.processTrigger(c.ActionManager.OnKeyDownTrigger,c.ActionEvent.CreateNewFromScene(e,a))};this._onKeyUp=function(a){e.actionManager&&e.actionManager.processTrigger(c.ActionManager.OnKeyUpTrigger,c.ActionEvent.CreateNewFromScene(e,a))};var q=c.Tools.GetPointerPrefix();
g&&(this._engine.getRenderingCanvas().addEventListener(q+"move",this._onPointerMove,!1),this._engine.getRenderingCanvas().addEventListener("mousewheel",this._onPointerMove,!1),this._engine.getRenderingCanvas().addEventListener("DOMMouseScroll",this._onPointerMove,!1));d&&this._engine.getRenderingCanvas().addEventListener(q+"down",this._onPointerDown,!1);a&&this._engine.getRenderingCanvas().addEventListener(q+"up",this._onPointerUp,!1);c.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},
{name:"keyup",handler:this._onKeyUp}])},g.prototype.detachControl=function(){var a=c.Tools.GetPointerPrefix();this._engine.getRenderingCanvas().removeEventListener(a+"move",this._onPointerMove);this._engine.getRenderingCanvas().removeEventListener(a+"down",this._onPointerDown);this._engine.getRenderingCanvas().removeEventListener(a+"up",this._onPointerUp);this._engine.getRenderingCanvas().removeEventListener("mousewheel",this._onPointerMove);this._engine.getRenderingCanvas().removeEventListener("DOMMouseScroll",
this._onPointerMove);c.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp}])},g.prototype.isReady=function(){if(0<this._pendingData.length)return!1;var a;for(a=0;a<this._geometries.length;a++)if(this._geometries[a].delayLoadState===c.Engine.DELAYLOADSTATE_LOADING)return!1;for(a=0;a<this.meshes.length;a++){var b=this.meshes[a];if(!b.isReady())return!1;var d=b.material;if(d&&!d.isReady(b))return!1}return!0},g.prototype.resetCachedMaterial=function(){this._cachedMaterial=
null},g.prototype.registerBeforeRender=function(a){this.onBeforeRenderObservable.add(a)},g.prototype.unregisterBeforeRender=function(a){this.onBeforeRenderObservable.removeCallback(a)},g.prototype.registerAfterRender=function(a){this.onAfterRenderObservable.add(a)},g.prototype.unregisterAfterRender=function(a){this.onAfterRenderObservable.removeCallback(a)},g.prototype._addPendingData=function(a){this._pendingData.push(a)},g.prototype._removePendingData=function(a){a=this._pendingData.indexOf(a);
-1!==a&&this._pendingData.splice(a,1)},g.prototype.getWaitingItemsCount=function(){return this._pendingData.length},g.prototype.executeWhenReady=function(a){var b=this;this.onReadyObservable.add(a);-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){b._checkIsReady()},150))},g.prototype._checkIsReady=function(){var a=this;return this.isReady()?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=
-1)):void(this._executeWhenReadyTimeoutId=setTimeout(function(){a._checkIsReady()},150))},g.prototype.beginAnimation=function(a,b,d,g,e,j,f){if(void 0===e&&(e=1),this.stopAnimation(a),f||(f=new c.Animatable(this,a,b,d,g,e,j)),a.animations&&f.appendAnimations(a,a.animations),a.getAnimatables){a=a.getAnimatables();for(var r=0;r<a.length;r++)this.beginAnimation(a[r],b,d,g,e,j,f)}return f.reset(),f},g.prototype.beginDirectAnimation=function(a,b,d,g,e,j,f){void 0===j&&(j=1);return new c.Animatable(this,
a,d,g,e,j,f,b)},g.prototype.getAnimatableByTarget=function(a){for(var b=0;b<this._activeAnimatables.length;b++)if(this._activeAnimatables[b].target===a)return this._activeAnimatables[b];return null},Object.defineProperty(g.prototype,"Animatables",{get:function(){return this._activeAnimatables},enumerable:!0,configurable:!0}),g.prototype.stopAnimation=function(a){(a=this.getAnimatableByTarget(a))&&a.stop()},g.prototype._animate=function(){if(this.animationsEnabled&&0!==this._activeAnimatables.length){if(!this._animationStartDate){if(0<
this._pendingData.length)return;this._animationStartDate=c.Tools.Now}for(var a=c.Tools.Now-this._animationStartDate,b=0;b<this._activeAnimatables.length;b++)this._activeAnimatables[b]._animate(a)}},g.prototype.getViewMatrix=function(){return this._viewMatrix},g.prototype.getProjectionMatrix=function(){return this._projectionMatrix},g.prototype.getTransformMatrix=function(){return this._transformMatrix},g.prototype.setTransformMatrix=function(a,b){this._viewMatrix=a;this._projectionMatrix=b;this._viewMatrix.multiplyToRef(this._projectionMatrix,
this._transformMatrix)},g.prototype.addMesh=function(a){a.uniqueId=this._uniqueIdCounter++;this.meshes.push(a);this.collisionCoordinator.onMeshAdded(a);this.onNewMeshAddedObservable.notifyObservers(a)},g.prototype.removeMesh=function(a){var b=this.meshes.indexOf(a);return-1!==b&&this.meshes.splice(b,1),this.collisionCoordinator.onMeshRemoved(a),this.onMeshRemovedObservable.notifyObservers(a),b},g.prototype.removeSkeleton=function(a){a=this.skeletons.indexOf(a);return-1!==a&&this.skeletons.splice(a,
1),a},g.prototype.removeLight=function(a){var b=this.lights.indexOf(a);return-1!==b&&this.lights.splice(b,1),this.onLightRemovedObservable.notifyObservers(a),b},g.prototype.removeCamera=function(a){var b=this.cameras.indexOf(a);-1!==b&&this.cameras.splice(b,1);var d=this.activeCameras.indexOf(a);return-1!==d&&this.activeCameras.splice(d,1),this.activeCamera===a&&(0<this.cameras.length?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(a),b},g.prototype.addLight=
function(a){a.uniqueId=this._uniqueIdCounter++;this.lights.push(a);this.onNewLightAddedObservable.notifyObservers(a)},g.prototype.addCamera=function(a){a.uniqueId=this._uniqueIdCounter++;this.cameras.push(a);this.onNewCameraAddedObservable.notifyObservers(a)},g.prototype.swithActiveCamera=function(a,b){void 0===b&&(b=!0);var d=this._engine.getRenderingCanvas();this.activeCamera.detachControl(d);this.activeCamera=a;b&&a.attachControl(d)},g.prototype.setActiveCameraByID=function(a){return(a=this.getCameraByID(a))?
(this.activeCamera=a,a):null},g.prototype.setActiveCameraByName=function(a){return(a=this.getCameraByName(a))?(this.activeCamera=a,a):null},g.prototype.getMaterialByID=function(a){for(var b=0;b<this.materials.length;b++)if(this.materials[b].id===a)return this.materials[b];return null},g.prototype.getMaterialByName=function(a){for(var b=0;b<this.materials.length;b++)if(this.materials[b].name===a)return this.materials[b];return null},g.prototype.getLensFlareSystemByName=function(a){for(var b=0;b<this.lensFlareSystems.length;b++)if(this.lensFlareSystems[b].name===
a)return this.lensFlareSystems[b];return null},g.prototype.getLensFlareSystemByID=function(a){for(var b=0;b<this.lensFlareSystems.length;b++)if(this.lensFlareSystems[b].id===a)return this.lensFlareSystems[b];return null},g.prototype.getCameraByID=function(a){for(var b=0;b<this.cameras.length;b++)if(this.cameras[b].id===a)return this.cameras[b];return null},g.prototype.getCameraByUniqueID=function(a){for(var b=0;b<this.cameras.length;b++)if(this.cameras[b].uniqueId===a)return this.cameras[b];return null},
g.prototype.getCameraByName=function(a){for(var b=0;b<this.cameras.length;b++)if(this.cameras[b].name===a)return this.cameras[b];return null},g.prototype.getBoneByID=function(a){for(var b=0;b<this.skeletons.length;b++)for(var d=this.skeletons[b],c=0;c<d.bones.length;c++)if(d.bones[c].id===a)return d.bones[c];return null},g.prototype.getBoneByName=function(a){for(var b=0;b<this.skeletons.length;b++)for(var d=this.skeletons[b],c=0;c<d.bones.length;c++)if(d.bones[c].name===a)return d.bones[c];return null},
g.prototype.getLightByName=function(a){for(var b=0;b<this.lights.length;b++)if(this.lights[b].name===a)return this.lights[b];return null},g.prototype.getLightByID=function(a){for(var b=0;b<this.lights.length;b++)if(this.lights[b].id===a)return this.lights[b];return null},g.prototype.getLightByUniqueID=function(a){for(var b=0;b<this.lights.length;b++)if(this.lights[b].uniqueId===a)return this.lights[b];return null},g.prototype.getParticleSystemByID=function(a){for(var b=0;b<this.particleSystems.length;b++)if(this.particleSystems[b].id===
a)return this.particleSystems[b];return null},g.prototype.getGeometryByID=function(a){for(var b=0;b<this._geometries.length;b++)if(this._geometries[b].id===a)return this._geometries[b];return null},g.prototype.pushGeometry=function(a,b){return!b&&this.getGeometryByID(a.id)?!1:(this._geometries.push(a),this.collisionCoordinator.onGeometryAdded(a),this.onNewGeometryAddedObservable.notifyObservers(a),!0)},g.prototype.removeGeometry=function(a){var b=this._geometries.indexOf(a);return-1<b?(this._geometries.splice(b,
1),this.collisionCoordinator.onGeometryDeleted(a),this.onGeometryRemovedObservable.notifyObservers(a),!0):!1},g.prototype.getGeometries=function(){return this._geometries},g.prototype.getMeshByID=function(a){for(var b=0;b<this.meshes.length;b++)if(this.meshes[b].id===a)return this.meshes[b];return null},g.prototype.getMeshesByID=function(a){return this.meshes.filter(function(b){return b.id===a})},g.prototype.getMeshByUniqueID=function(a){for(var b=0;b<this.meshes.length;b++)if(this.meshes[b].uniqueId===
a)return this.meshes[b];return null},g.prototype.getLastMeshByID=function(a){for(var b=this.meshes.length-1;0<=b;b--)if(this.meshes[b].id===a)return this.meshes[b];return null},g.prototype.getLastEntryByID=function(a){var b;for(b=this.meshes.length-1;0<=b;b--)if(this.meshes[b].id===a)return this.meshes[b];for(b=this.cameras.length-1;0<=b;b--)if(this.cameras[b].id===a)return this.cameras[b];for(b=this.lights.length-1;0<=b;b--)if(this.lights[b].id===a)return this.lights[b];return null},g.prototype.getNodeByID=
function(a){var b=this.getMeshByID(a);return b||(b=this.getLightByID(a))?b:(b=this.getCameraByID(a))?b:this.getBoneByID(a)},g.prototype.getNodeByName=function(a){var b=this.getMeshByName(a);return b||(b=this.getLightByName(a))?b:(b=this.getCameraByName(a))?b:this.getBoneByName(a)},g.prototype.getMeshByName=function(a){for(var b=0;b<this.meshes.length;b++)if(this.meshes[b].name===a)return this.meshes[b];return null},g.prototype.getSoundByName=function(a){var b;if(c.AudioEngine){for(b=0;b<this.mainSoundTrack.soundCollection.length;b++)if(this.mainSoundTrack.soundCollection[b].name===
a)return this.mainSoundTrack.soundCollection[b];for(var d=0;d<this.soundTracks.length;d++)for(b=0;b<this.soundTracks[d].soundCollection.length;b++)if(this.soundTracks[d].soundCollection[b].name===a)return this.soundTracks[d].soundCollection[b]}return null},g.prototype.getLastSkeletonByID=function(a){for(var b=this.skeletons.length-1;0<=b;b--)if(this.skeletons[b].id===a)return this.skeletons[b];return null},g.prototype.getSkeletonById=function(a){for(var b=0;b<this.skeletons.length;b++)if(this.skeletons[b].id===
a)return this.skeletons[b];return null},g.prototype.getSkeletonByName=function(a){for(var b=0;b<this.skeletons.length;b++)if(this.skeletons[b].name===a)return this.skeletons[b];return null},g.prototype.isActiveMesh=function(a){return-1!==this._activeMeshes.indexOf(a)},g.prototype._evaluateSubMesh=function(a,b){if(b.alwaysSelectAsActiveMesh||1===b.subMeshes.length||a.isInFrustum(this._frustumPlanes)){var d=a.getMaterial();b.showSubMeshesBoundingBox&&this._boundingBoxRenderer.renderList.push(a.getBoundingInfo().boundingBox);
d&&(d.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(d)&&(this._processedMaterials.push(d),this._renderTargets.concatWithNoDuplicate(d.getRenderTargetTextures())),this._activeIndices+=a.indexCount,this._renderingManager.dispatch(a))}},g.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},g.prototype._evaluateActiveMeshes=function(){this.activeCamera._activeMeshes.reset();this._activeMeshes.reset();this._renderingManager.reset();this._processedMaterials.reset();
this._activeParticleSystems.reset();this._activeSkeletons.reset();this._softwareSkinnedMeshes.reset();this._boundingBoxRenderer.reset();this._edgesRenderers.reset();this._frustumPlanes?c.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=c.Frustum.GetPlanes(this._transformMatrix);var a,b;this._selectionOctree?(b=this._selectionOctree.select(this._frustumPlanes),a=b.data,b=b.length):(b=this.meshes.length,a=this.meshes);for(var d=0;b>d;d++){var g=a[d];if(!g.isBlocked&&
(this._totalVertices+=g.getTotalVertices(),g.isReady()&&g.isEnabled())){g.computeWorldMatrix();g.actionManager&&g.actionManager.hasSpecificTriggers([c.ActionManager.OnIntersectionEnterTrigger,c.ActionManager.OnIntersectionExitTrigger])&&this._meshesForIntersections.pushNoDuplicate(g);var e=g.getLOD(this.activeCamera);e&&(g._preActivate(),(g.alwaysSelectAsActiveMesh||g.isVisible&&0<g.visibility&&0!==(g.layerMask&this.activeCamera.layerMask)&&g.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(g),
this.activeCamera._activeMeshes.push(g),g._activate(this._renderId),this._activeMesh(e)))}}a=c.Tools.Now;if(this.particlesEnabled){c.Tools.StartPerformanceCounter("Particles",0<this.particleSystems.length);for(b=0;b<this.particleSystems.length;b++)d=this.particleSystems[b],d.isStarted()&&(!d.emitter.position||d.emitter&&d.emitter.isEnabled())&&(this._activeParticleSystems.push(d),d.animate());c.Tools.EndPerformanceCounter("Particles",0<this.particleSystems.length)}this._particlesDuration+=c.Tools.Now-
a},g.prototype._activeMesh=function(a){if(a.skeleton&&this.skeletonsEnabled&&(this._activeSkeletons.pushNoDuplicate(a.skeleton)&&a.skeleton.prepare(),a.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(a)),(a.showBoundingBox||this.forceShowBoundingBoxes)&&this._boundingBoxRenderer.renderList.push(a.getBoundingInfo().boundingBox),a._edgesRenderer&&this._edgesRenderers.push(a._edgesRenderer),a&&a.subMeshes){var b,d;a._submeshesOctree&&a.useOctreeForRenderingSelection?(d=a._submeshesOctree.select(this._frustumPlanes),
b=d.length,d=d.data):(d=a.subMeshes,b=d.length);for(var c=0;b>c;c++)this._evaluateSubMesh(d[c],a)}},g.prototype.updateTransformMatrix=function(a){this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(a))},g.prototype._renderForCamera=function(a){var b=this._engine;if(this.activeCamera=a,!this.activeCamera)throw Error("Active camera not set");c.Tools.StartPerformanceCounter("Rendering camera "+this.activeCamera.name);b.setViewport(this.activeCamera.viewport);
this.resetCachedMaterial();this._renderId++;this.updateTransformMatrix();this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera);var d=c.Tools.Now;c.Tools.StartPerformanceCounter("Active meshes evaluation");this._evaluateActiveMeshes();this._evaluateActiveMeshesDuration+=c.Tools.Now-d;c.Tools.EndPerformanceCounter("Active meshes evaluation");for(d=0;d<this._softwareSkinnedMeshes.length;d++){var g=this._softwareSkinnedMeshes.data[d];g.applySkeleton(g.skeleton)}d=c.Tools.Now;if(this.renderTargetsEnabled&&
0<this._renderTargets.length){this._intermediateRendering=!0;c.Tools.StartPerformanceCounter("Render targets",0<this._renderTargets.length);for(g=0;g<this._renderTargets.length;g++){var e=this._renderTargets.data[g];e._shouldRender()&&(this._renderId++,e.render(e.activeCamera&&e.activeCamera!==this.activeCamera,this.dumpNextRenderTargets))}c.Tools.EndPerformanceCounter("Render targets",0<this._renderTargets.length);this._intermediateRendering=!1;this._renderId++;b.restoreDefaultFramebuffer()}this._renderTargetsDuration+=
c.Tools.Now-d;this.postProcessManager._prepareFrame();d=c.Tools.Now;if(this.layers.length){b.setDepthBuffer(!1);for(g=0;g<this.layers.length;g++)e=this.layers[g],e.isBackground&&e.render();b.setDepthBuffer(!0)}c.Tools.StartPerformanceCounter("Main render");this._renderingManager.render(null,null,!0,!0);c.Tools.EndPerformanceCounter("Main render");this._boundingBoxRenderer.render();for(g=0;g<this._edgesRenderers.length;g++)this._edgesRenderers.data[g].render();if(this.lensFlaresEnabled){c.Tools.StartPerformanceCounter("Lens flares",
0<this.lensFlareSystems.length);for(g=0;g<this.lensFlareSystems.length;g++)e=this.lensFlareSystems[g],0!==(a.layerMask&e.layerMask)&&e.render();c.Tools.EndPerformanceCounter("Lens flares",0<this.lensFlareSystems.length)}if(this.layers.length){b.setDepthBuffer(!1);for(g=0;g<this.layers.length;g++)e=this.layers[g],e.isBackground||e.render();b.setDepthBuffer(!0)}this._renderDuration+=c.Tools.Now-d;this.postProcessManager._finalizeFrame(a.isIntermediate);this.activeCamera._updateFromScene();this._renderTargets.reset();
this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera);c.Tools.EndPerformanceCounter("Rendering camera "+this.activeCamera.name)},g.prototype._processSubCameras=function(a){if(a.cameraRigMode===c.Camera.RIG_MODE_NONE)return void this._renderForCamera(a);for(var b=0;b<a._rigCameras.length;b++)this._renderForCamera(a._rigCameras[b]);this.activeCamera=a;this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix());this.activeCamera._updateFromScene()},
g.prototype._checkIntersections=function(){for(var a=0;a<this._meshesForIntersections.length;a++)for(var b=this._meshesForIntersections.data[a],d=0;d<b.actionManager.actions.length;d++){var g=b.actionManager.actions[d];if(g.trigger===c.ActionManager.OnIntersectionEnterTrigger||g.trigger===c.ActionManager.OnIntersectionExitTrigger){var e=g.getTriggerParameter(),j=e instanceof c.AbstractMesh?e:e.mesh,e=j.intersectsMesh(b,e.usePreciseIntersection),f=b._intersectionsInProgress.indexOf(j);e&&-1===f?g.trigger===
c.ActionManager.OnIntersectionEnterTrigger?(g._executeCurrent(c.ActionEvent.CreateNew(b,null,j)),b._intersectionsInProgress.push(j)):g.trigger===c.ActionManager.OnIntersectionExitTrigger&&b._intersectionsInProgress.push(j):!e&&-1<f&&(g.trigger===c.ActionManager.OnIntersectionExitTrigger&&g._executeCurrent(c.ActionEvent.CreateNew(b,null,j)),b.actionManager.hasSpecificTrigger(c.ActionManager.OnIntersectionExitTrigger)&&g.trigger!==c.ActionManager.OnIntersectionExitTrigger||b._intersectionsInProgress.splice(f,
1))}}},g.prototype.render=function(){var a=c.Tools.Now;this._activeBones=this._activeIndices=this._totalVertices=this._evaluateActiveMeshesDuration=this._renderTargetsDuration=this._renderDuration=this._activeParticles=this._spritesDuration=this._particlesDuration=0;this.getEngine().resetDrawCalls();this._meshesForIntersections.reset();this.resetCachedMaterial();c.Tools.StartPerformanceCounter("Scene rendering");this.actionManager&&this.actionManager.processTrigger(c.ActionManager.OnEveryFrameTrigger,
null);this.simplificationQueue&&!this.simplificationQueue.running&&this.simplificationQueue.executeNext();var b=Math.max(g.MinDeltaTime,Math.min(this._engine.getDeltaTime(),g.MaxDeltaTime));this._animationRatio=0.06*b;this._animate();this._physicsEngine&&(c.Tools.StartPerformanceCounter("Physics"),this._physicsEngine._step(b/1E3),c.Tools.EndPerformanceCounter("Physics"));this.onBeforeRenderObservable.notifyObservers(this);var b=c.Tools.Now,d=this.getEngine(),e=this.activeCamera;if(this.renderTargetsEnabled){c.Tools.StartPerformanceCounter("Custom render targets",
0<this.customRenderTargets.length);for(var j=0;j<this.customRenderTargets.length;j++){var f=this.customRenderTargets[j];if(f._shouldRender()){if(this._renderId++,this.activeCamera=f.activeCamera||this.activeCamera,!this.activeCamera)throw Error("Active camera not set");d.setViewport(this.activeCamera.viewport);this.updateTransformMatrix();f.render(e!==this.activeCamera,this.dumpNextRenderTargets)}}c.Tools.EndPerformanceCounter("Custom render targets",0<this.customRenderTargets.length);this._renderId++}if(0<
this.customRenderTargets.length&&d.restoreDefaultFramebuffer(),this._renderTargetsDuration+=c.Tools.Now-b,this.activeCamera=e,this.proceduralTexturesEnabled){c.Tools.StartPerformanceCounter("Procedural textures",0<this._proceduralTextures.length);for(b=0;b<this._proceduralTextures.length;b++)d=this._proceduralTextures[b],d._shouldRender()&&d.render();c.Tools.EndPerformanceCounter("Procedural textures",0<this._proceduralTextures.length)}if(this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||
this.forcePointsCloud,!0),this.shadowsEnabled)for(b=0;b<this.lights.length;b++)d=this.lights[b],e=d.getShadowGenerator(),d.isEnabled()&&e&&-1!==e.getShadowMap().getScene().textures.indexOf(e.getShadowMap())&&this._renderTargets.push(e.getShadowMap());if(this._depthRenderer&&this._renderTargets.push(this._depthRenderer.getDepthMap()),this.postProcessRenderPipelineManager.update(),0<this.activeCameras.length){b=this._renderId;for(d=0;d<this.activeCameras.length;d++)this._renderId=b,0<d&&this._engine.clear(0,
!1,!0),this._processSubCameras(this.activeCameras[d])}else{if(!this.activeCamera)throw Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();c.AudioEngine&&this._updateAudioParameters();this.afterRender&&this.afterRender();this.onAfterRenderObservable.notifyObservers(this);for(b=0;b<this._toBeDisposed.length;b++)this._toBeDisposed.data[b].dispose(),this._toBeDisposed[b]=null;this._toBeDisposed.reset();this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=
!1);c.Tools.EndPerformanceCounter("Scene rendering");this._lastFrameDuration=c.Tools.Now-a},g.prototype._updateAudioParameters=function(){if(this.audioEnabled&&(0!==this.mainSoundTrack.soundCollection.length||1!==this.soundTracks.length)){var a,b=c.Engine.audioEngine;if(a=0<this.activeCameras.length?this.activeCameras[0]:this.activeCamera,a&&b.canUseWebAudio){b.audioContext.listener.setPosition(a.position.x,a.position.y,a.position.z);a=c.Matrix.Invert(a.getViewMatrix());a=c.Vector3.TransformNormal(new c.Vector3(0,
0,-1),a);a.normalize();b.audioContext.listener.setOrientation(a.x,a.y,a.z,0,1,0);for(b=0;b<this.mainSoundTrack.soundCollection.length;b++)a=this.mainSoundTrack.soundCollection[b],a.useCustomAttenuation&&a.updateDistanceFromListener();for(b=0;b<this.soundTracks.length;b++)for(var d=0;d<this.soundTracks[b].soundCollection.length;d++)a=this.soundTracks[b].soundCollection[d],a.useCustomAttenuation&&a.updateDistanceFromListener()}}},Object.defineProperty(g.prototype,"audioEnabled",{get:function(){return this._audioEnabled},
set:function(a){this._audioEnabled=a;c.AudioEngine&&(this._audioEnabled?this._enableAudio():this._disableAudio())},enumerable:!0,configurable:!0}),g.prototype._disableAudio=function(){var a;for(a=0;a<this.mainSoundTrack.soundCollection.length;a++)this.mainSoundTrack.soundCollection[a].pause();for(a=0;a<this.soundTracks.length;a++)for(var b=0;b<this.soundTracks[a].soundCollection.length;b++)this.soundTracks[a].soundCollection[b].pause()},g.prototype._enableAudio=function(){var a;for(a=0;a<this.mainSoundTrack.soundCollection.length;a++)this.mainSoundTrack.soundCollection[a].isPaused&&
this.mainSoundTrack.soundCollection[a].play();for(a=0;a<this.soundTracks.length;a++)for(var b=0;b<this.soundTracks[a].soundCollection.length;b++)this.soundTracks[a].soundCollection[b].isPaused&&this.soundTracks[a].soundCollection[b].play()},Object.defineProperty(g.prototype,"headphone",{get:function(){return this._headphone},set:function(a){this._headphone=a;c.AudioEngine&&(this._headphone?this._switchAudioModeForHeadphones():this._switchAudioModeForNormalSpeakers())},enumerable:!0,configurable:!0}),
g.prototype._switchAudioModeForHeadphones=function(){this.mainSoundTrack.switchPanningModelToHRTF();for(var a=0;a<this.soundTracks.length;a++)this.soundTracks[a].switchPanningModelToHRTF()},g.prototype._switchAudioModeForNormalSpeakers=function(){this.mainSoundTrack.switchPanningModelToEqualPower();for(var a=0;a<this.soundTracks.length;a++)this.soundTracks[a].switchPanningModelToEqualPower()},g.prototype.enableDepthRenderer=function(){return this._depthRenderer?this._depthRenderer:(this._depthRenderer=
new c.DepthRenderer(this),this._depthRenderer)},g.prototype.disableDepthRenderer=function(){this._depthRenderer&&(this._depthRenderer.dispose(),this._depthRenderer=null)},g.prototype.freezeMaterials=function(){for(var a=0;a<this.materials.length;a++)this.materials[a].freeze()},g.prototype.unfreezeMaterials=function(){for(var a=0;a<this.materials.length;a++)this.materials[a].unfreeze()},g.prototype.dispose=function(){this.afterRender=this.beforeRender=null;this.skeletons=[];this._boundingBoxRenderer.dispose();
this._depthRenderer&&this._depthRenderer.dispose();this._debugLayer&&this._debugLayer.hide();this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear();this.onBeforeRenderObservable.clear();this.onAfterRenderObservable.clear();this.detachControl();c.AudioEngine&&this.disposeSounds();var a,b=this._engine.getRenderingCanvas();for(a=0;a<this.cameras.length;a++)this.cameras[a].detachControl(b);for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);
for(;this.cameras.length;)this.cameras[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.spriteManagers.length;)this.spriteManagers[0].dispose();for(;this.layers.length;)this.layers[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this.postProcessManager.dispose();this._physicsEngine&&this.disablePhysicsEngine();a=this._engine.scenes.indexOf(this);-1<a&&this._engine.scenes.splice(a,1);
this._engine.wipeCaches()},g.prototype.disposeSounds=function(){this.mainSoundTrack.dispose();for(var a=0;a<this.soundTracks.length;a++)this.soundTracks[a].dispose()},g.prototype.getWorldExtends=function(){for(var a=new c.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),b=new c.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),d=0;d<this.meshes.length;d++){var g=this.meshes[d];g.computeWorldMatrix(!0);var e=g.getBoundingInfo().boundingBox.minimumWorld,g=g.getBoundingInfo().boundingBox.maximumWorld;
c.Tools.CheckExtends(e,a,b);c.Tools.CheckExtends(g,a,b)}return{min:a,max:b}},g.prototype.createOrUpdateSelectionOctree=function(a,b){void 0===a&&(a=64);void 0===b&&(b=2);this._selectionOctree||(this._selectionOctree=new c.Octree(c.Octree.CreationFuncForMeshes,a,b));var d=this.getWorldExtends();return this._selectionOctree.update(d.min,d.max,this.meshes),this._selectionOctree},g.prototype.createPickingRay=function(a,b,d,g,e){void 0===e&&(e=!1);var j=this._engine;if(!g){if(!this.activeCamera)throw Error("Active camera not set");
g=this.activeCamera}j=g.viewport.toGlobal(j.getRenderWidth(),j.getRenderHeight());return a=a/this._engine.getHardwareScalingLevel()-j.x,b=b/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-j.y-j.height),c.Ray.CreateNew(a,b,j.width,j.height,d?d:c.Matrix.Identity(),e?c.Matrix.Identity():g.getViewMatrix(),g.getProjectionMatrix())},g.prototype.createPickingRayInCameraSpace=function(a,b,d){var g=this._engine;if(!d){if(!this.activeCamera)throw Error("Active camera not set");d=this.activeCamera}var g=
d.viewport.toGlobal(g.getRenderWidth(),g.getRenderHeight()),e=c.Matrix.Identity();return a=a/this._engine.getHardwareScalingLevel()-g.x,b=b/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-g.y-g.height),c.Ray.CreateNew(a,b,g.width,g.height,e,e,d.getProjectionMatrix())},g.prototype._internalPick=function(a,b,d){for(var g=null,e=0;e<this.meshes.length;e++){var j=this.meshes[e];if(b){if(!b(j))continue}else if(!j.isEnabled()||!j.isVisible||!j.isPickable)continue;var f=j.getWorldMatrix(),
f=a(f);if((j=j.intersects(f,d))&&j.hit&&(d||null==g||!(j.distance>=g.distance))&&(g=j,d))break}return g||new c.PickingInfo},g.prototype._internalPickSprites=function(a,b,d,g){var e=null;if(g=g||this.activeCamera,0<this.spriteManagers.length)for(var j=0;j<this.spriteManagers.length;j++){var f=this.spriteManagers[j];if(f.isPickable&&(f=f.intersects(a,g,b,d))&&f.hit&&(d||null==e||!(f.distance>=e.distance))&&(e=f,d))break}return e||new c.PickingInfo},g.prototype.pick=function(a,b,d,c,g){var e=this;return this._internalPick(function(d){return e.createPickingRay(a,
b,d,g)},d,c)},g.prototype.pickSprite=function(a,b,d,c,g){return this._internalPickSprites(this.createPickingRayInCameraSpace(a,b,g),d,c,g)},g.prototype.pickWithRay=function(a,b,d){var g=this;return this._internalPick(function(b){return g._pickWithRayInverseMatrix||(g._pickWithRayInverseMatrix=c.Matrix.Identity()),b.invertToRef(g._pickWithRayInverseMatrix),c.Ray.Transform(a,g._pickWithRayInverseMatrix)},b,d)},g.prototype.setPointerOverMesh=function(a){this._pointerOverMesh!==a&&(this._pointerOverMesh&&
this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(c.ActionManager.OnPointerOutTrigger,c.ActionEvent.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=a,this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(c.ActionManager.OnPointerOverTrigger,c.ActionEvent.CreateNew(this._pointerOverMesh)))},g.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},g.prototype.setPointerOverSprite=function(a){this._pointerOverSprite!==
a&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(c.ActionManager.OnPointerOutTrigger,c.ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=a,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(c.ActionManager.OnPointerOverTrigger,c.ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)))},g.prototype.getPointerOverSprite=
function(){return this._pointerOverSprite},g.prototype.getPhysicsEngine=function(){return this._physicsEngine},g.prototype.enablePhysics=function(a,b){if(this._physicsEngine)return!0;try{return this._physicsEngine=new c.PhysicsEngine(a,b),!0}catch(d){return c.Tools.Error(d.message),!1}},g.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=void 0)},g.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},g.prototype.setGravity=
function(a){c.Tools.Warn("Deprecated, please use 'scene.getPhysicsEngine().setGravity()'");this._physicsEngine&&this._physicsEngine.setGravity(a)},g.prototype.createCompoundImpostor=function(a,b){c.Tools.Warn("Scene.createCompoundImpostor is deprecated. Please use PhysicsImpostor parent/child");a.parts&&(b=a,a=a.parts);var d=a[0].mesh;d.physicsImpostor=new c.PhysicsImpostor(d,a[0].impostor,b,this);for(var g=1;g<a.length;g++){var e=a[g].mesh;e.parent!==d&&(e.position=e.position.subtract(d.position),
e.parent=d);e.physicsImpostor=new c.PhysicsImpostor(e,a[g].impostor,b,this)}d.physicsImpostor.forceUpdate()},g.prototype.deleteCompoundImpostor=function(a){a=a.parts[0].mesh;a.physicsImpostor.dispose();a.physicsImpostor=null},g.prototype.createDefaultCameraOrLight=function(){if(0===this.lights.length&&new c.HemisphericLight("default light",c.Vector3.Up(),this),!this.activeCamera){var a=new c.FreeCamera("default camera",c.Vector3.Zero(),this),b=this.getWorldExtends(),d=b.min.add(b.max.subtract(b.min).scale(0.5));
a.position=new c.Vector3(d.x,d.y,b.min.z-(b.max.z-b.min.z));a.setTarget(d);this.activeCamera=a}},g.prototype._getByTags=function(a,b,d){if(void 0===b)return a;var g=[];d=d||function(){};for(var e in a){var j=a[e];c.Tags.MatchesQuery(j,b)&&(g.push(j),d(j))}return g},g.prototype.getMeshesByTags=function(a,b){return this._getByTags(this.meshes,a,b)},g.prototype.getCamerasByTags=function(a,b){return this._getByTags(this.cameras,a,b)},g.prototype.getLightsByTags=function(a,b){return this._getByTags(this.lights,
a,b)},g.prototype.getMaterialByTags=function(a,b){return this._getByTags(this.materials,a,b).concat(this._getByTags(this.multiMaterials,a,b))},g._FOGMODE_NONE=0,g._FOGMODE_EXP=1,g._FOGMODE_EXP2=2,g._FOGMODE_LINEAR=3,g.MinDeltaTime=1,g.MaxDeltaTime=1E3,g);c.Scene=d}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(e,a,b,d,j,g){e instanceof c.Mesh?this._engine=e.getScene().getEngine():this._engine=e;this._updatable=b;this._data=a;this._strideSize=d;j||this.create();this._instanced=g};f=(f.prototype.createVertexBuffer=function(e,a,b,d){return new c.VertexBuffer(this._engine,this,e,this._updatable,!0,d?d:this._strideSize,this._instanced,a,b)},f.prototype.isUpdatable=function(){return this._updatable},f.prototype.getData=function(){return this._data},f.prototype.getBuffer=function(){return this._buffer},
f.prototype.getStrideSize=function(){return this._strideSize},f.prototype.getIsInstanced=function(){return this._instanced},f.prototype.create=function(c){!c&&this._buffer||(c=c||this._data,this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,c),this._data=c):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(c),this._data=c):this._buffer=this._engine.createVertexBuffer(c))},f.prototype.update=function(c){this.create(c)},f.prototype.updateDirectly=function(c,
a,b){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,c,a,b?b*this.getStrideSize():void 0),this._data=null)},f.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},f);c.Buffer=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,b,d,j,g,h,m,f,k){if(!h)switch(d){case e.PositionKind:h=3;break;case e.NormalKind:h=3;break;case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:h=2;break;case e.ColorKind:h=4;break;case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:h=4;break;case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:h=4}b instanceof c.Buffer?(h||(h=b.getStrideSize()),this._buffer=b,this._ownsBuffer=!1):(this._buffer=new c.Buffer(a,b,j,h,g,
m),this._ownsBuffer=!0);this._stride=h;this._offset=f?f:0;this._size=k?k:h;this._kind=d};f=(e.prototype.getKind=function(){return this._kind},e.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},e.prototype.getData=function(){return this._buffer.getData()},e.prototype.getBuffer=function(){return this._buffer.getBuffer()},e.prototype.getStrideSize=function(){return this._stride},e.prototype.getOffset=function(){return this._offset},e.prototype.getSize=function(){return this._size},
e.prototype.getIsInstanced=function(){return this._buffer.getIsInstanced()},e.prototype.create=function(a){return this._buffer.create(a)},e.prototype.update=function(a){return this._buffer.update(a)},e.prototype.updateDirectly=function(a,b){return this._buffer.updateDirectly(a,b)},e.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},Object.defineProperty(e,"PositionKind",{get:function(){return e._PositionKind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"NormalKind",
{get:function(){return e._NormalKind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UVKind",{get:function(){return e._UVKind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UV2Kind",{get:function(){return e._UV2Kind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UV3Kind",{get:function(){return e._UV3Kind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UV4Kind",{get:function(){return e._UV4Kind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UV5Kind",
{get:function(){return e._UV5Kind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"UV6Kind",{get:function(){return e._UV6Kind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ColorKind",{get:function(){return e._ColorKind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MatricesIndicesKind",{get:function(){return e._MatricesIndicesKind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MatricesWeightsKind",{get:function(){return e._MatricesWeightsKind},enumerable:!0,
configurable:!0}),Object.defineProperty(e,"MatricesIndicesExtraKind",{get:function(){return e._MatricesIndicesExtraKind},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MatricesWeightsExtraKind",{get:function(){return e._MatricesWeightsExtraKind},enumerable:!0,configurable:!0}),e._PositionKind="position",e._NormalKind="normal",e._UVKind="uv",e._UV2Kind="uv2",e._UV3Kind="uv3",e._UV4Kind="uv4",e._UV5Kind="uv5",e._UV6Kind="uv6",e._ColorKind="color",e._MatricesIndicesKind="matricesIndices",e._MatricesWeightsKind=
"matricesWeights",e._MatricesIndicesExtraKind="matricesIndicesExtra",e._MatricesWeightsExtraKind="matricesWeightsExtra",e);c.VertexBuffer=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.AbstractMesh;f=function(a,b){e.call(this,a,b.getScene());b.instances.push(this);this._sourceMesh=b;this.position.copyFrom(b.position);this.rotation.copyFrom(b.rotation);this.scaling.copyFrom(b.scaling);b.rotationQuaternion&&(this.rotationQuaternion=b.rotationQuaternion.clone());this.infiniteDistance=b.infiniteDistance;this.setPivotMatrix(b.getPivotMatrix());this.refreshBoundingInfo();this._syncSubMeshes()};f=(__extends(f,e),Object.defineProperty(f.prototype,"receiveShadows",
{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,
"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},enumerable:!0,configurable:!0}),f.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},Object.defineProperty(f.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),f.prototype.getVerticesData=function(a,b){return this._sourceMesh.getVerticesData(a,b)},f.prototype.isVerticesDataPresent=function(a){return this._sourceMesh.isVerticesDataPresent(a)},f.prototype.getIndices=
function(){return this._sourceMesh.getIndices()},Object.defineProperty(f.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),f.prototype.refreshBoundingInfo=function(){var a=this._sourceMesh.getBoundingInfo();this._boundingInfo=new c.BoundingInfo(a.minimum.clone(),a.maximum.clone());this._updateBoundingInfo()},f.prototype._preActivate=function(){this._currentLOD&&this._currentLOD._preActivate()},f.prototype._activate=function(a){this._currentLOD&&
this._currentLOD._registerInstanceForRenderId(this,a)},f.prototype.getLOD=function(){return this._currentLOD=this.sourceMesh.getLOD(this.getScene().activeCamera,this.getBoundingInfo().boundingSphere),this._currentLOD===this.sourceMesh?this:this._currentLOD},f.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var a=0;a<this._sourceMesh.subMeshes.length;a++)this._sourceMesh.subMeshes[a].clone(this,this._sourceMesh)},f.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},
f.prototype.clone=function(a,b,d){a=this._sourceMesh.createInstance(a);if(c.Tools.DeepCopy(this,a,["name","subMeshes"],[]),this.refreshBoundingInfo(),b&&(a.parent=b),!d)for(b=0;b<this.getScene().meshes.length;b++)d=this.getScene().meshes[b],d.parent===this&&d.clone(d.name,a);return a.computeWorldMatrix(!0),a},f.prototype.dispose=function(a){var b=this._sourceMesh.instances.indexOf(this);this._sourceMesh.instances.splice(b,1);e.prototype.dispose.call(this,a)},f);c.InstancedMesh=f}(BABYLON||(BABYLON=
{}));
!function(c){var f;f=function(){this.mustReturn=!1;this.visibleInstances=[];this.renderSelf=[]};c._InstancesBatch=f;var e,a=c.AbstractMesh,b=function(d,e,g,h,m,l){if(void 0===g&&(g=null),void 0===l&&(l=!0),a.call(this,d,e),this.onBeforeRenderObservable=new c.Observable,this.onAfterRenderObservable=new c.Observable,this.onBeforeDrawObservable=new c.Observable,this.delayLoadState=c.Engine.DELAYLOADSTATE_NONE,this.instances=[],this._LODLevels=[],this._visibleInstances={},this._renderIdForInstances=[],
this._batchCache=new f,this._instancesBufferSize=2048,this._sideOrientation=b._DEFAULTSIDE,this._areNormalsFrozen=!1,h){h._geometry&&h._geometry.applyToMesh(this);c.Tools.DeepCopy(h,this,["name","material","skeleton","instances"],["_poseMatrix"]);this.setPivotMatrix(h.getPivotMatrix());this.id=d+"."+h.id;this.material=h.material;var k;if(!m)for(k=0;k<e.meshes.length;k++){var n=e.meshes[k];n.parent===h&&n.clone(d+"."+n.name,this,m)}k=this.getScene().getPhysicsEngine();l&&k&&(l=k.getImpostorForPhysicsObject(h))&&
(this.physicsImpostor=l.clone(this));for(k=0;k<e.particleSystems.length;k++)l=e.particleSystems[k],l.emitter===h&&l.clone(l.name,this);this.computeWorldMatrix(!0)}null!==g&&(this.parent=g)};e=(__extends(b,a),Object.defineProperty(b,"FRONTSIDE",{get:function(){return b._FRONTSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(b,"BACKSIDE",{get:function(){return b._BACKSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(b,"DOUBLESIDE",{get:function(){return b._DOUBLESIDE},enumerable:!0,
configurable:!0}),Object.defineProperty(b,"DEFAULTSIDE",{get:function(){return b._DEFAULTSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(b,"NO_CAP",{get:function(){return b._NO_CAP},enumerable:!0,configurable:!0}),Object.defineProperty(b,"CAP_START",{get:function(){return b._CAP_START},enumerable:!0,configurable:!0}),Object.defineProperty(b,"CAP_END",{get:function(){return b._CAP_END},enumerable:!0,configurable:!0}),Object.defineProperty(b,"CAP_ALL",{get:function(){return b._CAP_ALL},
enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onBeforeDraw",{set:function(a){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver);this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(a)},enumerable:!0,configurable:!0}),b.prototype.toString=function(b){var e=a.prototype.toString.call(this,b);if(e+=", n vertices: "+this.getTotalVertices(),e+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),
this.animations)for(var g=0;g<this.animations.length;g++)e+=", animation[0]: "+this.animations[g].toString(b);return b&&(e+=", flat shading: "+(this._geometry?this.getVerticesData(c.VertexBuffer.PositionKind).length/3===this.getIndices().length?"YES":"NO":"UNKNOWN")),e},Object.defineProperty(b.prototype,"hasLODLevels",{get:function(){return 0<this._LODLevels.length},enumerable:!0,configurable:!0}),b.prototype._sortLODLevels=function(){this._LODLevels.sort(function(a,b){return a.distance<b.distance?
1:a.distance>b.distance?-1:0})},b.prototype.addLODLevel=function(a,b){if(b&&b._masterMesh)return c.Tools.Warn("You cannot use a mesh as LOD level twice"),this;var g=new c.Internals.MeshLODLevel(a,b);return this._LODLevels.push(g),b&&(b._masterMesh=this),this._sortLODLevels(),this},b.prototype.getLODLevelAtDistance=function(a){for(var b=0;b<this._LODLevels.length;b++){var c=this._LODLevels[b];if(c.distance===a)return c.mesh}return null},b.prototype.removeLODLevel=function(a){for(var b=0;b<this._LODLevels.length;b++)this._LODLevels[b].mesh===
a&&(this._LODLevels.splice(b,1),a&&(a._masterMesh=null));return this._sortLODLevels(),this},b.prototype.getLOD=function(a,b){if(!this._LODLevels||0===this._LODLevels.length)return this;var c=(b?b:this.getBoundingInfo().boundingSphere).centerWorld.subtract(a.globalPosition).length();if(this._LODLevels[this._LODLevels.length-1].distance>c)return this.onLODLevelSelection&&this.onLODLevelSelection(c,this,this._LODLevels[this._LODLevels.length-1].mesh),this;for(var h=0;h<this._LODLevels.length;h++){var e=
this._LODLevels[h];if(e.distance<c)return e.mesh&&(e.mesh._preActivate(),e.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(c,this,e.mesh),e.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(c,this,this),this},Object.defineProperty(b.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),b.prototype.getTotalVertices=function(){return this._geometry?this._geometry.getTotalVertices():0},
b.prototype.getVerticesData=function(a,b){return this._geometry?this._geometry.getVerticesData(a,b):null},b.prototype.getVertexBuffer=function(a){return this._geometry?this._geometry.getVertexBuffer(a):void 0},b.prototype.isVerticesDataPresent=function(a){return this._geometry?this._geometry.isVerticesDataPresent(a):this._delayInfo?-1!==this._delayInfo.indexOf(a):!1},b.prototype.getVerticesDataKinds=function(){if(!this._geometry){var a=[];if(this._delayInfo)for(var b in this._delayInfo)a.push(b);
return a}return this._geometry.getVerticesDataKinds()},b.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},b.prototype.getIndices=function(a){return this._geometry?this._geometry.getIndices(a):[]},Object.defineProperty(b.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),b.prototype.isReady=function(){return this.delayLoadState===c.Engine.DELAYLOADSTATE_LOADING?!1:a.prototype.isReady.call(this)},
b.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(b.prototype,"sideOrientation",{get:function(){return this._sideOrientation},set:function(a){this._sideOrientation=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"areNormalsFrozen",{get:function(){return this._areNormalsFrozen},enumerable:!0,configurable:!0}),b.prototype.freezeNormals=function(){this._areNormalsFrozen=!0},b.prototype.unfreezeNormals=function(){this._areNormalsFrozen=!1},Object.defineProperty(b.prototype,
"overridenInstanceCount",{set:function(a){this._overridenInstanceCount=a},enumerable:!0,configurable:!0}),b.prototype._preActivate=function(){var a=this.getScene().getRenderId();this._preActivateId!==a&&(this._preActivateId=a,this._visibleInstances=null)},b.prototype._preActivateForIntermediateRendering=function(a){this._visibleInstances&&(this._visibleInstances.intermediateDefaultRenderId=a)},b.prototype._registerInstanceForRenderId=function(a,b){this._visibleInstances||(this._visibleInstances={},
this._visibleInstances.defaultRenderId=b,this._visibleInstances.selfDefaultRenderId=this._renderId);this._visibleInstances[b]||(this._visibleInstances[b]=[]);this._visibleInstances[b].push(a)},b.prototype.refreshBoundingInfo=function(){if(!this._boundingInfo.isLocked){var a=this.getVerticesData(c.VertexBuffer.PositionKind);a&&(a=c.Tools.ExtractMinAndMax(a,0,this.getTotalVertices()),this._boundingInfo=new c.BoundingInfo(a.minimum,a.maximum));if(this.subMeshes)for(a=0;a<this.subMeshes.length;a++)this.subMeshes[a].refreshBoundingInfo();
this._updateBoundingInfo()}},b.prototype._createGlobalSubMesh=function(){var a=this.getTotalVertices();return a&&this.getIndices()?(this.releaseSubMeshes(),new c.SubMesh(0,0,a,0,this.getTotalIndices(),this)):null},b.prototype.subdivide=function(a){if(!(1>a)){for(var b=this.getTotalIndices(),g=b/a|0,h=0;0!==g%3;)g++;this.releaseSubMeshes();for(var e=0;a>e&&!(h>=b);e++)c.SubMesh.CreateFromIndices(0,h,Math.min(g,b-h),this),h+=g;this.synchronizeInstances()}},b.prototype.setVerticesData=function(a,b,g,
h){this._geometry?this._geometry.setVerticesData(a,b,g,h):(h=new c.VertexData,h.set(b,a),a=this.getScene(),new c.Geometry(c.Geometry.RandomId(),a,h,g,this))},b.prototype.setVerticesBuffer=function(a){if(!this._geometry){var b=this.getScene();(new c.Geometry(c.Geometry.RandomId(),b)).applyToMesh(this)}this._geometry.setVerticesBuffer(a)},b.prototype.updateVerticesData=function(a,b,c,h){this._geometry&&(h?(this.makeGeometryUnique(),this.updateVerticesData(a,b,c,!1)):this._geometry.updateVerticesData(a,
b,c))},b.prototype.updateVerticesDataDirectly=function(a,b,g,h){c.Tools.Warn("Mesh.updateVerticesDataDirectly deprecated since 2.3.");this._geometry&&(h?(this.makeGeometryUnique(),this.updateVerticesDataDirectly(a,b,g,!1)):this._geometry.updateVerticesDataDirectly(a,b,g))},b.prototype.updateMeshPositions=function(a,b){void 0===b&&(b=!0);var g=this.getVerticesData(c.VertexBuffer.PositionKind);if(a(g),this.updateVerticesData(c.VertexBuffer.PositionKind,g,!1,!1),b){var h=this.getIndices(),e=this.getVerticesData(c.VertexBuffer.NormalKind);
c.VertexData.ComputeNormals(g,h,e);this.updateVerticesData(c.VertexBuffer.NormalKind,e,!1,!1)}},b.prototype.makeGeometryUnique=function(){this._geometry&&this._geometry.copy(c.Geometry.RandomId()).applyToMesh(this)},b.prototype.setIndices=function(a,b){if(this._geometry)this._geometry.setIndices(a,b);else{var g=new c.VertexData;g.indices=a;var h=this.getScene();new c.Geometry(c.Geometry.RandomId(),h,g,!1,this)}},b.prototype.toLeftHanded=function(){this._geometry&&this._geometry.toLeftHanded()},b.prototype._bind=
function(a,b,g){var h=this.getScene().getEngine();if(this._unIndexed)a=null;else switch(g){case c.Material.PointFillMode:a=null;break;case c.Material.WireFrameFillMode:a=a.getLinesIndexBuffer(this.getIndices(),h);break;default:case c.Material.TriangleFillMode:a=this._unIndexed?null:this._geometry.getIndexBuffer()}h.bindBuffers(this._geometry.getVertexBuffers(),a,b)},b.prototype._draw=function(a,b,g){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){this.onBeforeDrawObservable.notifyObservers(this);
var h=this.getScene().getEngine();switch(b){case c.Material.PointFillMode:h.drawPointClouds(a.verticesStart,a.verticesCount,g);break;case c.Material.WireFrameFillMode:this._unIndexed?h.drawUnIndexed(!1,a.verticesStart,a.verticesCount,g):h.draw(!1,0,0<g?a.linesIndexCount/2:a.linesIndexCount,g);break;default:this._unIndexed?h.drawUnIndexed(!0,a.verticesStart,a.verticesCount,g):h.draw(!0,a.indexStart,a.indexCount,g)}}},b.prototype.registerBeforeRender=function(a){this.onBeforeRenderObservable.add(a)},
b.prototype.unregisterBeforeRender=function(a){this.onBeforeRenderObservable.removeCallback(a)},b.prototype.registerAfterRender=function(a){this.onAfterRenderObservable.add(a)},b.prototype.unregisterAfterRender=function(a){this.onAfterRenderObservable.removeCallback(a)},b.prototype._getInstancesRenderList=function(a){var b=this.getScene();if(this._batchCache.mustReturn=!1,this._batchCache.renderSelf[a]=this.isEnabled()&&this.isVisible,this._batchCache.visibleInstances[a]=null,this._visibleInstances){var c=
b.getRenderId(),b=b._isInIntermediateRendering()?this._visibleInstances.intermediateDefaultRenderId:this._visibleInstances.defaultRenderId;this._batchCache.visibleInstances[a]=this._visibleInstances[c];var h=this._renderId;if(!this._batchCache.visibleInstances[a]&&b&&(this._batchCache.visibleInstances[a]=this._visibleInstances[b],c=Math.max(b,c),h=Math.max(this._visibleInstances.selfDefaultRenderId,c)),this._batchCache.visibleInstances[a]&&this._batchCache.visibleInstances[a].length){if(this._renderIdForInstances[a]===
c)return this._batchCache.mustReturn=!0,this._batchCache;c!==h&&(this._batchCache.renderSelf[a]=!1)}this._renderIdForInstances[a]=c}return this._batchCache},b.prototype._renderWithInstances=function(a,b,g,h,e){for(var f=g.visibleInstances[a._id],k=64*(f.length+1),n=this._instancesBufferSize,q=this._instancesBuffer;this._instancesBufferSize<k;)this._instancesBufferSize*=2;this._instancesData&&n==this._instancesBufferSize||(this._instancesData=new Float32Array(this._instancesBufferSize/4));var p=k=
0,r=this.getWorldMatrix();if(g.renderSelf[a._id]&&(r.copyToArray(this._instancesData,k),k+=16,p++),f)for(g=0;g<f.length;g++)f[g].getWorldMatrix().copyToArray(this._instancesData,k),k+=16,p++;q&&n==this._instancesBufferSize?q.updateDirectly(this._instancesData,0,p):(q&&q.dispose(),q=new c.Buffer(e,this._instancesData,!0,16,!1,!0),this._instancesBuffer=q,this.setVerticesBuffer(q.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(q.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(q.createVertexBuffer("world2",
8,4)),this.setVerticesBuffer(q.createVertexBuffer("world3",12,4)));e.bindBuffers(this.geometry.getVertexBuffers(),this.geometry.getIndexBuffer(),h);this._draw(a,b,p);e.unbindInstanceAttributes()},b.prototype._processRendering=function(a,b,c,h,e,f){var k=this.getScene().getEngine();if(e)this._renderWithInstances(a,c,h,b,k);else if(h.renderSelf[a._id]&&(f&&f(!1,this.getWorldMatrix()),this._draw(a,c,this._overridenInstanceCount)),h.visibleInstances[a._id])for(b=0;b<h.visibleInstances[a._id].length;b++)e=
h.visibleInstances[a._id][b].getWorldMatrix(),f&&f(!0,e),this._draw(a,c)},b.prototype.render=function(a,b){var g=this.getScene(),h=this._getInstancesRenderList(a._id);if(!h.mustReturn&&this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){this.onBeforeRenderObservable.notifyObservers(this);var e=g.getEngine(),f=null!==e.getCaps().instancedArrays&&null!==h.visibleInstances[a._id]&&void 0!==h.visibleInstances[a._id],k=a.getMaterial();if(k&&k.isReady(this,f)){var n=e.getDepthWrite();
this.renderOutline&&(e.setDepthWrite(!1),g.getOutlineRenderer().render(a,h),e.setDepthWrite(n));k._preBind();var q=k.getEffect(),p=g.forcePointsCloud?c.Material.PointFillMode:g.forceWireframe?c.Material.WireFrameFillMode:k.fillMode;this._bind(a,q,p);var r=this.getWorldMatrix();if(k.bind(r,this),b&&e.setAlphaMode(k.alphaMode),this._processRendering(a,q,p,h,f,function(a,b){a&&k.bindOnlyWorldMatrix(b)}),k.unbind(),this.renderOutline&&n&&(e.setDepthWrite(!0),e.setColorWrite(!1),g.getOutlineRenderer().render(a,
h),e.setColorWrite(!0)),this.renderOverlay)f=e.getAlphaMode(),e.setAlphaMode(c.Engine.ALPHA_COMBINE),g.getOutlineRenderer().render(a,h,!0),e.setAlphaMode(f);this.onAfterRenderObservable.notifyObservers(this)}}},b.prototype.getEmittedParticleSystems=function(){for(var a=[],b=0;b<this.getScene().particleSystems.length;b++){var c=this.getScene().particleSystems[b];c.emitter===this&&a.push(c)}return a},b.prototype.getHierarchyEmittedParticleSystems=function(){var a=[],b=this.getDescendants();b.push(this);
for(var c=0;c<this.getScene().particleSystems.length;c++){var h=this.getScene().particleSystems[c];-1!==b.indexOf(h.emitter)&&a.push(h)}return a},b.prototype._checkDelayState=function(){var a=this,b=this.getScene();if(this._geometry)this._geometry.load(b);else if(this.delayLoadState===c.Engine.DELAYLOADSTATE_NOTLOADED){this.delayLoadState=c.Engine.DELAYLOADSTATE_LOADING;b._addPendingData(this);var g=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");c.Tools.LoadFile(this.delayLoadingFile,
function(g){g instanceof ArrayBuffer?a._delayLoadingFunction(g,a):a._delayLoadingFunction(JSON.parse(g),a);a.delayLoadState=c.Engine.DELAYLOADSTATE_LOADED;b._removePendingData(a)},function(){},b.database,g)}},b.prototype.isInFrustum=function(b){return this.delayLoadState===c.Engine.DELAYLOADSTATE_LOADING?!1:a.prototype.isInFrustum.call(this,b)?(this._checkDelayState(),!0):!1},b.prototype.setMaterialByID=function(a){var b,c=this.getScene().materials;for(b=0;b<c.length;b++)if(c[b].id===a)return void(this.material=
c[b]);c=this.getScene().multiMaterials;for(b=0;b<c.length;b++)if(c[b].id===a)return void(this.material=c[b])},b.prototype.getAnimatables=function(){var a=[];return this.material&&a.push(this.material),this.skeleton&&a.push(this.skeleton),a},b.prototype.bakeTransformIntoVertices=function(a){if(this.isVerticesDataPresent(c.VertexBuffer.PositionKind)){var b=this.subMeshes.splice(0);this._resetPointsArrayCache();var g,h=this.getVerticesData(c.VertexBuffer.PositionKind),e=[];for(g=0;g<h.length;g+=3)c.Vector3.TransformCoordinates(c.Vector3.FromArray(h,
g),a).toArray(e,g);if(this.setVerticesData(c.VertexBuffer.PositionKind,e,this.getVertexBuffer(c.VertexBuffer.PositionKind).isUpdatable()),this.isVerticesDataPresent(c.VertexBuffer.NormalKind)){h=this.getVerticesData(c.VertexBuffer.NormalKind);e=[];for(g=0;g<h.length;g+=3)c.Vector3.TransformNormal(c.Vector3.FromArray(h,g),a).normalize().toArray(e,g);this.setVerticesData(c.VertexBuffer.NormalKind,e,this.getVertexBuffer(c.VertexBuffer.NormalKind).isUpdatable());0>a.m[0]*a.m[5]*a.m[10]&&this.flipFaces();
this.releaseSubMeshes();this.subMeshes=b}}},b.prototype.bakeCurrentTransformIntoVertices=function(){this.bakeTransformIntoVertices(this.computeWorldMatrix(!0));this.scaling.copyFromFloats(1,1,1);this.position.copyFromFloats(0,0,0);this.rotation.copyFromFloats(0,0,0);this.rotationQuaternion&&(this.rotationQuaternion=c.Quaternion.Identity());this._worldMatrix=c.Matrix.Identity()},b.prototype._resetPointsArrayCache=function(){this._positions=null},b.prototype._generatePointsArray=function(){if(this._positions)return!0;
this._positions=[];var a=this.getVerticesData(c.VertexBuffer.PositionKind);if(!a)return!1;for(var b=0;b<a.length;b+=3)this._positions.push(c.Vector3.FromArray(a,b));return!0},b.prototype.clone=function(a,c,g,h){return void 0===h&&(h=!0),new b(a,this.getScene(),c,this,g,h)},b.prototype.dispose=function(b){this._geometry&&this._geometry.releaseForMesh(this,!0);for(this._instancesBuffer&&(this._instancesBuffer.dispose(),this._instancesBuffer=null);this.instances.length;)this.instances[0].dispose();a.prototype.dispose.call(this,
b)},b.prototype.applyDisplacementMap=function(a,b,g,h){var e=this,f=this.getScene();c.Tools.LoadImage(a,function(a){var c=document.createElement("canvas"),d=c.getContext("2d"),f=a.width,l=a.height;c.width=f;c.height=l;d.drawImage(a,0,0);a=d.getImageData(0,0,f,l).data;e.applyDisplacementMapFromBuffer(a,f,l,b,g);h&&h(e)},function(){},f.database)},b.prototype.applyDisplacementMapFromBuffer=function(a,b,g,h,e){if(!this.isVerticesDataPresent(c.VertexBuffer.PositionKind)||!this.isVerticesDataPresent(c.VertexBuffer.NormalKind)||
!this.isVerticesDataPresent(c.VertexBuffer.UVKind))return void c.Tools.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing");for(var f=this.getVerticesData(c.VertexBuffer.PositionKind),k=this.getVerticesData(c.VertexBuffer.NormalKind),n=this.getVerticesData(c.VertexBuffer.UVKind),q=c.Vector3.Zero(),p=c.Vector3.Zero(),r=c.Vector2.Zero(),t=0;t<f.length;t+=3){c.Vector3.FromArrayToRef(f,t,q);c.Vector3.FromArrayToRef(k,t,p);c.Vector2.FromArrayToRef(n,
2*(t/3),r);var s=Math.abs(r.x)*b%b|0,u=Math.abs(r.y)*g%g|0,s=4*(s+u*b),s=0.3*(a[s]/255)+0.59*(a[s+1]/255)+0.11*(a[s+2]/255);p.normalize();p.scaleInPlace(h+(e-h)*s);q=q.add(p);q.toArray(f,t)}c.VertexData.ComputeNormals(f,this.getIndices(),k);this.updateVerticesData(c.VertexBuffer.PositionKind,f);this.updateVerticesData(c.VertexBuffer.NormalKind,k)},b.prototype.convertToFlatShadedMesh=function(){var a,b,g=this.getVerticesDataKinds(),h=[],e=[],f=[],k=!1;for(a=0;a<g.length;a++){b=g[a];var n=this.getVertexBuffer(b);
b!==c.VertexBuffer.NormalKind?(h[b]=n,e[b]=h[b].getData(),f[b]=[]):(k=n.isUpdatable(),g.splice(a,1),a--)}var q,n=this.subMeshes.slice(0),p=this.getIndices(),r=this.getTotalIndices();for(q=0;r>q;q++){var t=p[q];for(a=0;a<g.length;a++){b=g[a];for(var s=h[b].getStrideSize(),u=0;s>u;u++)f[b].push(e[b][t*s+u])}}a=[];b=f[c.VertexBuffer.PositionKind];for(q=0;r>q;q+=3){p[q]=q;p[q+1]=q+1;p[q+2]=q+2;s=c.Vector3.FromArray(b,3*q);e=c.Vector3.FromArray(b,3*(q+1));t=c.Vector3.FromArray(b,3*(q+2));s=s.subtract(e);
e=t.subtract(e);e=c.Vector3.Normalize(c.Vector3.Cross(s,e));for(t=0;3>t;t++)a.push(e.x),a.push(e.y),a.push(e.z)}this.setIndices(p);this.setVerticesData(c.VertexBuffer.NormalKind,a,k);for(a=0;a<g.length;a++)b=g[a],this.setVerticesData(b,f[b],h[b].isUpdatable());this.releaseSubMeshes();for(g=0;g<n.length;g++)h=n[g],new c.SubMesh(h.materialIndex,h.indexStart,h.indexCount,h.indexStart,h.indexCount,this);this.synchronizeInstances()},b.prototype.convertToUnIndexedMesh=function(){var a,b,g=this.getVerticesDataKinds(),
h=[],e=[],f=[];for(a=0;a<g.length;a++){b=g[a];var k=this.getVertexBuffer(b);h[b]=k;e[b]=h[b].getData();f[b]=[]}var n,k=this.subMeshes.slice(0),q=this.getIndices(),p=this.getTotalIndices();for(n=0;p>n;n++){var r=q[n];for(a=0;a<g.length;a++){b=g[a];for(var t=h[b].getStrideSize(),s=0;t>s;s++)f[b].push(e[b][r*t+s])}}for(n=0;p>n;n+=3)q[n]=n,q[n+1]=n+1,q[n+2]=n+2;this.setIndices(q);for(a=0;a<g.length;a++)b=g[a],this.setVerticesData(b,f[b],h[b].isUpdatable());this.releaseSubMeshes();for(a=0;a<k.length;a++)b=
k[a],new c.SubMesh(b.materialIndex,b.indexStart,b.indexCount,b.indexStart,b.indexCount,this);this._unIndexed=!0;this.synchronizeInstances()},b.prototype.flipFaces=function(a){void 0===a&&(a=!1);var b=c.VertexData.ExtractFromMesh(this);if(a&&this.isVerticesDataPresent(c.VertexBuffer.NormalKind))for(a=0;a<b.normals.length;a++)b.normals[a]*=-1;var g;for(a=0;a<b.indices.length;a+=3)g=b.indices[a+1],b.indices[a+1]=b.indices[a+2],b.indices[a+2]=g;b.applyToMesh(this)},b.prototype.createInstance=function(a){return new c.InstancedMesh(a,
this)},b.prototype.synchronizeInstances=function(){for(var a=0;a<this.instances.length;a++)this.instances[a]._syncSubMeshes()},b.prototype.simplify=function(a,b,g,h){void 0===b&&(b=!0);void 0===g&&(g=c.SimplificationType.QUADRATIC);this.getScene().simplificationQueue.addTask({settings:a,parallelProcessing:b,mesh:this,simplificationType:g,successCallback:h})},b.prototype.optimizeIndices=function(a){for(var b=this,g=this.getIndices(),h=this.getVerticesData(c.VertexBuffer.PositionKind),e=[],f=0;f<h.length;f+=
3)e.push(c.Vector3.FromArray(h,f));var k=[];c.AsyncLoop.SyncAsyncForLoop(e.length,40,function(a){a=e.length-1-a;for(var b=e[a],c=0;a>c;++c)if(b.equals(e[c])){k[a]=c;break}},function(){for(var c=0;c<g.length;++c)g[c]=k[g[c]]||g[c];c=b.subMeshes.slice(0);b.setIndices(g);b.subMeshes=c;a&&a(b)})},b.Parse=function(a,e,g){var h=new b(a.name,e);if(h.id=a.id,c.Tags.AddTagsTo(h,a.tags),h.position=c.Vector3.FromArray(a.position),a.rotationQuaternion?h.rotationQuaternion=c.Quaternion.FromArray(a.rotationQuaternion):
a.rotation&&(h.rotation=c.Vector3.FromArray(a.rotation)),h.scaling=c.Vector3.FromArray(a.scaling),a.localMatrix?h.setPivotMatrix(c.Matrix.FromArray(a.localMatrix)):a.pivotMatrix&&h.setPivotMatrix(c.Matrix.FromArray(a.pivotMatrix)),h.setEnabled(a.isEnabled),h.isVisible=a.isVisible,h.infiniteDistance=a.infiniteDistance,h.showBoundingBox=a.showBoundingBox,h.showSubMeshesBoundingBox=a.showSubMeshesBoundingBox,void 0!==a.applyFog&&(h.applyFog=a.applyFog),void 0!==a.pickable&&(h.isPickable=a.pickable),
void 0!==a.alphaIndex&&(h.alphaIndex=a.alphaIndex),h.receiveShadows=a.receiveShadows,h.billboardMode=a.billboardMode,void 0!==a.visibility&&(h.visibility=a.visibility),h.checkCollisions=a.checkCollisions,h._shouldGenerateFlatShading=a.useFlatShading,a.freezeWorldMatrix&&(h._waitingFreezeWorldMatrix=a.freezeWorldMatrix),a.parentId&&(h._waitingParentId=a.parentId),void 0!==a.actions&&(h._waitingActions=a.actions),h.hasVertexAlpha=a.hasVertexAlpha,a.delayLoadingFile?(h.delayLoadState=c.Engine.DELAYLOADSTATE_NOTLOADED,
h.delayLoadingFile=g+a.delayLoadingFile,h._boundingInfo=new c.BoundingInfo(c.Vector3.FromArray(a.boundingBoxMinimum),c.Vector3.FromArray(a.boundingBoxMaximum)),a._binaryInfo&&(h._binaryInfo=a._binaryInfo),h._delayInfo=[],a.hasUVs&&h._delayInfo.push(c.VertexBuffer.UVKind),a.hasUVs2&&h._delayInfo.push(c.VertexBuffer.UV2Kind),a.hasUVs3&&h._delayInfo.push(c.VertexBuffer.UV3Kind),a.hasUVs4&&h._delayInfo.push(c.VertexBuffer.UV4Kind),a.hasUVs5&&h._delayInfo.push(c.VertexBuffer.UV5Kind),a.hasUVs6&&h._delayInfo.push(c.VertexBuffer.UV6Kind),
a.hasColors&&h._delayInfo.push(c.VertexBuffer.ColorKind),a.hasMatricesIndices&&h._delayInfo.push(c.VertexBuffer.MatricesIndicesKind),a.hasMatricesWeights&&h._delayInfo.push(c.VertexBuffer.MatricesWeightsKind),h._delayLoadingFunction=c.Geometry.ImportGeometry,c.SceneLoader.ForceFullSceneLoadingForIncremental&&h._checkDelayState()):c.Geometry.ImportGeometry(a,h),a.materialId?h.setMaterialByID(a.materialId):h.material=null,-1<a.skeletonId&&(h.skeleton=e.getLastSkeletonByID(a.skeletonId),a.numBoneInfluencers&&
(h.numBoneInfluencers=a.numBoneInfluencers)),a.animations){for(var m=0;m<a.animations.length;m++){var f=a.animations[m];h.animations.push(c.Animation.Parse(f))}c.Node.ParseAnimationRanges(h,a,e)}if(a.autoAnimate&&e.beginAnimation(h,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1),a.layerMask&&!isNaN(a.layerMask)?h.layerMask=Math.abs(parseInt(a.layerMask)):h.layerMask=268435455,a.physicsImpostor&&(h.physicsImpostor=new c.PhysicsImpostor(h,a.physicsImpostor,{mass:a.physicsMass,
friction:a.physicsFriction,restitution:a.physicsRestitution},e)),a.instances)for(g=0;g<a.instances.length;g++){var m=a.instances[g],k=h.createInstance(m.name);if(c.Tags.AddTagsTo(k,m.tags),k.position=c.Vector3.FromArray(m.position),m.rotationQuaternion?k.rotationQuaternion=c.Quaternion.FromArray(m.rotationQuaternion):m.rotation&&(k.rotation=c.Vector3.FromArray(m.rotation)),k.scaling=c.Vector3.FromArray(m.scaling),k.checkCollisions=h.checkCollisions,a.animations){for(m=0;m<a.animations.length;m++)f=
a.animations[m],k.animations.push(c.Animation.Parse(f));c.Node.ParseAnimationRanges(k,a,e)}}return h},b.CreateRibbon=function(a,b,g,h,e,f,k,n,q){return c.MeshBuilder.CreateRibbon(a,{pathArray:b,closeArray:g,closePath:h,offset:e,updatable:k,sideOrientation:n,instance:q},f)},b.CreateDisc=function(a,b,g,h,e,f){return c.MeshBuilder.CreateDisc(a,{radius:b,tessellation:g,sideOrientation:f,updatable:e},h)},b.CreateBox=function(a,b,g,h,e){return c.MeshBuilder.CreateBox(a,{size:b,sideOrientation:e,updatable:h},
g)},b.CreateSphere=function(a,b,g,h,e,f){return c.MeshBuilder.CreateSphere(a,{segments:b,diameterX:g,diameterY:g,diameterZ:g,sideOrientation:f,updatable:e},h)},b.CreateCylinder=function(a,e,g,h,m,f,k,n,q){void 0!==k&&k instanceof c.Scene||(void 0!==k&&(q=n||b.DEFAULTSIDE,n=k),k=f,f=1);return c.MeshBuilder.CreateCylinder(a,{height:e,diameterTop:g,diameterBottom:h,tessellation:m,subdivisions:f,sideOrientation:q,updatable:n},k)},b.CreateTorus=function(a,b,g,h,e,f,k){return c.MeshBuilder.CreateTorus(a,
{diameter:b,thickness:g,tessellation:h,sideOrientation:k,updatable:f},e)},b.CreateTorusKnot=function(a,b,g,h,e,f,k,n,q,p){return c.MeshBuilder.CreateTorusKnot(a,{radius:b,tube:g,radialSegments:h,tubularSegments:e,p:f,q:k,sideOrientation:p,updatable:q},n)},b.CreateLines=function(a,b,g,h,e){return c.MeshBuilder.CreateLines(a,{points:b,updatable:h,instance:e},g)},b.CreateDashedLines=function(a,b,g,h,e,f,k){return c.MeshBuilder.CreateDashedLines(a,{points:b,dashSize:g,gapSize:h,dashNb:e,updatable:k},
f)},b.ExtrudeShape=function(a,e,g,h,m,f,k,n,q,p){return c.MeshBuilder.ExtrudeShape(a,{shape:e,path:g,scale:h,rotation:m,cap:0===f?0:f||b.NO_CAP,sideOrientation:q,instance:p,updatable:n},k)},b.ExtrudeShapeCustom=function(a,e,g,h,m,f,k,n,q,p,r,t){return c.MeshBuilder.ExtrudeShapeCustom(a,{shape:e,path:g,scaleFunction:h,rotationFunction:m,ribbonCloseArray:f,ribbonClosePath:k,cap:0===n?0:n||b.NO_CAP,sideOrientation:r,instance:t,updatable:p},q)},b.CreateLathe=function(a,b,g,h,e,f,k){return c.MeshBuilder.CreateLathe(a,
{shape:b,radius:g,tessellation:h,sideOrientation:k,updatable:f},e)},b.CreatePlane=function(a,b,g,h,e){return c.MeshBuilder.CreatePlane(a,{size:b,width:b,height:b,sideOrientation:e,updatable:h},g)},b.CreateGround=function(a,b,g,h,e,f){return c.MeshBuilder.CreateGround(a,{width:b,height:g,subdivisions:h,updatable:f},e)},b.CreateTiledGround=function(a,b,g,h,e,f,k,n,q){return c.MeshBuilder.CreateTiledGround(a,{xmin:b,zmin:g,xmax:h,zmax:e,subdivisions:f,precision:k,updatable:q},n)},b.CreateGroundFromHeightMap=
function(a,b,g,h,e,f,k,n,q,p){return c.MeshBuilder.CreateGroundFromHeightMap(a,b,{width:g,height:h,subdivisions:e,minHeight:f,maxHeight:k,updatable:q,onReady:p},n)},b.CreateTube=function(a,b,g,h,e,f,k,n,q,p){return c.MeshBuilder.CreateTube(a,{path:b,radius:g,tessellation:h,radiusFunction:e,arc:1,cap:f,updatable:n,sideOrientation:q,instance:p},k)},b.CreatePolyhedron=function(a,b,g){return c.MeshBuilder.CreatePolyhedron(a,b,g)},b.CreateIcoSphere=function(a,b,g){return c.MeshBuilder.CreateIcoSphere(a,
b,g)},b.CreateDecal=function(a,b,g,h,e,f){return c.MeshBuilder.CreateDecal(a,b,{position:g,normal:h,size:e,angle:f})},b.prototype.setPositionsForCPUSkinning=function(){var a;return this._sourcePositions||(a=this.getVerticesData(c.VertexBuffer.PositionKind),this._sourcePositions=new Float32Array(a),this.getVertexBuffer(c.VertexBuffer.PositionKind).isUpdatable()||this.setVerticesData(c.VertexBuffer.PositionKind,a,!0)),this._sourcePositions},b.prototype.setNormalsForCPUSkinning=function(){var a;return this._sourceNormals||
(a=this.getVerticesData(c.VertexBuffer.NormalKind),this._sourceNormals=new Float32Array(a),this.getVertexBuffer(c.VertexBuffer.NormalKind).isUpdatable()||this.setVerticesData(c.VertexBuffer.NormalKind,a,!0)),this._sourceNormals},b.prototype.applySkeleton=function(a){if(this.geometry&&this.geometry._softwareSkinningRenderId!=this.getScene().getRenderId()){if((this.geometry._softwareSkinningRenderId=this.getScene().getRenderId(),!this.isVerticesDataPresent(c.VertexBuffer.PositionKind))||!this.isVerticesDataPresent(c.VertexBuffer.NormalKind)||
!this.isVerticesDataPresent(c.VertexBuffer.MatricesIndicesKind)||!this.isVerticesDataPresent(c.VertexBuffer.MatricesWeightsKind))return this;this._sourcePositions||this.setPositionsForCPUSkinning();this._sourceNormals||this.setNormalsForCPUSkinning();var b=this.getVerticesData(c.VertexBuffer.PositionKind);b instanceof Float32Array||(b=new Float32Array(b));var g=this.getVerticesData(c.VertexBuffer.NormalKind);g instanceof Float32Array||(g=new Float32Array(g));for(var h=this.getVerticesData(c.VertexBuffer.MatricesIndicesKind),
e=this.getVerticesData(c.VertexBuffer.MatricesWeightsKind),f=4<this.numBoneInfluencers,k=f?this.getVerticesData(c.VertexBuffer.MatricesIndicesExtraKind):null,n=f?this.getVerticesData(c.VertexBuffer.MatricesWeightsExtraKind):null,q=a.getTransformMatrices(this),p=c.Vector3.Zero(),r=new c.Matrix,t=new c.Matrix,s=0,u=0;u<b.length;u+=3,s+=4){var v;for(a=0;4>a&&(v=e[s+a],0<v);a++)c.Matrix.FromFloat32ArrayToRefScaled(q,16*h[s+a],v,t),r.addToSelf(t);if(f)for(a=0;4>a&&(v=n[s+a],0<v);a++)c.Matrix.FromFloat32ArrayToRefScaled(q,
16*k[s+a],v,t),r.addToSelf(t);c.Vector3.TransformCoordinatesFromFloatsToRef(this._sourcePositions[u],this._sourcePositions[u+1],this._sourcePositions[u+2],r,p);p.toArray(b,u);c.Vector3.TransformNormalFromFloatsToRef(this._sourceNormals[u],this._sourceNormals[u+1],this._sourceNormals[u+2],r,p);p.toArray(g,u);r.reset()}return this.updateVerticesData(c.VertexBuffer.PositionKind,b),this.updateVerticesData(c.VertexBuffer.NormalKind,g),this}},b.MinMax=function(a){var b=null,c=null,h;for(h in a){var e=a[h].getBoundingInfo().boundingBox;
b?(b.MinimizeInPlace(e.minimumWorld),c.MaximizeInPlace(e.maximumWorld)):(b=e.minimumWorld,c=e.maximumWorld)}return{min:b,max:c}},b.Center=function(a){a=void 0!==a.min?a:b.MinMax(a);return c.Vector3.Center(a.min,a.max)},b.MergeMeshes=function(a,e,g,h){void 0===e&&(e=!0);if(!g){var m=0;for(g=0;g<a.length;g++)if(a[g]&&(m+=a[g].getTotalVertices(),65536<m))return c.Tools.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),
null}var f,k,n;for(g=0;g<a.length;g++)a[g]&&(a[g].computeWorldMatrix(!0),k=c.VertexData.ExtractFromMesh(a[g],!0),k.transform(a[g].getWorldMatrix()),f?f.merge(k):(f=k,n=a[g]));if(h||(h=new b(n.name+"_merged",n.getScene())),f.applyToMesh(h),h.material=n.material,h.checkCollisions=n.checkCollisions,e)for(g=0;g<a.length;g++)a[g]&&a[g].dispose();return h},b._FRONTSIDE=0,b._BACKSIDE=1,b._DOUBLESIDE=2,b._DEFAULTSIDE=0,b._NO_CAP=0,b._CAP_START=1,b._CAP_END=2,b._CAP_ALL=3,b);c.Mesh=e}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,b,c,e,g,h,m,f){void 0===f&&(f=!0);this.materialIndex=a;this.verticesStart=b;this.verticesCount=c;this.indexStart=e;this.indexCount=g;this._renderId=0;this._mesh=h;this._renderingMesh=m||h;h.subMeshes.push(this);this._trianglePlanes=[];this._id=h.subMeshes.length-1;f&&(this.refreshBoundingInfo(),h.computeWorldMatrix(!0))};f=(Object.defineProperty(e.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount==this._mesh.getTotalVertices()},
enumerable:!0,configurable:!0}),e.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},e.prototype.getMesh=function(){return this._mesh},e.prototype.getRenderingMesh=function(){return this._renderingMesh},e.prototype.getMaterial=function(){var a=this._renderingMesh.material;return a&&a instanceof c.MultiMaterial?a.getSubMaterial(this.materialIndex):a?a:this._mesh.getScene().defaultMaterial},e.prototype.refreshBoundingInfo=function(){if(this._lastColliderWorldVertices=
null,!this.IsGlobal){var a=this._renderingMesh.getVerticesData(c.VertexBuffer.PositionKind);if(!a)return void(this._boundingInfo=this._mesh._boundingInfo);var b=this._renderingMesh.getIndices(),a=0===this.indexStart&&this.indexCount===b.length?{minimum:this._renderingMesh.getBoundingInfo().minimum.clone(),maximum:this._renderingMesh.getBoundingInfo().maximum.clone()}:c.Tools.ExtractMinAndMaxIndexed(a,b,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);this._boundingInfo=new c.BoundingInfo(a.minimum,
a.maximum)}},e.prototype._checkCollision=function(a){return this.getBoundingInfo()._checkCollision(a)},e.prototype.updateBoundingInfo=function(a){this.getBoundingInfo()||this.refreshBoundingInfo();this.getBoundingInfo().update(a)},e.prototype.isInFrustum=function(a){return this.getBoundingInfo().isInFrustum(a)},e.prototype.render=function(a){this._renderingMesh.render(this,a)},e.prototype.getLinesIndexBuffer=function(a,b){if(!this._linesIndexBuffer){for(var c=[],e=this.indexStart;e<this.indexStart+
this.indexCount;e+=3)c.push(a[e],a[e+1],a[e+1],a[e+2],a[e+2],a[e]);this._linesIndexBuffer=b.createIndexBuffer(c);this.linesIndexCount=c.length}return this._linesIndexBuffer},e.prototype.canIntersects=function(a){return a.intersectsBox(this.getBoundingInfo().boundingBox)},e.prototype.intersects=function(a,b,d,e){var g=null;if(this._mesh instanceof c.LinesMesh)for(var h=this._mesh,f=this.indexStart;f<this.indexStart+this.indexCount;f+=2){var l=b[d[f]],k=b[d[f+1]],l=a.intersectionSegment(l,k,h.intersectionThreshold);
if(!(0>l)&&(e||!g||l<g.distance)&&(g=new c.IntersectionInfo(null,null,l),e))break}else for(f=this.indexStart;f<this.indexStart+this.indexCount&&!(l=b[d[f]],k=b[d[f+1]],(h=a.intersectsTriangle(l,k,b[d[f+2]]))&&!(0>h.distance)&&(e||!g||h.distance<g.distance)&&(g=h,g.faceId=f/3,e));f+=3);return g},e.prototype.clone=function(a,b){var d=new e(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,a,b,!1);return this.IsGlobal||(d._boundingInfo=new c.BoundingInfo(this.getBoundingInfo().minimum,
this.getBoundingInfo().maximum)),d},e.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var a=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(a,1)},e.CreateFromIndices=function(a,b,c,j,g){var h=Number.MAX_VALUE,f=-Number.MAX_VALUE;g=g||j;for(var l=g.getIndices(),k=b;b+c>k;k++){var n=l[k];h>n&&(h=n);n>f&&(f=n)}return new e(a,h,f-h+1,b,c,j,g)},e);c.SubMesh=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(){};f=(e.CreateBox=function(a,b,d){a=new c.Mesh(a,d);return c.VertexData.CreateBox(b).applyToMesh(a,b.updatable),a},e.CreateSphere=function(a,b,d){a=new c.Mesh(a,d);return c.VertexData.CreateSphere(b).applyToMesh(a,b.updatable),a},e.CreateDisc=function(a,b,d){a=new c.Mesh(a,d);return c.VertexData.CreateDisc(b).applyToMesh(a,b.updatable),a},e.CreateIcoSphere=function(a,b,d){a=new c.Mesh(a,d);return c.VertexData.CreateIcoSphere(b).applyToMesh(a,b.updatable),a},e.CreateRibbon=
function(a,b,d){var e=b.pathArray,g=b.closeArray,h=b.closePath,f=(b.offset,b.sideOrientation),l=b.instance,k=b.updatable;if(l){g=l.getVerticesData(c.VertexBuffer.PositionKind);h=e[0].length;k=0;b=l.sideOrientation===c.Mesh.DOUBLESIDE?2:1;for(f=1;b>=f;f++)for(a=0;a<e.length;a++){d=e[a];for(var n=d.length,h=n>h?h:n,n=0;h>n;)g[k]=d[n].x,g[k+1]=d[n].y,g[k+2]=d[n].z,n++,k+=3;l._closePath&&(g[k]=d[0].x,g[k+1]=d[0].y,g[k+2]=d[0].z,k+=3)}if(l.updateVerticesData(c.VertexBuffer.PositionKind,g,!1,!1),!l.areNormalsFrozen){k=
l.getIndices();h=l.getVerticesData(c.VertexBuffer.NormalKind);if(c.VertexData.ComputeNormals(g,k,h),l._closePath)for(b=k=g=0;b<e.length;b++)g=3*l._idx[b],k=b+1<e.length?3*(l._idx[b+1]-1):h.length-3,h[g]=0.5*(h[g]+h[k]),h[g+1]=0.5*(h[g+1]+h[k+1]),h[g+2]=0.5*(h[g+2]+h[k+2]),h[k]=h[g],h[k+1]=h[g+1],h[k+2]=h[g+2];l.updateVerticesData(c.VertexBuffer.NormalKind,h,!1,!1)}return l}e=new c.Mesh(a,d);e.sideOrientation=f;l=c.VertexData.CreateRibbon(b);return h&&(e._idx=l._idx),e._closePath=h,e._closeArray=g,
l.applyToMesh(e,k),e},e.CreateCylinder=function(a,b,d){a=new c.Mesh(a,d);return c.VertexData.CreateCylinder(b).applyToMesh(a,b.updatable),a},e.CreateTorus=function(a,b,d){a=new c.Mesh(a,d);return c.VertexData.CreateTorus(b).applyToMesh(a,b.updatable),a},e.CreateTorusKnot=function(a,b,d){a=new c.Mesh(a,d);return c.VertexData.CreateTorusKnot(b).applyToMesh(a,b.updatable),a},e.CreateLineSystem=function(a,b,d){var e=b.instance,g=b.lines;if(e)return e.updateMeshPositions(function(a){for(var b=0,c=0;c<
g.length;c++)for(var d=g[c],e=0;e<d.length;e++)a[b]=d[e].x,a[b+1]=d[e].y,a[b+2]=d[e].z,b+=3},!1),e;a=new c.LinesMesh(a,d);return c.VertexData.CreateLineSystem(b).applyToMesh(a,b.updatable),a},e.CreateLines=function(a,b,c){return e.CreateLineSystem(a,{lines:[b.points],updatable:b.updatable,instance:b.instance},c)},e.CreateDashedLines=function(a,b,d){var e=b.points,g=b.instance,h=b.gapSize,f=(b.dashNb,b.dashSize);if(g)return g.updateMeshPositions(function(a){for(var b=c.Vector3.Zero(),d=a.length/6,
h=0,f=0,m=0,t=0,s=0,u=0,v=0,w=0,v=0;v<e.length-1;v++)e[v+1].subtractToRef(e[v],b),h+=b.length();m=h/d;t=g.dashSize*m/(g.dashSize+g.gapSize);for(v=0;v<e.length-1;v++){e[v+1].subtractToRef(e[v],b);f=Math.floor(b.length()/m);b.normalize();for(w=0;f>w&&u<a.length;)s=m*w,a[u]=e[v].x+s*b.x,a[u+1]=e[v].y+s*b.y,a[u+2]=e[v].z+s*b.z,a[u+3]=e[v].x+(s+t)*b.x,a[u+4]=e[v].y+(s+t)*b.y,a[u+5]=e[v].z+(s+t)*b.z,u+=6,w++}for(;u<a.length;)a[u]=e[v].x,a[u+1]=e[v].y,a[u+2]=e[v].z,u+=3},!1),g;a=new c.LinesMesh(a,d);return c.VertexData.CreateDashedLines(b).applyToMesh(a,
b.updatable),a.dashSize=f,a.gapSize=h,a},e.ExtrudeShape=function(a,b,d){return e._ExtrudeShapeGeneric(a,b.shape,b.path,b.scale||1,b.rotation||0,null,null,!1,!1,0===b.cap?0:b.cap||c.Mesh.NO_CAP,!1,d,b.updatable,0===b.sideOrientation?0:b.sideOrientation||c.Mesh.DEFAULTSIDE,b.instance)},e.ExtrudeShapeCustom=function(a,b,d){return e._ExtrudeShapeGeneric(a,b.shape,b.path,null,null,b.scaleFunction||function(){return 1},b.rotationFunction||function(){return 0},b.ribbonCloseArray||!1,b.ribbonClosePath||!1,
0===b.cap?0:b.cap||c.Mesh.NO_CAP,!0,d,b.updatable,0===b.sideOrientation?0:b.sideOrientation||c.Mesh.DEFAULTSIDE,b.instance)},e.CreateLathe=function(a,b,d){for(var j=void 0===b.closed?!0:b.closed,g=b.shape,h=b.radius||1,f=b.tessellation||64,l=b.updatable,k=0===b.sideOrientation?0:b.sideOrientation||c.Mesh.DEFAULTSIDE,n=b.cap||c.Mesh.NO_CAP,q=[],p=0,r=0,t=2*Math.PI/f*(0>=b.arc||1<b.arc?1:b.arc||1),s=[],p=0;f>=p;p++){s=[];n!=c.Mesh.CAP_START&&n!=c.Mesh.CAP_ALL||(s.push(new c.Vector3(0,g[0].y,0)),s.push(new c.Vector3(Math.cos(p*
t)*g[0].x*h,g[0].y,Math.sin(p*t)*g[0].x*h)));for(r=0;r<g.length;r++)b=new c.Vector3(Math.cos(p*t)*g[r].x*h,g[r].y,Math.sin(p*t)*g[r].x*h),s.push(b);n!=c.Mesh.CAP_END&&n!=c.Mesh.CAP_ALL||(s.push(new c.Vector3(Math.cos(p*t)*g[g.length-1].x*h,g[g.length-1].y,Math.sin(p*t)*g[g.length-1].x*h)),s.push(new c.Vector3(0,g[g.length-1].y,0)));q.push(s)}return e.CreateRibbon(a,{pathArray:q,closeArray:j,sideOrientation:k,updatable:l},d)},e.CreatePlane=function(a,b,d){a=new c.Mesh(a,d);if(c.VertexData.CreatePlane(b).applyToMesh(a,
b.updatable),b.sourcePlane)a.translate(b.sourcePlane.normal,b.sourcePlane.d),d=Math.acos(c.Vector3.Dot(b.sourcePlane.normal,c.Axis.Z)),b=c.Vector3.Cross(c.Axis.Z,b.sourcePlane.normal),a.rotate(b,d);return a},e.CreateGround=function(a,b,d){a=new c.GroundMesh(a,d);a._setReady(!1);a._subdivisions=b.subdivisions||1;a._width=b.width||1;a._height=b.height||1;a._maxX=a._width/2;a._maxZ=a._height/2;a._minX=-a._maxX;a._minZ=-a._maxZ;return c.VertexData.CreateGround(b).applyToMesh(a,b.updatable),a._setReady(!0),
a},e.CreateTiledGround=function(a,b,d){a=new c.Mesh(a,d);return c.VertexData.CreateTiledGround(b).applyToMesh(a,b.updatable),a},e.CreateGroundFromHeightMap=function(a,b,d,e){var g=d.width||10,h=d.height||10,f=d.subdivisions||1,l=d.minHeight,k=d.maxHeight||10,n=d.updatable,q=d.onReady,p=new c.GroundMesh(a,e);p._subdivisions=f;p._width=g;p._height=h;p._maxX=p._width/2;p._maxZ=p._height/2;p._minX=-p._maxX;p._minZ=-p._maxZ;p._setReady(!1);return c.Tools.LoadImage(b,function(a){var b=document.createElement("canvas"),
d=b.getContext("2d"),e=a.width,j=a.height;b.width=e;b.height=j;d.drawImage(a,0,0);a=d.getImageData(0,0,e,j).data;c.VertexData.CreateGroundFromHeightMap({width:g,height:h,subdivisions:f,minHeight:l,maxHeight:k,buffer:a,bufferWidth:e,bufferHeight:j}).applyToMesh(p,n);p._setReady(!0);q&&q(p)},function(){},e.database),p},e.CreateTube=function(a,b,d){var j=b.path,g=b.radius||1,h=b.tessellation||64,f=b.radiusFunction,l=b.cap||c.Mesh.NO_CAP,k=b.updatable,n=b.sideOrientation||c.Mesh.DEFAULTSIDE,q=b.instance;
b.arc=0>=b.arc||1<b.arc?1:b.arc||1;var p,r,t=function(a,b,d,g,h,e,j,k){var f,m,l,n,q=b.getTangents(),p=b.getNormals();b=b.getDistances();k*=2*Math.PI/h;var t=e||function(){return g},r=c.Tmp.Matrix[0];e=j===c.Mesh._NO_CAP||j===c.Mesh.CAP_END?0:2;for(var L=0;L<a.length;L++){m=t(L,b[L]);f=[];l=p[L];for(var K=0;h>K;K++)c.Matrix.RotationAxisToRef(q[L],k*K,r),n=f[K]?f[K]:c.Vector3.Zero(),c.Vector3.TransformCoordinatesToRef(l,r,n),n.scaleInPlace(m).addInPlace(a[L]),f[K]=n;d[e]=f;e++}q=function(b,c){for(var d=
[],g=0;b>g;g++)d.push(a[c]);return d};switch(j){case c.Mesh.CAP_START:d[0]=q(h,0);d[1]=d[2].slice(0);break;case c.Mesh.CAP_END:d[e]=d[e-1].slice(0);d[e+1]=q(h,a.length-1);break;case c.Mesh.CAP_ALL:d[0]=q(h,0),d[1]=d[2].slice(0),d[e]=d[e-1].slice(0),d[e+1]=q(h,a.length-1)}return d};if(q)return b=b.arc||q.arc,p=q.path3D.update(j),r=t(j,p,q.pathArray,g,q.tessellation,f,q.cap,b),q=e.CreateRibbon(null,{pathArray:r,instance:q}),q.path3D=p,q.pathArray=r,q.arc=b,q;p=new c.Path3D(j);l=0>l||3<l?0:l;r=t(j,p,
[],g,h,f,l,b.arc);j=e.CreateRibbon(a,{pathArray:r,closePath:!0,closeArray:!1,updatable:k,sideOrientation:n},d);return j.pathArray=r,j.path3D=p,j.tessellation=h,j.cap=l,j.arc=b.arc,j},e.CreatePolyhedron=function(a,b,d){a=new c.Mesh(a,d);return c.VertexData.CreatePolyhedron(b).applyToMesh(a,b.updatable),a},e.CreateDecal=function(a,b,d){var e=b.getIndices(),g=b.getVerticesData(c.VertexBuffer.PositionKind),h=b.getVerticesData(c.VertexBuffer.NormalKind),f=d.position||c.Vector3.Zero(),l=d.normal||c.Vector3.Up(),
k=d.size||new c.Vector3(1,1,1);d=d.angle||0;if(!l)var l=new c.Vector3(0,0,1),n=b.getScene().activeCamera,l=c.Vector3.TransformCoordinates(l,n.getWorldMatrix()),l=n.globalPosition.subtract(l);var n=-Math.atan2(l.z,l.x)-Math.PI/2,q=Math.sqrt(l.x*l.x+l.z*l.z),l=Math.atan2(l.y,q),q=c.Matrix.RotationYawPitchRoll(n,l,d).multiply(c.Matrix.Translation(f.x,f.y,f.z)),q=c.Matrix.Invert(q),p=b.getWorldMatrix().multiply(q),q=new c.VertexData;q.indices=[];q.positions=[];q.normals=[];q.uvs=[];for(var r=0,t=function(a){a=
e[a];var b=new c.PositionNormalVertex;return b.position=new c.Vector3(g[3*a],g[3*a+1],g[3*a+2]),b.position=c.Vector3.TransformCoordinates(b.position,p),b.normal=new c.Vector3(h[3*a],h[3*a+1],h[3*a+2]),b},s=function(a,b){if(0===a.length)return a;for(var d=0.5*Math.abs(c.Vector3.Dot(k,b)),g=function(a,g){var h=c.Vector3.GetClipFactor(a.position,g.position,b,d);return new c.PositionNormalVertex(c.Vector3.Lerp(a.position,g.position,h),c.Vector3.Lerp(a.normal,g.normal,h))},h=[],e=0;e<a.length;e+=3){var j,
f,m,l,n,q,p,t=c.Vector3.Dot(a[e].position,b)-d,r=c.Vector3.Dot(a[e+1].position,b)-d,s=c.Vector3.Dot(a[e+2].position,b)-d;switch(j=0<t,f=0<r,m=0<s,(j?1:0)+(f?1:0)+(m?1:0)){case 0:h.push(a[e]);h.push(a[e+1]);h.push(a[e+2]);break;case 1:if(j&&(l=a[e+1],n=a[e+2],q=g(a[e],l),p=g(a[e],n)),f){l=a[e];n=a[e+2];q=g(a[e+1],l);p=g(a[e+1],n);h.push(q);h.push(n.clone());h.push(l.clone());h.push(n.clone());h.push(q.clone());h.push(p);break}m&&(l=a[e],n=a[e+1],q=g(a[e+2],l),p=g(a[e+2],n));h.push(l.clone());h.push(n.clone());
h.push(q);h.push(p);h.push(q.clone());h.push(n.clone());break;case 2:j||(l=a[e].clone(),n=g(l,a[e+1]),q=g(l,a[e+2]),h.push(l),h.push(n),h.push(q)),f||(l=a[e+1].clone(),n=g(l,a[e+2]),q=g(l,a[e]),h.push(l),h.push(n),h.push(q)),m||(l=a[e+2].clone(),n=g(l,a[e]),q=g(l,a[e+1]),h.push(l),h.push(n),h.push(q))}}return h},u=0;u<e.length;u+=3){var v=[];if(v.push(t(u)),v.push(t(u+1)),v.push(t(u+2)),v=s(v,new c.Vector3(1,0,0)),v=s(v,new c.Vector3(-1,0,0)),v=s(v,new c.Vector3(0,1,0)),v=s(v,new c.Vector3(0,-1,0)),
v=s(v,new c.Vector3(0,0,1)),v=s(v,new c.Vector3(0,0,-1)),0!==v.length)for(var w=0;w<v.length;w++){var x=v[w];q.indices.push(r);x.position.toArray(q.positions,3*r);x.normal.toArray(q.normals,3*r);q.uvs.push(0.5+x.position.x/k.x);q.uvs.push(0.5+x.position.y/k.y);r++}}a=new c.Mesh(a,b.getScene());return q.applyToMesh(a),a.position=f.clone(),a.rotation=new c.Vector3(l,n,d),a},e._ExtrudeShapeGeneric=function(a,b,d,e,g,h,f,l,k,n,q,p,r,t,s){var u,v,w=function(a,b,d,g,h,e,j,f,k,m){var l=d.getTangents(),n=
d.getNormals(),q=d.getBinormals();d=d.getDistances();var p=0;f=m?f:function(){return e};m=m?j:function(){return h};j=k===c.Mesh.NO_CAP||k===c.Mesh.CAP_END?0:2;for(var t=c.Tmp.Matrix[0],r=0;r<b.length;r++){for(var s=[],u=f(r,d[r]),v=m(r,d[r]),w=0;w<a.length;w++){c.Matrix.RotationAxisToRef(l[r],p,t);var T=l[r].scale(a[w].z).add(n[r].scale(a[w].x)).add(q[r].scale(a[w].y)),S=s[w]?s[w]:c.Vector3.Zero();c.Vector3.TransformCoordinatesToRef(T,t,S);S.scaleInPlace(v).addInPlace(b[r]);s[w]=S}g[j]=s;p+=u;j++}a=
function(a){var b,d=[],g=c.Vector3.Zero();for(b=0;b<a.length;b++)g.addInPlace(a[b]);g.scaleInPlace(1/a.length);for(b=0;b<a.length;b++)d.push(g);return d};switch(k){case c.Mesh.CAP_START:g[0]=a(g[2]);g[1]=g[2].slice(0);break;case c.Mesh.CAP_END:g[j]=g[j-1];g[j+1]=a(g[j-1]);break;case c.Mesh.CAP_ALL:g[0]=a(g[2]),g[1]=g[2].slice(0),g[j]=g[j-1],g[j+1]=a(g[j-1])}return g};if(s)return u=s.path3D.update(d),v=w(b,d,s.path3D,s.pathArray,e,g,h,f,s.cap,q),s=c.Mesh.CreateRibbon(null,v,null,null,null,null,null,
null,s);u=new c.Path3D(d);n=0>n||3<n?0:n;v=w(b,d,u,[],e,g,h,f,n,q);a=c.Mesh.CreateRibbon(a,v,l,k,0,p,r,t);return a.pathArray=v,a.path3D=u,a.cap=n,a},e);c.MeshBuilder=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(e){this.getAlphaFromRGB=this.hasAlpha=!1;this.level=1;this.coordinatesIndex=0;this.coordinatesMode=c.Texture.EXPLICIT_MODE;this.wrapV=this.wrapU=c.Texture.WRAP_ADDRESSMODE;this.anisotropicFilteringLevel=4;this.isRenderTarget=this.isCube=!1;this.animations=[];this.onDisposeObservable=new c.Observable;this.delayLoadState=c.Engine.DELAYLOADSTATE_NONE;this._scene=e;this._scene.textures.push(this)};f=(f.prototype.toString=function(){return this.name},Object.defineProperty(f.prototype,
"onDispose",{set:function(c){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(c)},enumerable:!0,configurable:!0}),f.prototype.getScene=function(){return this._scene},f.prototype.getTextureMatrix=function(){return null},f.prototype.getReflectionTextureMatrix=function(){return null},f.prototype.getInternalTexture=function(){return this._texture},f.prototype.isReady=function(){return this.delayLoadState===c.Engine.DELAYLOADSTATE_NOTLOADED?
!0:this._texture?this._texture.isReady:!1},f.prototype.getSize=function(){return this._texture._width?{width:this._texture._width,height:this._texture._height}:this._texture._size?{width:this._texture._size,height:this._texture._size}:{width:0,height:0}},f.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?{width:this._texture._size,height:this._texture._size}:{width:this._texture._baseWidth,height:this._texture._baseHeight}:{width:0,height:0}},f.prototype.scale=
function(){},Object.defineProperty(f.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),f.prototype._removeFromCache=function(c,a){for(var b=this._scene.getEngine().getLoadedTexturesCache(),d=0;d<b.length;d++){var j=b[d];if(j.url===c&&j.noMipmap===a)return void b.splice(d,1)}},f.prototype._getFromCache=function(c,a,b){for(var d=this._scene.getEngine().getLoadedTexturesCache(),j=0;j<d.length;j++){var g=d[j];if(g.url===c&&g.noMipmap===a&&(!b||b===g.samplingMode))return g.references++,
g}return null},f.prototype.delayLoad=function(){},f.prototype.clone=function(){return null},f.prototype.releaseInternalTexture=function(){this._texture&&(this._scene.getEngine().releaseInternalTexture(this._texture),delete this._texture)},f.prototype.dispose=function(){this.getScene().stopAnimation(this);var c=this._scene.textures.indexOf(this);0<=c&&this._scene.textures.splice(c,1);void 0!==this._texture&&(this.releaseInternalTexture(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear())},
f.prototype.serialize=function(){if(!this.name)return null;var e=c.SerializationHelper.Serialize(this);return c.Animation.AppendSerializedAnimations(this,e),e},__decorate([c.serialize()],f.prototype,"name",void 0),__decorate([c.serialize()],f.prototype,"hasAlpha",void 0),__decorate([c.serialize()],f.prototype,"getAlphaFromRGB",void 0),__decorate([c.serialize()],f.prototype,"level",void 0),__decorate([c.serialize()],f.prototype,"coordinatesIndex",void 0),__decorate([c.serialize()],f.prototype,"coordinatesMode",
void 0),__decorate([c.serialize()],f.prototype,"wrapU",void 0),__decorate([c.serialize()],f.prototype,"wrapV",void 0),__decorate([c.serialize()],f.prototype,"anisotropicFilteringLevel",void 0),__decorate([c.serialize()],f.prototype,"isCube",void 0),__decorate([c.serialize()],f.prototype,"isRenderTarget",void 0),f);c.BaseTexture=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.BaseTexture,a=function(b,d,j,g,h,f,l,k,n){void 0===h&&(h=a.TRILINEAR_SAMPLINGMODE);void 0===f&&(f=null);void 0===l&&(l=null);void 0===k&&(k=null);void 0===n&&(n=!1);e.call(this,d);this.vOffset=this.uOffset=0;this.vScale=this.uScale=1;this.wAng=this.vAng=this.uAng=0;this.url=this.name=b;this._noMipmap=j;this._invertY=g;this._samplingMode=h;this._buffer=k;this._deleteBuffer=n;b&&(this._texture=this._getFromCache(b,j,h),this._texture?c.Tools.SetImmediate(function(){f&&f()}):d.useDelayedTextureLoading?
(this.delayLoadState=c.Engine.DELAYLOADSTATE_NOTLOADED,this._delayedOnLoad=f,this._delayedOnError=l):(this._texture=d.getEngine().createTexture(b,j,g,d,this._samplingMode,f,l,this._buffer),n&&delete this._buffer))};f=(__extends(a,e),Object.defineProperty(a.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),a.prototype.delayLoad=function(){this.delayLoadState===c.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=c.Engine.DELAYLOADSTATE_LOADED,this._texture=
this._getFromCache(this.url,this._noMipmap,this._samplingMode),this._texture||(this._texture=this.getScene().getEngine().createTexture(this.url,this._noMipmap,this._invertY,this.getScene(),this._samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer),this._deleteBuffer&&delete this._buffer))},a.prototype.updateSamplingMode=function(a){this._texture&&(this._samplingMode=a,this.getScene().getEngine().updateTextureSamplingMode(a,this._texture))},a.prototype._prepareRowForTextureGeneration=
function(a,d,e,g){a*=this.uScale;d*=this.vScale;a-=0.5*this.uScale;d-=0.5*this.vScale;c.Vector3.TransformCoordinatesFromFloatsToRef(a,d,e-0.5,this._rowGenerationMatrix,g);g.x+=0.5*this.uScale+this.uOffset;g.y+=0.5*this.vScale+this.vOffset;g.z+=0.5},a.prototype.getTextureMatrix=function(){return this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===
this._cachedWAng?this._cachedTextureMatrix:(this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=c.Matrix.Zero(),this._rowGenerationMatrix=new c.Matrix,this._t0=c.Vector3.Zero(),this._t1=c.Vector3.Zero(),this._t2=c.Vector3.Zero()),c.Matrix.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,
this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),c.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix.m[0]=this._t1.x,this._cachedTextureMatrix.m[1]=this._t1.y,this._cachedTextureMatrix.m[2]=this._t1.z,this._cachedTextureMatrix.m[4]=this._t2.x,this._cachedTextureMatrix.m[5]=
this._t2.y,this._cachedTextureMatrix.m[6]=this._t2.z,this._cachedTextureMatrix.m[8]=this._t0.x,this._cachedTextureMatrix.m[9]=this._t0.y,this._cachedTextureMatrix.m[10]=this._t0.z,this._cachedTextureMatrix)},a.prototype.getReflectionTextureMatrix=function(){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode)return this._cachedTextureMatrix;switch(this._cachedTextureMatrix||
(this._cachedTextureMatrix=c.Matrix.Zero(),this._projectionModeMatrix=c.Matrix.Zero()),this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case a.PLANAR_MODE:c.Matrix.IdentityToRef(this._cachedTextureMatrix);this._cachedTextureMatrix[0]=this.uScale;this._cachedTextureMatrix[5]=this.vScale;this._cachedTextureMatrix[12]=this.uOffset;this._cachedTextureMatrix[13]=this.vOffset;break;case a.PROJECTION_MODE:c.Matrix.IdentityToRef(this._projectionModeMatrix);this._projectionModeMatrix.m[0]=
0.5;this._projectionModeMatrix.m[5]=-0.5;this._projectionModeMatrix.m[10]=0;this._projectionModeMatrix.m[12]=0.5;this._projectionModeMatrix.m[13]=0.5;this._projectionModeMatrix.m[14]=1;this._projectionModeMatrix.m[15]=1;this.getScene().getProjectionMatrix().multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:c.Matrix.IdentityToRef(this._cachedTextureMatrix)}return this._cachedTextureMatrix},a.prototype.clone=function(){var b=this;return c.SerializationHelper.Clone(function(){return new a(b._texture.url,
b.getScene(),b._noMipmap,b._invertY,b._samplingMode)},this)},a.CreateFromBase64String=function(b,c,e,g,h,f,l,k){return void 0===f&&(f=a.TRILINEAR_SAMPLINGMODE),void 0===l&&(l=null),void 0===k&&(k=null),new a("data:"+c,e,g,h,f,l,k,b)},a.Parse=function(b,d,e){if(b.isCube)return c.CubeTexture.Parse(b,d,e);if(!b.name&&!b.isRenderTarget)return null;var g=c.SerializationHelper.Parse(function(){if(b.mirrorPlane){var g=new c.MirrorTexture(b.name,b.renderTargetSize,d);return g._waitingRenderList=b.renderList,
g.mirrorPlane=c.Plane.FromArray(b.mirrorPlane),g}return b.isRenderTarget?(g=new c.RenderTargetTexture(b.name,b.renderTargetSize,d),g._waitingRenderList=b.renderList,g):b.base64String?a.CreateFromBase64String(b.base64String,b.name,d):new a(e+b.name,d)},b,d);if(b.animations)for(var h=0;h<b.animations.length;h++)g.animations.push(c.Animation.Parse(b.animations[h]));return g},a.NEAREST_SAMPLINGMODE=1,a.BILINEAR_SAMPLINGMODE=2,a.TRILINEAR_SAMPLINGMODE=3,a.EXPLICIT_MODE=0,a.SPHERICAL_MODE=1,a.PLANAR_MODE=
2,a.CUBIC_MODE=3,a.PROJECTION_MODE=4,a.SKYBOX_MODE=5,a.INVCUBIC_MODE=6,a.EQUIRECTANGULAR_MODE=7,a.FIXED_EQUIRECTANGULAR_MODE=8,a.CLAMP_ADDRESSMODE=0,a.WRAP_ADDRESSMODE=1,a.MIRROR_ADDRESSMODE=2,__decorate([c.serialize()],a.prototype,"url",void 0),__decorate([c.serialize()],a.prototype,"uOffset",void 0),__decorate([c.serialize()],a.prototype,"vOffset",void 0),__decorate([c.serialize()],a.prototype,"uScale",void 0),__decorate([c.serialize()],a.prototype,"vScale",void 0),__decorate([c.serialize()],a.prototype,
"uAng",void 0),__decorate([c.serialize()],a.prototype,"vAng",void 0),__decorate([c.serialize()],a.prototype,"wAng",void 0),a);c.Texture=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.BaseTexture,a=function(a,d,j,g,h){if(e.call(this,d),this.coordinatesMode=c.Texture.CUBIC_MODE,this.name=a,this.url=a,this._noMipmap=g,this.hasAlpha=!1,a||h){if(this._texture=this._getFromCache(a,g),!h){j||(j="_px.jpg _py.jpg _pz.jpg _nx.jpg _ny.jpg _nz.jpg".split(" "));h=[];for(var f=0;f<j.length;f++)h.push(a+j[f]);this._extensions=j}this._files=h;this._texture||(d.useDelayedTextureLoading?this.delayLoadState=c.Engine.DELAYLOADSTATE_NOTLOADED:this._texture=d.getEngine().createCubeTexture(a,
d,h,g));this.isCube=!0;this._textureMatrix=c.Matrix.Identity()}};f=(__extends(a,e),a.CreateFromImages=function(b,c,e){return new a("",c,null,e,b)},a.prototype.delayLoad=function(){this.delayLoadState===c.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=c.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._texture=this.getScene().getEngine().createCubeTexture(this.url,this.getScene(),this._extensions)))},a.prototype.getReflectionTextureMatrix=
function(){return this._textureMatrix},a.Parse=function(a,d,e){var g=c.SerializationHelper.Parse(function(){return new c.CubeTexture(e+a.name,d,a.extensions)},a,d);if(a.animations)for(var h=0;h<a.animations.length;h++)g.animations.push(c.Animation.Parse(a.animations[h]));return g},a.prototype.clone=function(){var b=this;return c.SerializationHelper.Clone(function(){return new a(b.url,b.getScene(),b._extensions,b._noMipmap,b._files)},this)},a);c.CubeTexture=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Texture,a=function(a,d,j,g,h,f,l,k){void 0===h&&(h=!0);void 0===f&&(f=c.Engine.TEXTURETYPE_UNSIGNED_INT);void 0===l&&(l=!1);void 0===k&&(k=c.Texture.TRILINEAR_SAMPLINGMODE);e.call(this,null,j,!g);this.isCube=l;this.renderList=[];this.renderParticles=!0;this.renderSprites=!1;this.coordinatesMode=c.Texture.PROJECTION_MODE;this.onAfterUnbindObservable=new c.Observable;this.onBeforeRenderObservable=new c.Observable;this.onAfterRenderObservable=new c.Observable;this.onClearObservable=
new c.Observable;this._currentRefreshId=-1;this._refreshRate=1;this.name=a;this.isRenderTarget=!0;this._size=d;this._generateMipMaps=g;this._doNotChangeAspectRatio=h;k===c.Texture.NEAREST_SAMPLINGMODE&&(this.wrapU=c.Texture.CLAMP_ADDRESSMODE,this.wrapV=c.Texture.CLAMP_ADDRESSMODE);l?(this._texture=j.getEngine().createRenderTargetCubeTexture(d,{generateMipMaps:g,samplingMode:k}),this.coordinatesMode=c.Texture.INVCUBIC_MODE,this._textureMatrix=c.Matrix.Identity()):this._texture=j.getEngine().createRenderTargetTexture(d,
{generateMipMaps:g,type:f,samplingMode:k});this._renderingManager=new c.RenderingManager(j)};f=(__extends(a,e),Object.defineProperty(a,"REFRESHRATE_RENDER_ONCE",{get:function(){return a._REFRESHRATE_RENDER_ONCE},enumerable:!0,configurable:!0}),Object.defineProperty(a,"REFRESHRATE_RENDER_ONEVERYFRAME",{get:function(){return a._REFRESHRATE_RENDER_ONEVERYFRAME},enumerable:!0,configurable:!0}),Object.defineProperty(a,"REFRESHRATE_RENDER_ONEVERYTWOFRAMES",{get:function(){return a._REFRESHRATE_RENDER_ONEVERYTWOFRAMES},
enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onAfterUnbind",{set:function(a){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver);this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onBeforeRender",{set:function(a){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver);this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(a)},
enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onAfterRender",{set:function(a){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver);this._onAfterRenderObserver=this.onAfterRenderObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onClear",{set:function(a){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver);this._onClearObserver=this.onClearObservable.add(a)},enumerable:!0,configurable:!0}),
a.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(a.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(a){this._refreshRate=a;this.resetRefreshCounter()},enumerable:!0,configurable:!0}),a.prototype._shouldRender=function(){return-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},a.prototype.isReady=function(){return this.getScene().renderTargetsEnabled?
e.prototype.isReady.call(this):!1},a.prototype.getRenderSize=function(){return this._size},Object.defineProperty(a.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),a.prototype.scale=function(a){this.resize(this._size*a,this._generateMipMaps)},a.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:e.prototype.getReflectionTextureMatrix.call(this)},a.prototype.resize=function(a,c){this.releaseInternalTexture();this.isCube?this._texture=
this.getScene().getEngine().createRenderTargetCubeTexture(a):this._texture=this.getScene().getEngine().createRenderTargetTexture(a,c)},a.prototype.render=function(a,c){var e=this.getScene();if(void 0!==this.useCameraPostProcesses&&(a=this.useCameraPostProcesses),this.activeCamera&&this.activeCamera!==e.activeCamera&&e.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0)),this._waitingRenderList){this.renderList=[];for(var g=0;g<this._waitingRenderList.length;g++)this.renderList.push(e.getMeshByID(this._waitingRenderList[g]));
delete this._waitingRenderList}if(this.renderListPredicate){this.renderList.splice(0);for(var h=this.getScene().meshes,g=0;g<h.length;g++){var f=h[g];this.renderListPredicate(f)&&this.renderList.push(f)}}if(!this.renderList||0!==this.renderList.length){this._renderingManager.reset();for(var g=this.renderList?this.renderList:e.getActiveMeshes().data,h=e.getRenderId(),l=0;l<g.length;l++)if(f=g[l])if(f.isReady()){if(f._preActivateForIntermediateRendering(h),f.isEnabled()&&f.isVisible&&f.subMeshes&&0!==
(f.layerMask&e.activeCamera.layerMask)){f._activate(h);for(var k=0;k<f.subMeshes.length;k++){var n=f.subMeshes[k];e._activeIndices+=n.indexCount;this._renderingManager.dispatch(n)}}}else this.resetRefreshCounter();if(this.isCube)for(f=0;6>f;f++)this.renderToTarget(f,g,a,c),e.incrementRenderId(),e.resetCachedMaterial();else this.renderToTarget(0,g,a,c);this.onAfterUnbindObservable.notifyObservers(this);this.activeCamera&&this.activeCamera!==e.activeCamera&&e.setTransformMatrix(e.activeCamera.getViewMatrix(),
e.activeCamera.getProjectionMatrix(!0));e.resetCachedMaterial()}},a.prototype.renderToTarget=function(a,d,e,g){var h=this.getScene(),f=h.getEngine();e&&h.postProcessManager._prepareFrame(this._texture)||(this.isCube?f.bindFramebuffer(this._texture,a):f.bindFramebuffer(this._texture));this.onBeforeRenderObservable.notifyObservers(a);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(f):f.clear(h.clearColor,!0,!0);this._doNotChangeAspectRatio||h.updateTransformMatrix(!0);this._renderingManager.render(this.customRenderFunction,
d,this.renderParticles,this.renderSprites);e&&h.postProcessManager._finalizeFrame(!1,this._texture,a);this._doNotChangeAspectRatio||h.updateTransformMatrix(!0);this.onAfterRenderObservable.notifyObservers(a);g&&c.Tools.DumpFramebuffer(this._size,this._size,f);this.isCube&&5!==a||(this.isCube&&5===a&&f.generateMipMapsForCubemap(this._texture),f.unBindFramebuffer(this._texture,this.isCube))},a.prototype.clone=function(){var b=this.getSize(),b=new a(this.name,b.width,this.getScene(),this._generateMipMaps);
return b.hasAlpha=this.hasAlpha,b.level=this.level,b.coordinatesMode=this.coordinatesMode,b.renderList=this.renderList.slice(0),b},a.prototype.serialize=function(){if(!this.name)return null;var a=e.prototype.serialize.call(this);a.renderTargetSize=this.getRenderSize();a.renderList=[];for(var c=0;c<this.renderList.length;c++)a.renderList.push(this.renderList[c].id);return a},a._REFRESHRATE_RENDER_ONCE=0,a._REFRESHRATE_RENDER_ONEVERYFRAME=1,a._REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,a);c.RenderTargetTexture=
f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Texture,a=function(a,d,j,g,h,f,l){void 0===f&&(f=!0);void 0===l&&(l=!1);e.call(this,null,g,!f);this.isCube=l;this.isEnabled=!0;this._currentRefreshId=-1;this._refreshRate=1;this._vertexBuffers={};this._uniforms=[];this._samplers=[];this._textures=[];this._floats=[];this._floatsArrays={};this._colors3=[];this._colors4=[];this._vectors2=[];this._vectors3=[];this._matrices=[];this._fallbackTextureUsed=!1;g._proceduralTextures.push(this);this.name=a;this.isRenderTarget=!0;this._size=
d;this._generateMipMaps=f;this.setFragment(j);this._fallbackTexture=h;a=g.getEngine();l?(this._texture=a.createRenderTargetCubeTexture(d,{generateMipMaps:f}),this.setFloat("face",0)):this._texture=a.createRenderTargetTexture(d,f);d=[];d.push(1,1);d.push(-1,1);d.push(-1,-1);d.push(1,-1);this._vertexBuffers[c.VertexBuffer.PositionKind]=new c.VertexBuffer(a,d,c.VertexBuffer.PositionKind,!1,!1,2);d=[];d.push(0);d.push(1);d.push(2);d.push(0);d.push(2);d.push(3);this._indexBuffer=a.createIndexBuffer(d)};
f=(__extends(a,e),a.prototype.reset=function(){void 0!==this._effect&&this.getScene().getEngine()._releaseEffect(this._effect)},a.prototype.isReady=function(){var a,d=this,e=this.getScene().getEngine();return this._fragment?this._fallbackTextureUsed?!0:(a=void 0!==this._fragment.fragmentElement?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._effect=e.createEffect(a,[c.VertexBuffer.PositionKind],this._uniforms,this._samplers,
"",null,null,function(){d.releaseInternalTexture();d._fallbackTexture&&(d._texture=d._fallbackTexture._texture,d._texture.references++);d._fallbackTextureUsed=!0}),this._effect.isReady()):!1},a.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},a.prototype.setFragment=function(a){this._fragment=a},Object.defineProperty(a.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(a){this._refreshRate=a;this.resetRefreshCounter()},enumerable:!0,configurable:!0}),
a.prototype._shouldRender=function(){return this.isEnabled&&this.isReady()&&this._texture?this._fallbackTextureUsed?!1:-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1):!1},a.prototype.getRenderSize=function(){return this._size},a.prototype.resize=function(a,c){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this.getScene().getEngine().createRenderTargetTexture(a,c))},
a.prototype._checkUniform=function(a){-1===this._uniforms.indexOf(a)&&this._uniforms.push(a)},a.prototype.setTexture=function(a,c){return-1===this._samplers.indexOf(a)&&this._samplers.push(a),this._textures[a]=c,this},a.prototype.setFloat=function(a,c){return this._checkUniform(a),this._floats[a]=c,this},a.prototype.setFloats=function(a,c){return this._checkUniform(a),this._floatsArrays[a]=c,this},a.prototype.setColor3=function(a,c){return this._checkUniform(a),this._colors3[a]=c,this},a.prototype.setColor4=
function(a,c){return this._checkUniform(a),this._colors4[a]=c,this},a.prototype.setVector2=function(a,c){return this._checkUniform(a),this._vectors2[a]=c,this},a.prototype.setVector3=function(a,c){return this._checkUniform(a),this._vectors3[a]=c,this},a.prototype.setMatrix=function(a,c){return this._checkUniform(a),this._matrices[a]=c,this},a.prototype.render=function(){var a=this.getScene(),c=a.getEngine();c.enableEffect(this._effect);c.setState(!1);for(var e in this._textures)this._effect.setTexture(e,
this._textures[e]);for(e in this._floats)this._effect.setFloat(e,this._floats[e]);for(e in this._floatsArrays)this._effect.setArray(e,this._floatsArrays[e]);for(e in this._colors3)this._effect.setColor3(e,this._colors3[e]);for(e in this._colors4){var g=this._colors4[e];this._effect.setFloat4(e,g.r,g.g,g.b,g.a)}for(e in this._vectors2)this._effect.setVector2(e,this._vectors2[e]);for(e in this._vectors3)this._effect.setVector3(e,this._vectors3[e]);for(e in this._matrices)this._effect.setMatrix(e,this._matrices[e]);
if(c.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this.isCube)for(e=0;6>e;e++)c.bindFramebuffer(this._texture,e),this._effect.setFloat("face",e),c.clear(a.clearColor,!0,!0),c.draw(!0,0,6),5===e&&c.generateMipMapsForCubemap(this._texture);else c.bindFramebuffer(this._texture),c.clear(a.clearColor,!0,!0),c.draw(!0,0,6);c.unBindFramebuffer(this._texture,this.isCube);this.onGenerated&&this.onGenerated()},a.prototype.clone=function(){var b=this.getSize(),b=new a(this.name,b.width,this._fragment,
this.getScene(),this._fallbackTexture,this._generateMipMaps);return b.hasAlpha=this.hasAlpha,b.level=this.level,b.coordinatesMode=this.coordinatesMode,b},a.prototype.dispose=function(){var a=this.getScene()._proceduralTextures.indexOf(this);0<=a&&this.getScene()._proceduralTextures.splice(a,1);(a=this._vertexBuffers[c.VertexBuffer.PositionKind])&&(a.dispose(),this._vertexBuffers[c.VertexBuffer.PositionKind]=null);this._indexBuffer&&this.getScene().getEngine()._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=
null);e.prototype.dispose.call(this)},a);c.ProceduralTexture=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.RenderTargetTexture,a=function(a,d,j,g){var h=this;e.call(this,a,d,j,g,!0);this.mirrorPlane=new c.Plane(0,1,0,1);this._transformMatrix=c.Matrix.Zero();this._mirrorMatrix=c.Matrix.Zero();this.onBeforeRenderObservable.add(function(){c.Matrix.ReflectionToRef(h.mirrorPlane,h._mirrorMatrix);h._savedViewMatrix=j.getViewMatrix();h._mirrorMatrix.multiplyToRef(h._savedViewMatrix,h._transformMatrix);j.setTransformMatrix(h._transformMatrix,j.getProjectionMatrix());j.clipPlane=h.mirrorPlane;
j.getEngine().cullBackFaces=!1;j._mirroredCameraPosition=c.Vector3.TransformCoordinates(j.activeCamera.position,h._mirrorMatrix)});this.onAfterRenderObservable.add(function(){j.setTransformMatrix(h._savedViewMatrix,j.getProjectionMatrix());j.getEngine().cullBackFaces=!0;j._mirroredCameraPosition=null;delete j.clipPlane})};f=(__extends(a,e),a.prototype.clone=function(){var b=this.getSize(),b=new a(this.name,b.width,this.getScene(),this._generateMipMaps);return b.hasAlpha=this.hasAlpha,b.level=this.level,
b.mirrorPlane=this.mirrorPlane.clone(),b.renderList=this.renderList.slice(0),b},a.prototype.serialize=function(){if(!this.name)return null;var a=e.prototype.serialize.call(this);return a.mirrorPlane=this.mirrorPlane.asArray(),a},a);c.MirrorTexture=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.RenderTargetTexture,a=function(a,d,j,g){var h=this;e.call(this,a,d,j,g,!0);this.refractionPlane=new c.Plane(0,1,0,1);this.depth=2;this.onBeforeRenderObservable.add(function(){j.clipPlane=h.refractionPlane});this.onAfterRenderObservable.add(function(){delete j.clipPlane})};f=(__extends(a,e),a.prototype.clone=function(){var b=this.getSize(),b=new a(this.name,b.width,this.getScene(),this._generateMipMaps);return b.hasAlpha=this.hasAlpha,b.level=this.level,b.refractionPlane=this.refractionPlane.clone(),
b.renderList=this.renderList.slice(0),b.depth=this.depth,b},a.prototype.serialize=function(){if(!this.name)return null;var a=e.prototype.serialize.call(this);return a.mirrorPlane=this.refractionPlane.asArray(),a.depth=this.depth,a},a);c.RefractionTexture=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Texture,a=function(a,d,j,g,h){void 0===h&&(h=c.Texture.TRILINEAR_SAMPLINGMODE);e.call(this,null,j,!g);this.name=a;this.wrapV=this.wrapU=c.Texture.CLAMP_ADDRESSMODE;this._generateMipMaps=g;d.getContext?(this._canvas=d,this._texture=j.getEngine().createDynamicTexture(d.width,d.height,g,h)):(this._canvas=document.createElement("canvas"),d.width?this._texture=j.getEngine().createDynamicTexture(d.width,d.height,g,h):this._texture=j.getEngine().createDynamicTexture(d,d,g,h));a=this.getSize();
this._canvas.width=a.width;this._canvas.height=a.height;this._context=this._canvas.getContext("2d")};f=(__extends(a,e),Object.defineProperty(a.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),a.prototype.scale=function(a){var c=this.getSize();c.width*=a;c.height*=a;this._canvas.width=c.width;this._canvas.height=c.height;this.releaseInternalTexture();this._texture=this.getScene().getEngine().createDynamicTexture(c.width,c.height,this._generateMipMaps,this._samplingMode)},
a.prototype.getContext=function(){return this._context},a.prototype.clear=function(){var a=this.getSize();this._context.fillRect(0,0,a.width,a.height)},a.prototype.update=function(a){this.getScene().getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===a?!0:a)},a.prototype.drawText=function(a,c,e,g,h,f,l,k){void 0===k&&(k=!0);var n=this.getSize();if(f&&(this._context.fillStyle=f,this._context.fillRect(0,0,n.width,n.height)),this._context.font=g,null===c)c=this._context.measureText(a),
c=(n.width-c.width)/2;this._context.fillStyle=h;this._context.fillText(a,c,e);k&&this.update(l)},a.prototype.clone=function(){var b=this.getSize(),b=new a(this.name,b,this.getScene(),this._generateMipMaps);return b.hasAlpha=this.hasAlpha,b.level=this.level,b.wrapU=this.wrapU,b.wrapV=this.wrapV,b},a);c.DynamicTexture=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Texture;f=function(a,b,d,j,g,h){var f=this;void 0===j&&(j=!1);void 0===g&&(g=!1);void 0===h&&(h=c.Texture.TRILINEAR_SAMPLINGMODE);e.call(this,null,d,!j,g);this._autoLaunch=!0;var l;this.name=a;b instanceof HTMLVideoElement?this.video=b:(l=b,this.video=document.createElement("video"),this.video.autoplay=!1,this.video.loop=!0);this._generateMipMaps=j;this._samplingMode=h;c.Tools.IsExponentOfTwo(this.video.videoWidth)&&c.Tools.IsExponentOfTwo(this.video.videoHeight)?(this.wrapU=
c.Texture.WRAP_ADDRESSMODE,this.wrapV=c.Texture.WRAP_ADDRESSMODE):(this.wrapU=c.Texture.CLAMP_ADDRESSMODE,this.wrapV=c.Texture.CLAMP_ADDRESSMODE,this._generateMipMaps=!1);l?(this.video.addEventListener("canplaythrough",function(){f._createTexture()}),l.forEach(function(a){var b=document.createElement("source");b.src=a;f.video.appendChild(b)})):this._createTexture();this._lastUpdate=c.Tools.Now};f=(__extends(f,e),f.prototype._createTexture=function(){this._texture=this.getScene().getEngine().createDynamicTexture(this.video.videoWidth,
this.video.videoHeight,this._generateMipMaps,this._samplingMode);this._texture.isReady=!0},f.prototype.update=function(){this._autoLaunch&&(this._autoLaunch=!1,this.video.play());var a=c.Tools.Now;return 15>a-this._lastUpdate||this.video.readyState!==this.video.HAVE_ENOUGH_DATA?!1:(this._lastUpdate=a,this.getScene().getEngine().updateVideoTexture(this._texture,this.video,this._invertY),!0)},f);c.VideoTexture=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.ProceduralTexture;f=function(a,b,c,j,g,h){e.call(this,a,c,null,j,g,h);this._animate=!0;this._time=0;this._texturePath=b;this.loadJson(b);this.refreshRate=1};f=(__extends(f,e),f.prototype.loadJson=function(a){function b(){c.Tools.Log("No config file found in "+a+" trying to use ShadersStore or DOM element");try{e.setFragment(e._texturePath)}catch(b){c.Tools.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture")}}var d=this,e=this,g=new XMLHttpRequest;
g.open("GET",a+"/config.json",!0);g.addEventListener("load",function(){if(200===g.status||c.Tools.ValidateXHRData(g,1))try{d._config=JSON.parse(g.response),d.updateShaderUniforms(),d.updateTextures(),d.setFragment(d._texturePath+"/custom"),d._animate=d._config.animate,d.refreshRate=d._config.refreshrate}catch(a){b()}else b()},!1);g.addEventListener("error",function(){b()},!1);try{g.send()}catch(h){c.Tools.Error("CustomProceduralTexture: Error on XHR send request.")}},f.prototype.isReady=function(){if(!e.prototype.isReady.call(this))return!1;
for(var a in this._textures)if(!this._textures[a].isReady())return!1;return!0},f.prototype.render=function(a){this._animate&&(this._time+=0.03*this.getScene().getAnimationRatio(),this.updateShaderUniforms());e.prototype.render.call(this,a)},f.prototype.updateTextures=function(){for(var a=0;a<this._config.sampler2Ds.length;a++)this.setTexture(this._config.sampler2Ds[a].sample2Dname,new c.Texture(this._texturePath+"/"+this._config.sampler2Ds[a].textureRelativeUrl,this.getScene()))},f.prototype.updateShaderUniforms=
function(){if(this._config)for(var a=0;a<this._config.uniforms.length;a++){var b=this._config.uniforms[a];switch(b.type){case "float":this.setFloat(b.name,b.value);break;case "color3":this.setColor3(b.name,new c.Color3(b.r,b.g,b.b));break;case "color4":this.setColor4(b.name,new c.Color4(b.r,b.g,b.b,b.a));break;case "vector2":this.setVector2(b.name,new c.Vector2(b.x,b.y));break;case "vector3":this.setVector3(b.name,new c.Vector3(b.x,b.y,b.z))}}this.setFloat("time",this._time)},Object.defineProperty(f.prototype,
"animate",{get:function(){return this._animate},set:function(a){this._animate=a},enumerable:!0,configurable:!0}),f);c.CustomProceduralTexture=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){this._defines={};this._currentRank=32;this._maxRank=-1};f=(f.prototype.addFallback=function(a,b){this._defines[a]||(a<this._currentRank&&(this._currentRank=a),a>this._maxRank&&(this._maxRank=a),this._defines[a]=[]);this._defines[a].push(b)},f.prototype.addCPUSkinningFallback=function(a,b){this._meshRank=a;this._mesh=b;a>this._maxRank&&(this._maxRank=a)},Object.defineProperty(f.prototype,"isMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!0,
configurable:!0}),f.prototype.reduce=function(a){for(var b=this._defines[this._currentRank],d=0;d<b.length;d++)a=a.replace("#define "+b[d],"");return this._mesh&&this._currentRank===this._meshRank&&(this._mesh.computeBonesUsingShaders=!1,a=a.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),c.Tools.Log("Falling back to CPU skinning for "+this._mesh.name)),this._currentRank++,a},f);c.EffectFallbacks=f;var e=function(a,b,c,e,g,h,f,l,k,n){var q=this;
this._isReady=!1;this._compilationError="";this._valueCache=[];this._engine=g;this.name=a;this.defines=h;this._uniformsNames=c.concat(e);this._samplers=e;this._attributesNames=b;this.onError=k;this.onCompiled=l;this._indexParameters=n;var p,r;a.vertexElement?(p=document.getElementById(a.vertexElement),p||(p=a.vertexElement)):p=a.vertex||a;a.fragmentElement?(r=document.getElementById(a.fragmentElement),r||(r=a.fragmentElement)):r=a.fragment||a;this._loadVertexShader(p,function(a){q._processIncludes(a,
function(a){q._loadFragmentShader(r,function(c){q._processIncludes(c,function(c){q._prepareEffect(a,c,b,h,f)})})})})};f=(e.prototype.isReady=function(){return this._isReady},e.prototype.getProgram=function(){return this._program},e.prototype.getAttributesNames=function(){return this._attributesNames},e.prototype.getAttributeLocation=function(a){return this._attributes[a]},e.prototype.getAttributeLocationByName=function(a){a=this._attributesNames.indexOf(a);return this._attributes[a]},e.prototype.getAttributesCount=
function(){return this._attributes.length},e.prototype.getUniformIndex=function(a){return this._uniformsNames.indexOf(a)},e.prototype.getUniform=function(a){return this._uniforms[this._uniformsNames.indexOf(a)]},e.prototype.getSamplers=function(){return this._samplers},e.prototype.getCompilationError=function(){return this._compilationError},e.prototype._loadVertexShader=function(a,b){if(a instanceof HTMLElement){var d=c.Tools.GetDOMTextContent(a);return void b(d)}if(e.ShadersStore[a+"VertexShader"])return void b(e.ShadersStore[a+
"VertexShader"]);d="."===a[0]||"/"===a[0]||-1<a.indexOf("http")?a:c.Engine.ShadersRepository+a;c.Tools.LoadFile(d+".vertex.fx",b)},e.prototype._loadFragmentShader=function(a,b){if(a instanceof HTMLElement){var d=c.Tools.GetDOMTextContent(a);return void b(d)}if(e.ShadersStore[a+"PixelShader"])return void b(e.ShadersStore[a+"PixelShader"]);if(e.ShadersStore[a+"FragmentShader"])return void b(e.ShadersStore[a+"FragmentShader"]);d="."===a[0]||"/"===a[0]||-1<a.indexOf("http")?a:c.Engine.ShadersRepository+
a;c.Tools.LoadFile(d+".fragment.fx",b)},e.prototype._dumpShadersName=function(){this.name.vertexElement?(c.Tools.Error("Vertex shader:"+this.name.vertexElement),c.Tools.Error("Fragment shader:"+this.name.fragmentElement)):this.name.vertex?(c.Tools.Error("Vertex shader:"+this.name.vertex),c.Tools.Error("Fragment shader:"+this.name.fragment)):(c.Tools.Error("Vertex shader:"+this.name),c.Tools.Error("Fragment shader:"+this.name))},e.prototype._processIncludes=function(a,b){for(var d=this,j=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,
g=j.exec(a),h=new String(a);null!=g;){var f=g[1];if(!e.IncludesShadersStore[f])return void c.Tools.LoadFile(c.Engine.ShadersRepository+"ShadersInclude/"+f+".fx",function(a){e.IncludesShadersStore[f]=a;d._processIncludes(h,b)});var l=e.IncludesShadersStore[f];if(g[2])for(var k=g[3].split(","),n=0;n<k.length;n+=2)l=l.replace(RegExp(k[n],"g"),k[n+1]);if(g[4])if(k=g[5],-1!==k.indexOf("..")){var q=k.split(".."),p=parseInt(q[0]),k=parseInt(q[1]),n=l.slice(0),l="";isNaN(k)&&(k=this._indexParameters[q[1]]);
for(q=p;k>=q;q++)l+=n.replace(/\{X\}/g,q)+"\n"}else l=l.replace(/\{X\}/g,k);h=h.replace(g[0],l);g=j.exec(a)}b(h)},e.prototype._processPrecision=function(a){return-1===a.indexOf("precision highp float")?a=this._engine.getCaps().highPrecisionShaderSupported?"precision highp float;\n"+a:"precision mediump float;\n"+a:this._engine.getCaps().highPrecisionShaderSupported||(a=a.replace("precision highp float","precision mediump float")),a},e.prototype._prepareEffect=function(a,b,d,e,g){try{var h=this._engine;
a=this._processPrecision(a);b=this._processPrecision(b);this._program=h.createShaderProgram(a,b,e);this._uniforms=h.getUniforms(this._program,this._uniformsNames);this._attributes=h.getAttributes(this._program,d);for(var f=0;f<this._samplers.length;f++)null==this.getUniform(this._samplers[f])&&(this._samplers.splice(f,1),f--);h.bindSamplers(this);this._isReady=!0;this.onCompiled&&this.onCompiled(this)}catch(l){if(-1!==l.message.indexOf("highp"))return a=a.replace("precision highp float","precision mediump float"),
b=b.replace("precision highp float","precision mediump float"),void this._prepareEffect(a,b,d,e,g);g&&g.isMoreFallbacks?(c.Tools.Error("Unable to compile effect with current defines. Trying next fallback."),this._dumpShadersName(),e=g.reduce(e),this._prepareEffect(a,b,d,e,g)):(c.Tools.Error("Unable to compile effect: "),this._dumpShadersName(),c.Tools.Error("Defines: "+e),c.Tools.Error("Error: "+l.message),this._compilationError=l.message,this.onError&&this.onError(this,this._compilationError))}},
Object.defineProperty(e.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!0,configurable:!0}),e.prototype._bindTexture=function(a,b){this._engine._bindTexture(this._samplers.indexOf(a),b)},e.prototype.setTexture=function(a,b){this._engine.setTexture(this._samplers.indexOf(a),b)},e.prototype.setTextureFromPostProcess=function(a,b){this._engine.setTextureFromPostProcess(this._samplers.indexOf(a),b)},e.prototype._cacheMatrix=function(a,b){this._valueCache[a]||(this._valueCache[a]=
new c.Matrix);for(var d=0;16>d;d++)this._valueCache[a].m[d]=b.m[d]},e.prototype._cacheFloat2=function(a,b,c){return this._valueCache[a]?(this._valueCache[a][0]=b,void(this._valueCache[a][1]=c)):void(this._valueCache[a]=[b,c])},e.prototype._cacheFloat3=function(a,b,c,e){return this._valueCache[a]?(this._valueCache[a][0]=b,this._valueCache[a][1]=c,void(this._valueCache[a][2]=e)):void(this._valueCache[a]=[b,c,e])},e.prototype._cacheFloat4=function(a,b,c,e,g){return this._valueCache[a]?(this._valueCache[a][0]=
b,this._valueCache[a][1]=c,this._valueCache[a][2]=e,void(this._valueCache[a][3]=g)):void(this._valueCache[a]=[b,c,e,g])},e.prototype.setArray=function(a,b){return this._engine.setArray(this.getUniform(a),b),this},e.prototype.setArray2=function(a,b){return this._engine.setArray2(this.getUniform(a),b),this},e.prototype.setArray3=function(a,b){return this._engine.setArray3(this.getUniform(a),b),this},e.prototype.setArray4=function(a,b){return this._engine.setArray4(this.getUniform(a),b),this},e.prototype.setMatrices=
function(a,b){return this._engine.setMatrices(this.getUniform(a),b),this},e.prototype.setMatrix=function(a,b){return this._engine.setMatrix(this.getUniform(a),b),this},e.prototype.setMatrix3x3=function(a,b){return this._engine.setMatrix3x3(this.getUniform(a),b),this},e.prototype.setMatrix2x2=function(a,b){return this._engine.setMatrix2x2(this.getUniform(a),b),this},e.prototype.setFloat=function(a,b){return this._valueCache[a]&&this._valueCache[a]===b?this:(this._valueCache[a]=b,this._engine.setFloat(this.getUniform(a),
b),this)},e.prototype.setBool=function(a,b){return this._valueCache[a]&&this._valueCache[a]===b?this:(this._valueCache[a]=b,this._engine.setBool(this.getUniform(a),b?1:0),this)},e.prototype.setVector2=function(a,b){return this._valueCache[a]&&this._valueCache[a][0]===b.x&&this._valueCache[a][1]===b.y?this:(this._cacheFloat2(a,b.x,b.y),this._engine.setFloat2(this.getUniform(a),b.x,b.y),this)},e.prototype.setFloat2=function(a,b,c){return this._valueCache[a]&&this._valueCache[a][0]===b&&this._valueCache[a][1]===
c?this:(this._cacheFloat2(a,b,c),this._engine.setFloat2(this.getUniform(a),b,c),this)},e.prototype.setVector3=function(a,b){return this._valueCache[a]&&this._valueCache[a][0]===b.x&&this._valueCache[a][1]===b.y&&this._valueCache[a][2]===b.z?this:(this._cacheFloat3(a,b.x,b.y,b.z),this._engine.setFloat3(this.getUniform(a),b.x,b.y,b.z),this)},e.prototype.setFloat3=function(a,b,c,e){return this._valueCache[a]&&this._valueCache[a][0]===b&&this._valueCache[a][1]===c&&this._valueCache[a][2]===e?this:(this._cacheFloat3(a,
b,c,e),this._engine.setFloat3(this.getUniform(a),b,c,e),this)},e.prototype.setVector4=function(a,b){return this._valueCache[a]&&this._valueCache[a][0]===b.x&&this._valueCache[a][1]===b.y&&this._valueCache[a][2]===b.z&&this._valueCache[a][3]===b.w?this:(this._cacheFloat4(a,b.x,b.y,b.z,b.w),this._engine.setFloat4(this.getUniform(a),b.x,b.y,b.z,b.w),this)},e.prototype.setFloat4=function(a,b,c,e,g){return this._valueCache[a]&&this._valueCache[a][0]===b&&this._valueCache[a][1]===c&&this._valueCache[a][2]===
e&&this._valueCache[a][3]===g?this:(this._cacheFloat4(a,b,c,e,g),this._engine.setFloat4(this.getUniform(a),b,c,e,g),this)},e.prototype.setColor3=function(a,b){return this._valueCache[a]&&this._valueCache[a][0]===b.r&&this._valueCache[a][1]===b.g&&this._valueCache[a][2]===b.b?this:(this._cacheFloat3(a,b.r,b.g,b.b),this._engine.setColor3(this.getUniform(a),b),this)},e.prototype.setColor4=function(a,b,c){return this._valueCache[a]&&this._valueCache[a][0]===b.r&&this._valueCache[a][1]===b.g&&this._valueCache[a][2]===
b.b&&this._valueCache[a][3]===c?this:(this._cacheFloat4(a,b.r,b.g,b.b,c),this._engine.setColor4(this.getUniform(a),b,c),this)},e.ShadersStore={},e.IncludesShadersStore={},e);c.Effect=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(){};f=(e.PrepareDefinesForLights=function(a,b,d,e){void 0===e&&(e=4);for(var g=0,h=!1,f=!1,l=0;l<a.lights.length;l++){var k=a.lights[l];if(k.isEnabled()){if(0<k._excludedMeshesIds.length){for(var n=0;n<k._excludedMeshesIds.length;n++){var q=a.getMeshByID(k._excludedMeshesIds[n]);q&&k.excludedMeshes.push(q)}k._excludedMeshesIds=[]}if(0<k._includedOnlyMeshesIds.length){for(n=0;n<k._includedOnlyMeshesIds.length;n++)(q=a.getMeshByID(k._includedOnlyMeshesIds[n]))&&k.includedOnlyMeshes.push(q);
k._includedOnlyMeshesIds=[]}if(k.canAffectMesh(b)){h=!0;void 0===d["LIGHT"+g]&&(f=!0);d["LIGHT"+g]=!0;var p;if(p=k instanceof c.SpotLight?"SPOTLIGHT"+g:k instanceof c.HemisphericLight?"HEMILIGHT"+g:k instanceof c.PointLight?"POINTLIGHT"+g:"DIRLIGHT"+g,void 0===d[p]&&(f=!0),d[p]=!0,k.specular.equalsFloats(0,0,0)||void 0===d.SPECULARTERM||(d.SPECULARTERM=!0),a.shadowsEnabled)k=k.getShadowGenerator(),b&&b.receiveShadows&&k&&(void 0===d["SHADOW"+g]&&(f=!0),d["SHADOW"+g]=!0,d.SHADOWS=!0,(k.useVarianceShadowMap||
k.useBlurVarianceShadowMap)&&(void 0===d["SHADOWVSM"+g]&&(f=!0),d["SHADOWVSM"+g]=!0),k.usePoissonSampling&&(void 0===d["SHADOWPCF"+g]&&(f=!0),d["SHADOWPCF"+g]=!0));if(g++,g===e)break}}}return f&&d.rebuild(),h},e.PrepareUniformsAndSamplersList=function(a,b,c,e){void 0===e&&(e=4);for(var g=0;e>g&&c["LIGHT"+g];g++)a.push("vLightData"+g,"vLightDiffuse"+g,"vLightSpecular"+g,"vLightDirection"+g,"vLightGround"+g,"lightMatrix"+g,"shadowsInfo"+g),b.push("shadowSampler"+g)},e.HandleFallbacksForShadows=function(a,
b,c){void 0===c&&(c=4);for(var e=0;c>e&&a["LIGHT"+e];e++)0<e&&b.addFallback(e,"LIGHT"+e),a["SHADOW"+e]&&b.addFallback(0,"SHADOW"+e),a["SHADOWPCF"+e]&&b.addFallback(0,"SHADOWPCF"+e),a["SHADOWVSM"+e]&&b.addFallback(0,"SHADOWVSM"+e)},e.PrepareAttributesForBones=function(a,b,d,e){0<d.NUM_BONE_INFLUENCERS&&(e.addCPUSkinningFallback(0,b),a.push(c.VertexBuffer.MatricesIndicesKind),a.push(c.VertexBuffer.MatricesWeightsKind),4<d.NUM_BONE_INFLUENCERS&&(a.push(c.VertexBuffer.MatricesIndicesExtraKind),a.push(c.VertexBuffer.MatricesWeightsExtraKind)))},
e.PrepareAttributesForInstances=function(a,b){b.INSTANCES&&(a.push("world0"),a.push("world1"),a.push("world2"),a.push("world3"))},e.BindLightShadow=function(a,b,c,e,g,h){var f=a.getShadowGenerator();return c.receiveShadows&&f&&(a.needCube()?h||(h=!0,g.setFloat2("depthValues",b.activeCamera.minZ,b.activeCamera.maxZ)):g.setMatrix("lightMatrix"+e,f.getTransformMatrix()),g.setTexture("shadowSampler"+e,f.getShadowMapForRendering()),g.setFloat3("shadowsInfo"+e,f.getDarkness(),f.blurScale/f.getShadowMap().getSize().width,
f.bias)),h},e.BindLightProperties=function(a,b,d){a instanceof c.PointLight?a.transferToEffect(b,"vLightData"+d):a instanceof c.DirectionalLight?a.transferToEffect(b,"vLightData"+d):a instanceof c.SpotLight?a.transferToEffect(b,"vLightData"+d,"vLightDirection"+d):a instanceof c.HemisphericLight&&a.transferToEffect(b,"vLightData"+d,"vLightGround"+d)},e.BindLights=function(a,b,d,j,g){void 0===g&&(g=4);for(var h=0,f=!1,l=0;l<a.lights.length;l++){var k=a.lights[l];if(k.isEnabled()&&k.canAffectMesh(b)&&
(e.BindLightProperties(k,d,h),k.diffuse.scaleToRef(k.intensity,c.Tmp.Color3[0]),d.setColor4("vLightDiffuse"+h,c.Tmp.Color3[0],k.range),j.SPECULARTERM&&(k.specular.scaleToRef(k.intensity,c.Tmp.Color3[1]),d.setColor3("vLightSpecular"+h,c.Tmp.Color3[1])),a.shadowsEnabled&&(f=this.BindLightShadow(k,a,b,h,d,f)),h++,h===g))break}},e.BindFogParameters=function(a,b,d){a.fogEnabled&&b.applyFog&&a.fogMode!==c.Scene.FOGMODE_NONE&&(d.setFloat4("vFogInfos",a.fogMode,a.fogStart,a.fogEnd,a.fogDensity),d.setColor3("vFogColor",
a.fogColor))},e.BindBonesParameters=function(a,b){a&&a.useBones&&a.computeBonesUsingShaders&&b.setMatrices("mBones",a.skeleton.getTransformMatrices(a))},e.BindLogDepth=function(a,b,c){a.LOGARITHMICDEPTH&&b.setFloat("logarithmicDepthConstant",2/(Math.log(c.activeCamera.maxZ+1)/Math.LN2))},e.BindClipPlane=function(a,b){if(b.clipPlane){var c=b.clipPlane;a.setFloat4("vClipPlane",c.normal.x,c.normal.y,c.normal.z,c.d)}},e);c.MaterialHelper=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(){this.isEnabled=!0;this.leftColor=c.Color3.White();this.rightColor=c.Color3.Black();this.bias=0;this.power=1};f=(e.prototype.clone=function(){var a=new e;return c.Tools.DeepCopy(this,a),new e},e.prototype.serialize=function(){var a={};return a.isEnabled=this.isEnabled,a.leftColor=this.leftColor,a.rightColor=this.rightColor,a.bias=this.bias,a.power=this.power,a},e.Parse=function(a){var b=new e;return b.isEnabled=a.isEnabled,b.leftColor=c.Color3.FromArray(a.leftColor),
b.rightColor=c.Color3.FromArray(a.rightColor),b.bias=a.bias,b.power=a.power||1,b},e);c.FresnelParameters=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){};f=(f.prototype.rebuild=function(){this._keys&&delete this._keys;this._keys=Object.keys(this)},f.prototype.isEqual=function(a){if(this._keys.length!==a._keys.length)return!1;for(var b=0;b<this._keys.length;b++){var c=this._keys[b];if(this[c]!==a[c])return!1}return!0},f.prototype.cloneTo=function(a){this._keys.length!==a._keys.length&&(a._keys=this._keys.slice(0));for(var b=0;b<this._keys.length;b++){var c=this._keys[b];a[c]=this[c]}},f.prototype.reset=function(){for(var a=
0;a<this._keys.length;a++){var b=this._keys[a];"number"==typeof this[b]?this[b]=0:this[b]=!1}},f.prototype.toString=function(){for(var a="",b=0;b<this._keys.length;b++){var c=this._keys[b];"number"==typeof this[c]?a+="#define "+c+" "+this[c]+"\n":this[c]&&(a+="#define "+c+"\n")}return a},f);c.MaterialDefines=f;var e=function(a,b,d){this.name=a;this.checkReadyOnlyOnce=this.checkReadyOnEveryCall=!1;this.state="";this.alpha=1;this.backFaceCulling=!0;this.sideOrientation=e.CounterClockWiseSideOrientation;
this.onDisposeObservable=new c.Observable;this.onBindObservable=new c.Observable;this.alphaMode=c.Engine.ALPHA_COMBINE;this.disableDepthWrite=!1;this.fogEnabled=!0;this.pointSize=1;this.zOffset=0;this._wasPreviouslyReady=!1;this._fillMode=e.TriangleFillMode;this.id=a;this._scene=b;d||b.materials.push(this)};f=(Object.defineProperty(e,"TriangleFillMode",{get:function(){return e._TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(e,"WireFrameFillMode",{get:function(){return e._WireFrameFillMode},
enumerable:!0,configurable:!0}),Object.defineProperty(e,"PointFillMode",{get:function(){return e._PointFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ClockWiseSideOrientation",{get:function(){return e._ClockWiseSideOrientation},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CounterClockWiseSideOrientation",{get:function(){return e._CounterClockWiseSideOrientation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onDispose",{set:function(a){this._onDisposeObserver&&
this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBind",{set:function(a){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver);this._onBindObserver=this.onBindObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wireframe",{get:function(){return this._fillMode===e.WireFrameFillMode},set:function(a){this._fillMode=a?
e.WireFrameFillMode:e.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointsCloud",{get:function(){return this._fillMode===e.PointFillMode},set:function(a){this._fillMode=a?e.PointFillMode:e.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillMode",{get:function(){return this._fillMode},set:function(a){this._fillMode=a},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"Name: "+this.name},Object.defineProperty(e.prototype,
"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!0,configurable:!0}),e.prototype.freeze=function(){this.checkReadyOnlyOnce=!0},e.prototype.unfreeze=function(){this.checkReadyOnlyOnce=!1},e.prototype.isReady=function(){return!0},e.prototype.getEffect=function(){return this._effect},e.prototype.getScene=function(){return this._scene},e.prototype.needAlphaBlending=function(){return 1>this.alpha},e.prototype.needAlphaTesting=function(){return!1},e.prototype.getAlphaTestTexture=function(){return null},
e.prototype.markDirty=function(){this._wasPreviouslyReady=!1},e.prototype._preBind=function(){var a=this._scene.getEngine();a.enableEffect(this._effect);a.setState(this.backFaceCulling,this.zOffset,!1,this.sideOrientation===e.ClockWiseSideOrientation)},e.prototype.bind=function(a,b){if(this._scene._cachedMaterial=this,this.onBindObservable.notifyObservers(b),this.disableDepthWrite){var c=this._scene.getEngine();this._cachedDepthWriteState=c.getDepthWrite();c.setDepthWrite(!1)}},e.prototype.bindOnlyWorldMatrix=
function(){},e.prototype.unbind=function(){this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)},e.prototype.clone=function(){return null},e.prototype.getBindedMeshes=function(){for(var a=[],b=0;b<this._scene.meshes.length;b++){var c=this._scene.meshes[b];c.material===this&&a.push(c)}return a},e.prototype.dispose=function(a){this.getScene().stopAnimation(this);var b=this._scene.materials.indexOf(this);0<=b&&this._scene.materials.splice(b,1);a&&this._effect&&(this._scene.getEngine()._releaseEffect(this._effect),
this._effect=null);for(b=0;b<this._scene.meshes.length;b++)a=this._scene.meshes[b],a.material===this&&(a.material=null);this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear();this.onBindObservable.clear()},e.prototype.serialize=function(){return c.SerializationHelper.Serialize(this)},e.ParseMultiMaterial=function(a,b){var d=new c.MultiMaterial(a.name,b);d.id=a.id;c.Tags.AddTagsTo(d,a.tags);for(var e=0;e<a.materials.length;e++){var g=a.materials[e];g?d.subMaterials.push(b.getMaterialByID(g)):
d.subMaterials.push(null)}return d},e.Parse=function(a,b,d){return!a.customType?c.StandardMaterial.Parse(a,b,d):c.Tools.Instantiate(a.customType).Parse(a,b,d)},e._TriangleFillMode=0,e._WireFrameFillMode=1,e._PointFillMode=2,e._ClockWiseSideOrientation=0,e._CounterClockWiseSideOrientation=1,__decorate([c.serialize()],e.prototype,"id",void 0),__decorate([c.serialize()],e.prototype,"checkReadyOnEveryCall",void 0),__decorate([c.serialize()],e.prototype,"checkReadyOnlyOnce",void 0),__decorate([c.serialize()],
e.prototype,"state",void 0),__decorate([c.serialize()],e.prototype,"alpha",void 0),__decorate([c.serialize()],e.prototype,"backFaceCulling",void 0),__decorate([c.serialize()],e.prototype,"sideOrientation",void 0),__decorate([c.serialize()],e.prototype,"alphaMode",void 0),__decorate([c.serialize()],e.prototype,"disableDepthWrite",void 0),__decorate([c.serialize()],e.prototype,"fogEnabled",void 0),__decorate([c.serialize()],e.prototype,"pointSize",void 0),__decorate([c.serialize()],e.prototype,"zOffset",
void 0),__decorate([c.serialize()],e.prototype,"wireframe",null),__decorate([c.serialize()],e.prototype,"pointsCloud",null),__decorate([c.serialize()],e.prototype,"fillMode",null),e);c.Material=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.MaterialDefines,a=function(){e.call(this);this.VERTEXALPHA=this.VERTEXCOLOR=this.UV2=this.UV1=this.NORMAL=this.FRESNEL=this.EMISSIVEFRESNEL=this.REFRACTIONFRESNEL=this.REFLECTIONFRESNEL=this.OPACITYFRESNEL=this.DIFFUSEFRESNEL=this.SPECULARTERM=this.FOG=this.POINTSIZE=this.ALPHAFROMDIFFUSE=this.ALPHATEST=this.CLIPPLANE=this.SPECULAROVERALPHA=this.PARALLAXOCCLUSION=this.PARALLAX=this.BUMP=this.SPECULAR=this.EMISSIVE=this.REFLECTION=this.OPACITYRGB=this.OPACITY=this.AMBIENT=this.DIFFUSE=
!1;this.BonesPerMesh=this.NUM_BONE_INFLUENCERS=0;this.INVERTNORMALMAPY=this.INVERTNORMALMAPX=this.REFLECTIONOVERALPHA=this.REFRACTIONMAP_3D=this.REFRACTION=this.LOGARITHMICDEPTH=this.INVERTCUBICMAP=this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=this.REFLECTIONMAP_EQUIRECTANGULAR=this.REFLECTIONMAP_EXPLICIT=this.REFLECTIONMAP_SKYBOX=this.REFLECTIONMAP_PROJECTION=this.REFLECTIONMAP_CUBIC=this.REFLECTIONMAP_PLANAR=this.REFLECTIONMAP_SPHERICAL=this.REFLECTIONMAP_3D=this.USELIGHTMAPASSHADOWMAP=this.LIGHTMAP=
this.REFLECTIONFRESNELFROMSPECULAR=this.LINKEMISSIVEWITHDIFFUSE=this.EMISSIVEASILLUMINATION=this.ROUGHNESS=this.GLOSSINESS=this.INSTANCES=!1;this.rebuild()};f=(__extends(a,e),a);var b=c.Material,d=function(a,d){var h=this;b.call(this,a,d);this.ambientColor=new c.Color3(0,0,0);this.diffuseColor=new c.Color3(1,1,1);this.specularColor=new c.Color3(1,1,1);this.emissiveColor=new c.Color3(0,0,0);this.specularPower=64;this.useParallaxOcclusion=this.useParallax=this.disableLighting=this.useReflectionOverAlpha=
this.useSpecularOverAlpha=this.useReflectionFresnelFromSpecular=this.linkEmissiveWithDiffuse=this.useEmissiveAsIllumination=this.useAlphaFromDiffuseTexture=!1;this.parallaxScaleBias=0.05;this.roughness=0;this.indexOfRefraction=0.98;this.invertRefractionY=!0;this.useGlossinessFromSpecularMapAlpha=this.useLightmapAsShadowmap=!1;this.maxSimultaneousLights=4;this.invertNormalMapY=this.invertNormalMapX=!1;this._renderTargets=new c.SmartArray(16);this._worldViewProjectionMatrix=c.Matrix.Zero();this._globalAmbientColor=
new c.Color3(0,0,0);this._defines=new f;this._cachedDefines=new f;this._cachedDefines.BonesPerMesh=-1;this.getRenderTargetTextures=function(){return h._renderTargets.reset(),h.reflectionTexture&&h.reflectionTexture.isRenderTarget&&h._renderTargets.push(h.reflectionTexture),h.refractionTexture&&h.refractionTexture.isRenderTarget&&h._renderTargets.push(h.refractionTexture),h._renderTargets}},a=(__extends(d,b),Object.defineProperty(d.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},
set:function(a){this._useLogarithmicDepth=a&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!0,configurable:!0}),d.prototype.needAlphaBlending=function(){return 1>this.alpha||null!=this.opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled},d.prototype.needAlphaTesting=function(){return null!=this.diffuseTexture&&this.diffuseTexture.hasAlpha},d.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=
this.diffuseTexture&&this.diffuseTexture.hasAlpha&&this.useAlphaFromDiffuseTexture},d.prototype.getAlphaTestTexture=function(){return this.diffuseTexture},d.prototype._checkCache=function(a,b,c){return b?this._defines.INSTANCES!==c?!1:!(!b._materialDefines||!b._materialDefines.isEqual(this._defines)):!0},d.prototype.isReady=function(a,b){if(this.isFrozen&&this._wasPreviouslyReady)return!0;var h=this.getScene();if(!this.checkReadyOnEveryCall&&this._renderId===h.getRenderId()&&this._checkCache(h,a,
b))return!0;var e=h.getEngine(),l=!1,k=!1;if(this._defines.reset(),h.texturesEnabled){if(this.diffuseTexture&&d.DiffuseTextureEnabled){if(!this.diffuseTexture.isReady())return!1;k=!0;this._defines.DIFFUSE=!0}if(this.ambientTexture&&d.AmbientTextureEnabled){if(!this.ambientTexture.isReady())return!1;k=!0;this._defines.AMBIENT=!0}if(this.opacityTexture&&d.OpacityTextureEnabled){if(!this.opacityTexture.isReady())return!1;k=!0;this._defines.OPACITY=!0;this.opacityTexture.getAlphaFromRGB&&(this._defines.OPACITYRGB=
!0)}if(this.reflectionTexture&&d.ReflectionTextureEnabled){if(!this.reflectionTexture.isReady())return!1;switch(l=!0,this._defines.REFLECTION=!0,0<this.roughness&&(this._defines.ROUGHNESS=!0),this.useReflectionOverAlpha&&(this._defines.REFLECTIONOVERALPHA=!0),this.reflectionTexture.coordinatesMode===c.Texture.INVCUBIC_MODE&&(this._defines.INVERTCUBICMAP=!0),this._defines.REFLECTIONMAP_3D=this.reflectionTexture.isCube,this.reflectionTexture.coordinatesMode){case c.Texture.CUBIC_MODE:case c.Texture.INVCUBIC_MODE:this._defines.REFLECTIONMAP_CUBIC=
!0;break;case c.Texture.EXPLICIT_MODE:this._defines.REFLECTIONMAP_EXPLICIT=!0;break;case c.Texture.PLANAR_MODE:this._defines.REFLECTIONMAP_PLANAR=!0;break;case c.Texture.PROJECTION_MODE:this._defines.REFLECTIONMAP_PROJECTION=!0;break;case c.Texture.SKYBOX_MODE:this._defines.REFLECTIONMAP_SKYBOX=!0;break;case c.Texture.SPHERICAL_MODE:this._defines.REFLECTIONMAP_SPHERICAL=!0;break;case c.Texture.EQUIRECTANGULAR_MODE:this._defines.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case c.Texture.FIXED_EQUIRECTANGULAR_MODE:this._defines.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=
!0}}if(this.emissiveTexture&&d.EmissiveTextureEnabled){if(!this.emissiveTexture.isReady())return!1;k=!0;this._defines.EMISSIVE=!0}if(this.lightmapTexture&&d.LightmapTextureEnabled){if(!this.lightmapTexture.isReady())return!1;k=!0;this._defines.LIGHTMAP=!0;this._defines.USELIGHTMAPASSHADOWMAP=this.useLightmapAsShadowmap}if(this.specularTexture&&d.SpecularTextureEnabled){if(!this.specularTexture.isReady())return!1;k=!0;this._defines.SPECULAR=!0;this._defines.GLOSSINESS=this.useGlossinessFromSpecularMapAlpha}if(h.getEngine().getCaps().standardDerivatives&&
this.bumpTexture&&d.BumpTextureEnabled){if(!this.bumpTexture.isReady())return!1;k=!0;this._defines.BUMP=!0;this.useParallax&&(this._defines.PARALLAX=!0,this.useParallaxOcclusion&&(this._defines.PARALLAXOCCLUSION=!0));this.invertNormalMapX&&(this._defines.INVERTNORMALMAPX=!0);this.invertNormalMapY&&(this._defines.INVERTNORMALMAPY=!0)}if(this.refractionTexture&&d.RefractionTextureEnabled){if(!this.refractionTexture.isReady())return!1;k=!0;this._defines.REFRACTION=!0;this._defines.REFRACTIONMAP_3D=this.refractionTexture.isCube}}if(h.clipPlane&&
(this._defines.CLIPPLANE=!0),e.getAlphaTesting()&&(this._defines.ALPHATEST=!0),this._shouldUseAlphaFromDiffuseTexture()&&(this._defines.ALPHAFROMDIFFUSE=!0),this.useEmissiveAsIllumination&&(this._defines.EMISSIVEASILLUMINATION=!0),this.linkEmissiveWithDiffuse&&(this._defines.LINKEMISSIVEWITHDIFFUSE=!0),this.useLogarithmicDepth&&(this._defines.LOGARITHMICDEPTH=!0),(this.pointsCloud||h.forcePointsCloud)&&(this._defines.POINTSIZE=!0),h.fogEnabled&&a&&a.applyFog&&h.fogMode!==c.Scene.FOGMODE_NONE&&this.fogEnabled&&
(this._defines.FOG=!0),h.lightsEnabled&&!this.disableLighting&&(l=c.MaterialHelper.PrepareDefinesForLights(h,a,this._defines,this.maxSimultaneousLights)),d.FresnelEnabled&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled||this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled||this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled||this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled||this.reflectionFresnelParameters&&
this.reflectionFresnelParameters.isEnabled)&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._defines.DIFFUSEFRESNEL=!0),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&(this._defines.OPACITYFRESNEL=!0),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._defines.REFLECTIONFRESNEL=!0,this.useReflectionFresnelFromSpecular&&(this._defines.REFLECTIONFRESNELFROMSPECULAR=!0)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&
(this._defines.REFRACTIONFRESNEL=!0),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._defines.EMISSIVEFRESNEL=!0),l=!0,this._defines.FRESNEL=!0),this._defines.SPECULARTERM&&this.useSpecularOverAlpha&&(this._defines.SPECULAROVERALPHA=!0),a&&(l&&a.isVerticesDataPresent(c.VertexBuffer.NormalKind)&&(this._defines.NORMAL=!0),k&&(a.isVerticesDataPresent(c.VertexBuffer.UVKind)&&(this._defines.UV1=!0),a.isVerticesDataPresent(c.VertexBuffer.UV2Kind)&&(this._defines.UV2=!0)),
a.useVertexColors&&a.isVerticesDataPresent(c.VertexBuffer.ColorKind)&&(this._defines.VERTEXCOLOR=!0,a.hasVertexAlpha&&(this._defines.VERTEXALPHA=!0)),a.useBones&&a.computeBonesUsingShaders&&(this._defines.NUM_BONE_INFLUENCERS=a.numBoneInfluencers,this._defines.BonesPerMesh=a.skeleton.bones.length+1),b&&(this._defines.INSTANCES=!0)),!this._defines.isEqual(this._cachedDefines)){this._defines.cloneTo(this._cachedDefines);h.resetCachedMaterial();e=new c.EffectFallbacks;this._defines.REFLECTION&&e.addFallback(0,
"REFLECTION");this._defines.SPECULAR&&e.addFallback(0,"SPECULAR");this._defines.BUMP&&e.addFallback(0,"BUMP");this._defines.PARALLAX&&e.addFallback(1,"PARALLAX");this._defines.PARALLAXOCCLUSION&&e.addFallback(0,"PARALLAXOCCLUSION");this._defines.SPECULAROVERALPHA&&e.addFallback(0,"SPECULAROVERALPHA");this._defines.FOG&&e.addFallback(1,"FOG");this._defines.POINTSIZE&&e.addFallback(0,"POINTSIZE");this._defines.LOGARITHMICDEPTH&&e.addFallback(0,"LOGARITHMICDEPTH");c.MaterialHelper.HandleFallbacksForShadows(this._defines,
e,this.maxSimultaneousLights);this._defines.SPECULARTERM&&e.addFallback(0,"SPECULARTERM");this._defines.DIFFUSEFRESNEL&&e.addFallback(1,"DIFFUSEFRESNEL");this._defines.OPACITYFRESNEL&&e.addFallback(2,"OPACITYFRESNEL");this._defines.REFLECTIONFRESNEL&&e.addFallback(3,"REFLECTIONFRESNEL");this._defines.EMISSIVEFRESNEL&&e.addFallback(4,"EMISSIVEFRESNEL");this._defines.FRESNEL&&e.addFallback(4,"FRESNEL");l=[c.VertexBuffer.PositionKind];this._defines.NORMAL&&l.push(c.VertexBuffer.NormalKind);this._defines.UV1&&
l.push(c.VertexBuffer.UVKind);this._defines.UV2&&l.push(c.VertexBuffer.UV2Kind);this._defines.VERTEXCOLOR&&l.push(c.VertexBuffer.ColorKind);c.MaterialHelper.PrepareAttributesForBones(l,a,this._defines,e);c.MaterialHelper.PrepareAttributesForInstances(l,this._defines);k="default";h.getEngine().getCaps().standardDerivatives||(k="legacydefault");var n=this._defines.toString(),q="world view viewProjection vEyePosition vLightsType vAmbientColor vDiffuseColor vSpecularColor vEmissiveColor vFogInfos vFogColor pointSize vDiffuseInfos vAmbientInfos vOpacityInfos vReflectionInfos vEmissiveInfos vSpecularInfos vBumpInfos vLightmapInfos vRefractionInfos mBones vClipPlane diffuseMatrix ambientMatrix opacityMatrix reflectionMatrix emissiveMatrix specularMatrix bumpMatrix lightmapMatrix refractionMatrix depthValues diffuseLeftColor diffuseRightColor opacityParts reflectionLeftColor reflectionRightColor emissiveLeftColor emissiveRightColor refractionLeftColor refractionRightColor logarithmicDepthConstant".split(" "),
p="diffuseSampler ambientSampler opacitySampler reflectionCubeSampler reflection2DSampler emissiveSampler specularSampler bumpSampler lightmapSampler refractionCubeSampler refraction2DSampler".split(" ");c.MaterialHelper.PrepareUniformsAndSamplersList(q,p,this._defines,this.maxSimultaneousLights);this._effect=h.getEngine().createEffect(k,l,q,p,n,e,this.onCompiled,this.onError,{maxSimultaneousLights:this.maxSimultaneousLights-1})}return this._effect.isReady()?(this._renderId=h.getRenderId(),this._wasPreviouslyReady=
!0,a&&(a._materialDefines||(a._materialDefines=new f),this._defines.cloneTo(a._materialDefines)),!0):!1},d.prototype.unbind=function(){this.reflectionTexture&&this.reflectionTexture.isRenderTarget&&this._effect.setTexture("reflection2DSampler",null);this.refractionTexture&&this.refractionTexture.isRenderTarget&&this._effect.setTexture("refraction2DSampler",null);b.prototype.unbind.call(this)},d.prototype.bindOnlyWorldMatrix=function(a){this._effect.setMatrix("world",a)},d.prototype.bind=function(a,
g){var h=this.getScene();if(this.bindOnlyWorldMatrix(a),c.MaterialHelper.BindBonesParameters(g,this._effect),h.getCachedMaterial()!==this){if(this._effect.setMatrix("viewProjection",h.getTransformMatrix()),d.FresnelEnabled&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._effect.setColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),this._effect.setColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,
this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&this._effect.setColor4("opacityParts",new c.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._effect.setColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,
this.reflectionFresnelParameters.power),this._effect.setColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(this._effect.setColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),this._effect.setColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),
this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._effect.setColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),this._effect.setColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),h.texturesEnabled&&(this.diffuseTexture&&d.DiffuseTextureEnabled&&(this._effect.setTexture("diffuseSampler",this.diffuseTexture),this._effect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,
this.diffuseTexture.level),this._effect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),this.ambientTexture&&d.AmbientTextureEnabled&&(this._effect.setTexture("ambientSampler",this.ambientTexture),this._effect.setFloat2("vAmbientInfos",this.ambientTexture.coordinatesIndex,this.ambientTexture.level),this._effect.setMatrix("ambientMatrix",this.ambientTexture.getTextureMatrix())),this.opacityTexture&&d.OpacityTextureEnabled&&(this._effect.setTexture("opacitySampler",this.opacityTexture),
this._effect.setFloat2("vOpacityInfos",this.opacityTexture.coordinatesIndex,this.opacityTexture.level),this._effect.setMatrix("opacityMatrix",this.opacityTexture.getTextureMatrix())),this.reflectionTexture&&d.ReflectionTextureEnabled&&(this.reflectionTexture.isCube?this._effect.setTexture("reflectionCubeSampler",this.reflectionTexture):this._effect.setTexture("reflection2DSampler",this.reflectionTexture),this._effect.setMatrix("reflectionMatrix",this.reflectionTexture.getReflectionTextureMatrix()),
this._effect.setFloat2("vReflectionInfos",this.reflectionTexture.level,this.roughness)),this.emissiveTexture&&d.EmissiveTextureEnabled&&(this._effect.setTexture("emissiveSampler",this.emissiveTexture),this._effect.setFloat2("vEmissiveInfos",this.emissiveTexture.coordinatesIndex,this.emissiveTexture.level),this._effect.setMatrix("emissiveMatrix",this.emissiveTexture.getTextureMatrix())),this.lightmapTexture&&d.LightmapTextureEnabled&&(this._effect.setTexture("lightmapSampler",this.lightmapTexture),
this._effect.setFloat2("vLightmapInfos",this.lightmapTexture.coordinatesIndex,this.lightmapTexture.level),this._effect.setMatrix("lightmapMatrix",this.lightmapTexture.getTextureMatrix())),this.specularTexture&&d.SpecularTextureEnabled&&(this._effect.setTexture("specularSampler",this.specularTexture),this._effect.setFloat2("vSpecularInfos",this.specularTexture.coordinatesIndex,this.specularTexture.level),this._effect.setMatrix("specularMatrix",this.specularTexture.getTextureMatrix())),this.bumpTexture&&
h.getEngine().getCaps().standardDerivatives&&d.BumpTextureEnabled&&(this._effect.setTexture("bumpSampler",this.bumpTexture),this._effect.setFloat3("vBumpInfos",this.bumpTexture.coordinatesIndex,1/this.bumpTexture.level,this.parallaxScaleBias),this._effect.setMatrix("bumpMatrix",this.bumpTexture.getTextureMatrix())),this.refractionTexture&&d.RefractionTextureEnabled)){var e=1;this.refractionTexture.isCube?this._effect.setTexture("refractionCubeSampler",this.refractionTexture):(this._effect.setTexture("refraction2DSampler",
this.refractionTexture),this._effect.setMatrix("refractionMatrix",this.refractionTexture.getReflectionTextureMatrix()),this.refractionTexture.depth&&(e=this.refractionTexture.depth));this._effect.setFloat4("vRefractionInfos",this.refractionTexture.level,this.indexOfRefraction,e,this.invertRefractionY?-1:1)}c.MaterialHelper.BindClipPlane(this._effect,h);this.pointsCloud&&this._effect.setFloat("pointSize",this.pointSize);h.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor);this._effect.setVector3("vEyePosition",
h._mirroredCameraPosition?h._mirroredCameraPosition:h.activeCamera.position);this._effect.setColor3("vAmbientColor",this._globalAmbientColor);this._defines.SPECULARTERM&&this._effect.setColor4("vSpecularColor",this.specularColor,this.specularPower);this._effect.setColor3("vEmissiveColor",this.emissiveColor)}h.getCachedMaterial()===this&&this.isFrozen||(this._effect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*g.visibility),h.lightsEnabled&&!this.disableLighting&&c.MaterialHelper.BindLights(h,
g,this._effect,this._defines,this.maxSimultaneousLights),(h.fogEnabled&&g.applyFog&&h.fogMode!==c.Scene.FOGMODE_NONE||this.reflectionTexture||this.refractionTexture)&&this._effect.setMatrix("view",h.getViewMatrix()),c.MaterialHelper.BindFogParameters(h,g,this._effect),c.MaterialHelper.BindLogDepth(this._defines,this._effect,h));b.prototype.bind.call(this,a,g)},d.prototype.getAnimatables=function(){var a=[];return this.diffuseTexture&&this.diffuseTexture.animations&&0<this.diffuseTexture.animations.length&&
a.push(this.diffuseTexture),this.ambientTexture&&this.ambientTexture.animations&&0<this.ambientTexture.animations.length&&a.push(this.ambientTexture),this.opacityTexture&&this.opacityTexture.animations&&0<this.opacityTexture.animations.length&&a.push(this.opacityTexture),this.reflectionTexture&&this.reflectionTexture.animations&&0<this.reflectionTexture.animations.length&&a.push(this.reflectionTexture),this.emissiveTexture&&this.emissiveTexture.animations&&0<this.emissiveTexture.animations.length&&
a.push(this.emissiveTexture),this.specularTexture&&this.specularTexture.animations&&0<this.specularTexture.animations.length&&a.push(this.specularTexture),this.bumpTexture&&this.bumpTexture.animations&&0<this.bumpTexture.animations.length&&a.push(this.bumpTexture),this.lightmapTexture&&this.lightmapTexture.animations&&0<this.lightmapTexture.animations.length&&a.push(this.lightmapTexture),this.refractionTexture&&this.refractionTexture.animations&&0<this.refractionTexture.animations.length&&a.push(this.refractionTexture),
a},d.prototype.dispose=function(a,c){c&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.ambientTexture&&this.ambientTexture.dispose(),this.opacityTexture&&this.opacityTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose(),this.emissiveTexture&&this.emissiveTexture.dispose(),this.specularTexture&&this.specularTexture.dispose(),this.bumpTexture&&this.bumpTexture.dispose(),this.lightmapTexture&&this.lightmapTexture.dispose(),this.refractionTexture&&this.refractionTexture.dispose());
b.prototype.dispose.call(this,a,c)},d.prototype.clone=function(a){var b=this;return c.SerializationHelper.Clone(function(){return new d(a,b.getScene())},this)},d.prototype.serialize=function(){return c.SerializationHelper.Serialize(this)},d.Parse=function(a,b,h){return c.SerializationHelper.Parse(function(){return new d(a.name,b)},a,b,h)},d.DiffuseTextureEnabled=!0,d.AmbientTextureEnabled=!0,d.OpacityTextureEnabled=!0,d.ReflectionTextureEnabled=!0,d.EmissiveTextureEnabled=!0,d.SpecularTextureEnabled=
!0,d.BumpTextureEnabled=!0,d.FresnelEnabled=!0,d.LightmapTextureEnabled=!0,d.RefractionTextureEnabled=!0,__decorate([c.serializeAsTexture()],d.prototype,"diffuseTexture",void 0),__decorate([c.serializeAsTexture()],d.prototype,"ambientTexture",void 0),__decorate([c.serializeAsTexture()],d.prototype,"opacityTexture",void 0),__decorate([c.serializeAsTexture()],d.prototype,"reflectionTexture",void 0),__decorate([c.serializeAsTexture()],d.prototype,"emissiveTexture",void 0),__decorate([c.serializeAsTexture()],
d.prototype,"specularTexture",void 0),__decorate([c.serializeAsTexture()],d.prototype,"bumpTexture",void 0),__decorate([c.serializeAsTexture()],d.prototype,"lightmapTexture",void 0),__decorate([c.serializeAsTexture()],d.prototype,"refractionTexture",void 0),__decorate([c.serializeAsColor3("ambient")],d.prototype,"ambientColor",void 0),__decorate([c.serializeAsColor3("diffuse")],d.prototype,"diffuseColor",void 0),__decorate([c.serializeAsColor3("specular")],d.prototype,"specularColor",void 0),__decorate([c.serializeAsColor3("emissive")],
d.prototype,"emissiveColor",void 0),__decorate([c.serialize()],d.prototype,"specularPower",void 0),__decorate([c.serialize()],d.prototype,"useAlphaFromDiffuseTexture",void 0),__decorate([c.serialize()],d.prototype,"useEmissiveAsIllumination",void 0),__decorate([c.serialize()],d.prototype,"linkEmissiveWithDiffuse",void 0),__decorate([c.serialize()],d.prototype,"useReflectionFresnelFromSpecular",void 0),__decorate([c.serialize()],d.prototype,"useSpecularOverAlpha",void 0),__decorate([c.serialize()],
d.prototype,"useReflectionOverAlpha",void 0),__decorate([c.serialize()],d.prototype,"disableLighting",void 0),__decorate([c.serialize()],d.prototype,"useParallax",void 0),__decorate([c.serialize()],d.prototype,"useParallaxOcclusion",void 0),__decorate([c.serialize()],d.prototype,"parallaxScaleBias",void 0),__decorate([c.serialize()],d.prototype,"roughness",void 0),__decorate([c.serialize()],d.prototype,"indexOfRefraction",void 0),__decorate([c.serialize()],d.prototype,"invertRefractionY",void 0),
__decorate([c.serialize()],d.prototype,"useLightmapAsShadowmap",void 0),__decorate([c.serializeAsFresnelParameters()],d.prototype,"diffuseFresnelParameters",void 0),__decorate([c.serializeAsFresnelParameters()],d.prototype,"opacityFresnelParameters",void 0),__decorate([c.serializeAsFresnelParameters()],d.prototype,"reflectionFresnelParameters",void 0),__decorate([c.serializeAsFresnelParameters()],d.prototype,"refractionFresnelParameters",void 0),__decorate([c.serializeAsFresnelParameters()],d.prototype,
"emissiveFresnelParameters",void 0),__decorate([c.serialize()],d.prototype,"useGlossinessFromSpecularMapAlpha",void 0),__decorate([c.serialize()],d.prototype,"maxSimultaneousLights",void 0),__decorate([c.serialize()],d.prototype,"invertNormalMapX",void 0),__decorate([c.serialize()],d.prototype,"invertNormalMapY",void 0),__decorate([c.serialize()],d.prototype,"useLogarithmicDepth",null),d);c.StandardMaterial=a}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Material,a=function(a,c){e.call(this,a,c,!0);this.subMaterials=[];c.multiMaterials.push(this)};f=(__extends(a,e),a.prototype.getSubMaterial=function(a){return 0>a||a>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[a]},a.prototype.isReady=function(a){for(var c=0;c<this.subMaterials.length;c++)if(this.subMaterials[c]&&!this.subMaterials[c].isReady(a))return!1;return!0},a.prototype.clone=function(b,c){for(var e=new a(b,this.getScene()),g=0;g<this.subMaterials.length;g++){var h=
null,h=c?this.subMaterials[g].clone(b+"-"+this.subMaterials[g].name):this.subMaterials[g];e.subMaterials.push(h)}return e},a.prototype.serialize=function(){var a={};a.name=this.name;a.id=this.id;a.tags=c.Tags.GetTags(this);a.materials=[];for(var d=0;d<this.subMaterials.length;d++){var e=this.subMaterials[d];e?a.materials.push(e.id):a.materials.push(null)}return a},a);c.MultiMaterial=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(){};f=(Object.defineProperty(e,"NO_LOGGING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MINIMAL_LOGGING",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SUMMARY_LOGGING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DETAILED_LOGGING",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ForceFullSceneLoadingForIncremental",{get:function(){return e._ForceFullSceneLoadingForIncremental},
set:function(a){e._ForceFullSceneLoadingForIncremental=a},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShowLoadingScreen",{get:function(){return e._ShowLoadingScreen},set:function(a){e._ShowLoadingScreen=a},enumerable:!0,configurable:!0}),Object.defineProperty(e,"loggingLevel",{get:function(){return e._loggingLevel},set:function(a){e._loggingLevel=a},enumerable:!0,configurable:!0}),e._getPluginForFilename=function(a){var b=a.lastIndexOf("."),c=a.indexOf("?");-1===c&&(c=a.length);a=a.substring(b,
c).toLowerCase();for(b=0;b<this._registeredPlugins.length;b++)if(c=this._registeredPlugins[b],-1!==c.extensions.indexOf(a))return c;return this._registeredPlugins[0]},e.GetPluginForExtension=function(a){for(var b=0;b<this._registeredPlugins.length;b++){var c=this._registeredPlugins[b];if(-1!==c.extensions.indexOf(a))return c}return null},e.RegisterPlugin=function(a){a.extensions=a.extensions.toLowerCase();e._registeredPlugins.push(a)},e.ImportMesh=function(a,b,d,j,g,h,f){if(d.substr&&"/"===d.substr(0,
1)||d.substr&&"/"===d.substr(0,1))return void c.Tools.Error("Wrong sceneFilename parameter");var l={};j._addPendingData(l);var k=function(){j.database=n;var k=e._getPluginForFilename(d),p=function(c){var h=[],e=[],n=[];try{if(k.importMesh){if(!k.importMesh(a,j,c,b,h,e,n))return f&&f(j,"Unable to import meshes from "+b+d),void j._removePendingData(l);g&&(j.importedMeshesFiles.push(b+d),g(h,e,n),j._removePendingData(l))}else k.importMeshAsync(a,j,c,b,function(a,c,h){g&&(j.importedMeshesFiles.push(b+
d),g(a,c,h),j._removePendingData(l))},function(){f&&f(j,"Unable to import meshes from "+b+d);j._removePendingData(l)})}catch(p){f&&f(j,"Unable to import meshes from "+b+d,p),j._removePendingData(l)}};return d.substr&&"data:"===d.substr(0,5)?void p(d.substr(5)):void c.Tools.LoadFile(b+d,function(a){p(a)},h,n)};if(!j.getEngine().enableOfflineSupport||d.substr&&"data:"===d.substr(0,5))k(!0);else var n=new c.Database(b+d,k)},e.Load=function(a,b,d,j,g,h){e.Append(a,b,new c.Scene(d),j,g,h)},e.Append=function(a,
b,d,j,g,h){if(b.substr&&"/"===b.substr(0,1))return void c.Tools.Error("Wrong sceneFilename parameter");var f,l=this._getPluginForFilename(b.name||b),k={};d._addPendingData(k);e.ShowLoadingScreen&&d.getEngine().displayLoadingUI();var n=function(b){if(d.database=f,l.load){if(!l.load(d,b,a))return h&&h(d),d._removePendingData(k),void d.getEngine().hideLoadingUI();j&&j(d);d._removePendingData(k)}else l.loadAsync(d,b,a,function(){j&&j(d)},function(){h&&h(d);d._removePendingData(k);d.getEngine().hideLoadingUI()});
e.ShowLoadingScreen&&d.executeWhenReady(function(){d.getEngine().hideLoadingUI()})},q=function(){c.Tools.LoadFile(a+b,n,g,f)};return b.substr&&"data:"===b.substr(0,5)?void n(b.substr(5)):void(-1===a.indexOf("file:")?d.getEngine().enableOfflineSupport?f=new c.Database(a+b,q):q(!0):c.Tools.ReadFile(b,n,g))},e._ForceFullSceneLoadingForIncremental=!1,e._ShowLoadingScreen=!0,e._loggingLevel=e.NO_LOGGING,e._registeredPlugins=[],e);c.SceneLoader=f}(BABYLON||(BABYLON={}));
!function(c){c.Internals||(c.Internals={});var f=function(a,b,d,e){for(var g=0,h=b.materials.length;h>g;g++){var f=b.materials[g];if(f.id===a)return c.Material.Parse(f,d,e)}return null},e=function(a,b){return a+" of "+(b?b.file+" from "+b.name+" version: "+b.version+", exporter version: "+b.exporter_version:"unknown")};c.SceneLoader.RegisterPlugin({extensions:".babylon",importMesh:function(a,b,d,j,g,h,m){var l="importMesh has failed JSON parse";try{var k=JSON.parse(d),l="",n,q,p=c.SceneLoader.loggingLevel===
c.SceneLoader.DETAILED_LOGGING;d=[];var r=[],t=[];n=0;for(q=k.meshes.length;q>n;n++){var s=k.meshes[n],u;if(!(u=!a))a:{var v=s,w=a,x=t,w=w instanceof Array?w:[w],B=void 0;for(B in w)if(v.name===w[B]){u=(x.push(v.id),!0);break a}u=v.parentId&&-1!==x.indexOf(v.parentId)?(x.push(v.id),!0):!1}if(u){if(a instanceof Array&&delete a[a.indexOf(s.name)],s.geometryId&&k.geometries){var y=!1;"boxes spheres cylinders toruses grounds planes torusKnots vertexData".split(" ").forEach(function(a){!y&&k.geometries[a]&&
k.geometries[a]instanceof Array&&k.geometries[a].forEach(function(d){if(d.id===s.geometryId){switch(a){case "boxes":c.Geometry.Primitives.Box.Parse(d,b);break;case "spheres":c.Geometry.Primitives.Sphere.Parse(d,b);break;case "cylinders":c.Geometry.Primitives.Cylinder.Parse(d,b);break;case "toruses":c.Geometry.Primitives.Torus.Parse(d,b);break;case "grounds":c.Geometry.Primitives.Ground.Parse(d,b);break;case "planes":c.Geometry.Primitives.Plane.Parse(d,b);break;case "torusKnots":c.Geometry.Primitives.TorusKnot.Parse(d,
b);break;case "vertexData":c.Geometry.Parse(d,b,j)}y=!0}})});y||c.Tools.Warn("Geometry not found for mesh "+s.id)}if(s.materialId){var C=-1!==r.indexOf(s.materialId);if(!C&&k.multiMaterials)for(var v=0,D=k.multiMaterials.length;D>v;v++){var A=k.multiMaterials[v];if(A.id===s.materialId){for(var v=0,I=A.materials.length;I>v;v++){var z=A.materials[v];r.push(z);var E=f(z,k,b,j),l=l+("\n\tMaterial "+E.toString(p))}r.push(A.id);var F=c.Material.ParseMultiMaterial(A,b),C=!0,l=l+("\n\tMulti-Material "+F.toString(p));
break}}C||(r.push(s.materialId),(E=f(s.materialId,k,b,j))?l+="\n\tMaterial "+E.toString(p):c.Tools.Warn("Material not found for mesh "+s.id))}if(-1<s.skeletonId&&b.skeletons&&!(-1<d.indexOf(s.skeletonId)))for(var v=0,J=k.skeletons.length;J>v;v++){var G=k.skeletons[v];if(G.id===s.skeletonId){var L=c.Skeleton.Parse(G,b);m.push(L);d.push(G.id);l+="\n\tSkeleton "+L.toString(p)}}var K=c.Mesh.Parse(s,b,j);g.push(K);l+="\n\tMesh "+K.toString(p)}}var H;n=0;for(q=b.meshes.length;q>n;n++)H=b.meshes[n],H._waitingParentId&&
(H.parent=b.getLastEntryByID(H._waitingParentId),H._waitingParentId=void 0);n=0;for(q=b.meshes.length;q>n;n++)H=b.meshes[n],H._waitingFreezeWorldMatrix?(H.freezeWorldMatrix(),H._waitingFreezeWorldMatrix=void 0):H.computeWorldMatrix(!0);if(k.particleSystems){n=0;for(q=k.particleSystems.length;q>n;n++){var M=k.particleSystems[n];-1!==t.indexOf(M.emitterId)&&h.push(c.ParticleSystem.Parse(M,b,j))}}return!0}catch(N){throw c.Tools.Log(e("importMesh",k.producer)+l),l=null,N;}finally{null!==l&&c.SceneLoader.loggingLevel!==
c.SceneLoader.NO_LOGGING&&c.Tools.Log(e("importMesh",k.producer)+(c.SceneLoader.loggingLevel!==c.SceneLoader.MINIMAL_LOGGING?l:""))}},load:function(a,b,d){var j="importScene has failed JSON parse";try{var g=JSON.parse(b),j="",h=c.SceneLoader.loggingLevel===c.SceneLoader.DETAILED_LOGGING;if(a.useDelayedTextureLoading=g.useDelayedTextureLoading&&!c.SceneLoader.ForceFullSceneLoadingForIncremental,a.autoClear=g.autoClear,a.clearColor=c.Color4.FromArray(g.clearColor),a.ambientColor=c.Color3.FromArray(g.ambientColor),
g.gravity&&(a.gravity=c.Vector3.FromArray(g.gravity)),g.fogMode&&0!==g.fogMode)switch(a.fogMode=g.fogMode,a.fogColor=c.Color3.FromArray(g.fogColor),a.fogStart=g.fogStart,a.fogEnd=g.fogEnd,a.fogDensity=g.fogDensity,j+="\tFog mode for scene:  ",a.fogMode){case 1:j+="exp\n";break;case 2:j+="exp2\n";break;case 3:j+="linear\n"}if(g.physicsEnabled){var f;"cannon"===g.physicsEngine?f=new c.CannonJSPlugin:"oimo"===g.physicsEngine&&(f=new c.OimoJSPlugin);var j="\tPhysics engine "+(g.physicsEngine?g.physicsEngine:
"oimo")+" enabled\n",l=g.physicsGravity?c.Vector3.FromArray(g.physicsGravity):null;a.enablePhysics(l,f)}void 0!=g.collisionsEnabled&&(a.collisionsEnabled=g.collisionsEnabled);a.workerCollisions=!!g.workerCollisions;var k,n;k=0;for(n=g.lights.length;n>k;k++)var q=c.Light.Parse(g.lights[k],a),j=j+(0===k?"\n\tLights:":""),j=j+("\n\t\t"+q.toString(h));if(g.animations){k=0;for(n=g.animations.length;n>k;k++){var p=c.Animation.Parse(g.animations[k]);a.animations.push(p);j+=0===k?"\n\tAnimations:":"";j+=
"\n\t\t"+p.toString(h)}}if(g.autoAnimate&&a.beginAnimation(a,g.autoAnimateFrom,g.autoAnimateTo,g.autoAnimateLoop,g.autoAnimateSpeed||1),g.materials){k=0;for(n=g.materials.length;n>k;k++)var r=c.Material.Parse(g.materials[k],a,d),j=j+(0===k?"\n\tMaterials:":""),j=j+("\n\t\t"+r.toString(h))}if(g.multiMaterials){k=0;for(n=g.multiMaterials.length;n>k;k++)var t=c.Material.ParseMultiMaterial(g.multiMaterials[k],a),j=j+(0===k?"\n\tMultiMaterials:":""),j=j+("\n\t\t"+t.toString(h))}if(g.skeletons){k=0;for(n=
g.skeletons.length;n>k;k++)var s=c.Skeleton.Parse(g.skeletons[k],a),j=j+(0===k?"\n\tSkeletons:":""),j=j+("\n\t\t"+s.toString(h))}var u=g.geometries;if(u){var v=u.boxes;if(v){k=0;for(n=v.length;n>k;k++)c.Geometry.Primitives.Box.Parse(v[k],a)}var w=u.spheres;if(w){k=0;for(n=w.length;n>k;k++)c.Geometry.Primitives.Sphere.Parse(w[k],a)}var x=u.cylinders;if(x){k=0;for(n=x.length;n>k;k++)c.Geometry.Primitives.Cylinder.Parse(x[k],a)}var B=u.toruses;if(B){k=0;for(n=B.length;n>k;k++)c.Geometry.Primitives.Torus.Parse(B[k],
a)}var y=u.grounds;if(y){k=0;for(n=y.length;n>k;k++)c.Geometry.Primitives.Ground.Parse(y[k],a)}var C=u.planes;if(C){k=0;for(n=C.length;n>k;k++)c.Geometry.Primitives.Plane.Parse(C[k],a)}var D=u.torusKnots;if(D){k=0;for(n=D.length;n>k;k++)c.Geometry.Primitives.TorusKnot.Parse(D[k],a)}var A=u.vertexData;if(A){k=0;for(n=A.length;n>k;k++)c.Geometry.Parse(A[k],a,d)}}k=0;for(n=g.meshes.length;n>k;k++)var I=c.Mesh.Parse(g.meshes[k],a,d),j=j+(0===k?"\n\tMeshes:":""),j=j+("\n\t\t"+I.toString(h));k=0;for(n=
g.cameras.length;n>k;k++)var z=c.Camera.Parse(g.cameras[k],a),j=j+(0===k?"\n\tCameras:":""),j=j+("\n\t\t"+z.toString(h));g.activeCameraID&&a.setActiveCameraByID(g.activeCameraID);k=0;for(n=a.cameras.length;n>k;k++)z=a.cameras[k],z._waitingParentId&&(z.parent=a.getLastEntryByID(z._waitingParentId),z._waitingParentId=void 0);k=0;for(n=a.lights.length;n>k;k++)q=a.lights[k],q._waitingParentId&&(q.parent=a.getLastEntryByID(q._waitingParentId),q._waitingParentId=void 0);var E;b=[];if(c.AudioEngine&&g.sounds){k=
0;for(n=g.sounds.length;n>k;k++){var F=g.sounds[k];c.Engine.audioEngine.canUseWebAudio?(F.url||(F.url=F.name),b[F.url]?c.Sound.Parse(F,a,d,b[F.url]):(E=c.Sound.Parse(F,a,d),b[F.url]=E)):new c.Sound(F.name,null,a)}}k=0;for(n=a.meshes.length;n>k;k++)I=a.meshes[k],I._waitingParentId&&(I.parent=a.getLastEntryByID(I._waitingParentId),I._waitingParentId=void 0),I._waitingActions&&(c.ActionManager.Parse(I._waitingActions,I,a),I._waitingActions=void 0);k=0;for(n=a.meshes.length;n>k;k++){var J=a.meshes[k];
J._waitingFreezeWorldMatrix?(J.freezeWorldMatrix(),J._waitingFreezeWorldMatrix=void 0):J.computeWorldMatrix(!0)}if(g.particleSystems){k=0;for(n=g.particleSystems.length;n>k;k++)c.ParticleSystem.Parse(g.particleSystems[k],a,d)}if(g.lensFlareSystems){k=0;for(n=g.lensFlareSystems.length;n>k;k++)c.LensFlareSystem.Parse(g.lensFlareSystems[k],a,d)}if(g.shadowGenerators){k=0;for(n=g.shadowGenerators.length;n>k;k++)c.ShadowGenerator.Parse(g.shadowGenerators[k],a)}return g.actions&&c.ActionManager.Parse(g.actions,
null,a),!0}catch(G){throw c.Tools.Log(e("importScene",g.producer)+j),G;}finally{null!==j&&c.SceneLoader.loggingLevel!==c.SceneLoader.NO_LOGGING&&c.Tools.Log(e("importScene",g.producer)+(c.SceneLoader.loggingLevel!==c.SceneLoader.MINIMAL_LOGGING?j:""))}}});!0}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(e,a,b,d,j,g,h){void 0===h&&(h=c.Texture.TRILINEAR_SAMPLINGMODE);this.name=e;this.cellSize=d;this.sprites=[];this.renderingGroupId=0;this.layerMask=268435455;this.fogEnabled=!0;this.isPickable=!1;this.onDisposeObservable=new c.Observable;this._vertexBuffers={};this._capacity=b;this._spriteTexture=new c.Texture(a,j,!0,!1,h);this._spriteTexture.wrapU=c.Texture.CLAMP_ADDRESSMODE;this._spriteTexture.wrapV=c.Texture.CLAMP_ADDRESSMODE;this._epsilon=void 0===g?0.01:g;this._scene=
j;this._scene.spriteManagers.push(this);e=[];for(d=a=0;b>d;d++)e.push(a),e.push(a+1),e.push(a+2),e.push(a),e.push(a+2),e.push(a+3),a+=4;this._indexBuffer=j.getEngine().createIndexBuffer(e);this._vertexData=new Float32Array(64*b);this._buffer=new c.Buffer(j.getEngine(),this._vertexData,!0,16);b=this._buffer.createVertexBuffer(c.VertexBuffer.PositionKind,0,4);j=this._buffer.createVertexBuffer("options",4,4);e=this._buffer.createVertexBuffer("cellInfo",8,4);a=this._buffer.createVertexBuffer(c.VertexBuffer.ColorKind,
12,4);this._vertexBuffers[c.VertexBuffer.PositionKind]=b;this._vertexBuffers.options=j;this._vertexBuffers.cellInfo=e;this._vertexBuffers[c.VertexBuffer.ColorKind]=a;this._effectBase=this._scene.getEngine().createEffect("sprites",[c.VertexBuffer.PositionKind,"options","cellInfo",c.VertexBuffer.ColorKind],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],"");this._effectFog=this._scene.getEngine().createEffect("sprites",[c.VertexBuffer.PositionKind,"options","cellInfo",c.VertexBuffer.ColorKind],
"view projection textureInfos alphaTest vFogInfos vFogColor".split(" "),["diffuseSampler"],"#define FOG")};f=(Object.defineProperty(f.prototype,"onDispose",{set:function(c){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(c)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"texture",{get:function(){return this._spriteTexture},set:function(c){this._spriteTexture=c},enumerable:!0,configurable:!0}),
f.prototype._appendSpriteVertex=function(c,a,b,d,j){c*=16;0===b?b=this._epsilon:1===b&&(b=1-this._epsilon);0===d?d=this._epsilon:1===d&&(d=1-this._epsilon);this._vertexData[c]=a.position.x;this._vertexData[c+1]=a.position.y;this._vertexData[c+2]=a.position.z;this._vertexData[c+3]=a.angle;this._vertexData[c+4]=a.width;this._vertexData[c+5]=a.height;this._vertexData[c+6]=b;this._vertexData[c+7]=d;this._vertexData[c+8]=a.invertU?1:0;this._vertexData[c+9]=a.invertV?1:0;b=a.cellIndex/j>>0;this._vertexData[c+
10]=a.cellIndex-b*j;this._vertexData[c+11]=b;this._vertexData[c+12]=a.color.r;this._vertexData[c+13]=a.color.g;this._vertexData[c+14]=a.color.b;this._vertexData[c+15]=a.color.a},f.prototype.intersects=function(e,a,b,d){var j,g=Math.min(this._capacity,this.sprites.length),h=c.Vector3.Zero(),f=c.Vector3.Zero(),l=Number.MAX_VALUE,k=c.Vector3.Zero();a=a.getViewMatrix();for(var n=0;g>n;n++){var q=this.sprites[n];if(q){if(b){if(!b(q))continue}else if(!q.isPickable)continue;if(c.Vector3.TransformCoordinatesToRef(q.position,
a,k),h.copyFromFloats(k.x-q.width/2,k.y-q.height/2,k.z),f.copyFromFloats(k.x+q.width/2,k.y+q.height/2,k.z),e.intersectsBoxMinMax(h,f)){var p=c.Vector3.Distance(k,e.origin);if(l>p&&(l=p,j=q,d))break}}}return j?(e=new c.PickingInfo,e.hit=!0,e.pickedSprite=j,e.distance=l,e):null},f.prototype.render=function(){if(this._effectBase.isReady()&&this._effectFog.isReady()&&this._spriteTexture&&this._spriteTexture.isReady()){for(var e=this._scene.getEngine(),a=this._spriteTexture.getBaseSize(),b=e.getDeltaTime(),
d=Math.min(this._capacity,this.sprites.length),j=a.width/this.cellSize,g=0,h=0;d>h;h++){var f=this.sprites[h];f&&(f._animate(b),this._appendSpriteVertex(g++,f,0,0,j),this._appendSpriteVertex(g++,f,1,0,j),this._appendSpriteVertex(g++,f,1,1,j),this._appendSpriteVertex(g++,f,0,1,j))}this._buffer.update(this._vertexData);b=this._effectBase;this._scene.fogEnabled&&this._scene.fogMode!==c.Scene.FOGMODE_NONE&&this.fogEnabled&&(b=this._effectFog);e.enableEffect(b);j=this._scene.getViewMatrix();b.setTexture("diffuseSampler",
this._spriteTexture);b.setMatrix("view",j);b.setMatrix("projection",this._scene.getProjectionMatrix());b.setFloat2("textureInfos",this.cellSize/a.width,this.cellSize/a.height);this._scene.fogEnabled&&this._scene.fogMode!==c.Scene.FOGMODE_NONE&&this.fogEnabled&&(b.setFloat4("vFogInfos",this._scene.fogMode,this._scene.fogStart,this._scene.fogEnd,this._scene.fogDensity),b.setColor3("vFogColor",this._scene.fogColor));e.bindBuffers(this._vertexBuffers,this._indexBuffer,b);e.setDepthFunctionToLessOrEqual();
b.setBool("alphaTest",!0);e.setColorWrite(!1);e.draw(!0,0,6*d);e.setColorWrite(!0);b.setBool("alphaTest",!1);e.setAlphaMode(c.Engine.ALPHA_COMBINE);e.draw(!0,0,6*d);e.setAlphaMode(c.Engine.ALPHA_DISABLE)}},f.prototype.dispose=function(){this._buffer&&(this._buffer.dispose(),this._buffer=null);this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this._spriteTexture&&(this._spriteTexture.dispose(),this._spriteTexture=null);var c=this._scene.spriteManagers.indexOf(this);
this._scene.spriteManagers.splice(c,1);this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear()},f);c.SpriteManager=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(e,a){this.name=e;this.color=new c.Color4(1,1,1,1);this.height=this.width=1;this.invertV=this.invertU=this.cellIndex=this.angle=0;this.animations=[];this._loopAnimation=this._animationStarted=this.isPickable=!1;this._delay=this._toIndex=this._fromIndex=0;this._direction=1;this._time=this._frameCount=0;this._manager=a;this._manager.sprites.push(this);this.position=c.Vector3.Zero()};f=(Object.defineProperty(f.prototype,"size",{get:function(){return this.width},set:function(c){this.height=
this.width=c},enumerable:!0,configurable:!0}),f.prototype.playAnimation=function(c,a,b,d){this._fromIndex=c;this._toIndex=a;this._loopAnimation=b;this._delay=d;this._animationStarted=!0;this._direction=a>c?1:-1;this.cellIndex=c;this._time=0},f.prototype.stopAnimation=function(){this._animationStarted=!1},f.prototype._animate=function(c){this._animationStarted&&(this._time+=c,this._time>this._delay&&(this._time%=this._delay,this.cellIndex+=this._direction,this.cellIndex==this._toIndex&&(this._loopAnimation?
this.cellIndex=this._fromIndex:(this._animationStarted=!1,this.disposeWhenFinishedAnimating&&this.dispose()))))},f.prototype.dispose=function(){for(var c=0;c<this._manager.sprites.length;c++)this._manager.sprites[c]==this&&this._manager.sprites.splice(c,1)},f);c.Sprite=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(e,a,b,d,j){this.name=e;this.scale=new c.Vector2(1,1);this.offset=new c.Vector2(0,0);this.alphaBlendingMode=c.Engine.ALPHA_COMBINE;this._vertexBuffers={};this.onDisposeObservable=new c.Observable;this.onBeforeRenderObservable=new c.Observable;this.onAfterRenderObservable=new c.Observable;this.texture=a?new c.Texture(a,b,!0):null;this.isBackground=void 0===d?!0:d;this.color=void 0===j?new c.Color4(1,1,1,1):j;this._scene=b;this._scene.layers.push(this);e=b.getEngine();a=
[];a.push(1,1);a.push(-1,1);a.push(-1,-1);a.push(1,-1);a=new c.VertexBuffer(e,a,c.VertexBuffer.PositionKind,!1,!1,2);this._vertexBuffers[c.VertexBuffer.PositionKind]=a;a=[];a.push(0);a.push(1);a.push(2);a.push(0);a.push(2);a.push(3);this._indexBuffer=e.createIndexBuffer(a);this._effect=e.createEffect("layer",[c.VertexBuffer.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],"");this._alphaTestEffect=e.createEffect("layer",[c.VertexBuffer.PositionKind],["textureMatrix","color",
"scale","offset"],["textureSampler"],"#define ALPHATEST")};f=(Object.defineProperty(f.prototype,"onDispose",{set:function(c){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(c)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"onBeforeRender",{set:function(c){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver);this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(c)},
enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"onAfterRender",{set:function(c){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver);this._onAfterRenderObserver=this.onAfterRenderObservable.add(c)},enumerable:!0,configurable:!0}),f.prototype.render=function(){var e=this.alphaTest?this._alphaTestEffect:this._effect;if(e.isReady()&&this.texture&&this.texture.isReady()){var a=this._scene.getEngine();this.onBeforeRenderObservable.notifyObservers(this);
a.enableEffect(e);a.setState(!1);e.setTexture("textureSampler",this.texture);e.setMatrix("textureMatrix",this.texture.getTextureMatrix());e.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a);e.setVector2("offset",this.offset);e.setVector2("scale",this.scale);a.bindBuffers(this._vertexBuffers,this._indexBuffer,e);this._alphaTestEffect?a.draw(!0,0,6):(a.setAlphaMode(this.alphaBlendingMode),a.draw(!0,0,6),a.setAlphaMode(c.Engine.ALPHA_DISABLE));this.onAfterRenderObservable.notifyObservers(this)}},
f.prototype.dispose=function(){var e=this._vertexBuffers[c.VertexBuffer.PositionKind];e&&(e.dispose(),this._vertexBuffers[c.VertexBuffer.PositionKind]=null);this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.texture&&(this.texture.dispose(),this.texture=null);e=this._scene.layers.indexOf(this);this._scene.layers.splice(e,1);this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear();this.onAfterRenderObservable.clear();this.onBeforeRenderObservable.clear()},
f);c.Layer=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){this.position=c.Vector3.Zero();this.direction=c.Vector3.Zero();this.color=new c.Color4(0,0,0,0);this.colorStep=new c.Color4(0,0,0,0);this.lifeTime=1;this.angularSpeed=this.angle=this.size=this.age=0};f=(f.prototype.copyTo=function(c){c.position.copyFrom(this.position);c.direction.copyFrom(this.direction);c.color.copyFrom(this.color);c.colorStep.copyFrom(this.colorStep);c.lifeTime=this.lifeTime;c.age=this.age;c.size=this.size;c.angle=this.angle;c.angularSpeed=this.angularSpeed},
f);c.Particle=f}(BABYLON||(BABYLON={}));
!function(c){var f=function(a,c){return a===c?a:Math.random()*(c-a)+a},e,a=function(b,d,e,g){var h=this;this.name=b;this.animations=[];this.renderingGroupId=0;this.emitter=null;this.emitRate=10;this.manualEmitCount=-1;this.updateSpeed=0.01;this.targetStopDuration=0;this.disposeOnStop=!1;this.maxSize=this.minSize=this.maxLifeTime=this.minLifeTime=this.maxEmitPower=this.minEmitPower=1;this.maxAngularSpeed=this.minAngularSpeed=0;this.layerMask=268435455;this.onDisposeObservable=new c.Observable;this.blendMode=
a.BLENDMODE_ONEONE;this.forceDepthWrite=!1;this.gravity=c.Vector3.Zero();this.direction1=new c.Vector3(0,1,0);this.direction2=new c.Vector3(0,1,0);this.minEmitBox=new c.Vector3(-0.5,-0.5,-0.5);this.maxEmitBox=new c.Vector3(0.5,0.5,0.5);this.color1=new c.Color4(1,1,1,1);this.color2=new c.Color4(1,1,1,1);this.colorDead=new c.Color4(0,0,0,1);this.textureMask=new c.Color4(1,1,1,1);this.particles=[];this._stockParticles=[];this._newPartsExcess=0;this._vertexBuffers={};this._scaledColorStep=new c.Color4(0,
0,0,0);this._colorDiff=new c.Color4(0,0,0,0);this._scaledDirection=c.Vector3.Zero();this._scaledGravity=c.Vector3.Zero();this._currentRenderId=-1;this._stopped=this._started=!1;this._actualFrame=0;this.id=b;this._capacity=d;this._scene=e;this._customEffect=g;e.particleSystems.push(this);b=[];for(var m=g=0;d>m;m++)b.push(g),b.push(g+1),b.push(g+2),b.push(g),b.push(g+2),b.push(g+3),g+=4;this._indexBuffer=e.getEngine().createIndexBuffer(b);this._vertexData=new Float32Array(44*d);this._vertexBuffer=new c.Buffer(e.getEngine(),
this._vertexData,!0,11);d=this._vertexBuffer.createVertexBuffer(c.VertexBuffer.PositionKind,0,3);e=this._vertexBuffer.createVertexBuffer(c.VertexBuffer.ColorKind,3,4);b=this._vertexBuffer.createVertexBuffer("options",7,4);this._vertexBuffers[c.VertexBuffer.PositionKind]=d;this._vertexBuffers[c.VertexBuffer.ColorKind]=e;this._vertexBuffers.options=b;this.startDirectionFunction=function(a,b,d){var g=f(h.direction1.x,h.direction2.x),e=f(h.direction1.y,h.direction2.y),j=f(h.direction1.z,h.direction2.z);
c.Vector3.TransformNormalFromFloatsToRef(g*a,e*a,j*a,b,d)};this.startPositionFunction=function(a,b){var d=f(h.minEmitBox.x,h.maxEmitBox.x),g=f(h.minEmitBox.y,h.maxEmitBox.y),e=f(h.minEmitBox.z,h.maxEmitBox.z);c.Vector3.TransformCoordinatesFromFloatsToRef(d,g,e,a,b)};this.updateFunction=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.age+=h._scaledUpdateSpeed;c.age>=c.lifeTime?(h.recycleParticle(c),b--):(c.colorStep.scaleToRef(h._scaledUpdateSpeed,h._scaledColorStep),c.color.addInPlace(h._scaledColorStep),
0>c.color.a&&(c.color.a=0),c.angle+=c.angularSpeed*h._scaledUpdateSpeed,c.direction.scaleToRef(h._scaledUpdateSpeed,h._scaledDirection),c.position.addInPlace(h._scaledDirection),h.gravity.scaleToRef(h._scaledUpdateSpeed,h._scaledGravity),c.direction.addInPlace(h._scaledGravity))}}};e=(Object.defineProperty(a.prototype,"onDispose",{set:function(a){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver);this._onDisposeObserver=this.onDisposeObservable.add(a)},enumerable:!0,
configurable:!0}),a.prototype.recycleParticle=function(a){var c=this.particles.pop();c!==a&&(c.copyTo(a),this._stockParticles.push(c))},a.prototype.getCapacity=function(){return this._capacity},a.prototype.isAlive=function(){return this._alive},a.prototype.isStarted=function(){return this._started},a.prototype.start=function(){this._started=!0;this._stopped=!1;this._actualFrame=0},a.prototype.stop=function(){this._stopped=!0},a.prototype._appendParticleVertex=function(a,c,e,g){a*=11;this._vertexData[a]=
c.position.x;this._vertexData[a+1]=c.position.y;this._vertexData[a+2]=c.position.z;this._vertexData[a+3]=c.color.r;this._vertexData[a+4]=c.color.g;this._vertexData[a+5]=c.color.b;this._vertexData[a+6]=c.color.a;this._vertexData[a+7]=c.angle;this._vertexData[a+8]=c.size;this._vertexData[a+9]=e;this._vertexData[a+10]=g},a.prototype._update=function(a){this._alive=0<this.particles.length;this.updateFunction(this.particles);var d;d=this.emitter.position?this.emitter.getWorldMatrix():c.Matrix.Translation(this.emitter.x,
this.emitter.y,this.emitter.z);for(var e,g=0;a>g&&this.particles.length!==this._capacity;g++){0!==this._stockParticles.length?(e=this._stockParticles.pop(),e.age=0):e=new c.Particle;this.particles.push(e);var h=f(this.minEmitPower,this.maxEmitPower);this.startDirectionFunction(h,d,e.direction,e);e.lifeTime=f(this.minLifeTime,this.maxLifeTime);e.size=f(this.minSize,this.maxSize);e.angularSpeed=f(this.minAngularSpeed,this.maxAngularSpeed);this.startPositionFunction(d,e.position,e);h=f(0,1);c.Color4.LerpToRef(this.color1,
this.color2,h,e.color);this.colorDead.subtractToRef(e.color,this._colorDiff);this._colorDiff.scaleToRef(1/e.lifeTime,e.colorStep)}},a.prototype._getEffect=function(){if(this._customEffect)return this._customEffect;var a=[];this._scene.clipPlane&&a.push("#define CLIPPLANE");a=a.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect("particles",[c.VertexBuffer.PositionKind,c.VertexBuffer.ColorKind,"options"],["invView","view","projection",
"vClipPlane","textureMask"],["diffuseSampler"],a)),this._effect},a.prototype.animate=function(){if(this._started){var a=this._getEffect();if(this.emitter&&a.isReady()&&this.particleTexture&&this.particleTexture.isReady()&&this._currentRenderId!==this._scene.getRenderId()){this._currentRenderId=this._scene.getRenderId();this._scaledUpdateSpeed=this.updateSpeed*this._scene.getAnimationRatio();var c;-1<this.manualEmitCount?(c=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0):(c=this.emitRate*
this._scaledUpdateSpeed>>0,this._newPartsExcess+=this.emitRate*this._scaledUpdateSpeed-c);1<this._newPartsExcess&&(c+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0);this._alive=!1;this._stopped?c=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop());this._update(c);this._stopped&&(this._alive||(this._started=!1,this.disposeOnStop&&this._scene._toBeDisposed.push(this)));for(c=a=0;c<this.particles.length;c++){var e=
this.particles[c];this._appendParticleVertex(a++,e,0,0);this._appendParticleVertex(a++,e,1,0);this._appendParticleVertex(a++,e,1,1);this._appendParticleVertex(a++,e,0,1)}this._vertexBuffer.update(this._vertexData)}}},a.prototype.render=function(){var b=this._getEffect();if(!this.emitter||!b.isReady()||!this.particleTexture||!this.particleTexture.isReady()||!this.particles.length)return 0;var d=this._scene.getEngine();d.enableEffect(b);d.setState(!1);var e=this._scene.getViewMatrix();if(b.setTexture("diffuseSampler",
this.particleTexture),b.setMatrix("view",e),b.setMatrix("projection",this._scene.getProjectionMatrix()),b.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._scene.clipPlane){var g=this._scene.clipPlane,e=e.clone();e.invert();b.setMatrix("invView",e);b.setFloat4("vClipPlane",g.normal.x,g.normal.y,g.normal.z,g.d)}return d.bindBuffers(this._vertexBuffers,this._indexBuffer,b),this.blendMode===a.BLENDMODE_ONEONE?d.setAlphaMode(c.Engine.ALPHA_ONEONE):
d.setAlphaMode(c.Engine.ALPHA_COMBINE),this.forceDepthWrite&&d.setDepthWrite(!0),d.draw(!0,0,6*this.particles.length),d.setAlphaMode(c.Engine.ALPHA_DISABLE),this.particles.length},a.prototype.dispose=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null);this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null);var a=this._scene.particleSystems.indexOf(this);
this._scene.particleSystems.splice(a,1);this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear()},a.prototype.clone=function(b,d){var e=new a(b,this._capacity,this._scene);return c.Tools.DeepCopy(this,e,["particles"]),void 0===d&&(d=this.emitter),e.emitter=d,this.particleTexture&&(e.particleTexture=new c.Texture(this.particleTexture.url,this._scene)),e.start(),e},a.prototype.serialize=function(){var a={};return a.name=this.name,a.id=this.id,this.emitter.position?a.emitterId=
this.emitter.id:a.emitter=this.emitter.asArray(),a.capacity=this.getCapacity(),this.particleTexture&&(a.textureName=this.particleTexture.name),c.Animation.AppendSerializedAnimations(this,a),a.minAngularSpeed=this.minAngularSpeed,a.maxAngularSpeed=this.maxAngularSpeed,a.minSize=this.minSize,a.maxSize=this.maxSize,a.minEmitPower=this.minEmitPower,a.maxEmitPower=this.maxEmitPower,a.minLifeTime=this.minLifeTime,a.maxLifeTime=this.maxLifeTime,a.emitRate=this.emitRate,a.minEmitBox=this.minEmitBox.asArray(),
a.maxEmitBox=this.maxEmitBox.asArray(),a.gravity=this.gravity.asArray(),a.direction1=this.direction1.asArray(),a.direction2=this.direction2.asArray(),a.color1=this.color1.asArray(),a.color2=this.color2.asArray(),a.colorDead=this.colorDead.asArray(),a.updateSpeed=this.updateSpeed,a.targetStopDuration=this.targetStopDuration,a.textureMask=this.textureMask.asArray(),a.blendMode=this.blendMode,a},a.Parse=function(b,d,e){var g=new a(b.name,b.capacity,d);if(b.id&&(g.id=b.id),b.textureName&&(g.particleTexture=
new c.Texture(e+b.textureName,d),g.particleTexture.name=b.textureName),b.emitterId?g.emitter=d.getLastMeshByID(b.emitterId):g.emitter=c.Vector3.FromArray(b.emitter),b.animations)for(e=0;e<b.animations.length;e++)g.animations.push(c.Animation.Parse(b.animations[e]));return b.autoAnimate&&d.beginAnimation(g,b.autoAnimateFrom,b.autoAnimateTo,b.autoAnimateLoop,b.autoAnimateSpeed||1),g.minAngularSpeed=b.minAngularSpeed,g.maxAngularSpeed=b.maxAngularSpeed,g.minSize=b.minSize,g.maxSize=b.maxSize,g.minLifeTime=
b.minLifeTime,g.maxLifeTime=b.maxLifeTime,g.minEmitPower=b.minEmitPower,g.maxEmitPower=b.maxEmitPower,g.emitRate=b.emitRate,g.minEmitBox=c.Vector3.FromArray(b.minEmitBox),g.maxEmitBox=c.Vector3.FromArray(b.maxEmitBox),g.gravity=c.Vector3.FromArray(b.gravity),g.direction1=c.Vector3.FromArray(b.direction1),g.direction2=c.Vector3.FromArray(b.direction2),g.color1=c.Color4.FromArray(b.color1),g.color2=c.Color4.FromArray(b.color2),g.colorDead=c.Color4.FromArray(b.colorDead),g.updateSpeed=b.updateSpeed,
g.targetStopDuration=b.targetStopDuration,g.textureMask=c.Color4.FromArray(b.textureMask),g.blendMode=b.blendMode,b.preventAutoStart||g.start(),g},a.BLENDMODE_ONEONE=0,a.BLENDMODE_STANDARD=1,a);c.ParticleSystem=e}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,b,c){this.name=a;this.from=b;this.to=c};f=(e.prototype.clone=function(){return new e(this.name,this.from,this.to)},e);c.AnimationRange=f;c.AnimationEvent=function(a,b,c){this.frame=a;this.action=b;this.onlyOnce=c;this.isDone=!1};var a;a=function(a){this.path=a;this._onchange=[];this.value=0;this.animations=[]};a=(a.prototype.getPoint=function(){var a=this.path.getPointAtLengthPosition(this.value);return new c.Vector3(a.x,0,a.y)},a.prototype.moveAhead=function(a){return void 0===
a&&(a=0.002),this.move(a),this},a.prototype.moveBack=function(a){return void 0===a&&(a=0.002),this.move(-a),this},a.prototype.move=function(a){if(1<Math.abs(a))throw"step size should be less than 1.";return this.value+=a,this.ensureLimits(),this.raiseOnChange(),this},a.prototype.ensureLimits=function(){for(;1<this.value;)this.value-=1;for(;0>this.value;)this.value+=1;return this},a.prototype.markAsDirty=function(){return this.ensureLimits(),this.raiseOnChange(),this},a.prototype.raiseOnChange=function(){var a=
this;return this._onchange.forEach(function(b){return b(a)}),this},a.prototype.onchange=function(a){return this._onchange.push(a),this},a);c.PathCursor=a;var b=function(a,c,g,h,e,f){this.name=a;this.targetProperty=c;this.framePerSecond=g;this.dataType=h;this.loopMode=e;this.enableBlending=f;this._offsetsCache={};this._highLimitsCache={};this._stopped=!1;this._blendingFactor=0;this._events=[];this.allowMatricesInterpolation=!1;this.blendingSpeed=0.01;this._ranges={};this.targetPropertyPath=c.split(".");
this.dataType=h;this.loopMode=void 0===e?b.ANIMATIONLOOPMODE_CYCLE:e};a=(b._PrepareAnimation=function(a,e,g,h,f,l,k,n){var q=void 0;if(!isNaN(parseFloat(f))&&isFinite(f)?q=b.ANIMATIONTYPE_FLOAT:f instanceof c.Quaternion?q=b.ANIMATIONTYPE_QUATERNION:f instanceof c.Vector3?q=b.ANIMATIONTYPE_VECTOR3:f instanceof c.Vector2?q=b.ANIMATIONTYPE_VECTOR2:f instanceof c.Color3?q=b.ANIMATIONTYPE_COLOR3:f instanceof c.Size&&(q=b.ANIMATIONTYPE_SIZE),void 0==q)return null;a=new b(a,e,g,q,k);e=[];return e.push({frame:0,
value:f}),e.push({frame:h,value:l}),a.setKeys(e),void 0!==n&&a.setEasingFunction(n),a},b.CreateAndStartAnimation=function(a,c,g,h,e,f,k,n,q,p){a=b._PrepareAnimation(a,g,h,e,f,k,n,q);return c.getScene().beginDirectAnimation(c,[a],0,e,1===a.loopMode,1,p)},b.CreateMergeAndStartAnimation=function(a,c,g,h,e,f,k,n,q,p){a=b._PrepareAnimation(a,g,h,e,f,k,n,q);return c.animations.push(a),c.getScene().beginAnimation(c,0,e,1===a.loopMode,1,p)},b.prototype.toString=function(a){var b="Name: "+this.name+", property: "+
this.targetProperty;if(b+=", datatype: "+"Float Vector3 Quaternion Matrix Color3 Vector2".split(" ")[this.dataType],b+=", nKeys: "+(this._keys?this._keys.length:"none"),b+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),a){b+=", Ranges: {";a=!0;for(var c in this._ranges)a&&(b+=", ",a=!1),b+=c;b+="}"}return b},b.prototype.addEvent=function(a){this._events.push(a)},b.prototype.removeEvents=function(a){for(var b=0;b<this._events.length;b++)this._events[b].frame===a&&(this._events.splice(b,
1),b--)},b.prototype.createRange=function(a,b,c){this._ranges[a]||(this._ranges[a]=new f(a,b,c))},b.prototype.deleteRange=function(a,b){if(void 0===b&&(b=!0),this._ranges[a]){if(b)for(var c=this._ranges[a].from,h=this._ranges[a].to,e=this._keys.length-1;0<=e;e--)this._keys[e].frame>=c&&this._keys[e].frame<=h&&this._keys.splice(e,1);this._ranges[a]=void 0}},b.prototype.getRange=function(a){return this._ranges[a]},b.prototype.reset=function(){this._offsetsCache={};this._highLimitsCache={};this._blendingFactor=
this.currentFrame=0;this._originalBlendValue=null},b.prototype.isStopped=function(){return this._stopped},b.prototype.getKeys=function(){return this._keys},b.prototype.getHighestFrame=function(){for(var a=0,b=0,c=this._keys.length;c>b;b++)a<this._keys[b].frame&&(a=this._keys[b].frame);return a},b.prototype.getEasingFunction=function(){return this._easingFunction},b.prototype.setEasingFunction=function(a){this._easingFunction=a},b.prototype.floatInterpolateFunction=function(a,b,c){return a+(b-a)*c},
b.prototype.quaternionInterpolateFunction=function(a,b,g){return c.Quaternion.Slerp(a,b,g)},b.prototype.vector3InterpolateFunction=function(a,b,g){return c.Vector3.Lerp(a,b,g)},b.prototype.vector2InterpolateFunction=function(a,b,g){return c.Vector2.Lerp(a,b,g)},b.prototype.sizeInterpolateFunction=function(a,b,g){return c.Size.Lerp(a,b,g)},b.prototype.color3InterpolateFunction=function(a,b,g){return c.Color3.Lerp(a,b,g)},b.prototype.matrixInterpolateFunction=function(a,b,g){return c.Matrix.Lerp(a,
b,g)},b.prototype.clone=function(){var a=new b(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(this._keys&&a.setKeys(this._keys),this._ranges){a._ranges={};for(var c in this._ranges)a._ranges[c]=this._ranges[c].clone()}return a},b.prototype.setKeys=function(a){this._keys=a.slice(0);this._offsetsCache={};this._highLimitsCache={}},b.prototype._getKeyValue=function(a){return"function"==typeof a?a():a},b.prototype._interpolate=function(a,c,g,h,e){if(g===
b.ANIMATIONLOOPMODE_CONSTANT&&0<c)return e.clone?e.clone():e;this.currentFrame=a;e=Math.max(0,Math.min(this._keys.length-1,Math.floor(this._keys.length*(a-this._keys[0].frame)/(this._keys[this._keys.length-1].frame-this._keys[0].frame))-1));if(this._keys[e].frame>=a)for(;0<=e-1&&this._keys[e].frame>=a;)e--;for(var f=e;f<this._keys.length;f++)if(this._keys[f+1].frame>=a){e=this._getKeyValue(this._keys[f].value);var k=this._getKeyValue(this._keys[f+1].value);a=(a-this._keys[f].frame)/(this._keys[f+
1].frame-this._keys[f].frame);switch(null!=this._easingFunction&&(a=this._easingFunction.ease(a)),this.dataType){case b.ANIMATIONTYPE_FLOAT:switch(g){case b.ANIMATIONLOOPMODE_CYCLE:case b.ANIMATIONLOOPMODE_CONSTANT:return this.floatInterpolateFunction(e,k,a);case b.ANIMATIONLOOPMODE_RELATIVE:return h*c+this.floatInterpolateFunction(e,k,a)}break;case b.ANIMATIONTYPE_QUATERNION:f=null;switch(g){case b.ANIMATIONLOOPMODE_CYCLE:case b.ANIMATIONLOOPMODE_CONSTANT:f=this.quaternionInterpolateFunction(e,k,
a);break;case b.ANIMATIONLOOPMODE_RELATIVE:f=this.quaternionInterpolateFunction(e,k,a).add(h.scale(c))}return f;case b.ANIMATIONTYPE_VECTOR3:switch(g){case b.ANIMATIONLOOPMODE_CYCLE:case b.ANIMATIONLOOPMODE_CONSTANT:return this.vector3InterpolateFunction(e,k,a);case b.ANIMATIONLOOPMODE_RELATIVE:return this.vector3InterpolateFunction(e,k,a).add(h.scale(c))}case b.ANIMATIONTYPE_VECTOR2:switch(g){case b.ANIMATIONLOOPMODE_CYCLE:case b.ANIMATIONLOOPMODE_CONSTANT:return this.vector2InterpolateFunction(e,
k,a);case b.ANIMATIONLOOPMODE_RELATIVE:return this.vector2InterpolateFunction(e,k,a).add(h.scale(c))}case b.ANIMATIONTYPE_SIZE:switch(g){case b.ANIMATIONLOOPMODE_CYCLE:case b.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(e,k,a);case b.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(e,k,a).add(h.scale(c))}case b.ANIMATIONTYPE_COLOR3:switch(g){case b.ANIMATIONLOOPMODE_CYCLE:case b.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(e,k,a);case b.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(e,
k,a).add(h.scale(c))}case b.ANIMATIONTYPE_MATRIX:switch(g){case b.ANIMATIONLOOPMODE_CYCLE:case b.ANIMATIONLOOPMODE_CONSTANT:if(this.allowMatricesInterpolation)return this.matrixInterpolateFunction(e,k,a);case b.ANIMATIONLOOPMODE_RELATIVE:return e}}break}return this._getKeyValue(this._keys[this._keys.length-1].value)},b.prototype.setValue=function(a){var b,g;if(1<this.targetPropertyPath.length){g=this._target[this.targetPropertyPath[0]];for(b=1;b<this.targetPropertyPath.length-1;b++)g=g[this.targetPropertyPath[b]];
b=this.targetPropertyPath[this.targetPropertyPath.length-1]}else b=this.targetPropertyPath[0],g=this._target;this.enableBlending&&1>=this._blendingFactor?(this._originalBlendValue||(g[b].clone?this._originalBlendValue=g[b].clone():this._originalBlendValue=g[b]),this._originalBlendValue.prototype?this._originalBlendValue.prototype.Lerp?g[b]=this._originalBlendValue.construtor.prototype.Lerp(a,this._originalBlendValue,this._blendingFactor):g[b]=a:this._originalBlendValue.m?g[b]=c.Matrix.Lerp(this._originalBlendValue,
a,this._blendingFactor):g[b]=this._originalBlendValue*(1-this._blendingFactor)+this._blendingFactor*a,this._blendingFactor+=this.blendingSpeed):g[b]=a;this._target.markAsDirty&&this._target.markAsDirty(this.targetProperty)},b.prototype.goToFrame=function(a){a<this._keys[0].frame?a=this._keys[0].frame:a>this._keys[this._keys.length-1].frame&&(a=this._keys[this._keys.length-1].frame);a=this._interpolate(a,0,this.loopMode);this.setValue(a)},b.prototype.animate=function(a,e,g,h,f){if(!this.targetPropertyPath||
1>this.targetPropertyPath.length)return this._stopped=!0,!1;var l=!0;0!==this._keys[0].frame&&this._keys.splice(0,0,{frame:0,value:this._keys[0].value});(e<this._keys[0].frame||e>this._keys[this._keys.length-1].frame)&&(e=this._keys[0].frame);(g<this._keys[0].frame||g>this._keys[this._keys.length-1].frame)&&(g=this._keys[this._keys.length-1].frame);var k,n=g-e;a=a*this.framePerSecond*f/1E3;f=0;if(a>n&&!h)l=!1,f=this._getKeyValue(this._keys[this._keys.length-1].value);else if(this.loopMode!==b.ANIMATIONLOOPMODE_CYCLE){k=
g.toString()+e.toString();if(!this._offsetsCache[k]){h=this._interpolate(e,0,b.ANIMATIONLOOPMODE_CYCLE);f=this._interpolate(g,0,b.ANIMATIONLOOPMODE_CYCLE);switch(this.dataType){case b.ANIMATIONTYPE_FLOAT:this._offsetsCache[k]=f-h;break;case b.ANIMATIONTYPE_QUATERNION:this._offsetsCache[k]=f.subtract(h);break;case b.ANIMATIONTYPE_VECTOR3:this._offsetsCache[k]=f.subtract(h);case b.ANIMATIONTYPE_VECTOR2:this._offsetsCache[k]=f.subtract(h);case b.ANIMATIONTYPE_SIZE:this._offsetsCache[k]=f.subtract(h);
case b.ANIMATIONTYPE_COLOR3:this._offsetsCache[k]=f.subtract(h)}this._highLimitsCache[k]=f}f=this._highLimitsCache[k];k=this._offsetsCache[k]}if(void 0===k)switch(this.dataType){case b.ANIMATIONTYPE_FLOAT:k=0;break;case b.ANIMATIONTYPE_QUATERNION:k=new c.Quaternion(0,0,0,0);break;case b.ANIMATIONTYPE_VECTOR3:k=c.Vector3.Zero();break;case b.ANIMATIONTYPE_VECTOR2:k=c.Vector2.Zero();break;case b.ANIMATIONTYPE_SIZE:k=c.Size.Zero();break;case b.ANIMATIONTYPE_COLOR3:k=c.Color3.Black()}e=l?e+a%n:g;n=this._interpolate(e,
a/n>>0,this.loopMode,k,f);this.setValue(n);for(n=0;n<this._events.length;n++)e>=this._events[n].frame?(g=this._events[n],g.isDone||(g.onlyOnce&&(this._events.splice(n,1),n--),g.isDone=!0,g.action())):this._events[n].isDone&&!this._events[n].onlyOnce&&(this._events[n].isDone=!1);return l||(this._stopped=!0),l},b.prototype.serialize=function(){var a={};a.name=this.name;a.property=this.targetProperty;a.framePerSecond=this.framePerSecond;a.dataType=this.dataType;a.loopBehavior=this.loopMode;var c=this.dataType;
a.keys=[];for(var g=this.getKeys(),h=0;h<g.length;h++){var e=g[h],f={};switch(f.frame=e.frame,c){case b.ANIMATIONTYPE_FLOAT:f.values=[e.value];break;case b.ANIMATIONTYPE_QUATERNION:case b.ANIMATIONTYPE_MATRIX:case b.ANIMATIONTYPE_VECTOR3:case b.ANIMATIONTYPE_COLOR3:f.values=e.value.asArray()}a.keys.push(f)}a.ranges=[];for(var k in this._ranges)c={},c.name=k,c.from=this._ranges[k].from,c.to=this._ranges[k].to,a.ranges.push(c);return a},Object.defineProperty(b,"ANIMATIONTYPE_FLOAT",{get:function(){return b._ANIMATIONTYPE_FLOAT},
enumerable:!0,configurable:!0}),Object.defineProperty(b,"ANIMATIONTYPE_VECTOR3",{get:function(){return b._ANIMATIONTYPE_VECTOR3},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ANIMATIONTYPE_VECTOR2",{get:function(){return b._ANIMATIONTYPE_VECTOR2},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ANIMATIONTYPE_SIZE",{get:function(){return b._ANIMATIONTYPE_SIZE},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ANIMATIONTYPE_QUATERNION",{get:function(){return b._ANIMATIONTYPE_QUATERNION},
enumerable:!0,configurable:!0}),Object.defineProperty(b,"ANIMATIONTYPE_MATRIX",{get:function(){return b._ANIMATIONTYPE_MATRIX},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ANIMATIONTYPE_COLOR3",{get:function(){return b._ANIMATIONTYPE_COLOR3},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ANIMATIONLOOPMODE_RELATIVE",{get:function(){return b._ANIMATIONLOOPMODE_RELATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ANIMATIONLOOPMODE_CYCLE",{get:function(){return b._ANIMATIONLOOPMODE_CYCLE},
enumerable:!0,configurable:!0}),Object.defineProperty(b,"ANIMATIONLOOPMODE_CONSTANT",{get:function(){return b._ANIMATIONLOOPMODE_CONSTANT},enumerable:!0,configurable:!0}),b.Parse=function(a){var e,g,h=new b(a.name,a.property,a.framePerSecond,a.dataType,a.loopBehavior),f=a.dataType,l=[];for(g=0;g<a.keys.length;g++){var k=a.keys[g];switch(f){case b.ANIMATIONTYPE_FLOAT:e=k.values[0];break;case b.ANIMATIONTYPE_QUATERNION:e=c.Quaternion.FromArray(k.values);break;case b.ANIMATIONTYPE_MATRIX:e=c.Matrix.FromArray(k.values);
break;case b.ANIMATIONTYPE_COLOR3:e=c.Color3.FromArray(k.values);break;default:e=c.Vector3.FromArray(k.values)}l.push({frame:k.frame,value:e})}if(h.setKeys(l),a.ranges)for(g=0;g<a.ranges.length;g++)e=a.ranges[g],h.createRange(e.name,e.from,e.to);return h},b.AppendSerializedAnimations=function(a,b){if(a.animations){b.animations=[];for(var c=0;c<a.animations.length;c++)b.animations.push(a.animations[c].serialize())}},b._ANIMATIONTYPE_FLOAT=0,b._ANIMATIONTYPE_VECTOR3=1,b._ANIMATIONTYPE_QUATERNION=2,
b._ANIMATIONTYPE_MATRIX=3,b._ANIMATIONTYPE_COLOR3=4,b._ANIMATIONTYPE_VECTOR2=5,b._ANIMATIONTYPE_SIZE=6,b._ANIMATIONLOOPMODE_RELATIVE=0,b._ANIMATIONLOOPMODE_CYCLE=1,b._ANIMATIONLOOPMODE_CONSTANT=2,b);c.Animation=a}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(c,a,b,d,j,g,h,f){void 0===b&&(b=0);void 0===d&&(d=100);void 0===j&&(j=!1);void 0===g&&(g=1);this.target=a;this.fromFrame=b;this.toFrame=d;this.loopAnimation=j;this.speedRatio=g;this.onAnimationEnd=h;this._animations=[];this.animationStarted=this._paused=!1;f&&this.appendAnimations(a,f);this._scene=c;c._activeAnimatables.push(this)};f=(f.prototype.getAnimations=function(){return this._animations},f.prototype.appendAnimations=function(c,a){for(var b=0;b<a.length;b++){var d=
a[b];d._target=c;this._animations.push(d)}},f.prototype.getAnimationByTargetProperty=function(c){for(var a=this._animations,b=0;b<a.length;b++)if(a[b].targetProperty===c)return a[b];return null},f.prototype.reset=function(){for(var c=this._animations,a=0;a<c.length;a++)c[a].reset();this._pausedDelay=this._localDelayOffset=null},f.prototype.enableBlending=function(c){for(var a=this._animations,b=0;b<a.length;b++)a[b].enableBlending=!0,a[b].blendingSpeed=c},f.prototype.disableBlending=function(){for(var c=
this._animations,a=0;a<c.length;a++)c[a].enableBlending=!1},f.prototype.goToFrame=function(c){for(var a=this._animations,b=0;b<a.length;b++)a[b].goToFrame(c)},f.prototype.pause=function(){this._paused||(this._paused=!0)},f.prototype.restart=function(){this._paused=!1},f.prototype.stop=function(){var c=this._scene._activeAnimatables.indexOf(this);if(-1<c){this._scene._activeAnimatables.splice(c,1);for(var a=this._animations,c=0;c<a.length;c++)a[c].reset();this.onAnimationEnd&&this.onAnimationEnd()}},
f.prototype._animate=function(c){if(this._paused)return this.animationStarted=!1,this._pausedDelay||(this._pausedDelay=c),!0;this._localDelayOffset?this._pausedDelay&&(this._localDelayOffset+=c-this._pausedDelay,this._pausedDelay=null):this._localDelayOffset=c;var a,b=!1,d=this._animations;for(a=0;a<d.length;a++)var j=d[a].animate(c-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this.speedRatio),b=b||j;return this.animationStarted=b,b||(a=this._scene._activeAnimatables.indexOf(this),
this._scene._activeAnimatables.splice(a,1)),!b&&this.onAnimationEnd&&(this.onAnimationEnd(),this.onAnimationEnd=null),b},f);c.Animatable=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(){this._easingMode=e.EASINGMODE_EASEIN};f=(Object.defineProperty(e,"EASINGMODE_EASEIN",{get:function(){return e._EASINGMODE_EASEIN},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EASINGMODE_EASEOUT",{get:function(){return e._EASINGMODE_EASEOUT},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EASINGMODE_EASEINOUT",{get:function(){return e._EASINGMODE_EASEINOUT},enumerable:!0,configurable:!0}),e.prototype.setEasingMode=function(a){this._easingMode=Math.min(Math.max(a,
0),2)},e.prototype.getEasingMode=function(){return this._easingMode},e.prototype.easeInCore=function(){throw Error("You must implement this method");},e.prototype.ease=function(a){switch(this._easingMode){case e.EASINGMODE_EASEIN:return this.easeInCore(a);case e.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-a)}return 0.5<=a?0.5*(1-this.easeInCore(2*(1-a)))+0.5:0.5*this.easeInCore(2*a)},e._EASINGMODE_EASEIN=0,e._EASINGMODE_EASEOUT=1,e._EASINGMODE_EASEINOUT=2,e);c.EasingFunction=f;var a;a=function(){f.apply(this,
arguments)};a=(__extends(a,f),a.prototype.easeInCore=function(a){return a=Math.max(0,Math.min(1,a)),1-Math.sqrt(1-a*a)},a);c.CircleEase=a;a=function(a){void 0===a&&(a=1);f.call(this);this.amplitude=a};a=(__extends(a,f),a.prototype.easeInCore=function(a){var c=Math.max(0,this.amplitude);return Math.pow(a,3)-a*c*Math.sin(3.141592653589793*a)},a);c.BackEase=a;a=function(a,c){void 0===a&&(a=3);void 0===c&&(c=2);f.call(this);this.bounces=a;this.bounciness=c};a=(__extends(a,f),a.prototype.easeInCore=function(a){var c=
Math.max(0,this.bounces),e=this.bounciness;1>=e&&(e=1.001);var g=Math.pow(e,c),h=1-e,f=(1-g)/h+0.5*g,g=Math.log(-(a*f)*(1-e)+1)/Math.log(e),g=Math.floor(g),l=g+1,k=(1-Math.pow(e,g))/(h*f),h=(1-Math.pow(e,l))/(h*f),h=0.5*(k+h);a-=h;k=h-k;return-Math.pow(1/e,c-g)/(k*k)*(a-k)*(a+k)},a);c.BounceEase=a;a=function(){f.apply(this,arguments)};a=(__extends(a,f),a.prototype.easeInCore=function(a){return a*a*a},a);c.CubicEase=a;a=function(a,c){void 0===a&&(a=3);void 0===c&&(c=3);f.call(this);this.oscillations=
a;this.springiness=c};a=(__extends(a,f),a.prototype.easeInCore=function(a){var c,e=Math.max(0,this.oscillations),g=Math.max(0,this.springiness);return c=0==g?a:(Math.exp(g*a)-1)/(Math.exp(g)-1),c*Math.sin((6.283185307179586*e+1.5707963267948966)*a)},a);c.ElasticEase=a;a=function(a){void 0===a&&(a=2);f.call(this);this.exponent=a};a=(__extends(a,f),a.prototype.easeInCore=function(a){return 0>=this.exponent?a:(Math.exp(this.exponent*a)-1)/(Math.exp(this.exponent)-1)},a);c.ExponentialEase=a;a=function(a){void 0===
a&&(a=2);f.call(this);this.power=a};a=(__extends(a,f),a.prototype.easeInCore=function(a){var c=Math.max(0,this.power);return Math.pow(a,c)},a);c.PowerEase=a;a=function(){f.apply(this,arguments)};a=(__extends(a,f),a.prototype.easeInCore=function(a){return a*a},a);c.QuadraticEase=a;a=function(){f.apply(this,arguments)};a=(__extends(a,f),a.prototype.easeInCore=function(a){return a*a*a*a},a);c.QuarticEase=a;a=function(){f.apply(this,arguments)};a=(__extends(a,f),a.prototype.easeInCore=function(a){return a*
a*a*a*a},a);c.QuinticEase=a;a=function(){f.apply(this,arguments)};a=(__extends(a,f),a.prototype.easeInCore=function(a){return 1-Math.sin(1.5707963267948966*(1-a))},a);c.SineEase=a;a=function(a,c,e,g){void 0===a&&(a=0);void 0===c&&(c=0);void 0===e&&(e=1);void 0===g&&(g=1);f.call(this);this.x1=a;this.y1=c;this.x2=e;this.y2=g};a=(__extends(a,f),a.prototype.easeInCore=function(a){return c.BezierCurve.interpolate(a,this.x1,this.y1,this.x2,this.y2)},a);c.BezierCurveEase=a}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Node;f=function(a,b,d,j,g){e.call(this,a,b.getScene());this.name=a;this.children=[];this.animations=[];this._worldTransform=new c.Matrix;this._absoluteTransform=new c.Matrix;this._invertedAbsoluteTransform=new c.Matrix;this._skeleton=b;this._baseMatrix=this._matrix=j;this._restPose=g?g:j.clone();b.bones.push(this);d?(this._parent=d,d.children.push(this)):this._parent=null;this._updateDifferenceMatrix()};f=(__extends(f,e),f.prototype.getParent=function(){return this._parent},
f.prototype.getLocalMatrix=function(){return this._matrix},f.prototype.getBaseMatrix=function(){return this._baseMatrix},f.prototype.getRestPose=function(){return this._restPose},f.prototype.returnToRest=function(){this.updateMatrix(this._restPose.clone())},f.prototype.getWorldMatrix=function(){return this._worldTransform},f.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},f.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},f.prototype.updateMatrix=
function(a){this._baseMatrix=a.clone();this._matrix=a.clone();this._skeleton._markAsDirty();this._updateDifferenceMatrix()},f.prototype._updateDifferenceMatrix=function(a){a||(a=this._baseMatrix);this._parent?a.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(a);this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform);for(a=0;a<this.children.length;a++)this.children[a]._updateDifferenceMatrix()},f.prototype.markAsDirty=function(){this._currentRenderId++;
this._skeleton._markAsDirty()},f.prototype.copyAnimationRange=function(a,b,d,e,g){void 0===e&&(e=!1);void 0===g&&(g=null);0===this.animations.length&&(this.animations.push(new c.Animation(this.name,"_matrix",a.animations[0].framePerSecond,c.Animation.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var h=a.animations[0].getRange(b);if(!h)return!1;var f,l,k,n=h.from,h=h.to,q=a.animations[0].getKeys(),p=a.length;a=a.getParent();f=this.getParent();a=(p=e&&a&&p&&this.length&&p!==this.length)?
f.length/a.length:null;for(var r=e&&!f&&g&&(1!==g.x||1!==g.y||1!==g.z),t=this.animations[0].getKeys(),s=0,u=q.length;u>s;s++)f=q[s],f.frame>=n&&f.frame<=h&&(e?(k=f.value.clone(),p?(l=k.getTranslation(),k.setTranslation(l.scaleInPlace(a))):r?(l=k.getTranslation(),k.setTranslation(l.multiplyInPlace(g))):k=f.value):k=f.value,t.push({frame:f.frame+d,value:k}));return this.animations[0].createRange(b,n+d,h+d),!0},f);c.Bone=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,b,d){this.name=a;this.id=b;this.bones=[];this.needInitialSkinMatrix=!1;this._isDirty=!0;this._meshesWithPoseMatrix=[];this._identity=c.Matrix.Identity();this._ranges={};this.bones=[];this._scene=d;d.skeletons.push(this);this._isDirty=!0};f=(e.prototype.getTransformMatrices=function(a){return this.needInitialSkinMatrix&&a._bonesTransformMatrices?a._bonesTransformMatrices:this._transformMatrices},e.prototype.getScene=function(){return this._scene},e.prototype.toString=
function(a){var b="Name: "+this.name+", nBones: "+this.bones.length;if(b+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),a){b+=", Ranges: {";a=!0;for(var c in this._ranges)a&&(b+=", ",a=!1),b+=c;b+="}"}return b},e.prototype.getBoneIndexByName=function(a){for(var b=0,c=this.bones.length;c>b;b++)if(this.bones[b].name===a)return b;return-1},e.prototype.createAnimationRange=function(a,b,d){if(!this._ranges[a]){this._ranges[a]=new c.AnimationRange(a,b,d);for(var e=0,g=this.bones.length;g>
e;e++)this.bones[e].animations[0]&&this.bones[e].animations[0].createRange(a,b,d)}},e.prototype.deleteAnimationRange=function(a,b){void 0===b&&(b=!0);for(var c=0,e=this.bones.length;e>c;c++)this.bones[c].animations[0]&&this.bones[c].animations[0].deleteRange(a,b);this._ranges[a]=void 0},e.prototype.getAnimationRange=function(a){return this._ranges[a]},e.prototype.getAnimationRanges=function(){var a,b=[],c=0;for(a in this._ranges)b[c]=this._ranges[a],c++;return b},e.prototype.copyAnimationRange=function(a,
b,d){if(void 0===d&&(d=!1),this._ranges[b]||!a.getAnimationRange(b))return!1;var e,g,h=!0,f=this._getHighestAnimationFrame()+1,l={},k=a.bones;g=0;for(e=k.length;e>g;g++)l[k[g].name]=k[g];this.bones.length!==k.length&&(c.Tools.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+k.length),h=!1);k=d&&this.dimensionsAtRest&&a.dimensionsAtRest?this.dimensionsAtRest.divide(a.dimensionsAtRest):null;g=0;for(e=this.bones.length;e>g;g++){var n=this.bones[g].name,q=l[n];q?h=
h&&this.bones[g].copyAnimationRange(q,b,f,d,k):(c.Tools.Warn("copyAnimationRange: not same rig, missing source bone "+n),h=!1)}a=a.getAnimationRange(b);return this._ranges[b]=new c.AnimationRange(b,a.from+f,a.to+f),h},e.prototype.returnToRest=function(){for(var a=0;a<this.bones.length;a++)this.bones[a].returnToRest()},e.prototype._getHighestAnimationFrame=function(){for(var a=0,b=0,c=this.bones.length;c>b;b++)if(this.bones[b].animations[0]){var e=this.bones[b].animations[0].getHighestFrame();e>a&&
(a=e)}return a},e.prototype.beginAnimation=function(a,b,c,e){return(a=this.getAnimationRange(a))?this._scene.beginAnimation(this,a.from,a.to,b,c,e):null},e.prototype._markAsDirty=function(){this._isDirty=!0},e.prototype._registerMeshWithPoseMatrix=function(a){this._meshesWithPoseMatrix.push(a)},e.prototype._unregisterMeshWithPoseMatrix=function(a){a=this._meshesWithPoseMatrix.indexOf(a);-1<a&&this._meshesWithPoseMatrix.splice(a,1)},e.prototype._computeTransformMatrices=function(a,b){for(var c=0;c<
this.bones.length;c++){var e=this.bones[c],g=e.getParent();g?e.getLocalMatrix().multiplyToRef(g.getWorldMatrix(),e.getWorldMatrix()):b?e.getLocalMatrix().multiplyToRef(b,e.getWorldMatrix()):e.getWorldMatrix().copyFrom(e.getLocalMatrix());e.getInvertedAbsoluteTransform().multiplyToArray(e.getWorldMatrix(),a,16*c)}this._identity.copyToArray(a,16*this.bones.length)},e.prototype.prepare=function(){if(this._isDirty){if(this.needInitialSkinMatrix)for(var a=0;a<this._meshesWithPoseMatrix.length;a++){var b=
this._meshesWithPoseMatrix[a];b._bonesTransformMatrices&&b._bonesTransformMatrices.length===16*(this.bones.length+1)||(b._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)));for(var d=b.getPoseMatrix(),e=0;e<this.bones.length;e++){var g=this.bones[e];g.getParent()||(g.getBaseMatrix().multiplyToRef(d,c.Tmp.Matrix[0]),g._updateDifferenceMatrix(c.Tmp.Matrix[0]))}this._computeTransformMatrices(b._bonesTransformMatrices,d)}else this._transformMatrices&&this._transformMatrices.length===16*
(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1))),this._computeTransformMatrices(this._transformMatrices,null);this._isDirty=!1;this._scene._activeBones+=this.bones.length}},e.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var a=0;a<this.bones.length;a++)this._animatables.push(this.bones[a])}return this._animatables},e.prototype.clone=function(a,b){var d=new e(a,b||a,this._scene);
d.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var j=0;j<this.bones.length;j++){var g=this.bones[j],h=null;g.getParent()&&(h=this.bones.indexOf(g.getParent()),h=d.bones[h]);h=new c.Bone(g.name,d,h,g.getBaseMatrix().clone(),g.getRestPose().clone());c.Tools.DeepCopy(g.animations,h.animations)}if(this._ranges){d._ranges={};for(var f in this._ranges)d._ranges[f]=this._ranges[f].clone()}return this._isDirty=!0,d},e.prototype.enableBlending=function(a){void 0===a&&(a=0.01);this.bones.forEach(function(b){b.animations.forEach(function(b){b.enableBlending=
!0;b.blendingSpeed=a})})},e.prototype.dispose=function(){this._meshesWithPoseMatrix=[];this.getScene().stopAnimation(this);this.getScene().removeSkeleton(this)},e.prototype.serialize=function(){var a={};a.name=this.name;a.id=this.id;a.dimensionsAtRest=this.dimensionsAtRest;a.bones=[];a.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var b=0;b<this.bones.length;b++){var c=this.bones[b],e={parentBoneIndex:c.getParent()?this.bones.indexOf(c.getParent()):-1,name:c.name,matrix:c.getLocalMatrix().toArray(),
rest:c.getRestPose().toArray()};a.bones.push(e);c.length&&(e.length=c.length);c.animations&&0<c.animations.length&&(e.animation=c.animations[0].serialize());a.ranges=[];for(var g in this._ranges)c={},c.name=g,c.from=this._ranges[g].from,c.to=this._ranges[g].to,a.ranges.push(c)}return a},e.Parse=function(a,b){var d=new e(a.name,a.id,b);a.dimensionsAtRest&&(d.dimensionsAtRest=c.Vector3.FromArray(a.dimensionsAtRest));d.needInitialSkinMatrix=a.needInitialSkinMatrix;var j;for(j=0;j<a.bones.length;j++){var g=
a.bones[j],h=null;-1<g.parentBoneIndex&&(h=d.bones[g.parentBoneIndex]);var f=g.rest?c.Matrix.FromArray(g.rest):null,h=new c.Bone(g.name,d,h,c.Matrix.FromArray(g.matrix),f);g.length&&(h.length=g.length);g.animation&&h.animations.push(c.Animation.Parse(g.animation))}if(a.ranges)for(j=0;j<a.ranges.length;j++)g=a.ranges[j],d.createAnimationRange(g.name,g.from,g.to);return d},e);c.Skeleton=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(e,a,b,d,j,g,h,f,l,k,n){void 0===h&&(h=c.Texture.NEAREST_SAMPLINGMODE);void 0===n&&(n=c.Engine.TEXTURETYPE_UNSIGNED_INT);this.name=e;this.height=this.width=-1;this._reusable=this.enablePixelPerfectMode=!1;this._textures=new c.SmartArray(2);this._currentRenderTextureInd=0;this._scaleRatio=new c.Vector2(1,1);this.onActivateObservable=new c.Observable;this.onSizeChangedObservable=new c.Observable;this.onApplyObservable=new c.Observable;this.onBeforeRenderObservable=new c.Observable;
this.onAfterRenderObservable=new c.Observable;null!=g?(this._camera=g,this._scene=g.getScene(),g.attachPostProcess(this),this._engine=this._scene.getEngine()):this._engine=f;this._options=j;this.renderTargetSamplingMode=h?h:c.Texture.NEAREST_SAMPLINGMODE;this._reusable=l||!1;this._textureType=n;this._samplers=d||[];this._samplers.push("textureSampler");this._fragmentUrl=a;this._parameters=b||[];this._parameters.push("scale");this.updateEffect(k)};f=(Object.defineProperty(f.prototype,"onActivate",
{set:function(c){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver);this._onActivateObserver=this.onActivateObservable.add(c)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"onSizeChanged",{set:function(c){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver);this._onSizeChangedObserver=this.onSizeChangedObservable.add(c)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"onApply",{set:function(c){this._onApplyObserver&&
this.onApplyObservable.remove(this._onApplyObserver);this._onApplyObserver=this.onApplyObservable.add(c)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"onBeforeRender",{set:function(c){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver);this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(c)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"onAfterRender",{set:function(c){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver);
this._onAfterRenderObserver=this.onAfterRenderObservable.add(c)},enumerable:!0,configurable:!0}),f.prototype.updateEffect=function(c){this._effect=this._engine.createEffect({vertex:"postprocess",fragment:this._fragmentUrl},["position"],this._parameters,this._samplers,void 0!==c?c:"")},f.prototype.isReusable=function(){return this._reusable},f.prototype.markTextureDirty=function(){this.width=-1},f.prototype.activate=function(e,a){e=e||this._camera;var b=e.getScene(),d=e.getEngine().getCaps().maxTextureSize,
j=(a?a._width:this._engine.getRenderingCanvas().width)*this._options|0,g=(a?a._height:this._engine.getRenderingCanvas().height)*this._options|0,h=this._options.width||j,f=this._options.height||g;if(this.renderTargetSamplingMode!==c.Texture.NEAREST_SAMPLINGMODE&&(this._options.width||(h=c.Tools.GetExponentOfTwo(h,d)),this._options.height||(f=c.Tools.GetExponentOfTwo(f,d))),this.width!==h||this.height!==f){if(0<this._textures.length){for(d=0;d<this._textures.length;d++)this._engine._releaseTexture(this._textures.data[d]);
this._textures.reset()}this.width=h;this.height=f;this._textures.push(this._engine.createRenderTargetTexture({width:this.width,height:this.height},{generateMipMaps:!1,generateDepthBuffer:0===e._postProcesses.indexOf(this),samplingMode:this.renderTargetSamplingMode,type:this._textureType}));this._reusable&&this._textures.push(this._engine.createRenderTargetTexture({width:this.width,height:this.height},{generateMipMaps:!1,generateDepthBuffer:0===e._postProcesses.indexOf(this),samplingMode:this.renderTargetSamplingMode,
type:this._textureType}));this.onSizeChangedObservable.notifyObservers(this)}this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(j/h,g/f),this._engine.bindFramebuffer(this._textures.data[this._currentRenderTextureInd],0,j,g)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(this._textures.data[this._currentRenderTextureInd]));this.onActivateObservable.notifyObservers(e);this.clearColor?this._engine.clear(this.clearColor,!0,!0):this._engine.clear(b.clearColor,b.autoClear||
b.forceWireframe,!0);this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2)},Object.defineProperty(f.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!0,configurable:!0}),f.prototype.apply=function(){return this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setAlphaMode(c.Engine.ALPHA_DISABLE),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._effect._bindTexture("textureSampler",
this._textures.data[this._currentRenderTextureInd]),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect):null},f.prototype.dispose=function(c){if(c=c||this._camera,0<this._textures.length){for(var a=0;a<this._textures.length;a++)this._engine._releaseTexture(this._textures.data[a]);this._textures.reset()}c&&(c.detachPostProcess(this),0===c._postProcesses.indexOf(this)&&0<c._postProcesses.length&&this._camera._postProcesses[0].markTextureDirty(),
this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear())},f);c.PostProcess=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(c){this._vertexBuffers={};this._scene=c};f=(f.prototype._prepareBuffers=function(){if(!this._vertexBuffers[c.VertexBuffer.PositionKind]){var e=[];e.push(1,1);e.push(-1,1);e.push(-1,-1);e.push(1,-1);this._vertexBuffers[c.VertexBuffer.PositionKind]=new c.VertexBuffer(this._scene.getEngine(),e,c.VertexBuffer.PositionKind,!1,!1,2);e=[];e.push(0);e.push(1);e.push(2);e.push(0);e.push(2);e.push(3);this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)}},f.prototype._prepareFrame=
function(c){var a=this._scene.activeCamera._postProcesses;return 0!==a.length&&this._scene.postProcessesEnabled?(a[0].activate(this._scene.activeCamera,c),!0):!1},f.prototype.directRender=function(c,a){for(var b=this._scene.getEngine(),d=0;d<c.length;d++){d<c.length-1?c[d+1].activate(this._scene.activeCamera,a):a?b.bindFramebuffer(a):b.restoreDefaultFramebuffer();var j=c[d],g=j.apply();g&&(j.onBeforeRenderObservable.notifyObservers(g),this._prepareBuffers(),b.bindBuffers(this._vertexBuffers,this._indexBuffer,
g),b.draw(!0,0,6),j.onAfterRenderObservable.notifyObservers(g))}b.setDepthBuffer(!0);b.setDepthWrite(!0)},f.prototype._finalizeFrame=function(c,a,b,d){if(d=d||this._scene.activeCamera._postProcesses,0!==d.length&&this._scene.postProcessesEnabled){for(var j=this._scene.getEngine(),g=0,h=d.length;h>g&&(h-1>g?d[g+1].activate(this._scene.activeCamera,a):a?j.bindFramebuffer(a,b):j.restoreDefaultFramebuffer(),!c);g++){var f=d[g],l=f.apply();l&&(f.onBeforeRenderObservable.notifyObservers(l),this._prepareBuffers(),
j.bindBuffers(this._vertexBuffers,this._indexBuffer,l),j.draw(!0,0,6),f.onAfterRenderObservable.notifyObservers(l))}j.setDepthBuffer(!0);j.setDepthWrite(!0)}},f.prototype.dispose=function(){var e=this._vertexBuffers[c.VertexBuffer.PositionKind];e&&(e.dispose(),this._vertexBuffers[c.VertexBuffer.PositionKind]=null);this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},f);c.PostProcessManager=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.PostProcess;f=function(a,b,c,j,g,h){e.call(this,a,"pass",null,null,b,c,j,g,h)};f=(__extends(f,e),f);c.PassPostProcess=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,c){this.type=a;this.jointData=c;c.nativeParams=c.nativeParams||{}};f=(Object.defineProperty(e.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(a){this._physicsJoint;this._physicsJoint=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"physicsPlugin",{set:function(a){this._physicsPlugin=a},enumerable:!0,configurable:!0}),e.prototype.executeNativeFunction=function(a){a(this._physicsPlugin.world,this._physicsJoint)},e.DistanceJoint=
0,e.HingeJoint=1,e.BallAndSocketJoint=2,e.WheelJoint=3,e.SliderJoint=4,e.PrismaticJoint=5,e.UniversalJoint=6,e.Hinge2Joint=e.WheelJoint,e.PointToPointJoint=8,e.SpringJoint=9,e.LockJoint=10,e);c.PhysicsJoint=f;e=function(a){f.call(this,f.DistanceJoint,a)};e=(__extends(e,f),e.prototype.updateDistance=function(a,c){this._physicsPlugin.updateDistanceJoint(this,a,c)},e);c.DistanceJoint=e;var a,e=function(a,c){f.call(this,a,c)};a=(__extends(e,f),e.prototype.setMotor=function(a,c){this._physicsPlugin.setMotor(this,
a,c)},e.prototype.setLimit=function(a,c){this._physicsPlugin.setLimit(this,a,c)},e);c.MotorEnabledJoint=a;e=function(b){a.call(this,f.HingeJoint,b)};e=(__extends(e,a),e.prototype.setMotor=function(a,c){this._physicsPlugin.setMotor(this,a,c)},e.prototype.setLimit=function(a,c){this._physicsPlugin.setLimit(this,a,c)},e);c.HingeJoint=e;e=function(b){a.call(this,f.Hinge2Joint,b)};e=(__extends(e,a),e.prototype.setMotor=function(a,c,e){void 0===e&&(e=0);this._physicsPlugin.setMotor(this,a,c,e)},e.prototype.setLimit=
function(a,c,e){void 0===e&&(e=0);this._physicsPlugin.setLimit(this,a,c,e)},e);c.Hinge2Joint=e}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,b,d,e){var g=this;return void 0===d&&(d={mass:0}),this.object=a,this.type=b,this._options=d,this._scene=e,this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=[],this._onAfterPhysicsStepCallbacks=[],this._onPhysicsCollideCallbacks=[],this._deltaPosition=c.Vector3.Zero(),this._tmpPositionWithDelta=c.Vector3.Zero(),this._tmpRotationWithDelta=new c.Quaternion,this.beforeStep=function(){g.object.position.subtractToRef(g._deltaPosition,g._tmpPositionWithDelta);
g._deltaRotationConjugated?g.object.rotationQuaternion.multiplyToRef(g._deltaRotationConjugated,g._tmpRotationWithDelta):g._tmpRotationWithDelta.copyFrom(g.object.rotationQuaternion);g._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(g,g._tmpPositionWithDelta,g._tmpRotationWithDelta);g._onBeforePhysicsStepCallbacks.forEach(function(a){a(g)})},this.afterStep=function(){g._onAfterPhysicsStepCallbacks.forEach(function(a){a(g)});g._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(g);
g.object.position.addInPlace(g._deltaPosition);g._deltaRotation&&g.object.rotationQuaternion.multiplyInPlace(g._deltaRotation)},this.onCollide=function(a){if(g._onPhysicsCollideCallbacks.length){var b=g._physicsEngine.getImpostorWithPhysicsBody(a.body);b&&g._onPhysicsCollideCallbacks.filter(function(a){return-1!==a.otherImpostors.indexOf(b)}).forEach(function(a){a.callback(g,b)})}},this.object?(!this._scene&&a.getScene&&(this._scene=a.getScene()),this._physicsEngine=this._scene.getPhysicsEngine(),
void(this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=c.Quaternion.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new c.Quaternion),this._options.mass=void 0===d.mass?0:d.mass,this._options.friction=void 0===d.friction?0.2:d.friction,this._options.restitution=void 0===d.restitution?0.2:d.restitution,this._joints=[],this.object.parent||this._init()):c.Tools.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):
void c.Tools.Error("No object was provided. A physics object is obligatory")};f=(e.prototype._init=function(){this._physicsEngine.removeImpostor(this);this.physicsBody=null;this._parent=this._parent||this._getPhysicsParent();this.parent||this._physicsEngine.addImpostor(this)},e.prototype._getPhysicsParent=function(){if(this.object.parent instanceof c.AbstractMesh)return this.object.parent.physicsImpostor},e.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&
!this._parent},e.prototype.setScalingUpdated=function(){this.forceUpdate()},e.prototype.forceUpdate=function(){this._init();this.parent&&this.parent.forceUpdate()},Object.defineProperty(e.prototype,"physicsBody",{get:function(){return this._parent?this._parent.physicsBody:this._physicsBody},set:function(a){this._physicsBody&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this);this._physicsBody=a;this.resetUpdateFlags()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,
"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),e.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},e.prototype.getObjectExtendSize=function(){return this.object.getBoundingInfo?(this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),this.object.getBoundingInfo().boundingBox.extendSize.scale(2).multiply(this.object.scaling)):e.DEFAULT_OBJECT_SIZE},e.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.center:
this.object.position},e.prototype.getParam=function(a){return this._options[a]},e.prototype.setParam=function(a,b){this._options[a]=b;this._bodyUpdateRequired=!0},e.prototype.setMass=function(a){this.getParam("mass")!==a&&this.setParam("mass",a);this._physicsEngine.getPhysicsPlugin().setBodyMass(this,a)},e.prototype.getLinearVelocity=function(){return this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this)},e.prototype.setLinearVelocity=function(a){this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,
a)},e.prototype.getAngularVelocity=function(){return this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this)},e.prototype.setAngularVelocity=function(a){this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,a)},e.prototype.executeNativeFunction=function(a){a(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},e.prototype.registerBeforePhysicsStep=function(a){this._onBeforePhysicsStepCallbacks.push(a)},e.prototype.unregisterBeforePhysicsStep=function(a){a=this._onBeforePhysicsStepCallbacks.indexOf(a);
-1<a?this._onBeforePhysicsStepCallbacks.splice(a,1):c.Tools.Warn("Function to remove was not found")},e.prototype.registerAfterPhysicsStep=function(a){this._onAfterPhysicsStepCallbacks.push(a)},e.prototype.unregisterAfterPhysicsStep=function(a){a=this._onAfterPhysicsStepCallbacks.indexOf(a);-1<a?this._onAfterPhysicsStepCallbacks.splice(a,1):c.Tools.Warn("Function to remove was not found")},e.prototype.registerOnPhysicsCollide=function(a,b){this._onPhysicsCollideCallbacks.push({callback:b,otherImpostors:a instanceof
Array?a:[a]})},e.prototype.unregisterOnPhysicsCollide=function(a,b){var d=this._onPhysicsCollideCallbacks.indexOf({callback:b,otherImpostors:a instanceof Array?a:[a]});-1<d?this._onPhysicsCollideCallbacks.splice(d,1):c.Tools.Warn("Function to remove was not found")},e.prototype.applyForce=function(a,b){this._physicsEngine.getPhysicsPlugin().applyForce(this,a,b)},e.prototype.applyImpulse=function(a,b){this._physicsEngine.getPhysicsPlugin().applyImpulse(this,a,b)},e.prototype.createJoint=function(a,
b,d){b=new c.PhysicsJoint(b,d);this.addJoint(a,b)},e.prototype.addJoint=function(a,b){this._joints.push({otherImpostor:a,joint:b});this._physicsEngine.addJoint(this,a,b)},e.prototype.sleep=function(){this._physicsEngine.getPhysicsPlugin().sleepBody(this)},e.prototype.wakeUp=function(){this._physicsEngine.getPhysicsPlugin().wakeUpBody(this)},e.prototype.clone=function(a){return a?new e(a,this.type,this._options,this._scene):null},e.prototype.dispose=function(){var a=this;this._physicsEngine&&(this._joints.forEach(function(b){a._physicsEngine.removeJoint(a,
b.otherImpostor,b.joint)}),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate())},e.prototype.setDeltaPosition=function(a){this._deltaPosition.copyFrom(a)},e.prototype.setDeltaRotation=function(a){this._deltaRotation||(this._deltaRotation=new c.Quaternion);this._deltaRotation.copyFrom(a);this._deltaRotationConjugated=this._deltaRotation.conjugate()},e.DEFAULT_OBJECT_SIZE=new c.Vector3(1,1,1),e.NoImpostor=0,e.SphereImpostor=1,e.BoxImpostor=2,e.PlaneImpostor=3,e.MeshImpostor=
4,e.CylinderImpostor=7,e.ParticleImpostor=8,e.HeightmapImpostor=9,e);c.PhysicsImpostor=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(e,a){if(void 0===a&&(a=new c.CannonJSPlugin),this._physicsPlugin=a,this._impostors=[],this._joints=[],!this._physicsPlugin.isSupported())throw Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");e=e||new c.Vector3(0,-9.807,0);this.setGravity(e);this.setTimeStep()};f=(f.prototype.setGravity=function(c){this.gravity=c;this._physicsPlugin.setGravity(this.gravity)},f.prototype.setTimeStep=function(c){void 0===c&&(c=1/60);
this._physicsPlugin.setTimeStep(c)},f.prototype.dispose=function(){this._impostors.forEach(function(c){c.dispose()});this._physicsPlugin.dispose()},f.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},f.prototype.addImpostor=function(c){c.uniqueId=this._impostors.push(c);c.parent||this._physicsPlugin.generatePhysicsBody(c)},f.prototype.removeImpostor=function(c){c=this._impostors.indexOf(c);-1<c&&(c=this._impostors.splice(c,1),c.length&&(c[0].physicsBody=null))},f.prototype.addJoint=
function(c,a,b){c={mainImpostor:c,connectedImpostor:a,joint:b};b.physicsPlugin=this._physicsPlugin;this._joints.push(c);this._physicsPlugin.generateJoint(c)},f.prototype.removeJoint=function(c,a,b){var d=this._joints.filter(function(d){return d.connectedImpostor===a&&d.joint===b&&d.mainImpostor===c});d.length&&this._physicsPlugin.removeJoint(d[0])},f.prototype._step=function(c){var a=this;this._impostors.forEach(function(b){b.isBodyInitRequired()&&a._physicsPlugin.generatePhysicsBody(b)});0.1<c?c=
0.1:0>=c&&(c=1/60);this._physicsPlugin.executeStep(c,this._impostors)},f.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},f.prototype.getImpostorForPhysicsObject=function(c){for(var a=0;a<this._impostors.length;++a)if(this._impostors[a].object===c)return this._impostors[a]},f.prototype.getImpostorWithPhysicsBody=function(c){for(var a=0;a<this._impostors.length;++a)if(this._impostors[a].physicsBody===c)return this._impostors[a]},f.NoImpostor=c.PhysicsImpostor.NoImpostor,f.SphereImpostor=
c.PhysicsImpostor.SphereImpostor,f.BoxImpostor=c.PhysicsImpostor.BoxImpostor,f.PlaneImpostor=c.PhysicsImpostor.PlaneImpostor,f.MeshImpostor=c.PhysicsImpostor.MeshImpostor,f.CylinderImpostor=c.PhysicsImpostor.CylinderImpostor,f.HeightmapImpostor=c.PhysicsImpostor.HeightmapImpostor,f.CapsuleImpostor=-1,f.ConeImpostor=-1,f.ConvexHullImpostor=-1,f.Epsilon=0.001,f);c.PhysicsEngine=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(){};f=(e.prototype.set=function(a,b){switch(b){case c.VertexBuffer.PositionKind:this.positions=a;break;case c.VertexBuffer.NormalKind:this.normals=a;break;case c.VertexBuffer.UVKind:this.uvs=a;break;case c.VertexBuffer.UV2Kind:this.uvs2=a;break;case c.VertexBuffer.UV3Kind:this.uvs3=a;break;case c.VertexBuffer.UV4Kind:this.uvs4=a;break;case c.VertexBuffer.UV5Kind:this.uvs5=a;break;case c.VertexBuffer.UV6Kind:this.uvs6=a;break;case c.VertexBuffer.ColorKind:this.colors=
a;break;case c.VertexBuffer.MatricesIndicesKind:this.matricesIndices=a;break;case c.VertexBuffer.MatricesWeightsKind:this.matricesWeights=a;break;case c.VertexBuffer.MatricesIndicesExtraKind:this.matricesIndicesExtra=a;break;case c.VertexBuffer.MatricesWeightsExtraKind:this.matricesWeightsExtra=a}},e.prototype.applyToMesh=function(a,b){this._applyTo(a,b)},e.prototype.applyToGeometry=function(a,b){this._applyTo(a,b)},e.prototype.updateMesh=function(a){this._update(a)},e.prototype.updateGeometry=function(a){this._update(a)},
e.prototype._applyTo=function(a,b){this.positions&&a.setVerticesData(c.VertexBuffer.PositionKind,this.positions,b);this.normals&&a.setVerticesData(c.VertexBuffer.NormalKind,this.normals,b);this.uvs&&a.setVerticesData(c.VertexBuffer.UVKind,this.uvs,b);this.uvs2&&a.setVerticesData(c.VertexBuffer.UV2Kind,this.uvs2,b);this.uvs3&&a.setVerticesData(c.VertexBuffer.UV3Kind,this.uvs3,b);this.uvs4&&a.setVerticesData(c.VertexBuffer.UV4Kind,this.uvs4,b);this.uvs5&&a.setVerticesData(c.VertexBuffer.UV5Kind,this.uvs5,
b);this.uvs6&&a.setVerticesData(c.VertexBuffer.UV6Kind,this.uvs6,b);this.colors&&a.setVerticesData(c.VertexBuffer.ColorKind,this.colors,b);this.matricesIndices&&a.setVerticesData(c.VertexBuffer.MatricesIndicesKind,this.matricesIndices,b);this.matricesWeights&&a.setVerticesData(c.VertexBuffer.MatricesWeightsKind,this.matricesWeights,b);this.matricesIndicesExtra&&a.setVerticesData(c.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,b);this.matricesWeightsExtra&&a.setVerticesData(c.VertexBuffer.MatricesWeightsExtraKind,
this.matricesWeightsExtra,b);this.indices&&a.setIndices(this.indices)},e.prototype._update=function(a,b,d){this.positions&&a.updateVerticesData(c.VertexBuffer.PositionKind,this.positions,b,d);this.normals&&a.updateVerticesData(c.VertexBuffer.NormalKind,this.normals,b,d);this.uvs&&a.updateVerticesData(c.VertexBuffer.UVKind,this.uvs,b,d);this.uvs2&&a.updateVerticesData(c.VertexBuffer.UV2Kind,this.uvs2,b,d);this.uvs3&&a.updateVerticesData(c.VertexBuffer.UV3Kind,this.uvs3,b,d);this.uvs4&&a.updateVerticesData(c.VertexBuffer.UV4Kind,
this.uvs4,b,d);this.uvs5&&a.updateVerticesData(c.VertexBuffer.UV5Kind,this.uvs5,b,d);this.uvs6&&a.updateVerticesData(c.VertexBuffer.UV6Kind,this.uvs6,b,d);this.colors&&a.updateVerticesData(c.VertexBuffer.ColorKind,this.colors,b,d);this.matricesIndices&&a.updateVerticesData(c.VertexBuffer.MatricesIndicesKind,this.matricesIndices,b,d);this.matricesWeights&&a.updateVerticesData(c.VertexBuffer.MatricesWeightsKind,this.matricesWeights,b,d);this.matricesIndicesExtra&&a.updateVerticesData(c.VertexBuffer.MatricesIndicesExtraKind,
this.matricesIndicesExtra,b,d);this.matricesWeightsExtra&&a.updateVerticesData(c.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,b,d);this.indices&&a.setIndices(this.indices)},e.prototype.transform=function(a){var b,d=c.Vector3.Zero();if(this.positions){var e=c.Vector3.Zero();for(b=0;b<this.positions.length;b+=3)c.Vector3.FromArrayToRef(this.positions,b,e),c.Vector3.TransformCoordinatesToRef(e,a,d),this.positions[b]=d.x,this.positions[b+1]=d.y,this.positions[b+2]=d.z}if(this.normals){e=
c.Vector3.Zero();for(b=0;b<this.normals.length;b+=3)c.Vector3.FromArrayToRef(this.normals,b,e),c.Vector3.TransformNormalToRef(e,a,d),this.normals[b]=d.x,this.normals[b+1]=d.y,this.normals[b+2]=d.z}},e.prototype.merge=function(a){if(a.indices){this.indices||(this.indices=[]);for(var b=this.positions?this.positions.length/3:0,c=0;c<a.indices.length;c++)this.indices.push(a.indices[c]+b)}this.positions=this._mergeElement(this.positions,a.positions);this.normals=this._mergeElement(this.normals,a.normals);
this.uvs=this._mergeElement(this.uvs,a.uvs);this.uvs2=this._mergeElement(this.uvs2,a.uvs2);this.uvs3=this._mergeElement(this.uvs3,a.uvs3);this.uvs4=this._mergeElement(this.uvs4,a.uvs4);this.uvs5=this._mergeElement(this.uvs5,a.uvs5);this.uvs6=this._mergeElement(this.uvs6,a.uvs6);this.colors=this._mergeElement(this.colors,a.colors);this.matricesIndices=this._mergeElement(this.matricesIndices,a.matricesIndices);this.matricesWeights=this._mergeElement(this.matricesWeights,a.matricesWeights);this.matricesIndicesExtra=
this._mergeElement(this.matricesIndicesExtra,a.matricesIndicesExtra);this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,a.matricesWeightsExtra)},e.prototype._mergeElement=function(a,b){if(!b)return a;if(!a)return b;var c=b.length+a.length,e=b instanceof Float32Array;if(a instanceof Float32Array)return c=new Float32Array(c),c.set(a),c.set(b,a.length),c;if(e){for(var e=a.slice(0),g=0,c=b.length;c>g;g++)e.push(b[g]);return e}return a.concat(b)},e.prototype.serialize=function(){var a=
this.serialize();return this.positions&&(a.positions=this.positions),this.normals&&(a.normals=this.normals),this.uvs&&(a.uvs=this.uvs),this.uvs2&&(a.uvs2=this.uvs2),this.uvs3&&(a.uvs3=this.uvs3),this.uvs4&&(a.uvs4=this.uvs4),this.uvs5&&(a.uvs5=this.uvs5),this.uvs6&&(a.uvs6=this.uvs6),this.colors&&(a.colors=this.colors),this.matricesIndices&&(a.matricesIndices=this.matricesIndices,a.matricesIndices._isExpanded=!0),this.matricesWeights&&(a.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&
(a.matricesIndicesExtra=this.matricesIndicesExtra,a.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(a.matricesWeightsExtra=this.matricesWeightsExtra),a.indices=this.indices,a},e.ExtractFromMesh=function(a,b){return e._ExtractFrom(a,b)},e.ExtractFromGeometry=function(a,b){return e._ExtractFrom(a,b)},e._ExtractFrom=function(a,b){var d=new e;return a.isVerticesDataPresent(c.VertexBuffer.PositionKind)&&(d.positions=a.getVerticesData(c.VertexBuffer.PositionKind,b)),a.isVerticesDataPresent(c.VertexBuffer.NormalKind)&&
(d.normals=a.getVerticesData(c.VertexBuffer.NormalKind,b)),a.isVerticesDataPresent(c.VertexBuffer.UVKind)&&(d.uvs=a.getVerticesData(c.VertexBuffer.UVKind,b)),a.isVerticesDataPresent(c.VertexBuffer.UV2Kind)&&(d.uvs2=a.getVerticesData(c.VertexBuffer.UV2Kind,b)),a.isVerticesDataPresent(c.VertexBuffer.UV3Kind)&&(d.uvs3=a.getVerticesData(c.VertexBuffer.UV3Kind,b)),a.isVerticesDataPresent(c.VertexBuffer.UV4Kind)&&(d.uvs4=a.getVerticesData(c.VertexBuffer.UV4Kind,b)),a.isVerticesDataPresent(c.VertexBuffer.UV5Kind)&&
(d.uvs5=a.getVerticesData(c.VertexBuffer.UV5Kind,b)),a.isVerticesDataPresent(c.VertexBuffer.UV6Kind)&&(d.uvs6=a.getVerticesData(c.VertexBuffer.UV6Kind,b)),a.isVerticesDataPresent(c.VertexBuffer.ColorKind)&&(d.colors=a.getVerticesData(c.VertexBuffer.ColorKind,b)),a.isVerticesDataPresent(c.VertexBuffer.MatricesIndicesKind)&&(d.matricesIndices=a.getVerticesData(c.VertexBuffer.MatricesIndicesKind,b)),a.isVerticesDataPresent(c.VertexBuffer.MatricesWeightsKind)&&(d.matricesWeights=a.getVerticesData(c.VertexBuffer.MatricesWeightsKind,
b)),a.isVerticesDataPresent(c.VertexBuffer.MatricesIndicesExtraKind)&&(d.matricesIndicesExtra=a.getVerticesData(c.VertexBuffer.MatricesIndicesExtraKind,b)),a.isVerticesDataPresent(c.VertexBuffer.MatricesWeightsExtraKind)&&(d.matricesWeightsExtra=a.getVerticesData(c.VertexBuffer.MatricesWeightsExtraKind,b)),d.indices=a.getIndices(b),d},e.CreateRibbon=function(a){var b=a.pathArray,d=a.closeArray||!1,j=a.closePath||!1,g=Math.floor(b[0].length/2),h=a.offset||g,h=h>g?g:Math.floor(h),f,l,k=0===a.sideOrientation?
0:a.sideOrientation||c.Mesh.DEFAULTSIDE;a=[];var g=[],n=[],q=[],p=[],r=[],t=[],s=[],u=[],v=[];if(2>b.length){f=[];var w=[];for(l=0;l<b[0].length-h;l++)f.push(b[0][l]),w.push(b[0][l+h]);b=[f,w]}var x,B,y=0,w=j?1:0;f=b[0].length;for(var C,D,h=0;h<b.length;h++){t[h]=0;p[h]=[0];x=b[h];B=x.length;f=B>f?f:B;for(l=0;B>l;)a.push(x[l].x,x[l].y,x[l].z),0<l&&(C=x[l].subtract(x[l-1]).length(),D=C+t[h],p[h].push(D),t[h]=D),l++;j&&(l--,a.push(x[0].x,x[0].y,x[0].z),C=x[l].subtract(x[0]).length(),D=C+t[h],p[h].push(D),
t[h]=D);u[h]=B+w;v[h]=y;y+=B+w}var A,I,z;for(l=0;f+w>l;l++){s[l]=0;r[l]=[0];for(h=0;h<b.length-1;h++)C=b[h],A=b[h+1],l===f?(I=C[0],z=A[0]):(I=C[l],z=A[l]),C=z.subtract(I).length(),D=C+s[l],r[l].push(D),s[l]=D;d&&(A=b[0],l===f&&(z=A[0]),C=z.subtract(I).length(),D=C+s[l],s[l]=D)}for(h=0;h<b.length;h++)for(l=0;f+w>l;l++)A=p[h][l]/t[h],I=r[l][h]/s[l],q.push(A,I);p=h=0;r=u[h]-1;t=u[h+1]-1;s=t>r?r:t;A=v[1]-v[0];for(d=d?u.length:u.length-1;s>=p&&d>h;)g.push(p,p+A,p+1),g.push(p+A+1,p+1,p+A),p+=1,p===s&&(h++,
h===u.length-1?(A=v[0]-v[h],r=u[h]-1,t=u[0]-1):(A=v[h+1]-v[h],r=u[h]-1,t=u[h+1]-1),p=v[h],s=t>r?r+p:t+p);if(e.ComputeNormals(a,g,n),j)for(h=u=d=0;h<b.length;h++)d=3*v[h],u=h+1<b.length?3*(v[h+1]-1):n.length-3,n[d]=0.5*(n[d]+n[u]),n[d+1]=0.5*(n[d+1]+n[u+1]),n[d+2]=0.5*(n[d+2]+n[u+2]),n[u]=n[d],n[u+1]=n[d+1],n[u+2]=n[d+2];e._ComputeSides(k,a,g,n,q);b=new e;return b.indices=g,b.positions=a,b.normals=n,b.uvs=q,j&&(b._idx=v),b},e.CreateBox=function(a){var b=[new c.Vector3(0,0,1),new c.Vector3(0,0,-1),
new c.Vector3(1,0,0),new c.Vector3(-1,0,0),new c.Vector3(0,1,0),new c.Vector3(0,-1,0)],d=[],j=[],g=[],h=[],f=a.width||a.size||1,l=a.height||a.size||1,k=a.depth||a.size||1,n=0===a.sideOrientation?0:a.sideOrientation||c.Mesh.DEFAULTSIDE,q=a.faceUV||Array(6);a=a.faceColors;for(var p=[],r=0;6>r;r++)void 0===q[r]&&(q[r]=new c.Vector4(0,0,1,1)),a&&void 0===a[r]&&(a[r]=new c.Color4(1,1,1,1));f=new c.Vector3(f/2,l/2,k/2);for(l=0;l<b.length;l++){var k=b[l],r=new c.Vector3(k.y,k.z,k.x),t=c.Vector3.Cross(k,
r),s=j.length/3;d.push(s);d.push(s+1);d.push(s+2);d.push(s);d.push(s+2);d.push(s+3);s=k.subtract(r).subtract(t).multiply(f);j.push(s.x,s.y,s.z);g.push(k.x,k.y,k.z);h.push(q[l].z,q[l].w);a&&p.push(a[l].r,a[l].g,a[l].b,a[l].a);s=k.subtract(r).add(t).multiply(f);j.push(s.x,s.y,s.z);g.push(k.x,k.y,k.z);h.push(q[l].x,q[l].w);a&&p.push(a[l].r,a[l].g,a[l].b,a[l].a);s=k.add(r).add(t).multiply(f);j.push(s.x,s.y,s.z);g.push(k.x,k.y,k.z);h.push(q[l].x,q[l].y);a&&p.push(a[l].r,a[l].g,a[l].b,a[l].a);s=k.add(r).subtract(t).multiply(f);
j.push(s.x,s.y,s.z);g.push(k.x,k.y,k.z);h.push(q[l].z,q[l].y);a&&p.push(a[l].r,a[l].g,a[l].b,a[l].a)}e._ComputeSides(n,j,d,g,h);b=new e;if(b.indices=d,b.positions=j,b.normals=g,b.uvs=h,a)d=n===c.Mesh.DOUBLESIDE?p.concat(p):p,b.colors=d;return b},e.CreateSphere=function(a){var b=a.segments||32,d=0>=a.arc||1<a.arc?1:a.arc||1,f=0>=a.slice?1:a.slice||1,g=0===a.sideOrientation?0:a.sideOrientation||c.Mesh.DEFAULTSIDE;a=new c.Vector3((a.diameterX||a.diameter||1)/2,(a.diameterY||a.diameter||1)/2,(a.diameterZ||
a.diameter||1)/2);for(var h=2+b,m=2*h,b=[],l=[],k=[],n=[],q=0;h>=q;q++){for(var p=q/h,r=p*Math.PI*f,t=0;m>=t;t++){var s=t/m,u=2*(s*Math.PI)*d,v=c.Matrix.RotationZ(-r),u=c.Matrix.RotationY(u),v=c.Vector3.TransformCoordinates(c.Vector3.Up(),v),u=c.Vector3.TransformCoordinates(v,u),v=u.multiply(a),u=u.divide(a).normalize();l.push(v.x,v.y,v.z);k.push(u.x,u.y,u.z);n.push(s,p)}if(0<q){p=l.length/3;for(r=p-2*(m+1);p>r+m+2;r++)b.push(r),b.push(r+1),b.push(r+m+1),b.push(r+m+1),b.push(r+1),b.push(r+m+2)}}e._ComputeSides(g,
l,b,k,n);d=new e;return d.indices=b,d.positions=l,d.normals=k,d.uvs=n,d},e.CreateCylinder=function(a){var b=a.height||2,d=0===a.diameterTop?0:a.diameterTop||a.diameter||1,f=a.diameterBottom||a.diameter||1,g=a.tessellation||24,h=a.subdivisions||1,m=a.hasRings,l=a.enclose,k=0>=a.arc||1<a.arc?1:a.arc||1,n=0===a.sideOrientation?0:a.sideOrientation||c.Mesh.DEFAULTSIDE,q=a.faceUV||Array(3),p=a.faceColors,r=2+(1+(1!==k&&l?2:0))*(m?h:1);for(a=0;r>a;a++)p&&void 0===p[a]&&(p[a]=new c.Color4(1,1,1,1));for(a=
0;r>a;a++)q&&void 0===q[a]&&(q[a]=new c.Vector4(0,0,1,1));var t,s,u,v,w,x=[],B=[],y=[],C=[],D=[],A=2*Math.PI*k/g,I=(f-d)/2/b,z=c.Vector3.Zero(),E=c.Vector3.Zero(),F=c.Vector3.Zero(),J=c.Vector3.Zero(),G=c.Vector3.Zero(),L=c.Axis.Y,K=1,H=1,M=0;for(a=t=0;h>=a;a++){s=a/h;u=(s*(d-f)+f)/2;K=m&&0!==a&&a!==h?2:1;for(w=0;K>w;w++){m&&(H+=w);l&&(H+=2*w);for(v=0;g>=v;v++)t=v*A,z.x=Math.cos(-t)*u,z.y=-b/2+s*b,z.z=Math.sin(-t)*u,0===d&&a===h?(E.x=y[y.length-3*(g+1)],E.y=y[y.length-3*(g+1)+1],E.z=y[y.length-3*
(g+1)+2]):(E.x=z.x,E.z=z.z,E.y=Math.sqrt(E.x*E.x+E.z*E.z)*I,E.normalize()),0===v&&(F.copyFrom(z),J.copyFrom(E)),B.push(z.x,z.y,z.z),y.push(E.x,E.y,E.z),t=m?M!==H?q[H].y:q[H].w:q[H].y+(q[H].w-q[H].y)*s,C.push(q[H].x+(q[H].z-q[H].x)*v/g,t),p&&D.push(p[H].r,p[H].g,p[H].b,p[H].a);1!==k&&l&&(B.push(z.x,z.y,z.z),B.push(0,z.y,0),B.push(0,z.y,0),B.push(F.x,F.y,F.z),c.Vector3.CrossToRef(L,E,G),G.normalize(),y.push(G.x,G.y,G.z,G.x,G.y,G.z),c.Vector3.CrossToRef(J,L,G),G.normalize(),y.push(G.x,G.y,G.z,G.x,G.y,
G.z),t=m?M!==H?q[H+1].y:q[H+1].w:q[H+1].y+(q[H+1].w-q[H+1].y)*s,C.push(q[H+1].x,t),C.push(q[H+1].z,t),t=m?M!==H?q[H+2].y:q[H+2].w:q[H+2].y+(q[H+2].w-q[H+2].y)*s,C.push(q[H+2].x,t),C.push(q[H+2].z,t),p&&(D.push(p[H+1].r,p[H+1].g,p[H+1].b,p[H+1].a),D.push(p[H+1].r,p[H+1].g,p[H+1].b,p[H+1].a),D.push(p[H+2].r,p[H+2].g,p[H+2].b,p[H+2].a),D.push(p[H+2].r,p[H+2].g,p[H+2].b,p[H+2].a)));M!==H&&(M=H)}}s=1!==k&&l?g+4:g;for(H=a=0;h>H;H++){for(v=0;g>v;v++){var N=a*(s+1)+v,O=(a+1)*(s+1)+v,P=a*(s+1)+(v+1),R=(a+
1)*(s+1)+(v+1);x.push(N,O,P);x.push(R,P,O)}1!==k&&l&&(x.push(N+2,O+2,P+2),x.push(R+2,P+2,O+2),x.push(N+4,O+4,P+4),x.push(R+4,P+4,O+4));a=m?a+2:a+1}h=function(a){var h=a?d/2:f/2;if(0!==h){var e,l,m,n=a?q[r-1]:q[0];p&&(m=a?p[r-1]:p[0]);var t=B.length/3,s=a?b/2:-b/2;l=new c.Vector3(0,s,0);B.push(l.x,l.y,l.z);y.push(0,a?1:-1,0);C.push(n.x+0.5*(n.z-n.x),n.y+0.5*(n.w-n.y));p&&D.push(m.r,m.g,m.b,m.a);var u=new c.Vector2(0.5,0.5);for(l=0;g>=l;l++){e=2*Math.PI*l*k/g;var v=Math.cos(-e),w=Math.sin(-e);e=new c.Vector3(v*
h,s,w*h);v=new c.Vector2(v*u.x+0.5,w*u.y+0.5);B.push(e.x,e.y,e.z);y.push(0,a?1:-1,0);C.push(n.x+(n.z-n.x)*v.x,n.y+(n.w-n.y)*v.y);p&&D.push(m.r,m.g,m.b,m.a)}for(l=0;g>l;l++)a?(x.push(t),x.push(t+(l+2)),x.push(t+(l+1))):(x.push(t),x.push(t+(l+1)),x.push(t+(l+2)))}};h(!1);h(!0);e._ComputeSides(n,B,x,y,C);n=new e;return n.indices=x,n.positions=B,n.normals=y,n.uvs=C,p&&(n.colors=D),n},e.CreateTorus=function(a){var b=[],d=[],f=[],g=[],h=a.diameter||1,m=a.thickness||0.5,l=a.tessellation||16;a=0===a.sideOrientation?
0:a.sideOrientation||c.Mesh.DEFAULTSIDE;for(var k=l+1,n=0;l>=n;n++)for(var q=n/l,p=2*n*Math.PI/l-Math.PI/2,p=c.Matrix.Translation(h/2,0,0).multiply(c.Matrix.RotationY(p)),r=0;l>=r;r++){var t=1-r/l,s=2*r*Math.PI/l+Math.PI,u=Math.cos(s),s=Math.sin(s),u=new c.Vector3(u,s,0),s=u.scale(m/2),t=new c.Vector2(q,t),s=c.Vector3.TransformCoordinates(s,p),u=c.Vector3.TransformNormal(u,p);d.push(s.x,s.y,s.z);f.push(u.x,u.y,u.z);g.push(t.x,t.y);t=(n+1)%k;u=(r+1)%k;b.push(n*k+r);b.push(n*k+u);b.push(t*k+r);b.push(n*
k+u);b.push(t*k+u);b.push(t*k+r)}e._ComputeSides(a,d,b,f,g);h=new e;return h.indices=b,h.positions=d,h.normals=f,h.uvs=g,h},e.CreateLineSystem=function(a){var b=[],c=[];a=a.lines;for(var f=0,g=0;g<a.length;g++)for(var h=a[g],m=0;m<h.length;m++)c.push(h[m].x,h[m].y,h[m].z),0<m&&(b.push(f-1),b.push(f)),f++;a=new e;return a.indices=b,a.positions=c,a},e.CreateDashedLines=function(a){var b=a.dashSize||3,d=a.gapSize||1,f=a.dashNb||200,g=a.points;a=[];for(var h=[],m=c.Vector3.Zero(),l=0,k=0,n=0,q=0,p=0,
r=0,t=0,t=0;t<g.length-1;t++)g[t+1].subtractToRef(g[t],m),l+=m.length();n=l/f;q=b*n/(b+d);for(t=0;t<g.length-1;t++){g[t+1].subtractToRef(g[t],m);k=Math.floor(m.length()/n);m.normalize();for(b=0;k>b;b++)p=n*b,a.push(g[t].x+p*m.x,g[t].y+p*m.y,g[t].z+p*m.z),a.push(g[t].x+(p+q)*m.x,g[t].y+(p+q)*m.y,g[t].z+(p+q)*m.z),h.push(r,r+1),r+=2}b=new e;return b.positions=a,b.indices=h,b},e.CreateGround=function(a){var b,d=[],f=[],g=[],h=[],m=a.width||1,l=a.height||1,k=a.subdivisions||1;for(a=0;k>=a;a++)for(b=0;k>=
b;b++){var n=new c.Vector3(b*m/k-m/2,0,(k-a)*l/k-l/2),q=new c.Vector3(0,1,0);f.push(n.x,n.y,n.z);g.push(q.x,q.y,q.z);h.push(b/k,1-a/k)}for(a=0;k>a;a++)for(b=0;k>b;b++)d.push(b+1+(a+1)*(k+1)),d.push(b+1+a*(k+1)),d.push(b+a*(k+1)),d.push(b+(a+1)*(k+1)),d.push(b+1+(a+1)*(k+1)),d.push(b+a*(k+1));m=new e;return m.indices=d,m.positions=f,m.normals=g,m.uvs=h,m},e.CreateTiledGround=function(a){var b,d,f,g,h=a.xmin,m=a.zmin,l=a.xmax;b=a.zmax;var k=a.subdivisions||{w:1,h:1},n=a.precision||{w:1,h:1};a=[];var q=
[],p=[],r=[];k.h=1>k.w?1:k.h;k.w=1>k.w?1:k.w;n.w=1>n.w?1:n.w;n.h=1>n.h?1:n.h;var l=(l-h)/k.w,t=(b-m)/k.h;for(f=0;f<k.h;f++)for(g=0;g<k.w;g++){var s=h+g*l,u=m+f*t,v=h+(g+1)*l,w=m+(f+1)*t,x=q.length/3,B=n.w+1;for(b=0;b<n.h;b++)for(d=0;d<n.w;d++){var y=[x+d+b*B,x+(d+1)+b*B,x+(d+1)+(b+1)*B,x+d+(b+1)*B];a.push(y[1]);a.push(y[2]);a.push(y[3]);a.push(y[0]);a.push(y[1]);a.push(y[3])}x=c.Vector3.Zero();B=new c.Vector3(0,1,0);for(b=0;b<=n.h;b++){x.z=b*(w-u)/n.h+u;for(d=0;d<=n.w;d++)x.x=d*(v-s)/n.w+s,x.y=0,
q.push(x.x,x.y,x.z),p.push(B.x,B.y,B.z),r.push(d/n.w,b/n.h)}}h=new e;return h.indices=a,h.positions=q,h.normals=p,h.uvs=r,h},e.CreateGroundFromHeightMap=function(a){var b,d,f=[],g=[],h=[],m=[];for(b=0;b<=a.subdivisions;b++)for(d=0;d<=a.subdivisions;d++){var l=new c.Vector3(d*a.width/a.subdivisions-a.width/2,0,(a.subdivisions-b)*a.height/a.subdivisions-a.height/2),k=4*(((l.x+a.width/2)/a.width*(a.bufferWidth-1)|0)+((1-(l.z+a.height/2)/a.height)*(a.bufferHeight-1)|0)*a.bufferWidth);l.y=a.minHeight+
(a.maxHeight-a.minHeight)*(0.3*(a.buffer[k]/255)+0.59*(a.buffer[k+1]/255)+0.11*(a.buffer[k+2]/255));g.push(l.x,l.y,l.z);h.push(0,0,0);m.push(d/a.subdivisions,1-b/a.subdivisions)}for(b=0;b<a.subdivisions;b++)for(d=0;d<a.subdivisions;d++)f.push(d+1+(b+1)*(a.subdivisions+1)),f.push(d+1+b*(a.subdivisions+1)),f.push(d+b*(a.subdivisions+1)),f.push(d+(b+1)*(a.subdivisions+1)),f.push(d+1+(b+1)*(a.subdivisions+1)),f.push(d+b*(a.subdivisions+1));e.ComputeNormals(g,f,h);a=new e;return a.indices=f,a.positions=
g,a.normals=h,a.uvs=m,a},e.CreatePlane=function(a){var b=[],d=[],f=[],g=[],h=0===a.sideOrientation?0:a.sideOrientation||c.Mesh.DEFAULTSIDE,m=(a.width||a.size||1)/2;a=(a.height||a.size||1)/2;d.push(-m,-a,0);f.push(0,0,-1);g.push(0,0);d.push(m,-a,0);f.push(0,0,-1);g.push(1,0);d.push(m,a,0);f.push(0,0,-1);g.push(1,1);d.push(-m,a,0);f.push(0,0,-1);g.push(0,1);b.push(0);b.push(1);b.push(2);b.push(0);b.push(2);b.push(3);e._ComputeSides(h,d,b,f,g);h=new e;return h.indices=b,h.positions=d,h.normals=f,h.uvs=
g,h},e.CreateDisc=function(a){var b=[],d=[],f=[],g=[],h=a.radius||0.5,m=a.tessellation||64,l=0>=a.arc||1<a.arc?1:a.arc||1;a=0===a.sideOrientation?0:a.sideOrientation||c.Mesh.DEFAULTSIDE;b.push(0,0,0);g.push(0.5,0.5);for(var k=2*Math.PI*l,m=k/m,n=0;k>n;n+=m){var q=Math.cos(n),p=Math.sin(n),r=(q+1)/2,t=(1-p)/2;b.push(h*q,h*p,0);g.push(r,t)}1===l&&(b.push(b[3],b[4],b[5]),g.push(g[2],g[3]));h=b.length/3;for(l=1;h-1>l;l++)d.push(l+1,0,l);e.ComputeNormals(b,d,f);e._ComputeSides(a,b,d,f,g);a=new e;return a.indices=
d,a.positions=b,a.normals=f,a.uvs=g,a},e.CreateIcoSphere=function(a){var b,d=a.sideOrientation||c.Mesh.DEFAULTSIDE,f=a.radius||1,g=void 0===a.flat?!0:a.flat,h=a.subdivisions||4,m=a.radiusX||f,l=a.radiusY||f,k=a.radiusZ||f;a=(1+Math.sqrt(5))/2;a=[-1,a,-0,1,a,0,-1,-a,0,1,-a,0,0,-1,-a,0,1,-a,0,-1,a,0,1,a,a,0,1,a,0,-1,-a,0,1,-a,0,-1];var n=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],q=[0,1,2,3,4,5,
6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],p=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],r=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],t=[],s=[],u=[],v=[],w=0,x=Array(3),B=Array(3);for(b=0;3>b;b++)x[b]=c.Vector3.Zero(),B[b]=c.Vector2.Zero();for(var y=0;20>y;y++){for(b=0;3>b;b++){var C=n[3*y+b];x[b].copyFromFloats(a[3*q[C]],a[3*q[C]+1],a[3*q[C]+2]);x[b].normalize().scaleInPlace(f);B[b].copyFromFloats(0.134765625*p[2*C]+0.05859375+-0.0390625*r[y],0.2333984375*
p[2*C+1]+0.025390625+0.01953125*r[y])}b=function(a,b,d,e){var f=c.Vector3.Lerp(x[0],x[2],b/h),j=c.Vector3.Lerp(x[1],x[2],b/h),f=h===b?x[2]:c.Vector3.Lerp(f,j,a/(h-b));f.normalize();if(g){var j=c.Vector3.Lerp(x[0],x[2],e/h),n=c.Vector3.Lerp(x[1],x[2],e/h);d=c.Vector3.Lerp(j,n,d/(h-e))}else d=new c.Vector3(f.x,f.y,f.z);d.x/=m;d.y/=l;d.z/=k;d.normalize();e=c.Vector2.Lerp(B[0],B[2],b/h);j=c.Vector2.Lerp(B[1],B[2],b/h);a=h===b?B[2]:c.Vector2.Lerp(e,j,a/(h-b));s.push(f.x*m,f.y*l,f.z*k);u.push(d.x,d.y,d.z);
v.push(a.x,a.y);t.push(w);w++};for(C=0;h>C;C++)for(var D=0;h>D+C;D++)b(D,C,D+1/3,C+1/3),b(D+1,C,D+1/3,C+1/3),b(D,C+1,D+1/3,C+1/3),h>D+C+1&&(b(D+1,C,D+2/3,C+2/3),b(D+1,C+1,D+2/3,C+2/3),b(D,C+1,D+2/3,C+2/3))}e._ComputeSides(d,s,t,u,v);d=new e;return d.indices=t,d.positions=s,d.normals=u,d.uvs=v,d},e.CreatePolyhedron=function(a){var b=[{vertex:[[0,0,1.732051],[1.632993,0,-0.5773503],[-0.8164966,1.414214,-0.5773503],[-0.8164966,-1.414214,-0.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},{vertex:[[0,
0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},{vertex:[[0,0,1.070466],[0.7136442,0,0.7978784],[-0.3568221,0.618034,0.7978784],[-0.3568221,-0.618034,0.7978784],[0.7978784,0.618034,0.3568221],[0.7978784,-0.618034,0.3568221],[-0.9341724,0.381966,0.3568221],[0.1362939,1,0.3568221],[0.1362939,-1,0.3568221],[-0.9341724,-0.381966,0.3568221],[0.9341724,0.381966,-0.3568221],[0.9341724,-0.381966,
-0.3568221],[-0.7978784,0.618034,-0.3568221],[-0.1362939,1,-0.3568221],[-0.1362939,-1,-0.3568221],[-0.7978784,-0.618034,-0.3568221],[0.3568221,0.618034,-0.7978784],[0.3568221,-0.618034,-0.7978784],[-0.7136442,0,-0.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},{vertex:[[0,0,1.175571],[1.051462,0,0.5257311],[0.3249197,1,0.5257311],[-0.8506508,
0.618034,0.5257311],[-0.8506508,-0.618034,0.5257311],[0.3249197,-1,0.5257311],[0.8506508,0.618034,-0.5257311],[0.8506508,-0.618034,-0.5257311],[-0.3249197,1,-0.5257311],[-1.051462,0,-0.5257311],[-0.3249197,-1,-0.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},{vertex:[[0,0,1.070722],[0.7148135,0,0.7971752],[-0.104682,0.7071068,0.7971752],[-0.6841528,
0.2071068,0.7971752],[-0.104682,-0.7071068,0.7971752],[0.6101315,0.7071068,0.5236279],[1.04156,0.2071068,0.1367736],[0.6101315,-0.7071068,0.5236279],[-0.3574067,1,0.1367736],[-0.7888348,-0.5,0.5236279],[-0.9368776,0.5,0.1367736],[-0.3574067,-1,0.1367736],[0.3574067,1,-0.1367736],[0.9368776,-0.5,-0.1367736],[0.7888348,0.5,-0.5236279],[0.3574067,-1,-0.1367736],[-0.6101315,0.7071068,-0.5236279],[-1.04156,-0.2071068,-0.1367736],[-0.6101315,-0.7071068,-0.5236279],[0.104682,0.7071068,-0.7971752],[0.6841528,
-0.2071068,-0.7971752],[0.104682,-0.7071068,-0.7971752],[-0.7148135,0,-0.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},{vertex:[[0,0,1.322876],[1.309307,0,0.1889822],[-0.9819805,0.8660254,0.1889822],[0.1636634,-1.299038,
0.1889822],[0.3273268,0.8660254,-0.9449112],[-0.8183171,-0.4330127,-0.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},{vertex:[[0,0,1.159953],[1.013464,0,0.5642542],[-0.3501431,0.9510565,0.5642542],[-0.7715208,-0.6571639,0.5642542],[0.6633206,0.9510565,-0.03144481],[0.8682979,-0.6571639,-0.3996071],[-1.121664,0.2938926,-0.03144481],[-0.2348831,-1.063314,-0.3996071],[0.5181548,0.2938926,-0.9953061],[-0.5850262,-0.112257,-0.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,
7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},{vertex:[[0,0,1.118034],[0.8944272,0,0.6708204],[-0.2236068,0.8660254,0.6708204],[-0.7826238,-0.4330127,0.6708204],[0.6708204,0.8660254,0.2236068],[1.006231,-0.4330127,-0.2236068],[-1.006231,0.4330127,0.2236068],[-0.6708204,-0.8660254,-0.2236068],[0.7826238,0.4330127,-0.6708204],[0.2236068,-0.8660254,-0.6708204],[-0.8944272,0,-0.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},{vertex:[[-0.729665,
0.670121,0.319155],[-0.655235,-0.29213,-0.754096],[-0.093922,-0.607123,0.537818],[0.702196,0.595691,0.485187],[0.776626,-0.36656,-0.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},{vertex:[[-0.868849,-0.100041,0.61257],[-0.329458,0.976099,0.28078],[-0.26629,-0.013796,-0.477654],[-0.13392,-1.034115,0.229829],[0.738834,0.707117,-0.307018],[0.859683,-0.535264,-0.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},{vertex:[[-0.610389,0.243975,0.531213],[-0.187812,-0.48795,
-0.664016],[-0.187812,0.9759,-0.664016],[0.187812,-0.9759,0.664016],[0.798201,0.243975,0.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},{vertex:[[-1.028778,0.392027,-0.048786],[-0.640503,-0.646161,0.621837],[-0.125162,-0.395663,-0.540059],[0.004683,0.888447,-0.651988],[0.125161,0.395663,0.540059],[0.632925,-0.791376,0.433102],[1.031672,0.157063,-0.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},{vertex:[[-0.669867,0.334933,-0.529576],
[-0.669867,0.334933,0.529577],[-0.4043,1.212901,0],[-0.334933,-0.669867,-0.529576],[-0.334933,-0.669867,0.529577],[0.334933,0.669867,-0.529576],[0.334933,0.669867,0.529577],[0.4043,-1.212901,0],[0.669867,-0.334933,-0.529576],[0.669867,-0.334933,0.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},{vertex:[[-0.931836,0.219976,-0.264632],[-0.636706,0.318353,0.692816],[-0.613483,-0.735083,-0.264632],[-0.326545,0.979634,0],[-0.318353,
-0.636706,0.692816],[-0.159176,0.477529,-0.856368],[0.159176,-0.477529,-0.856368],[0.318353,0.636706,0.692816],[0.326545,-0.979634,0],[0.613482,0.735082,-0.264632],[0.636706,-0.318353,0.692816],[0.931835,-0.219977,-0.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},{vertex:[[-0.93465,0.300459,-0.271185],[-0.838689,-0.260219,-0.516017],[-0.711319,0.717591,0.128359],[-0.710334,-0.156922,0.080946],
[-0.599799,0.556003,-0.725148],[-0.503838,-0.004675,-0.969981],[-0.487004,0.26021,0.48049],[-0.460089,-0.750282,-0.512622],[-0.376468,0.973135,-0.325605],[-0.331735,-0.646985,0.084342],[-0.254001,0.831847,0.530001],[-0.125239,-0.494738,-0.966586],[0.029622,0.027949,0.730817],[0.056536,-0.982543,-0.262295],[0.08085,1.087391,0.076037],[0.125583,-0.532729,0.485984],[0.262625,0.599586,0.780328],[0.391387,-0.726999,-0.716259],[0.513854,-0.868287,0.139347],[0.597475,0.85513,0.326364],[0.641224,0.109523,
0.783723],[0.737185,-0.451155,0.538891],[0.848705,-0.612742,-0.314616],[0.976075,0.365067,0.32976],[1.072036,-0.19561,0.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]}],d,f,g,h,m,l=0>a.type||a.type>=b.length?0:a.type||0,k=a.size,n=a.sizeX||k||1,q=a.sizeY||
k||1,k=a.sizeZ||k||1,p=a.custom||b[l],r=p.face.length,t=a.faceUV||Array(r),b=a.faceColors,l=void 0===a.flat?!0:a.flat,s=0===a.sideOrientation?0:a.sideOrientation||c.Mesh.DEFAULTSIDE;a=[];var u=[],v=[],w=[],x=[],B=0,y=0,C=[],D=0,A=0;if(l)for(A=0;r>A;A++)b&&void 0===b[A]&&(b[A]=new c.Color4(1,1,1,1)),t&&void 0===t[A]&&(t[A]=new c.Vector4(0,0,1,1));if(l)for(A=0;r>A;A++){var I=p.face[A].length;g=2*Math.PI/I;h=0.5*Math.tan(g/2);m=0.5;for(D=0;I>D;D++)a.push(p.vertex[p.face[A][D]][0]*n,p.vertex[p.face[A][D]][1]*
q,p.vertex[p.face[A][D]][2]*k),C.push(B),B++,d=t[A].x+(t[A].z-t[A].x)*(0.5+h),f=t[A].y+(t[A].w-t[A].y)*(m-0.5),w.push(d,f),d=h*Math.cos(g)-m*Math.sin(g),m=h*Math.sin(g)+m*Math.cos(g),h=d,b&&x.push(b[A].r,b[A].g,b[A].b,b[A].a);for(D=0;I-2>D;D++)u.push(C[0+y],C[D+2+y],C[D+1+y]);y+=I}else{for(D=0;D<p.vertex.length;D++)a.push(p.vertex[D][0]*n,p.vertex[D][1]*q,p.vertex[D][2]*k),w.push(0,0);for(A=0;r>A;A++)for(D=0;D<p.face[A].length-2;D++)u.push(p.face[A][0],p.face[A][D+2],p.face[A][D+1])}e.ComputeNormals(a,
u,v);e._ComputeSides(s,a,u,v,w);n=new e;return n.positions=a,n.indices=u,n.normals=v,n.uvs=w,b&&l&&(n.colors=x),n},e.CreateTorusKnot=function(a){var b,d=[],f=[],g=[],h=[],m=a.radius||2,l=a.tube||0.5,k=a.radialSegments||32,n=a.tubularSegments||32,q=a.p||2,p=a.q||3,r=0===a.sideOrientation?0:a.sideOrientation||c.Mesh.DEFAULTSIDE,t=function(a){var b=Math.cos(a),d=Math.sin(a);a*=p/q;var g=Math.cos(a),b=0.5*(m*(2+g))*b,d=0.5*m*(2+g)*d;a=0.5*m*Math.sin(a);return new c.Vector3(b,d,a)};for(a=0;k>=a;a++){b=
2*(a%k/k)*q*Math.PI;var s=t(b),u=t(b+0.01);b=u.subtract(s);var u=u.add(s),v=c.Vector3.Cross(b,u),u=c.Vector3.Cross(v,b);v.normalize();u.normalize();for(b=0;n>b;b++){var w=2*(b%n/n)*Math.PI,x=-l*Math.cos(w),w=l*Math.sin(w);f.push(s.x+x*u.x+w*v.x);f.push(s.y+x*u.y+w*v.y);f.push(s.z+x*u.z+w*v.z);h.push(a/k);h.push(b/n)}}for(a=0;k>a;a++)for(b=0;n>b;b++)u=(b+1)%n,l=a*n+b,t=(a+1)*n+b,s=(a+1)*n+u,u=a*n+u,d.push(u),d.push(t),d.push(l),d.push(u),d.push(s),d.push(t);e.ComputeNormals(f,d,g);e._ComputeSides(r,
f,d,g,h);k=new e;return k.indices=d,k.positions=f,k.normals=g,k.uvs=h,k},e.ComputeNormals=function(a,b,c){for(var e=0,g=0,h=0,f=0,l=0,k=0,n=0,q=0,p=h=g=f=0,r=0,t=0,e=0;e<a.length;e++)c[e]=0;for(var s=b.length/3,e=0;s>e;e++)p=b[3*e],r=b[3*e+1],t=b[3*e+2],g=a[3*p]-a[3*r],h=a[3*p+1]-a[3*r+1],f=a[3*p+2]-a[3*r+2],l=a[3*t]-a[3*r],k=a[3*t+1]-a[3*r+1],n=a[3*t+2]-a[3*r+2],q=h*n-f*k,f=f*l-g*n,g=g*k-h*l,h=Math.sqrt(q*q+f*f+g*g),h=0===h?1:h,q/=h,f/=h,g/=h,c[3*p]+=q,c[3*p+1]+=f,c[3*p+2]+=g,c[3*r]+=q,c[3*r+1]+=
f,c[3*r+2]+=g,c[3*t]+=q,c[3*t+1]+=f,c[3*t+2]+=g;for(e=0;e<c.length/3;e++)q=c[3*e],f=c[3*e+1],g=c[3*e+2],h=Math.sqrt(q*q+f*f+g*g),h=0===h?1:h,q/=h,f/=h,g/=h,c[3*e]=q,c[3*e+1]=f,c[3*e+2]=g},e._ComputeSides=function(a,b,d,e,g){var h=d.length,f=e.length;switch(a||c.Mesh.DEFAULTSIDE){case c.Mesh.BACKSIDE:for(b=0;h>b;b+=3)g=d[b],d[b]=d[b+2],d[b+2]=g;for(d=0;f>d;d++)e[d]=-e[d];break;case c.Mesh.DOUBLESIDE:var l=b.length;a=l/3;for(var k=0;l>k;k++)b[l+k]=b[k];for(b=0;h>b;b+=3)d[b+h]=d[b+2]+a,d[b+1+h]=d[b+
1]+a,d[b+2+h]=d[b]+a;for(d=0;f>d;d++)e[f+d]=-e[d];e=g.length;for(f=0;e>f;f++)g[f+e]=g[f]}},e.ImportVertexData=function(a,b){var d=new e,f=a.positions;f&&d.set(f,c.VertexBuffer.PositionKind);var g=a.normals;g&&d.set(g,c.VertexBuffer.NormalKind);(g=a.uvs)&&d.set(g,c.VertexBuffer.UVKind);(g=a.uv2s)&&d.set(g,c.VertexBuffer.UV2Kind);(g=a.uv3s)&&d.set(g,c.VertexBuffer.UV3Kind);(g=a.uv4s)&&d.set(g,c.VertexBuffer.UV4Kind);(g=a.uv5s)&&d.set(g,c.VertexBuffer.UV5Kind);(g=a.uv6s)&&d.set(g,c.VertexBuffer.UV6Kind);
(g=a.colors)&&d.set(c.Color4.CheckColors4(g,f.length/3),c.VertexBuffer.ColorKind);(f=a.matricesIndices)&&d.set(f,c.VertexBuffer.MatricesIndicesKind);(f=a.matricesWeights)&&d.set(f,c.VertexBuffer.MatricesWeightsKind);(f=a.indices)&&(d.indices=f);b.setAllVerticesData(d,a.updatable)},e);c.VertexData=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(){};f=(e.EnableFor=function(a){a._tags=a._tags||{};a.hasTags=function(){return e.HasTags(a)};a.addTags=function(b){return e.AddTagsTo(a,b)};a.removeTags=function(b){return e.RemoveTagsFrom(a,b)};a.matchesTagsQuery=function(b){return e.MatchesQuery(a,b)}},e.DisableFor=function(a){delete a._tags;delete a.hasTags;delete a.addTags;delete a.removeTags;delete a.matchesTagsQuery},e.HasTags=function(a){return a._tags?!c.Tools.IsEmpty(a._tags):!1},e.GetTags=function(a,b){if(void 0===
b&&(b=!0),!a._tags)return null;if(b){var c=[],e;for(e in a._tags)a._tags.hasOwnProperty(e)&&!0===a._tags[e]&&c.push(e);return c.join(" ")}return a._tags},e.AddTagsTo=function(a,b){if(b&&"string"==typeof b){var c=b.split(" "),f;for(f in c)e._AddTagTo(a,c[f])}},e._AddTagTo=function(a,b){b=b.trim();""!==b&&"true"!==b&&"false"!==b&&(b.match(/[\s]/)||b.match(/^([!]|([|]|[&]){2})/)||(e.EnableFor(a),a._tags[b]=!0))},e.RemoveTagsFrom=function(a,b){if(e.HasTags(a)){var c=b.split(" "),f;for(f in c)e._RemoveTagFrom(a,
c[f])}},e._RemoveTagFrom=function(a,b){delete a._tags[b]},e.MatchesQuery=function(a,b){return void 0===b?!0:""===b?e.HasTags(a):c.Internals.AndOrNotEvaluator.Eval(b,function(b){return e.HasTags(a)&&a._tags[b]})},e);c.Tags=f}(BABYLON||(BABYLON={}));
!function(c){c=c.Internals||(c.Internals={});var f,e=function(){};f=(e.Eval=function(a,b){return a=a.match(/\([^\(\)]*\)/g)?a.replace(/\([^\(\)]*\)/g,function(a){return a=a.slice(1,a.length-1),e._HandleParenthesisContent(a,b)}):e._HandleParenthesisContent(a,b),"true"===a?!0:"false"===a?!1:e.Eval(a,b)},e._HandleParenthesisContent=function(a,b){b=b||function(a){return"true"===a};var c,f=a.split("||"),g;for(g in f){var h=e._SimplifyNegation(f[g].trim()),m=h.split("&&");if(1<m.length)for(var l=0;l<m.length;++l){var k=
e._SimplifyNegation(m[l].trim());if(c="true"!==k&&"false"!==k?"!"===k[0]?!b(k.substring(1)):b(k):"true"===k,!c){h="false";break}}if(c||"true"===h){c=!0;break}c="true"!==h&&"false"!==h?"!"===h[0]?!b(h.substring(1)):b(h):"true"===h}return c?"true":"false"},e._SimplifyNegation=function(a){return a=a.replace(/^[\s!]+/,function(a){return a=a.replace(/[\s]/g,function(){return""}),a.length%2?"!":""}),a=a.trim(),"!true"===a?a="false":"!false"===a&&(a="true"),a},e);c.AndOrNotEvaluator=f;!0}(BABYLON||(BABYLON=
{}));
!function(c){var f;f=function(e,a,b,d,f,g){this._enabled=!0;this._refCount=0;this._name=a;this._renderTexture=new c.RenderTargetTexture(a,b,e);this.setRenderList(d);this._renderTexture.onBeforeRenderObservable.add(f);this._renderTexture.onAfterRenderObservable.add(g);this._scene=e;this._renderList=d};f=(f.prototype._incRefCount=function(){return 0===this._refCount&&this._scene.customRenderTargets.push(this._renderTexture),++this._refCount},f.prototype._decRefCount=function(){return this._refCount--,0>=
this._refCount&&this._scene.customRenderTargets.splice(this._scene.customRenderTargets.indexOf(this._renderTexture),1),this._refCount},f.prototype._update=function(){this.setRenderList(this._renderList)},f.prototype.setRenderList=function(c){this._renderTexture.renderList=c},f.prototype.getRenderTexture=function(){return this._renderTexture},f);c.PostProcessRenderPass=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(c,a,b,d){this._engine=c;this._name=a;this._singleInstance=d||!0;this._getPostProcess=b;this._cameras=[];this._indicesForCamera=[];this._postProcesses={};this._renderPasses={};this._renderEffectAsPasses={}};f=(Object.defineProperty(f.prototype,"isSupported",{get:function(){for(var c in this._postProcesses)if(!this._postProcesses[c].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),f.prototype._update=function(){for(var c in this._renderPasses)this._renderPasses[c]._update()},
f.prototype.addPass=function(c){this._renderPasses[c._name]=c;this._linkParameters()},f.prototype.removePass=function(c){delete this._renderPasses[c._name];this._linkParameters()},f.prototype.addRenderEffectAsPass=function(c){this._renderEffectAsPasses[c._name]=c;this._linkParameters()},f.prototype.getPass=function(c){for(var a in this._renderPasses)if(a===c)return this._renderPasses[c]},f.prototype.emptyPasses=function(){this._renderPasses={};this._linkParameters()},f.prototype._attachCameras=function(e){var a;
e=c.Tools.MakeArray(e||this._cameras);for(var b=0;b<e.length;b++){var d=e[b],f=d.name;a=this._singleInstance?0:f;this._postProcesses[a]=this._postProcesses[a]||this._getPostProcess();a=d.attachPostProcess(this._postProcesses[a]);this._indicesForCamera[f]||(this._indicesForCamera[f]=[]);this._indicesForCamera[f].push(a);-1===this._cameras.indexOf(d)&&(this._cameras[f]=d);for(var g in this._renderPasses)this._renderPasses[g]._incRefCount()}this._linkParameters()},f.prototype._detachCameras=function(e){e=
c.Tools.MakeArray(e||this._cameras);for(var a=0;a<e.length;a++){var b=e[a],d=b.name;b.detachPostProcess(this._postProcesses[this._singleInstance?0:d],this._indicesForCamera[d]);b=this._cameras.indexOf(d);this._indicesForCamera.splice(b,1);this._cameras.splice(b,1);for(var f in this._renderPasses)this._renderPasses[f]._decRefCount()}},f.prototype._enable=function(e){for(var a=c.Tools.MakeArray(e||this._cameras),b=0;b<a.length;b++){for(var d=a[b],f=d.name,g=0;g<this._indicesForCamera[f].length;g++)void 0===
d._postProcesses[this._indicesForCamera[f][g]]&&e[b].attachPostProcess(this._postProcesses[this._singleInstance?0:f],this._indicesForCamera[f][g]);for(var h in this._renderPasses)this._renderPasses[h]._incRefCount()}},f.prototype._disable=function(e){e=c.Tools.MakeArray(e||this._cameras);for(var a=0;a<e.length;a++){var b=e[a],d=b.Name;b.detachPostProcess(this._postProcesses[this._singleInstance?0:d],this._indicesForCamera[d]);for(var f in this._renderPasses)this._renderPasses[f]._decRefCount()}},
f.prototype.getPostProcess=function(c){return this._singleInstance?this._postProcesses[0]:this._postProcesses[c.name]},f.prototype._linkParameters=function(){var c=this,a;for(a in this._postProcesses)this.applyParameters&&this.applyParameters(this._postProcesses[a]),this._postProcesses[a].onBeforeRenderObservable.add(function(a){c._linkTextures(a)})},f.prototype._linkTextures=function(c){for(var a in this._renderPasses)c.setTexture(a,this._renderPasses[a].getRenderTexture());for(var b in this._renderEffectAsPasses)c.setTextureFromPostProcess(b+
"Sampler",this._renderEffectAsPasses[b].getPostProcess())},f);c.PostProcessRenderEffect=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,b){this._engine=a;this._name=b;this._renderEffects={};this._renderEffectsForIsolatedPass={};this._cameras=[]};f=(Object.defineProperty(e.prototype,"isSupported",{get:function(){for(var a in this._renderEffects)if(!this._renderEffects[a].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),e.prototype.addEffect=function(a){this._renderEffects[a._name]=a},e.prototype._enableEffect=function(a,b){var d=this._renderEffects[a];d&&d._enable(c.Tools.MakeArray(b||
this._cameras))},e.prototype._disableEffect=function(a,b){var d=this._renderEffects[a];d&&d._disable(c.Tools.MakeArray(b||this._cameras))},e.prototype._attachCameras=function(a,b){var d,e=c.Tools.MakeArray(a||this._cameras),g=[];for(d=0;d<e.length;d++){var h=e[d],f=h.name;-1===this._cameras.indexOf(h)?this._cameras[f]=h:b&&g.push(d)}for(d=0;d<g.length;d++)a.splice(g[d],1);for(var l in this._renderEffects)this._renderEffects[l]._attachCameras(e)},e.prototype._detachCameras=function(a){a=c.Tools.MakeArray(a||
this._cameras);for(var b in this._renderEffects)this._renderEffects[b]._detachCameras(a);for(b=0;b<a.length;b++)this._cameras.splice(this._cameras.indexOf(a[b]),1)},e.prototype._enableDisplayOnlyPass=function(a,b){var d,f=this,g=c.Tools.MakeArray(b||this._cameras),h=null;for(d in this._renderEffects)if(h=this._renderEffects[d].getPass(a),null!=h)break;if(null!==h){for(d in this._renderEffects)this._renderEffects[d]._disable(g);h._name=e.PASS_SAMPLER_NAME;for(d=0;d<g.length;d++){var m=g[d],l=m.name;
this._renderEffectsForIsolatedPass[l]=this._renderEffectsForIsolatedPass[l]||new c.PostProcessRenderEffect(this._engine,e.PASS_EFFECT_NAME,function(){return new c.DisplayPassPostProcess(e.PASS_EFFECT_NAME,1,null,null,f._engine,!0)});this._renderEffectsForIsolatedPass[l].emptyPasses();this._renderEffectsForIsolatedPass[l].addPass(h);this._renderEffectsForIsolatedPass[l]._attachCameras(m)}}},e.prototype._disableDisplayOnlyPass=function(a){var b=this;a=c.Tools.MakeArray(a||this._cameras);for(var d=0;d<
a.length;d++){var f=a[d],g=f.name;this._renderEffectsForIsolatedPass[g]=this._renderEffectsForIsolatedPass[g]||new c.PostProcessRenderEffect(this._engine,e.PASS_EFFECT_NAME,function(){return new c.DisplayPassPostProcess(e.PASS_EFFECT_NAME,1,null,null,b._engine,!0)});this._renderEffectsForIsolatedPass[g]._disable(f)}for(var h in this._renderEffects)this._renderEffects[h]._enable(a)},e.prototype._update=function(){for(var a in this._renderEffects)this._renderEffects[a]._update();for(a=0;a<this._cameras.length;a++){var b=
this._cameras[a].name;this._renderEffectsForIsolatedPass[b]&&this._renderEffectsForIsolatedPass[b]._update()}},e.prototype.dispose=function(){},e.PASS_EFFECT_NAME="passEffect",e.PASS_SAMPLER_NAME="passSampler",e);c.PostProcessRenderPipeline=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){this._renderPipelines={}};f=(f.prototype.addPipeline=function(c){this._renderPipelines[c._name]=c},f.prototype.attachCamerasToRenderPipeline=function(c,a,b){(c=this._renderPipelines[c])&&c._attachCameras(a,b)},f.prototype.detachCamerasFromRenderPipeline=function(c,a){var b=this._renderPipelines[c];b&&b._detachCameras(a)},f.prototype.enableEffectInPipeline=function(c,a,b){(c=this._renderPipelines[c])&&c._enableEffect(a,b)},f.prototype.disableEffectInPipeline=function(c,
a,b){(c=this._renderPipelines[c])&&c._disableEffect(a,b)},f.prototype.enableDisplayOnlyPassInPipeline=function(c,a,b){(c=this._renderPipelines[c])&&c._enableDisplayOnlyPass(a,b)},f.prototype.disableDisplayOnlyPassInPipeline=function(c,a){var b=this._renderPipelines[c];b&&b._disableDisplayOnlyPass(a)},f.prototype.update=function(){for(var c in this._renderPipelines){var a=this._renderPipelines[c];a.isSupported?a._update():(a.dispose(),delete this._renderPipelines[c])}},f);c.PostProcessRenderPipelineManager=
f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(e){this.frontColor=new c.Color3(1,1,1);this.backColor=new c.Color3(0.1,0.1,0.1);this.showBackLines=!0;this.renderList=new c.SmartArray(32);this._vertexBuffers={};this._scene=e};f=(f.prototype._prepareRessources=function(){if(!this._colorShader){this._colorShader=new c.ShaderMaterial("colorShader",this._scene,"color",{attributes:[c.VertexBuffer.PositionKind],uniforms:["worldViewProjection","color"]});var e=this._scene.getEngine(),a=c.VertexData.CreateBox(1);this._vertexBuffers[c.VertexBuffer.PositionKind]=
new c.VertexBuffer(e,a.positions,c.VertexBuffer.PositionKind,!1);this._indexBuffer=e.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])}},f.prototype.reset=function(){this.renderList.reset()},f.prototype.render=function(){if(0!==this.renderList.length&&(this._prepareRessources(),this._colorShader.isReady())){var e=this._scene.getEngine();e.setDepthWrite(!1);this._colorShader._preBind();for(var a=0;a<this.renderList.length;a++){var b=this.renderList.data[a],d=b.minimum,f=b.maximum.subtract(d),
d=d.add(f.scale(0.5)),b=c.Matrix.Scaling(f.x,f.y,f.z).multiply(c.Matrix.Translation(d.x,d.y,d.z)).multiply(b.getWorldMatrix());e.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect());this.showBackLines&&(e.setDepthFunctionToGreaterOrEqual(),this._scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(b),e.draw(!1,0,24));e.setDepthFunctionToLess();this._scene.resetCachedMaterial();this._colorShader.setColor4("color",
this.frontColor.toColor4());this._colorShader.bind(b);e.draw(!1,0,24)}this._colorShader.unbind();e.setDepthFunctionToLessOrEqual();e.setDepthWrite(!0)}},f.prototype.dispose=function(){if(this._colorShader){this._colorShader.dispose();var e=this._vertexBuffers[c.VertexBuffer.PositionKind];e&&(e.dispose(),this._vertexBuffers[c.VertexBuffer.PositionKind]=null);this._scene.getEngine()._releaseBuffer(this._indexBuffer)}},f);c.BoundingBoxRenderer=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a){this._actionManager=a};f=(e.prototype.isValid=function(){return!0},e.prototype._getProperty=function(a){return this._actionManager._getProperty(a)},e.prototype._getEffectiveTarget=function(a,c){return this._actionManager._getEffectiveTarget(a,c)},e.prototype.serialize=function(){},e.prototype._serialize=function(a){return{type:2,children:[],name:a.name,properties:a.properties}},e);c.Condition=f;var a=function(b,c,e,g,h){void 0===h&&(h=a.IsEqual);f.call(this,b);this.propertyPath=
e;this.value=g;this.operator=h;this._target=c;this._effectiveTarget=this._getEffectiveTarget(c,this.propertyPath);this._property=this._getProperty(this.propertyPath)},e=(__extends(a,f),Object.defineProperty(a,"IsEqual",{get:function(){return a._IsEqual},enumerable:!0,configurable:!0}),Object.defineProperty(a,"IsDifferent",{get:function(){return a._IsDifferent},enumerable:!0,configurable:!0}),Object.defineProperty(a,"IsGreater",{get:function(){return a._IsGreater},enumerable:!0,configurable:!0}),Object.defineProperty(a,
"IsLesser",{get:function(){return a._IsLesser},enumerable:!0,configurable:!0}),a.prototype.isValid=function(){switch(this.operator){case a.IsGreater:return this._effectiveTarget[this._property]>this.value;case a.IsLesser:return this._effectiveTarget[this._property]<this.value;case a.IsEqual:case a.IsDifferent:var b;return b=this.value.equals?this.value.equals(this._effectiveTarget[this._property]):this.value===this._effectiveTarget[this._property],this.operator===a.IsEqual?b:!b}return!1},a.prototype.serialize=
function(){return this._serialize({name:"ValueCondition",properties:[c.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:c.Action._SerializeValueAsString(this.value)},{name:"operator",value:a.GetOperatorName(this.operator)}]})},a.GetOperatorName=function(b){switch(b){case a._IsEqual:return"IsEqual";case a._IsDifferent:return"IsDifferent";case a._IsGreater:return"IsGreater";case a._IsLesser:return"IsLesser";default:return""}},a._IsEqual=0,a._IsDifferent=
1,a._IsGreater=2,a._IsLesser=3,a);c.ValueCondition=e;e=function(a,c){f.call(this,a);this.predicate=c};e=(__extends(e,f),e.prototype.isValid=function(){return this.predicate()},e);c.PredicateCondition=e;e=function(a,c,e){f.call(this,a);this.value=e;this._target=c};e=(__extends(e,f),e.prototype.isValid=function(){return this._target.state===this.value},e.prototype.serialize=function(){return this._serialize({name:"StateCondition",properties:[c.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]})},
e);c.StateCondition=e}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(c,a){this.triggerOptions=c;c.parameter?(this.trigger=c.trigger,this._triggerParameter=c.parameter):this.trigger=c;this._nextActiveAction=this;this._condition=a};f=(f.prototype._prepare=function(){},f.prototype.getTriggerParameter=function(){return this._triggerParameter},f.prototype._executeCurrent=function(c){if(this._nextActiveAction._condition){var a=this._nextActiveAction._condition,b=this._actionManager.getScene().getRenderId();if(a._evaluationId===b){if(!a._currentResult)return}else{if(a._evaluationId=
b,!a.isValid())return void(a._currentResult=!1);a._currentResult=!0}}this._nextActiveAction.execute(c);this.skipToNextActiveAction()},f.prototype.execute=function(){},f.prototype.skipToNextActiveAction=function(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},f.prototype.then=function(c){return this._child=c,c._actionManager=
this._actionManager,c._prepare(),c},f.prototype._getProperty=function(c){return this._actionManager._getProperty(c)},f.prototype._getEffectiveTarget=function(c,a){return this._actionManager._getEffectiveTarget(c,a)},f.prototype.serialize=function(){},f.prototype._serialize=function(c,a){var b={type:1,children:[],name:c.name,properties:c.properties||[]};if(this._child&&this._child.serialize(b),this._condition){var d=this._condition.serialize();return d.children.push(b),a&&a.children.push(d),d}return a&&
a.children.push(b),b},f._SerializeValueAsString=function(e){return"number"==typeof e?e.toString():"boolean"==typeof e?e?"true":"false":e instanceof c.Vector2?e.x+", "+e.y:e instanceof c.Vector3?e.x+", "+e.y+", "+e.z:e instanceof c.Color3?e.r+", "+e.g+", "+e.b:e instanceof c.Color4?e.r+", "+e.g+", "+e.b+", "+e.a:e},f._GetTargetProperty=function(e){return{name:"target",targetType:e instanceof c.Mesh?"MeshProperties":e instanceof c.Light?"LightProperties":e instanceof c.Camera?"CameraProperties":"SceneProperties",
value:e instanceof c.Scene?"Scene":e.name}},f);c.Action=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,c,e,g,h,f){this.source=a;this.pointerX=c;this.pointerY=e;this.meshUnderPointer=g;this.sourceEvent=h;this.additionalData=f};f=(e.CreateNew=function(a,c,f){var g=a.getScene();return new e(a,g.pointerX,g.pointerY,g.meshUnderPointer,c,f)},e.CreateNewFromSprite=function(a,c,f,g){return new e(a,c.pointerX,c.pointerY,c.meshUnderPointer,f,g)},e.CreateNewFromScene=function(a,c){return new e(null,a.pointerX,a.pointerY,a.meshUnderPointer,c)},e.CreateNewFromPrimitive=function(a,
c,f,g){return new e(a,c.x,c.y,null,f,g)},e);c.ActionEvent=f;var a=function(a){this.actions=[];this._scene=a;a._actionManagers.push(this)};f=(Object.defineProperty(a,"NothingTrigger",{get:function(){return a._NothingTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(a,"OnPickTrigger",{get:function(){return a._OnPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(a,"OnLeftPickTrigger",{get:function(){return a._OnLeftPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(a,
"OnRightPickTrigger",{get:function(){return a._OnRightPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(a,"OnCenterPickTrigger",{get:function(){return a._OnCenterPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(a,"OnPickDownTrigger",{get:function(){return a._OnPickDownTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(a,"OnPickUpTrigger",{get:function(){return a._OnPickUpTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(a,"OnPickOutTrigger",
{get:function(){return a._OnPickOutTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(a,"OnLongPressTrigger",{get:function(){return a._OnLongPressTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(a,"OnPointerOverTrigger",{get:function(){return a._OnPointerOverTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(a,"OnPointerOutTrigger",{get:function(){return a._OnPointerOutTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(a,"OnEveryFrameTrigger",{get:function(){return a._OnEveryFrameTrigger},
enumerable:!0,configurable:!0}),Object.defineProperty(a,"OnIntersectionEnterTrigger",{get:function(){return a._OnIntersectionEnterTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(a,"OnIntersectionExitTrigger",{get:function(){return a._OnIntersectionExitTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(a,"OnKeyDownTrigger",{get:function(){return a._OnKeyDownTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(a,"OnKeyUpTrigger",{get:function(){return a._OnKeyUpTrigger},
enumerable:!0,configurable:!0}),a.prototype.dispose=function(){var a=this._scene._actionManagers.indexOf(this);-1<a&&this._scene._actionManagers.splice(a,1)},a.prototype.getScene=function(){return this._scene},a.prototype.hasSpecificTriggers=function(a){for(var c=0;c<this.actions.length;c++)if(-1<a.indexOf(this.actions[c].trigger))return!0;return!1},a.prototype.hasSpecificTrigger=function(a){for(var c=0;c<this.actions.length;c++)if(this.actions[c].trigger===a)return!0;return!1},Object.defineProperty(a.prototype,
"hasPointerTriggers",{get:function(){for(var b=0;b<this.actions.length;b++){var c=this.actions[b];if(c.trigger>=a._OnPickTrigger&&c.trigger<=a._OnPointerOutTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hasPickTriggers",{get:function(){for(var b=0;b<this.actions.length;b++){var c=this.actions[b];if(c.trigger>=a._OnPickTrigger&&c.trigger<=a._OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),a.prototype.registerAction=function(b){return b.trigger===
a.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(c.Tools.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(b),b._actionManager=this,b._prepare(),b)},a.prototype.processTrigger=function(b,c){for(var e=0;e<this.actions.length;e++){var g=this.actions[e];if(g.trigger===b){if(b===a.OnKeyUpTrigger||b===a.OnKeyDownTrigger){var h=g.getTriggerParameter();if(h&&String.fromCharCode(c.sourceEvent.charCode?c.sourceEvent.charCode:c.sourceEvent.keyCode).toLowerCase()!==
h.toLowerCase())continue}g._executeCurrent(c)}}},a.prototype._getEffectiveTarget=function(a,c){for(var e=c.split("."),g=0;g<e.length-1;g++)a=a[e[g]];return a},a.prototype._getProperty=function(a){a=a.split(".");return a[a.length-1]},a.prototype.serialize=function(b){b={children:[],name:b,type:3,properties:[]};for(var d=0;d<this.actions.length;d++){var e={type:0,children:[],name:a.GetTriggerName(this.actions[d].trigger),properties:[]},g=this.actions[d].triggerOptions;g&&"number"!=typeof g&&(g.parameter instanceof
c.Node?e.properties.push(c.Action._GetTargetProperty(g.parameter)):e.properties.push({name:"parameter",targetType:null,value:g.parameter}));this.actions[d].serialize(e);b.children.push(e)}return b},a.Parse=function(b,d,e){var g=new c.ActionManager(e);null===d?e.actionManager=g:d.actionManager=g;var h=function(b,d,f,k,l){if(void 0===l&&(l=null),!b.detached){var m=[],u=null,v=null,w=b.combine&&0<b.combine.length;if(2===b.type?m.push(g):m.push(d),w){u=[];for(v=0;v<b.combine.length;v++)h(b.combine[v],
a.NothingTrigger,f,k,u);m.push(u)}else for(w=0;w<b.properties.length;w++){var x=b.properties[w].value,B=b.properties[w].name,y=b.properties[w].targetType;if("target"===B)x=u=null!==y&&"SceneProperties"===y?e:e.getNodeByName(x);else if("parent"===B)x=e.getNodeByName(x);else if("sound"===B)x=e.getSoundByName(x);else if("propertyPath"!==B)if(2===b.type&&"operator"===B)x=c.ValueCondition[x];else if(y=x,x=u,B="value"===B?v:null,null===B)x=parseFloat(y),x="true"===y||"false"===y?"true"===y:isNaN(x)?y:x;
else{for(var B=B.split("."),y=y.split(","),C=0;C<B.length;C++)x=x[B[C]];if("boolean"==typeof x)x="true"===y[0];else if("string"==typeof x)x=y[0];else{B=[];for(C=0;C<y.length;C++)B.push(parseFloat(y[C]));x=x instanceof c.Vector3?c.Vector3.FromArray(B):x instanceof c.Vector4?c.Vector4.FromArray(B):x instanceof c.Color3?c.Color3.FromArray(B):x instanceof c.Color4?c.Color4.FromArray(B):parseFloat(y[0])}}else v=x;m.push(x)}if(null===l?m.push(f):m.push(null),"InterpolateValueAction"===b.name)m[m.length-
1]=m[m.length-2],m[m.length-2]=f;u=Object.create(c[b.name].prototype);m=(u.constructor.apply(u,m),u);m instanceof c.Condition&&null!==f&&(u=new c.DoNothingAction(d,f),k?k.then(u):g.registerAction(u),k=u);null===l?m instanceof c.Condition?(f=m,m=k):(f=null,k?k.then(m):g.registerAction(m)):l.push(m);for(w=0;w<b.children.length;w++)h(b.children[w],d,f,m,null)}};for(d=0;d<b.children.length;d++){var f,l=b.children[d];0<l.properties.length?(f=l.properties[0].value,f=null===l.properties[0].targetType?f:
e.getMeshByName(f),f={trigger:c.ActionManager[l.name],parameter:f}):f=c.ActionManager[l.name];for(var k=0;k<l.children.length;k++)l.detached||h(l.children[k],f,null,null)}},a.GetTriggerName=function(a){switch(a){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnPickUpTrigger";case 7:return"OnLongPressTrigger";case 8:return"OnPointerOverTrigger";
case 9:return"OnPointerOutTrigger";case 10:return"OnEveryFrameTrigger";case 11:return"OnIntersectionEnterTrigger";case 12:return"OnIntersectionExitTrigger";case 13:return"OnKeyDownTrigger";case 14:return"OnKeyUpTrigger";case 15:return"OnPickOutTrigger";default:return""}},a._NothingTrigger=0,a._OnPickTrigger=1,a._OnLeftPickTrigger=2,a._OnRightPickTrigger=3,a._OnCenterPickTrigger=4,a._OnPickDownTrigger=5,a._OnPickUpTrigger=6,a._OnLongPressTrigger=7,a._OnPointerOverTrigger=8,a._OnPointerOutTrigger=9,
a._OnEveryFrameTrigger=10,a._OnIntersectionEnterTrigger=11,a._OnIntersectionExitTrigger=12,a._OnKeyDownTrigger=13,a._OnKeyUpTrigger=14,a._OnPickOutTrigger=15,a.DragMovementThreshold=10,a.LongPressDelay=500,a);c.ActionManager=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Action;f=function(a,b,c,f,g,h,m,l){void 0===g&&(g=1E3);e.call(this,a,h);this.propertyPath=c;this.value=f;this.duration=g;this.stopOtherAnimations=m;this.onInterpolationDone=l;this._target=this._effectiveTarget=b};f=(__extends(f,e),f.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath);this._property=this._getProperty(this.propertyPath)},f.prototype.execute=function(){var a,b=this._actionManager.getScene(),d=[{frame:0,
value:this._effectiveTarget[this._property]},{frame:100,value:this.value}];if("number"==typeof this.value)a=c.Animation.ANIMATIONTYPE_FLOAT;else if(this.value instanceof c.Color3)a=c.Animation.ANIMATIONTYPE_COLOR3;else if(this.value instanceof c.Vector3)a=c.Animation.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof c.Matrix)a=c.Animation.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof c.Quaternion))return void c.Tools.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");
a=c.Animation.ANIMATIONTYPE_QUATERNION}a=new c.Animation("InterpolateValueAction",this._property,100*(1E3/this.duration),a,c.Animation.ANIMATIONLOOPMODE_CONSTANT);a.setKeys(d);this.stopOtherAnimations&&b.stopAnimation(this._effectiveTarget);b.beginDirectAnimation(this._effectiveTarget,[a],0,100,!1,1,this.onInterpolationDone)},f.prototype.serialize=function(a){return e.prototype._serialize.call(this,{name:"InterpolateValueAction",properties:[c.Action._GetTargetProperty(this._target),{name:"propertyPath",
value:this.propertyPath},{name:"value",value:c.Action._SerializeValueAsString(this.value)},{name:"duration",value:c.Action._SerializeValueAsString(this.duration)},{name:"stopOtherAnimations",value:c.Action._SerializeValueAsString(this.stopOtherAnimations)||!1}]},a)},f);c.InterpolateValueAction=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Action;f=function(a,b,c,d){e.call(this,a,d);this.propertyPath=c;this._target=this._effectiveTarget=b};f=(__extends(f,e),f.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath);this._property=this._getProperty(this.propertyPath)},f.prototype.execute=function(){this._effectiveTarget[this._property]=!this._effectiveTarget[this._property]},f.prototype.serialize=function(a){return e.prototype._serialize.call(this,{name:"SwitchBooleanAction",
properties:[c.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},a)},f);c.SwitchBooleanAction=f;var a=c.Action;f=function(b,c,d,g){a.call(this,b,g);this.value=d;this._target=c};f=(__extends(f,a),f.prototype.execute=function(){this._target.state=this.value},f.prototype.serialize=function(b){return a.prototype._serialize.call(this,{name:"SetStateAction",properties:[c.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]},b)},f);c.SetStateAction=
f;var b=c.Action;f=function(a,c,d,g,h){b.call(this,a,h);this.propertyPath=d;this.value=g;this._target=this._effectiveTarget=c};f=(__extends(f,b),f.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath);this._property=this._getProperty(this.propertyPath)},f.prototype.execute=function(){this._effectiveTarget[this._property]=this.value;this._target.markAsDirty&&this._target.markAsDirty(this._property)},f.prototype.serialize=function(a){return b.prototype._serialize.call(this,
{name:"SetValueAction",properties:[c.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:c.Action._SerializeValueAsString(this.value)}]},a)},f);c.SetValueAction=f;var d=c.Action;f=function(a,b,c,g,h){d.call(this,a,h);this.propertyPath=c;this.value=g;this._target=this._effectiveTarget=b};f=(__extends(f,d),f.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath);this._property=this._getProperty(this.propertyPath);
"number"!=typeof this._effectiveTarget[this._property]&&c.Tools.Warn("Warning: IncrementValueAction can only be used with number values")},f.prototype.execute=function(){this._effectiveTarget[this._property]+=this.value;this._target.markAsDirty&&this._target.markAsDirty(this._property)},f.prototype.serialize=function(a){return d.prototype._serialize.call(this,{name:"IncrementValueAction",properties:[c.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",
value:c.Action._SerializeValueAsString(this.value)}]},a)},f);c.IncrementValueAction=f;var j=c.Action;f=function(a,b,c,d,g,h){j.call(this,a,h);this.from=c;this.to=d;this.loop=g;this._target=b};f=(__extends(f,j),f.prototype._prepare=function(){},f.prototype.execute=function(){this._actionManager.getScene().beginAnimation(this._target,this.from,this.to,this.loop)},f.prototype.serialize=function(a){return j.prototype._serialize.call(this,{name:"PlayAnimationAction",properties:[c.Action._GetTargetProperty(this._target),
{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:c.Action._SerializeValueAsString(this.loop)||!1}]},a)},f);c.PlayAnimationAction=f;var g=c.Action;f=function(a,b,c){g.call(this,a,c);this._target=b};f=(__extends(f,g),f.prototype._prepare=function(){},f.prototype.execute=function(){this._actionManager.getScene().stopAnimation(this._target)},f.prototype.serialize=function(a){return g.prototype._serialize.call(this,{name:"StopAnimationAction",properties:[c.Action._GetTargetProperty(this._target)]},
a)},f);c.StopAnimationAction=f;var h=c.Action;f=function(a,b){void 0===a&&(a=c.ActionManager.NothingTrigger);h.call(this,a,b)};f=(__extends(f,h),f.prototype.execute=function(){},f.prototype.serialize=function(a){return h.prototype._serialize.call(this,{name:"DoNothingAction",properties:[]},a)},f);c.DoNothingAction=f;var m=c.Action;f=function(a,b,c){m.call(this,a,c);this.children=b};f=(__extends(f,m),f.prototype._prepare=function(){for(var a=0;a<this.children.length;a++)this.children[a]._actionManager=
this._actionManager,this.children[a]._prepare()},f.prototype.execute=function(a){for(var b=0;b<this.children.length;b++)this.children[b].execute(a)},f.prototype.serialize=function(a){a=m.prototype._serialize.call(this,{name:"CombineAction",properties:[],combine:[]},a);for(var b=0;b<this.children.length;b++)a.combine.push(this.children[b].serialize(null));return a},f);c.CombineAction=f;var l=c.Action;f=function(a,b,c){l.call(this,a,c);this.func=b};f=(__extends(f,l),f.prototype.execute=function(a){this.func(a)},
f);c.ExecuteCodeAction=f;var k=c.Action;f=function(a,b,c,d){k.call(this,a,d);this._target=b;this._parent=c};f=(__extends(f,k),f.prototype._prepare=function(){},f.prototype.execute=function(){if(this._target.parent!==this._parent){var a=this._parent.getWorldMatrix().clone();a.invert();this._target.position=c.Vector3.TransformCoordinates(this._target.position,a);this._target.parent=this._parent}},f.prototype.serialize=function(a){return k.prototype._serialize.call(this,{name:"SetParentAction",properties:[c.Action._GetTargetProperty(this._target),
c.Action._GetTargetProperty(this._parent)]},a)},f);c.SetParentAction=f;var n=c.Action;f=function(a,b,c){n.call(this,a,c);this._sound=b};f=(__extends(f,n),f.prototype._prepare=function(){},f.prototype.execute=function(){void 0!==this._sound&&this._sound.play()},f.prototype.serialize=function(a){return n.prototype._serialize.call(this,{name:"PlaySoundAction",properties:[{name:"sound",value:this._sound.name}]},a)},f);c.PlaySoundAction=f;var q=c.Action;f=function(a,b,c){q.call(this,a,c);this._sound=b};
f=(__extends(f,q),f.prototype._prepare=function(){},f.prototype.execute=function(){void 0!==this._sound&&this._sound.stop()},f.prototype.serialize=function(a){return q.prototype._serialize.call(this,{name:"StopSoundAction",properties:[{name:"sound",value:this._sound.name}]},a)},f);c.StopSoundAction=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,b,d,g,h){this.delayLoadState=c.Engine.DELAYLOADSTATE_NONE;this._totalVertices=0;this._isDisposed=!1;this.id=a;this._engine=b.getEngine();this._meshes=[];this._scene=b;this._vertexBuffers={};this._indices=[];d?this.setAllVerticesData(d,g):(this._totalVertices=0,this._indices=[]);h&&(h instanceof c.LinesMesh&&(this.boundingBias=new c.Vector2(0,h.intersectionThreshold),this.updateExtend()),this.applyToMesh(h),h.computeWorldMatrix(!0))};f=(Object.defineProperty(e.prototype,
"boundingBias",{get:function(){return this._boundingBias},set:function(a){this._boundingBias&&this._boundingBias.equals(a)||(this._boundingBias=a.clone(),this.updateBoundingInfo(!0,null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extend",{get:function(){return this._extend},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEngine=function(){return this._engine},e.prototype.isReady=function(){return this.delayLoadState===c.Engine.DELAYLOADSTATE_LOADED||
this.delayLoadState===c.Engine.DELAYLOADSTATE_NONE},e.prototype.setAllVerticesData=function(a,b){a.applyToGeometry(this,b);this.notifyUpdate()},e.prototype.setVerticesData=function(a,b,d,g){a=new c.VertexBuffer(this._engine,b,a,d,0===this._meshes.length,g);this.setVerticesBuffer(a)},e.prototype.setVerticesBuffer=function(a){var b=a.getKind();if(this._vertexBuffers[b]&&this._vertexBuffers[b].dispose(),this._vertexBuffers[b]=a,b===c.VertexBuffer.PositionKind){var d=a.getData();a=a.getStrideSize();this._totalVertices=
d.length/a;this.updateExtend(d,a);d=this._meshes;a=d.length;for(var g=0;a>g;g++){var h=d[g];h._resetPointsArrayCache();h._boundingInfo=new c.BoundingInfo(this._extend.minimum,this._extend.maximum);h._createGlobalSubMesh();h.computeWorldMatrix(!0)}}this.notifyUpdate(b)},e.prototype.updateVerticesDataDirectly=function(a,b,c){var d=this.getVertexBuffer(a);d&&(d.updateDirectly(b,c),this.notifyUpdate(a))},e.prototype.updateVerticesData=function(a,b,d){var g=this.getVertexBuffer(a);if(g){if(g.update(b),
a===c.VertexBuffer.PositionKind)g=g.getStrideSize(),this._totalVertices=b.length/g,this.updateBoundingInfo(d,b);this.notifyUpdate(a)}},e.prototype.updateBoundingInfo=function(a,b){a&&this.updateExtend(b);for(var d=this._meshes,g=d.length,h=0;g>h;h++){var e=d[h];if(e._resetPointsArrayCache(),a){e._boundingInfo=new c.BoundingInfo(this._extend.minimum,this._extend.maximum);for(var f=0;f<e.subMeshes.length;f++)e.subMeshes[f].refreshBoundingInfo()}}},e.prototype.getTotalVertices=function(){return this.isReady()?
this._totalVertices:0},e.prototype.getVerticesData=function(a,b){var c=this.getVertexBuffer(a);if(!c)return null;c=c.getData();if(b&&1!==this._meshes.length){for(var d=c.length,g=[],h=0;d>h;h++)g.push(c[h]);return g}return c},e.prototype.getVertexBuffer=function(a){return this.isReady()?this._vertexBuffers[a]:null},e.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},e.prototype.isVerticesDataPresent=function(a){return this._vertexBuffers?void 0!==this._vertexBuffers[a]:
this._delayInfo?-1!==this._delayInfo.indexOf(a):!1},e.prototype.getVerticesDataKinds=function(){var a,b=[];if(!this._vertexBuffers&&this._delayInfo)for(a in this._delayInfo)b.push(a);else for(a in this._vertexBuffers)b.push(a);return b},e.prototype.setIndices=function(a,b){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer);this._indices=a;0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices));void 0!==b&&(this._totalVertices=b);for(var c=
this._meshes,d=c.length,g=0;d>g;g++)c[g]._createGlobalSubMesh();this.notifyUpdate()},e.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},e.prototype.getIndices=function(a){if(!this.isReady())return null;var b=this._indices;if(a&&1!==this._meshes.length){a=b.length;for(var c=[],d=0;a>d;d++)c.push(b[d]);return c}return b},e.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},e.prototype.releaseForMesh=function(a,b){var c=this._meshes,d=
c.indexOf(a);if(-1!==d){for(var g in this._vertexBuffers)this._vertexBuffers[g].dispose();this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null);c.splice(d,1);a._geometry=null;0===c.length&&b&&this.dispose()}},e.prototype.applyToMesh=function(a){if(a._geometry!==this){var b=a._geometry;b&&b.releaseForMesh(a);b=this._meshes;a._geometry=this;this._scene.pushGeometry(this);b.push(a);this.isReady()?this._applyToMesh(a):a._boundingInfo=this._boundingInfo}},e.prototype.updateExtend=
function(a,b){void 0===a&&(a=null);a||(a=this._vertexBuffers[c.VertexBuffer.PositionKind].getData());this._extend=c.Tools.ExtractMinAndMax(a,0,this._totalVertices,this.boundingBias,b)},e.prototype._applyToMesh=function(a){var b=this._meshes.length,d;for(d in this._vertexBuffers)1===b&&this._vertexBuffers[d].create(),this._vertexBuffers[d].getBuffer().references=b,d===c.VertexBuffer.PositionKind&&(a._resetPointsArrayCache(),this._extend||this.updateExtend(this._vertexBuffers[d].getData()),a._boundingInfo=
new c.BoundingInfo(this._extend.minimum,this._extend.maximum),a._createGlobalSubMesh(),a._updateBoundingInfo());1===b&&this._indices&&0<this._indices.length&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices));this._indexBuffer&&(this._indexBuffer.references=b)},e.prototype.notifyUpdate=function(a){this.onGeometryUpdated&&this.onGeometryUpdated(this,a)},e.prototype.load=function(a,b){var d=this;if(this.delayLoadState!==c.Engine.DELAYLOADSTATE_LOADING){if(this.isReady())return void(b&&
b());this.delayLoadState=c.Engine.DELAYLOADSTATE_LOADING;a._addPendingData(this);c.Tools.LoadFile(this.delayLoadingFile,function(g){d._delayLoadingFunction(JSON.parse(g),d);d.delayLoadState=c.Engine.DELAYLOADSTATE_LOADED;d._delayInfo=[];a._removePendingData(d);g=d._meshes;for(var h=g.length,e=0;h>e;e++)d._applyToMesh(g[e]);b&&b()},function(){},a.database)}},e.prototype.toLeftHanded=function(){var a=this.getIndices(!1);if(null!=a&&0<a.length){for(var b=0;b<a.length;b+=3){var d=a[b+0];a[b+0]=a[b+2];
a[b+2]=d}this.setIndices(a)}a=this.getVerticesData(c.VertexBuffer.PositionKind,!1);if(null!=a&&0<a.length){for(b=0;b<a.length;b+=3)a[b+2]=-a[b+2];this.setVerticesData(c.VertexBuffer.PositionKind,a,!1)}a=this.getVerticesData(c.VertexBuffer.NormalKind,!1);if(null!=a&&0<a.length){for(b=0;b<a.length;b+=3)a[b+2]=-a[b+2];this.setVerticesData(c.VertexBuffer.NormalKind,a,!1)}},e.prototype.isDisposed=function(){return this._isDisposed},e.prototype.dispose=function(){var a,b=this._meshes,d=b.length;for(a=0;d>
a;a++)this.releaseForMesh(b[a]);this._meshes=[];for(var g in this._vertexBuffers)this._vertexBuffers[g].dispose();this._vertexBuffers={};this._totalVertices=0;this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer);this._indexBuffer=null;this._indices=[];this.delayLoadState=c.Engine.DELAYLOADSTATE_NONE;this._delayLoadingFunction=this.delayLoadingFile=null;this._delayInfo=[];this._boundingInfo=null;this._scene.removeGeometry(this);this._isDisposed=!0},e.prototype.copy=function(a){var b=new c.VertexData;
b.indices=[];for(var d=this.getIndices(),g=0;g<d.length;g++)b.indices.push(d[g]);var h,g=d=!1;for(h in this._vertexBuffers){var f=this.getVerticesData(h);f instanceof Float32Array?b.set(new Float32Array(f),h):b.set(f.slice(0),h);g||(d=this.getVertexBuffer(h).isUpdatable(),g=!d)}a=new e(a,this._scene,b,d,null);a.delayLoadState=this.delayLoadState;a.delayLoadingFile=this.delayLoadingFile;a._delayLoadingFunction=this._delayLoadingFunction;for(h in this._delayInfo)a._delayInfo=a._delayInfo||[],a._delayInfo.push(h);
return a._boundingInfo=new c.BoundingInfo(this._extend.minimum,this._extend.maximum),a},e.prototype.serialize=function(){var a={};return a.id=this.id,c.Tags.HasTags(this)&&(a.tags=c.Tags.GetTags(this)),a},e.prototype.serializeVerticeData=function(){var a=this.serialize();return this.isVerticesDataPresent(c.VertexBuffer.PositionKind)&&(a.positions=this.getVerticesData(c.VertexBuffer.PositionKind)),this.isVerticesDataPresent(c.VertexBuffer.NormalKind)&&(a.normals=this.getVerticesData(c.VertexBuffer.NormalKind)),
this.isVerticesDataPresent(c.VertexBuffer.UVKind)&&(a.uvs=this.getVerticesData(c.VertexBuffer.UVKind)),this.isVerticesDataPresent(c.VertexBuffer.UV2Kind)&&(a.uvs2=this.getVerticesData(c.VertexBuffer.UV2Kind)),this.isVerticesDataPresent(c.VertexBuffer.UV3Kind)&&(a.uvs3=this.getVerticesData(c.VertexBuffer.UV3Kind)),this.isVerticesDataPresent(c.VertexBuffer.UV4Kind)&&(a.uvs4=this.getVerticesData(c.VertexBuffer.UV4Kind)),this.isVerticesDataPresent(c.VertexBuffer.UV5Kind)&&(a.uvs5=this.getVerticesData(c.VertexBuffer.UV5Kind)),
this.isVerticesDataPresent(c.VertexBuffer.UV6Kind)&&(a.uvs6=this.getVerticesData(c.VertexBuffer.UV6Kind)),this.isVerticesDataPresent(c.VertexBuffer.ColorKind)&&(a.colors=this.getVerticesData(c.VertexBuffer.ColorKind)),this.isVerticesDataPresent(c.VertexBuffer.MatricesIndicesKind)&&(a.matricesIndices=this.getVerticesData(c.VertexBuffer.MatricesIndicesKind),a.matricesIndices._isExpanded=!0),this.isVerticesDataPresent(c.VertexBuffer.MatricesWeightsKind)&&(a.matricesWeights=this.getVerticesData(c.VertexBuffer.MatricesWeightsKind)),
a.indices=this.getIndices(),a},e.ExtractFromMesh=function(a,b){var c=a._geometry;return c?c.copy(b):null},e.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)})},e.ImportGeometry=function(a,b){var d=b.getScene(),g=a.geometryId;if(g)(g=d.getGeometryByID(g))&&g.applyToMesh(b);else if(a instanceof ArrayBuffer){g=b._binaryInfo;if(g.positionsAttrDesc&&0<g.positionsAttrDesc.count){var h=new Float32Array(a,
g.positionsAttrDesc.offset,g.positionsAttrDesc.count);b.setVerticesData(c.VertexBuffer.PositionKind,h,!1)}g.normalsAttrDesc&&0<g.normalsAttrDesc.count&&(h=new Float32Array(a,g.normalsAttrDesc.offset,g.normalsAttrDesc.count),b.setVerticesData(c.VertexBuffer.NormalKind,h,!1));g.uvsAttrDesc&&0<g.uvsAttrDesc.count&&(h=new Float32Array(a,g.uvsAttrDesc.offset,g.uvsAttrDesc.count),b.setVerticesData(c.VertexBuffer.UVKind,h,!1));g.uvs2AttrDesc&&0<g.uvs2AttrDesc.count&&(h=new Float32Array(a,g.uvs2AttrDesc.offset,
g.uvs2AttrDesc.count),b.setVerticesData(c.VertexBuffer.UV2Kind,h,!1));g.uvs3AttrDesc&&0<g.uvs3AttrDesc.count&&(h=new Float32Array(a,g.uvs3AttrDesc.offset,g.uvs3AttrDesc.count),b.setVerticesData(c.VertexBuffer.UV3Kind,h,!1));g.uvs4AttrDesc&&0<g.uvs4AttrDesc.count&&(h=new Float32Array(a,g.uvs4AttrDesc.offset,g.uvs4AttrDesc.count),b.setVerticesData(c.VertexBuffer.UV4Kind,h,!1));g.uvs5AttrDesc&&0<g.uvs5AttrDesc.count&&(h=new Float32Array(a,g.uvs5AttrDesc.offset,g.uvs5AttrDesc.count),b.setVerticesData(c.VertexBuffer.UV5Kind,
h,!1));g.uvs6AttrDesc&&0<g.uvs6AttrDesc.count&&(h=new Float32Array(a,g.uvs6AttrDesc.offset,g.uvs6AttrDesc.count),b.setVerticesData(c.VertexBuffer.UV6Kind,h,!1));g.colorsAttrDesc&&0<g.colorsAttrDesc.count&&(h=new Float32Array(a,g.colorsAttrDesc.offset,g.colorsAttrDesc.count),b.setVerticesData(c.VertexBuffer.ColorKind,h,!1,g.colorsAttrDesc.stride));g.matricesIndicesAttrDesc&&0<g.matricesIndicesAttrDesc.count&&(h=new Int32Array(a,g.matricesIndicesAttrDesc.offset,g.matricesIndicesAttrDesc.count),b.setVerticesData(c.VertexBuffer.MatricesIndicesKind,
h,!1));g.matricesWeightsAttrDesc&&0<g.matricesWeightsAttrDesc.count&&(h=new Float32Array(a,g.matricesWeightsAttrDesc.offset,g.matricesWeightsAttrDesc.count),b.setVerticesData(c.VertexBuffer.MatricesWeightsKind,h,!1));g.indicesAttrDesc&&0<g.indicesAttrDesc.count&&(h=new Int32Array(a,g.indicesAttrDesc.offset,g.indicesAttrDesc.count),b.setIndices(h));if(g.subMeshesAttrDesc&&0<g.subMeshesAttrDesc.count){var e=new Int32Array(a,g.subMeshesAttrDesc.offset,5*g.subMeshesAttrDesc.count);b.subMeshes=[];for(h=
0;h<g.subMeshesAttrDesc.count;h++)new c.SubMesh(e[5*h+0],e[5*h+1],e[5*h+2],e[5*h+3],e[5*h+4],b)}}else if(a.positions&&a.normals&&a.indices){if(b.setVerticesData(c.VertexBuffer.PositionKind,a.positions,!1),b.setVerticesData(c.VertexBuffer.NormalKind,a.normals,!1),a.uvs&&b.setVerticesData(c.VertexBuffer.UVKind,a.uvs,!1),a.uvs2&&b.setVerticesData(c.VertexBuffer.UV2Kind,a.uvs2,!1),a.uvs3&&b.setVerticesData(c.VertexBuffer.UV3Kind,a.uvs3,!1),a.uvs4&&b.setVerticesData(c.VertexBuffer.UV4Kind,a.uvs4,!1),a.uvs5&&
b.setVerticesData(c.VertexBuffer.UV5Kind,a.uvs5,!1),a.uvs6&&b.setVerticesData(c.VertexBuffer.UV6Kind,a.uvs6,!1),a.colors&&b.setVerticesData(c.VertexBuffer.ColorKind,c.Color4.CheckColors4(a.colors,a.positions.length/3),!1),a.matricesIndices)if(a.matricesIndices._isExpanded)delete a.matricesIndices._isExpanded,b.setVerticesData(c.VertexBuffer.MatricesIndicesKind,a.matricesIndices,!1);else{g=[];for(h=0;h<a.matricesIndices.length;h++)e=a.matricesIndices[h],g.push(255&e),g.push((65280&e)>>8),g.push((16711680&
e)>>16),g.push(e>>24);b.setVerticesData(c.VertexBuffer.MatricesIndicesKind,g,!1)}if(a.matricesIndicesExtra)if(a.matricesIndicesExtra._isExpanded)delete a.matricesIndices._isExpanded,b.setVerticesData(c.VertexBuffer.MatricesIndicesExtraKind,a.matricesIndicesExtra,!1);else{g=[];for(h=0;h<a.matricesIndicesExtra.length;h++)e=a.matricesIndicesExtra[h],g.push(255&e),g.push((65280&e)>>8),g.push((16711680&e)>>16),g.push(e>>24);b.setVerticesData(c.VertexBuffer.MatricesIndicesExtraKind,g,!1)}a.matricesWeights&&
b.setVerticesData(c.VertexBuffer.MatricesWeightsKind,a.matricesWeights,!1);a.matricesWeightsExtra&&b.setVerticesData(c.VertexBuffer.MatricesWeightsExtraKind,a.matricesWeightsExtra,!1);b.setIndices(a.indices)}if(a.subMeshes){b.subMeshes=[];for(g=0;g<a.subMeshes.length;g++)h=a.subMeshes[g],new c.SubMesh(h.materialIndex,h.verticesStart,h.verticesCount,h.indexStart,h.indexCount,b)}b._shouldGenerateFlatShading&&(b.convertToFlatShadedMesh(),delete b._shouldGenerateFlatShading);b.computeWorldMatrix(!0);
d._selectionOctree&&d._selectionOctree.addMesh(b)},e.Parse=function(a,b,d){if(b.getGeometryByID(a.id))return null;var g=new e(a.id,b);return c.Tags.AddTagsTo(g,a.tags),a.delayLoadingFile?(g.delayLoadState=c.Engine.DELAYLOADSTATE_NOTLOADED,g.delayLoadingFile=d+a.delayLoadingFile,g._boundingInfo=new c.BoundingInfo(c.Vector3.FromArray(a.boundingBoxMinimum),c.Vector3.FromArray(a.boundingBoxMaximum)),g._delayInfo=[],a.hasUVs&&g._delayInfo.push(c.VertexBuffer.UVKind),a.hasUVs2&&g._delayInfo.push(c.VertexBuffer.UV2Kind),
a.hasUVs3&&g._delayInfo.push(c.VertexBuffer.UV3Kind),a.hasUVs4&&g._delayInfo.push(c.VertexBuffer.UV4Kind),a.hasUVs5&&g._delayInfo.push(c.VertexBuffer.UV5Kind),a.hasUVs6&&g._delayInfo.push(c.VertexBuffer.UV6Kind),a.hasColors&&g._delayInfo.push(c.VertexBuffer.ColorKind),a.hasMatricesIndices&&g._delayInfo.push(c.VertexBuffer.MatricesIndicesKind),a.hasMatricesWeights&&g._delayInfo.push(c.VertexBuffer.MatricesWeightsKind),g._delayLoadingFunction=c.VertexData.ImportVertexData):c.VertexData.ImportVertexData(a,
g),b.pushGeometry(g,!0),g},e);c.Geometry=f;var a=f=c.Geometry||(c.Geometry={});f=a.Primitives||(a.Primitives={});var b,d=function(b,c,d,g){a.call(this,b,c,null,!1,g);this._canBeRegenerated=d;this._beingRegenerated=!0;this.regenerate();this._beingRegenerated=!1};b=(__extends(d,a),d.prototype.canBeRegenerated=function(){return this._canBeRegenerated},d.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=
!1)},d.prototype.asNewGeometry=function(b){return a.prototype.copy.call(this,b)},d.prototype.setAllVerticesData=function(b){this._beingRegenerated&&a.prototype.setAllVerticesData.call(this,b,!1)},d.prototype.setVerticesData=function(b,c){this._beingRegenerated&&a.prototype.setVerticesData.call(this,b,c,!1)},d.prototype._regenerateVertexData=function(){throw Error("Abstract method");},d.prototype.copy=function(){throw Error("Must be overriden in sub-classes.");},d.prototype.serialize=function(){var b=
a.prototype.serialize.call(this);return b.canBeRegenerated=this.canBeRegenerated(),b},d);f._Primitive=b;var j=function(a,d,g,h,e,f,j,k,l){void 0===l&&(l=c.Mesh.DEFAULTSIDE);b.call(this,a,d,j,k);this.pathArray=g;this.closeArray=h;this.closePath=e;this.offset=f;this.side=l},d=(__extends(j,b),j.prototype._regenerateVertexData=function(){return c.VertexData.CreateRibbon({pathArray:this.pathArray,closeArray:this.closeArray,closePath:this.closePath,offset:this.offset,sideOrientation:this.side})},j.prototype.copy=
function(a){return new j(a,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),null,this.side)},j);f.Ribbon=d;var g=function(a,d,g,h,e,f){void 0===f&&(f=c.Mesh.DEFAULTSIDE);b.call(this,a,d,h,e);this.size=g;this.side=f},d=(__extends(g,b),g.prototype._regenerateVertexData=function(){return c.VertexData.CreateBox({size:this.size,sideOrientation:this.side})},g.prototype.copy=function(a){return new g(a,this.getScene(),this.size,this.canBeRegenerated(),null,
this.side)},g.prototype.serialize=function(){var a=b.prototype.serialize.call(this);return a.size=this.size,a},g.Parse=function(b,d){if(d.getGeometryByID(b.id))return null;var g=new a.Primitives.Box(b.id,d,b.size,b.canBeRegenerated,null);return c.Tags.AddTagsTo(g,b.tags),d.pushGeometry(g,!0),g},g);f.Box=d;var h=function(a,d,g,h,e,f,j){void 0===j&&(j=c.Mesh.DEFAULTSIDE);b.call(this,a,d,e,f);this.segments=g;this.diameter=h;this.side=j},d=(__extends(h,b),h.prototype._regenerateVertexData=function(){return c.VertexData.CreateSphere({segments:this.segments,
diameter:this.diameter,sideOrientation:this.side})},h.prototype.copy=function(a){return new h(a,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side)},h.prototype.serialize=function(){var a=b.prototype.serialize.call(this);return a.segments=this.segments,a.diameter=this.diameter,a},h.Parse=function(b,d){if(d.getGeometryByID(b.id))return null;var g=new a.Primitives.Sphere(b.id,d,b.segments,b.diameter,b.canBeRegenerated,null);return c.Tags.AddTagsTo(g,b.tags),d.pushGeometry(g,
!0),g},h);f.Sphere=d;var m=function(a,d,g,h,e,f,j){void 0===j&&(j=c.Mesh.DEFAULTSIDE);b.call(this,a,d,e,f);this.radius=g;this.tessellation=h;this.side=j},d=(__extends(m,b),m.prototype._regenerateVertexData=function(){return c.VertexData.CreateDisc({radius:this.radius,tessellation:this.tessellation,sideOrientation:this.side})},m.prototype.copy=function(a){return new m(a,this.getScene(),this.radius,this.tessellation,this.canBeRegenerated(),null,this.side)},m);f.Disc=d;var l=function(a,d,g,h,e,f,j,k,
l,m){void 0===j&&(j=1);void 0===m&&(m=c.Mesh.DEFAULTSIDE);b.call(this,a,d,k,l);this.height=g;this.diameterTop=h;this.diameterBottom=e;this.tessellation=f;this.subdivisions=j;this.side=m},d=(__extends(l,b),l.prototype._regenerateVertexData=function(){return c.VertexData.CreateCylinder({height:this.height,diameterTop:this.diameterTop,diameterBottom:this.diameterBottom,tessellation:this.tessellation,subdivisions:this.subdivisions,sideOrientation:this.side})},l.prototype.copy=function(a){return new l(a,
this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)},l.prototype.serialize=function(){var a=b.prototype.serialize.call(this);return a.height=this.height,a.diameterTop=this.diameterTop,a.diameterBottom=this.diameterBottom,a.tessellation=this.tessellation,a},l.Parse=function(b,d){if(d.getGeometryByID(b.id))return null;var g=new a.Primitives.Cylinder(b.id,d,b.height,b.diameterTop,b.diameterBottom,b.tessellation,
b.subdivisions,b.canBeRegenerated,null);return c.Tags.AddTagsTo(g,b.tags),d.pushGeometry(g,!0),g},l);f.Cylinder=d;var k=function(a,d,g,h,e,f,j,k){void 0===k&&(k=c.Mesh.DEFAULTSIDE);b.call(this,a,d,f,j);this.diameter=g;this.thickness=h;this.tessellation=e;this.side=k},d=(__extends(k,b),k.prototype._regenerateVertexData=function(){return c.VertexData.CreateTorus({diameter:this.diameter,thickness:this.thickness,tessellation:this.tessellation,sideOrientation:this.side})},k.prototype.copy=function(a){return new k(a,
this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)},k.prototype.serialize=function(){var a=b.prototype.serialize.call(this);return a.diameter=this.diameter,a.thickness=this.thickness,a.tessellation=this.tessellation,a},k.Parse=function(b,d){if(d.getGeometryByID(b.id))return null;var g=new a.Primitives.Torus(b.id,d,b.diameter,b.thickness,b.tessellation,b.canBeRegenerated,null);return c.Tags.AddTagsTo(g,b.tags),d.pushGeometry(g,!0),g},k);f.Torus=d;
var n=function(a,c,d,g,h,e,f){b.call(this,a,c,e,f);this.width=d;this.height=g;this.subdivisions=h},d=(__extends(n,b),n.prototype._regenerateVertexData=function(){return c.VertexData.CreateGround({width:this.width,height:this.height,subdivisions:this.subdivisions})},n.prototype.copy=function(a){return new n(a,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},n.prototype.serialize=function(){var a=b.prototype.serialize.call(this);return a.width=this.width,a.height=
this.height,a.subdivisions=this.subdivisions,a},n.Parse=function(b,d){if(d.getGeometryByID(b.id))return null;var g=new a.Primitives.Ground(b.id,d,b.width,b.height,b.subdivisions,b.canBeRegenerated,null);return c.Tags.AddTagsTo(g,b.tags),d.pushGeometry(g,!0),g},n);f.Ground=d;var q=function(a,c,d,g,h,e,f,j,k,l){b.call(this,a,c,k,l);this.xmin=d;this.zmin=g;this.xmax=h;this.zmax=e;this.subdivisions=f;this.precision=j},d=(__extends(q,b),q.prototype._regenerateVertexData=function(){return c.VertexData.CreateTiledGround({xmin:this.xmin,
zmin:this.zmin,xmax:this.xmax,zmax:this.zmax,subdivisions:this.subdivisions,precision:this.precision})},q.prototype.copy=function(a){return new q(a,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},q);f.TiledGround=d;var p=function(a,d,g,h,e,f){void 0===f&&(f=c.Mesh.DEFAULTSIDE);b.call(this,a,d,h,e);this.size=g;this.side=f},d=(__extends(p,b),p.prototype._regenerateVertexData=function(){return c.VertexData.CreatePlane({size:this.size,
sideOrientation:this.side})},p.prototype.copy=function(a){return new p(a,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},p.prototype.serialize=function(){var a=b.prototype.serialize.call(this);return a.size=this.size,a},p.Parse=function(b,d){if(d.getGeometryByID(b.id))return null;var g=new a.Primitives.Plane(b.id,d,b.size,b.canBeRegenerated,null);return c.Tags.AddTagsTo(g,b.tags),d.pushGeometry(g,!0),g},p);f.Plane=d;var r=function(a,d,g,h,e,f,j,k,l,m,n){void 0===n&&(n=c.Mesh.DEFAULTSIDE);
b.call(this,a,d,l,m);this.radius=g;this.tube=h;this.radialSegments=e;this.tubularSegments=f;this.p=j;this.q=k;this.side=n},d=(__extends(r,b),r.prototype._regenerateVertexData=function(){return c.VertexData.CreateTorusKnot({radius:this.radius,tube:this.tube,radialSegments:this.radialSegments,tubularSegments:this.tubularSegments,p:this.p,q:this.q,sideOrientation:this.side})},r.prototype.copy=function(a){return new r(a,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,
this.q,this.canBeRegenerated(),null,this.side)},r.prototype.serialize=function(){var a=b.prototype.serialize.call(this);return a.radius=this.radius,a.tube=this.tube,a.radialSegments=this.radialSegments,a.tubularSegments=this.tubularSegments,a.p=this.p,a.q=this.q,a},r.Parse=function(b,d){if(d.getGeometryByID(b.id))return null;var g=new a.Primitives.TorusKnot(b.id,d,b.radius,b.tube,b.radialSegments,b.tubularSegments,b.p,b.q,b.canBeRegenerated,null);return c.Tags.AddTagsTo(g,b.tags),d.pushGeometry(g,
!0),g},r);f.TorusKnot=d;!0;!0}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Mesh;f=function(a,b){e.call(this,a,b);this.generateOctree=!1;this._worldInverse=new c.Matrix};f=(__extends(f,e),Object.defineProperty(f.prototype,"subdivisions",{get:function(){return this._subdivisions},enumerable:!0,configurable:!0}),f.prototype.optimize=function(a,b){void 0===b&&(b=32);this._subdivisions=a;this.subdivide(this._subdivisions);this.createOrUpdateSubmeshesOctree(b)},f.prototype.getHeightAtCoordinates=function(a,b){if(a-=this.position.x,b-=this.position.z,a/=
this.scaling.x,b/=this.scaling.z,a<this._minX||a>this._maxX||b<this._minZ||b>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var c=this._getFacetAt(a,b);return-(c.x*a+c.z*b+c.w)/c.y*this.scaling.y+this.position.y},f.prototype.getNormalAtCoordinates=function(a,b){var d=new c.Vector3(0,1,0);return this.getNormalAtCoordinatesToRef(a,b,d),d},f.prototype.getNormalAtCoordinatesToRef=function(a,b,c){if(a-=this.position.x,
b-=this.position.z,a/=this.scaling.x,b/=this.scaling.z,!(a<this._minX||a>this._maxX||b<this._minZ||b>this._maxZ))this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads()),a=this._getFacetAt(a,b),c.x=a.x,c.y=a.y,c.z=a.z},f.prototype.updateCoordinateHeights=function(){this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads();this._computeHeightQuads()},f.prototype._getFacetAt=function(a,b){var c=this._heightQuads[Math.floor(-(b+this._maxZ)*this._subdivisions/
this._height+this._subdivisions)*this._subdivisions+Math.floor((a+this._maxX)*this._subdivisions/this._width)];return b<c.slope.x*a+c.slope.y?c.facet1:c.facet2},f.prototype._initHeightQuads=function(){this._heightQuads=[];for(var a=0;a<this._subdivisions;a++)for(var b=0;b<this._subdivisions;b++){var d={slope:c.Vector2.Zero(),facet1:new c.Vector4(0,0,0,0),facet2:new c.Vector4(0,0,0,0)};this._heightQuads[a*this._subdivisions+b]=d}},f.prototype._computeHeightQuads=function(){for(var a=this.getVerticesData(c.VertexBuffer.PositionKind),
b=c.Tmp.Vector3[0],d=c.Tmp.Vector3[1],e=c.Tmp.Vector3[2],g=c.Tmp.Vector3[3],h=c.Tmp.Vector3[4],f=c.Tmp.Vector3[5],l=c.Tmp.Vector3[6],k=c.Tmp.Vector3[7],n=c.Tmp.Vector3[8],q=0,p=0,r=0,t=r=p=q=0,s=0;s<this._subdivisions;s++)for(var u=0;u<this._subdivisions;u++){q=3*u;p=3*s*(this._subdivisions+1);r=3*(s+1)*(this._subdivisions+1);b.x=a[p+q];b.y=a[p+q+1];b.z=a[p+q+2];d.x=a[p+q+3];d.y=a[p+q+4];d.z=a[p+q+5];e.x=a[r+q];e.y=a[r+q+1];e.z=a[r+q+2];g.x=a[r+q+3];g.y=a[r+q+4];g.z=a[r+q+5];q=(g.z-b.z)/(g.x-b.x);
p=b.z-q*b.x;d.subtractToRef(b,h);e.subtractToRef(b,f);g.subtractToRef(b,l);c.Vector3.CrossToRef(l,f,k);c.Vector3.CrossToRef(h,l,n);k.normalize();n.normalize();var r=-(k.x*b.x+k.y*b.y+k.z*b.z),t=-(n.x*d.x+n.y*d.y+n.z*d.z),v=this._heightQuads[s*this._subdivisions+u];v.slope.copyFromFloats(q,p);v.facet1.copyFromFloats(k.x,k.y,k.z,r);v.facet2.copyFromFloats(n.x,n.y,n.z,t)}},f);c.GroundMesh=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Mesh,a=function(a,d,f,g,h){void 0===f&&(f=null);e.call(this,a,d,f,g,h);this.color=new c.Color3(1,1,1);this.alpha=1;this._positionBuffer={};g&&(this.color=g.color.clone(),this.alpha=g.alpha);this._intersectionThreshold=0.1;this._colorShader=new c.ShaderMaterial("colorShader",d,"color",{attributes:[c.VertexBuffer.PositionKind],uniforms:["worldViewProjection","color"],needAlphaBlending:!0});this._positionBuffer[c.VertexBuffer.PositionKind]=null};f=(__extends(a,e),Object.defineProperty(a.prototype,
"intersectionThreshold",{get:function(){return this._intersectionThreshold},set:function(a){this._intersectionThreshold!==a&&(this._intersectionThreshold=a,this.geometry&&(this.geometry.boundingBias=new c.Vector2(0,a)))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"material",{get:function(){return this._colorShader},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),a.prototype.createInstance=
function(){return c.Tools.Log("LinesMeshes do not support createInstance."),null},a.prototype._bind=function(){var a=this.getScene().getEngine();this._positionBuffer[c.VertexBuffer.PositionKind]=this._geometry.getVertexBuffer(c.VertexBuffer.PositionKind);a.bindBuffers(this._positionBuffer,this._geometry.getIndexBuffer(),this._colorShader.getEffect());this._colorShader.setColor4("color",this.color.toColor4(this.alpha))},a.prototype._draw=function(a){this._geometry&&(this._geometry.getVertexBuffers()&&
this._geometry.getIndexBuffer())&&this.getScene().getEngine().draw(!1,a.indexStart,a.indexCount)},a.prototype.dispose=function(a){this._colorShader.dispose();e.prototype.dispose.call(this,a)},a.prototype.clone=function(b,c,e){return new a(b,this.getScene(),c,this,e)},a);c.LinesMesh=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(c,a,b){var d=this;void 0===a&&(a="");void 0===b&&(b="black");this._renderingCanvas=c;this._loadingText=a;this._loadingDivBackgroundColor=b;this._resizeLoadingUI=function(){var a=d._renderingCanvas.getBoundingClientRect();d._loadingDiv.style.position="absolute";d._loadingDiv.style.left=a.left+"px";d._loadingDiv.style.top=a.top+"px";d._loadingDiv.style.width=a.width+"px";d._loadingDiv.style.height=a.height+"px"}};f=(f.prototype.displayLoadingUI=function(){var c=this;if(!this._loadingDiv){this._loadingDiv=
document.createElement("div");this._loadingDiv.id="babylonjsLoadingDiv";this._loadingDiv.style.opacity="0";this._loadingDiv.style.transition="opacity 1.5s ease";this._loadingTextDiv=document.createElement("div");this._loadingTextDiv.style.position="absolute";this._loadingTextDiv.style.left="0";this._loadingTextDiv.style.top="50%";this._loadingTextDiv.style.marginTop="80px";this._loadingTextDiv.style.width="100%";this._loadingTextDiv.style.height="20px";this._loadingTextDiv.style.fontFamily="Arial";
this._loadingTextDiv.style.fontSize="14px";this._loadingTextDiv.style.color="white";this._loadingTextDiv.style.textAlign="center";this._loadingTextDiv.innerHTML="Loading";this._loadingDiv.appendChild(this._loadingTextDiv);this._loadingTextDiv.innerHTML=this._loadingText;var a=new Image;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAARbSURBVHhe7Z09aFNRFMc716kuLrq4FdyLq4Wi4CAoRQcR0UJBUBdRiuLSIYMo6CA4FF2sgw6CFAdFUOpSQYcWO4hD26UQCfXrIQrx/JJzw1OSWq3NPeL/B4Fy+0jg/HO+7j3vpUcI8b/Q39+/49ihfWdPHT94Yf/e3Se3bd263f8lus218TPn6vV6Ya8Wi/MzNRNmj18iusX9W1evmP1/EKNEIVG6CMbG6E3bt+fT++pHha8NoHdT72bLE8NDg7tGU64gLLndV4Wc4m8j/pS+vr4tGB/DT16v3Fyr8dvBe/jbit8BL0AES9LX1iPAz+BR/hFiLVCynj95dPzNy6fv3IZ/k4L3948Sq7FzYGBg4vLFGxitabuOFCbWNKGrMnbiUuo18KaV6tIHv6YtvL9/nOgE31jCktmrY7k6+/zhE4yP4Vf7hiNqh/BWWEl8mzDol4p22Lf7cIdvdUMEvv0Y2S9fE5S1hLzpqTsPkiep//gFGPnR3Yl7GL5p/xYFBrTwM+iXio3GqpwDGL5p/xYNIX7XG8Q6IJRgdIzf1KBBgafII7oMidhyQtVFaMA2Bt7il4huQRhaXphbcR2g4RXqBzKAGHiCCwGFVUAj/m/RTRDj29cvn10I0PZ3LghH5f4CL1EFlQmqqXK3jDDKFxmhQ3Yt6oQseUZGKmMnTpsOqc8o1F9kBOMjQlOLeqEeIyOc6JV6jYLJD/+XyIFvnzdgl9aXRQ5I2qZDK1SpospMqaoqON/wZZGDciLnMMiXRS7IF4hhqMTNTdk7CFu+LHLhR7BQqBvPDJUUQqCGvCMATHUgBmhWNgApmdOda9YpM+VwRYfuyyIXDK8hBlilNerLIheMZCKGwlUAyru6GlwOgPUbRxADdJ9FAChxXY864viyyEXqPxhc0M2TAfAbatSdRyHtXymhByEdRnE3ky+JnHAIhSA0h74kckETmHoQbSgGwJrCIRMEPSRIBCRIMAhZaYhaggQhJXUJEoRU9mofKwh+F22dLRRfEjlJM7w6KQwCoQpBOKTyJZETjmwRxKqtGV8SOSkNOGjKPQppBEgDDkFgpxdBVGkFgaYQQXRIFQSObk0P5ZFIpAZRHXsQ0r0hCluBWKkuvVbYCkQaCdL5ehBScudJP4yY+rLISdps1NBDEJKXMMmoSfggWC4ZQRR17oFYXph7hSiquIKQ+hJGTX1J5MYSPD/GVdNzsgLBwZVCVyAQAkF0ohiI/c1fS6tNXq9UfEnkhudmIQolsS+J3Hh/UtNDzQLhj42VKJFInqLwFYiUU5ToA+HdfI0JevUpQUAIn+vSz2lHIuUV/dJOIHhOY/IWVWGBIHQtzs88s9zyWBuTgcBLzGOmeNnfF/QslSDgMeQW85i3DOQxuipxAkCyZ8SIm4Omp+7MMlCB59j6sKZcMoM4iIEoeI2J9AKxrFobZx0v4vYInuHFS4J1GQRCAGaLEYQXfyMML5XSQgghhBBCCCH+cXp6vgNhKpSKX/XdOAAAAABJRU5ErkJggg==";
a.style.position="absolute";a.style.left="50%";a.style.top="50%";a.style.marginLeft="-50px";a.style.marginTop="-50px";a.style.transition="transform 1.0s ease";a.style.webkitTransition="-webkit-transform 1.0s ease";var b=360,d=function(){b+=360;a.style.transform="rotateZ("+b+"deg)";a.style.webkitTransform="rotateZ("+b+"deg)"};a.addEventListener("transitionend",d);a.addEventListener("webkitTransitionEnd",d);this._loadingDiv.appendChild(a);d=new Image;d.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAAYJSURBVHhe7Zy/qx1FFMff/2Av2Nvbi4WFiiAEY/OQ2IgQsbCJQoqkCAgpFLXyoZURLfwBIiIpgqZJoYQYlWelNsIrNOxDJcrzfHe+G97dnTl75u7euzv7zgcWHrlnZmfOmXPmzI/NjuM4juM4juM4juM4juM4juM4juM4juM45fPic08/uHf5/CvffH7lnT8PfrtxdHS0n3p+/fHGl5+89/prr5599iEWd8bg0rkXHoFyqehKnlxQpjYSDHTm9JMPsGrHylOPPXofvICKXMcIGtXdf/76AYbm6xyNW9e/eAtKC7rbKLXnvHHx5Sf4auc4Ek7OQkFU1Dap/vv37k/wSjblZANFiFIGzw98hhizwqBgs04mCBdQRNCHidoAEtY+lLIvtSdoGFeyql2ZH57HBH4sE7O+o/r9l+8/ZXUni68+2jsHBQQ9qNRGeP/tSxdSYQX/roUcpL4/f3vtM9TD+jTq92n1LQ7jxF1hhGPtwWL3gGccy8JuS1r8sVWBGXNVdSKMYjBGPUJjCzooiGuSpnwlnnOGP2dhHRSLNgpHp2oMKIriK8TmG4Qh/rwW8D6pps9b9im+LDDipXOqMVJrAngBfg9i98gevWKA+/nnCod3Dr5GfaHaDgidVym6HKRjGIkpqthcAVKGxNqBImbEo66kjCih8AOpNmkUmbMuUrR8kEqiU6FvHZLGAPJ71JCYSyhiBqmwFE2GoD6jLGIfDHtG6EzoU4dK21PCqIRMEF0FGRjFzGDtIkXVAdATvsqfT9CJ0JcOFdYiFIsiMlqYy1YOFpQo2OddqBtyEaq9y+efoVh5oPHoROjLKn0j3JIE5Ka8UqZRtGrMnneX6yVofOhDh94MSbznTcpqmDOt1vyQzOgaJAF4F3JBfIXesrNEGWWmjIX7UBZ6jRJbBMLg/DmJiKUGVHleIpnVNTa+jakzkAviJqLhi4MC9XQGBrZeKJZESSrKy7ik0VGFWhQBRDTHIACKQ5l9nAjy75gya4a2w+Jhs0FJdc0xX/GwUbAqFBkZi7QpJ2w16WUbjFyK9MJF3KaoEM74KhVtLrQOrsmRxkbdHEqmSC/c+EuGnIFkjW7Ih2Kr4CCMIvNG2hrrgLpCjiFloooYCjyYrzCRyvhyBthkIPuQtsZGdnbMTezyDiU71KTC5zr7aVsHbsz2tllrEkS5UHwU1tq1HbtPW4UbeB0O7xx8R5EsMJql+BheUmHjkNVmIRP7LutoM3+D4O4tG7vCkNO9ESZ4lL3J6rKRMPx4qKbD/A0icf8CG7tC7kTahnMTwleuYSrsS7GatRAvfZh1tTm5BmmQCdZ8a0Sefe28xUrRBkmFLKy8KTIKUDRX0Y1xagPgwbaIdeFnQULmKak3xvwNMkVGgok/N5XNoehJvejRlCDl9escI28dJU0tZ++nBTJE9mEF647x5Ehbo4s5hDOKFIU0PdofeA5F5k1q63zIWmQqNI/P3ZubjFTqKxQ3jyjHAOX0RdlgVO9hzRFpczRcjZ3Gbxxpc7Qj6+5pTYF2OFXawNI+yDGf1k2NcvOlzBQeDQ/t7zD7DsEDpJ2xATXaNtDWUS4IzP4DS2ljajAVu57SUkYw245ptxZxA5JiZaJ0DswudGn3kYUy54426EjoT4dZfYbccxC2nI92cDkZHQr96jD4AGkMDKeSy/COBsRe6VTSKFN6irLeaCh3IteQjt1E5+oudsG/b/2DfZ5AqsYo8vMDK9LB1HzSsLWvlGThdxXvC6+NsqyPPWP0pMINtbdsajfVeC6f/GZ+cdAofQoB1d+Hf9waY98I7+RXWab3Lt4zYkjHtTnlOLXHYMsCh1zWeQYehu1zfNPOOiys/d91LAKEBSgh6MJMbSA82AaHofDgAIwbgvVvlLNS11nModMm4UZergLHZBZrodmBuA3lBB1thdorSjkOmATMDwg/UBQVtglqQyx6fbEJ+H3IWIapjYAjAfeIgeCMHldueJvFaqDaAHhwf8qNsEEQ1iQbOoUUGIbCLRc8+Bvfp4jyd2FEijuO4ziO4ziO4ziO4ziO4ziO4ziO4ziOUzw7O/8D0P7rcZ/GEboAAAAASUVORK5CYII=";
d.style.position="absolute";d.style.left="50%";d.style.top="50%";d.style.marginLeft="-50px";d.style.marginTop="-50px";this._loadingDiv.appendChild(d);this._resizeLoadingUI();window.addEventListener("resize",this._resizeLoadingUI);this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor;document.body.appendChild(this._loadingDiv);setTimeout(function(){c._loadingDiv.style.opacity="1";a.style.transform="rotateZ(360deg)";a.style.webkitTransform="rotateZ(360deg)"},0)}},f.prototype.hideLoadingUI=
function(){var c=this;this._loadingDiv&&(this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",function(){c._loadingDiv&&(document.body.removeChild(c._loadingDiv),window.removeEventListener("resize",c._resizeLoadingUI),c._loadingDiv=null)}))},Object.defineProperty(f.prototype,"loadingUIText",{set:function(c){this._loadingText=c;this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,
"loadingUIBackgroundColor",{get:function(){return this._loadingDivBackgroundColor},set:function(c){this._loadingDivBackgroundColor=c;this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),f);c.DefaultLoadingScreen=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){this._audioContext=null;this.unlocked=this.WarnedWebAudioUnsupported=this.canUseWebAudio=this._audioContextInitialized=!1;"undefined"==typeof window.AudioContext&&"undefined"==typeof window.webkitAudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0);/iPad|iPhone|iPod/.test(navigator.platform)?this._unlockiOSaudio():this.unlocked=!0};f=(Object.defineProperty(f.prototype,"audioContext",{get:function(){return this._audioContextInitialized||
this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),f.prototype._unlockiOSaudio=function(){var c=this,a=function(){var b=c.audioContext.createBuffer(1,1,22050),d=c.audioContext.createBufferSource();d.buffer=b;d.connect(c.audioContext.destination);d.start(0);setTimeout(function(){d.playbackState!==d.PLAYING_STATE&&d.playbackState!==d.FINISHED_STATE||(c.unlocked=!0,window.removeEventListener("touchend",a,!1),c.onAudioUnlocked&&c.onAudioUnlocked())},0)};window.addEventListener("touchend",
a,!1)},f.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0)}catch(e){this.canUseWebAudio=!1,c.Tools.Error("Web Audio: "+e.message)}},f.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&(this._connectedAnalyser.stopDebugCanvas(),
this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1);this.WarnedWebAudioUnsupported=!1},f.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},f.prototype.setGlobalVolume=function(c){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=c)},f.prototype.connectToAnalyser=function(c){this._connectedAnalyser&&
this._connectedAnalyser.stopDebugCanvas();this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser=c,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},f);c.AudioEngine=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,b,d,e,g){var h=this;this.spatialSound=this.useCustomAttenuation=this.loop=this.autoplay=!1;this.rolloffFactor=this.refDistance=1;this.maxDistance=100;this.distanceModel="linear";this._panningModel="equalpower";this._playbackRate=1;this._streaming=!1;this._startOffset=this._startTime=0;this._position=c.Vector3.Zero();this._localDirection=new c.Vector3(1,0,0);this._volume=1;this._isDirectional=this.isPaused=this.isPlaying=this._isReadyToPlay=this._isLoaded=!1;this._coneOuterAngle=
this._coneInnerAngle=360;this._coneOuterGain=0;this._isOutputConnected=!1;this.name=a;this._scene=d;this._readyToPlayCallback=e;this._customAttenuationFunction=function(a,b,c){return c>b?a*(1-b/c):0};g&&(this.autoplay=g.autoplay||!1,this.loop=g.loop||!1,void 0!==g.volume&&(this._volume=g.volume),this.spatialSound=g.spatialSound||!1,this.maxDistance=g.maxDistance||100,this.useCustomAttenuation=g.useCustomAttenuation||!1,this.rolloffFactor=g.rolloffFactor||1,this.refDistance=g.refDistance||1,this.distanceModel=
g.distanceModel||"linear",this._playbackRate=g.playbackRate||1,this._streaming=g.streaming||!1);c.Engine.audioEngine.canUseWebAudio?(this._soundGain=c.Engine.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._ouputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this),b&&("string"==typeof b?this._streaming?(this._htmlAudioElement=new Audio(b),this._htmlAudioElement.controls=
!1,this._htmlAudioElement.loop=this.loop,this._htmlAudioElement.crossOrigin="anonymous",this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",function(){h._isReadyToPlay=!0;h.autoplay&&h.play();h._readyToPlayCallback&&h._readyToPlayCallback()}),document.body.appendChild(this._htmlAudioElement)):c.Tools.LoadFile(b,function(a){h._soundLoaded(a)},null,this._scene.database,!0):b instanceof ArrayBuffer?0<b.byteLength&&this._soundLoaded(b):c.Tools.Error("Parameter must be a URL to the sound or an ArrayBuffer of the sound."))):
(this._scene.mainSoundTrack.AddSound(this),c.Engine.audioEngine.WarnedWebAudioUnsupported||(c.Tools.Error("Web Audio is not supported by your browser."),c.Engine.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){h._readyToPlayCallback()},1E3))};f=(e.prototype.dispose=function(){c.Engine.audioEngine.canUseWebAudio&&this._isReadyToPlay&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):
this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),
this._connectedMesh=null))},e.prototype._soundLoaded=function(a){var b=this;this._isLoaded=!0;c.Engine.audioEngine.audioContext.decodeAudioData(a,function(a){b._audioBuffer=a;b._isReadyToPlay=!0;b.autoplay&&b.play();b._readyToPlayCallback&&b._readyToPlayCallback()},function(){c.Tools.Error("Error while decoding audio data for: "+b.name)})},e.prototype.setAudioBuffer=function(a){c.Engine.audioEngine.canUseWebAudio&&(this._audioBuffer=a,this._isReadyToPlay=!0)},e.prototype.updateOptions=function(a){a&&
(this.loop=a.loop||this.loop,this.maxDistance=a.maxDistance||this.maxDistance,this.useCustomAttenuation=a.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=a.rolloffFactor||this.rolloffFactor,this.refDistance=a.refDistance||this.refDistance,this.distanceModel=a.distanceModel||this.distanceModel,this._playbackRate=a.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._streaming?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource.playbackRate.value=
this._playbackRate))},e.prototype._createSpatialParameters=function(){c.Engine.audioEngine.canUseWebAudio&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=c.Engine.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._ouputAudioNode),this._inputAudioNode=this._soundPanner)},e.prototype._updateSpatialParameters=function(){this.spatialSound&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=
Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},e.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF";this._switchPanningModel()},e.prototype.switchPanningModelToEqualPower=
function(){this._panningModel="equalpower";this._switchPanningModel()},e.prototype._switchPanningModel=function(){c.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&(this._soundPanner.panningModel=this._panningModel)},e.prototype.connectToSoundTrackAudioNode=function(a){c.Engine.audioEngine.canUseWebAudio&&(this._isOutputConnected&&this._ouputAudioNode.disconnect(),this._ouputAudioNode.connect(a),this._isOutputConnected=!0)},e.prototype.setDirectionalCone=function(a,b,d){return a>b?void c.Tools.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):
(this._coneInnerAngle=a,this._coneOuterAngle=b,this._coneOuterGain=d,this._isDirectional=!0,void(this.isPlaying&&this.loop&&(this.stop(),this.play())))},e.prototype.setPosition=function(a){this._position=a;c.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},e.prototype.setLocalDirectionToMesh=function(a){this._localDirection=a;c.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.isPlaying&&this._updateDirection()},
e.prototype._updateDirection=function(){var a=this._connectedMesh.getWorldMatrix(),a=c.Vector3.TransformNormal(this._localDirection,a);a.normalize();this._soundPanner.setOrientation(a.x,a.y,a.z)},e.prototype.updateDistanceFromListener=function(){if(c.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.useCustomAttenuation){var a=this._connectedMesh.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,a,this.maxDistance,this.refDistance,
this.rolloffFactor)}},e.prototype.setAttenuationFunction=function(a){this._customAttenuationFunction=a},e.prototype.play=function(a){var b=this;if(this._isReadyToPlay&&this._scene.audioEnabled)try{0>this._startOffset&&(a=-this._startOffset,this._startOffset=0);var d=a?c.Engine.audioEngine.audioContext.currentTime+a:c.Engine.audioEngine.audioContext.currentTime;this._soundSource&&this._streamingSource||this.spatialSound&&(this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),
this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedMesh?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z)));this._streaming?(this._streamingSource||(this._streamingSource=c.Engine.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=
function(){b._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement.play()):(this._soundSource=c.Engine.audioEngine.audioContext.createBufferSource(),this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=function(){b._onended()},
this._soundSource.start(d,this.isPaused?this._startOffset%this._soundSource.buffer.duration:0));this._startTime=d;this.isPlaying=!0;this.isPaused=!1}catch(e){c.Tools.Error("Error while trying to play audio: "+this.name+", "+e.message)}},e.prototype._onended=function(){this.isPlaying=!1;this.onended&&this.onended()},e.prototype.stop=function(a){this.isPlaying&&(this._streaming?(this._htmlAudioElement.pause(),0<this._htmlAudioElement.currentTime&&(this._htmlAudioElement.currentTime=0)):(this._soundSource.stop(a?
c.Engine.audioEngine.audioContext.currentTime+a:c.Engine.audioEngine.audioContext.currentTime),this._soundSource.onended=null,this.isPaused||(this._startOffset=0)),this.isPlaying=!1)},e.prototype.pause=function(){this.isPlaying&&(this.isPaused=!0,this._streaming?this._htmlAudioElement.pause():(this.stop(0),this._startOffset+=c.Engine.audioEngine.audioContext.currentTime-this._startTime))},e.prototype.setVolume=function(a,b){c.Engine.audioEngine.canUseWebAudio&&(b?(this._soundGain.gain.cancelScheduledValues(c.Engine.audioEngine.audioContext.currentTime),
this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,c.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(a,c.Engine.audioEngine.audioContext.currentTime+b)):this._soundGain.gain.value=a);this._volume=a},e.prototype.setPlaybackRate=function(a){this._playbackRate=a;this.isPlaying&&(this._streaming?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource.playbackRate.value=this._playbackRate)},e.prototype.getVolume=function(){return this._volume},
e.prototype.attachToMesh=function(a){var b=this;this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null);this._connectedMesh=a;this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play()));this._onRegisterAfterWorldMatrixUpdate(this._connectedMesh);this._registerFunc=function(a){return b._onRegisterAfterWorldMatrixUpdate(a)};a.registerAfterWorldMatrixUpdate(this._registerFunc)},
e.prototype.detachFromMesh=function(){this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedMesh=null)},e.prototype._onRegisterAfterWorldMatrixUpdate=function(a){this.setPosition(a.getBoundingInfo().boundingSphere.centerWorld);c.Engine.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()},e.prototype.clone=function(){var a=this;if(this._streaming)return null;var b=function(){a._isReadyToPlay?
(f._audioBuffer=a.getAudioBuffer(),f._isReadyToPlay=!0,f.autoplay&&f.play()):window.setTimeout(b,300)},c={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},f=new e(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,c);return this.useCustomAttenuation&&f.setAttenuationFunction(this._customAttenuationFunction),
f.setPosition(this._position),f.setPlaybackRate(this._playbackRate),b(),f},e.prototype.getAudioBuffer=function(){return this._audioBuffer},e.Parse=function(a,b,d,f){var g=a.name;d=a.url?d+a.url:d+g;var h,m={autoplay:a.autoplay,loop:a.loop,volume:a.volume,spatialSound:a.spatialSound,maxDistance:a.maxDistance,rolloffFactor:a.rolloffFactor,refDistance:a.refDistance,distanceModel:a.distanceModel,playbackRate:a.playbackRate};if(f){var l=function(){f._isReadyToPlay?(h._audioBuffer=f.getAudioBuffer(),h._isReadyToPlay=
!0,h.autoplay&&h.play()):window.setTimeout(l,300)};h=new e(g,new ArrayBuffer(0),b,null,m);l()}else h=new e(g,d,b,function(){b._removePendingData(h)},m),b._addPendingData(h);a.position&&(g=c.Vector3.FromArray(a.position),h.setPosition(g));if(a.isDirectional&&(h.setDirectionalCone(a.coneInnerAngle||360,a.coneOuterAngle||360,a.coneOuterGain||0),a.localDirectionToMesh))g=c.Vector3.FromArray(a.localDirectionToMesh),h.setLocalDirectionToMesh(g);a.connectedMeshId&&(a=b.getMeshByID(a.connectedMeshId))&&h.attachToMesh(a);
return h},e);c.Sound=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(c,a){this.id=-1;this._isInitialized=this._isMainTrack=!1;this._scene=c;this.soundCollection=[];this._options=a;this._isMainTrack||(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)};f=(f.prototype._initializeSoundTrackAudioGraph=function(){c.Engine.audioEngine.canUseWebAudio&&(this._outputAudioNode=c.Engine.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(c.Engine.audioEngine.masterGain),this._options&&(this._options.volume&&
(this._outputAudioNode.gain.value=this._options.volume),this._options.mainTrack&&(this._isMainTrack=this._options.mainTrack)),this._isInitialized=!0)},f.prototype.dispose=function(){if(c.Engine.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect();this._outputAudioNode=null}},f.prototype.AddSound=function(e){this._isInitialized||this._initializeSoundTrackAudioGraph();
c.Engine.audioEngine.canUseWebAudio&&e.connectToSoundTrackAudioNode(this._outputAudioNode);e.soundTrackId&&(-1===e.soundTrackId?this._scene.mainSoundTrack.RemoveSound(e):this._scene.soundTracks[e.soundTrackId].RemoveSound(e));this.soundCollection.push(e);e.soundTrackId=this.id},f.prototype.RemoveSound=function(c){c=this.soundCollection.indexOf(c);-1!==c&&this.soundCollection.splice(c,1)},f.prototype.setVolume=function(e){c.Engine.audioEngine.canUseWebAudio&&(this._outputAudioNode.gain.value=e)},f.prototype.switchPanningModelToHRTF=
function(){if(c.Engine.audioEngine.canUseWebAudio)for(var e=0;e<this.soundCollection.length;e++)this.soundCollection[e].switchPanningModelToHRTF()},f.prototype.switchPanningModelToEqualPower=function(){if(c.Engine.audioEngine.canUseWebAudio)for(var e=0;e<this.soundCollection.length;e++)this.soundCollection[e].switchPanningModelToEqualPower()},f.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this._connectedAnalyser=e;c.Engine.audioEngine.canUseWebAudio&&
(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,c.Engine.audioEngine.masterGain))},f);c.SoundTrack=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(){};f=(e.TransformCoordinatesToRefSIMD=function(a,b,c){a=SIMD.float32x4.loadXYZ(a._data,0);var d=SIMD.float32x4.load(b.m,0),g=SIMD.float32x4.load(b.m,4),h=SIMD.float32x4.load(b.m,8);b=SIMD.float32x4.load(b.m,12);b=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(a,0,0,0,0),d),SIMD.float32x4.mul(SIMD.float32x4.swizzle(a,1,1,1,1),g)),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(a,2,2,2,2),h),b));b=SIMD.float32x4.div(b,SIMD.float32x4.swizzle(b,
3,3,3,3));SIMD.float32x4.storeXYZ(c._data,0,b)},e.TransformCoordinatesFromFloatsToRefSIMD=function(a,b,c,d,g){a=SIMD.float32x4.splat(a);b=SIMD.float32x4.splat(b);c=SIMD.float32x4.splat(c);var h=SIMD.float32x4.load(d.m,0),e=SIMD.float32x4.load(d.m,4),f=SIMD.float32x4.load(d.m,8);d=SIMD.float32x4.load(d.m,12);d=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(a,h),SIMD.float32x4.mul(b,e)),SIMD.float32x4.add(SIMD.float32x4.mul(c,f),d));d=SIMD.float32x4.div(d,SIMD.float32x4.swizzle(d,3,3,3,3));
SIMD.float32x4.storeXYZ(g._data,0,d)},e);c.SIMDVector3=f;var a,e=function(){};a=(e.prototype.multiplyToArraySIMD=function(a,b,c){void 0===c&&(c=0);var d=this.m,g=a.m;a=SIMD.float32x4.load(g,0);var h=SIMD.float32x4.load(g,4),e=SIMD.float32x4.load(g,8),g=SIMD.float32x4.load(g,12),f=SIMD.float32x4.load(d,0);SIMD.float32x4.store(b,c+0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,0,0,0,0),a),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,1,1,1,1),h),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,
2,2,2,2),e),SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,3,3,3,3),g)))));f=SIMD.float32x4.load(d,4);SIMD.float32x4.store(b,c+4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,0,0,0,0),a),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,1,1,1,1),h),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,2,2,2,2),e),SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,3,3,3,3),g)))));f=SIMD.float32x4.load(d,8);SIMD.float32x4.store(b,c+8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,
0,0,0,0),a),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,1,1,1,1),h),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,2,2,2,2),e),SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,3,3,3,3),g)))));d=SIMD.float32x4.load(d,12);SIMD.float32x4.store(b,c+12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,0,0,0,0),a),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,1,1,1,1),h),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,2,2,2,2),e),
SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,3,3,3,3),g)))))},e.prototype.invertToRefSIMD=function(a){var b,c,d,g,h,e,f,j,m,w,x=this.m;a=a.m;var B=SIMD.float32x4.load(x,0),y=SIMD.float32x4.load(x,4),C=SIMD.float32x4.load(x,8),x=SIMD.float32x4.load(x,12);return h=SIMD.float32x4.shuffle(B,y,0,1,4,5),c=SIMD.float32x4.shuffle(C,x,0,1,4,5),b=SIMD.float32x4.shuffle(h,c,0,2,4,6),c=SIMD.float32x4.shuffle(c,h,1,3,5,7),h=SIMD.float32x4.shuffle(B,y,2,3,6,7),g=SIMD.float32x4.shuffle(C,x,2,3,6,7),d=SIMD.float32x4.shuffle(h,
g,0,2,4,6),g=SIMD.float32x4.shuffle(g,h,1,3,5,7),h=SIMD.float32x4.mul(d,g),h=SIMD.float32x4.swizzle(h,1,0,3,2),e=SIMD.float32x4.mul(c,h),f=SIMD.float32x4.mul(b,h),h=SIMD.float32x4.swizzle(h,2,3,0,1),e=SIMD.float32x4.sub(SIMD.float32x4.mul(c,h),e),f=SIMD.float32x4.sub(SIMD.float32x4.mul(b,h),f),f=SIMD.float32x4.swizzle(f,2,3,0,1),h=SIMD.float32x4.mul(c,d),h=SIMD.float32x4.swizzle(h,1,0,3,2),e=SIMD.float32x4.add(SIMD.float32x4.mul(g,h),e),m=SIMD.float32x4.mul(b,h),h=SIMD.float32x4.swizzle(h,2,3,0,1),
e=SIMD.float32x4.sub(e,SIMD.float32x4.mul(g,h)),m=SIMD.float32x4.sub(SIMD.float32x4.mul(b,h),m),m=SIMD.float32x4.swizzle(m,2,3,0,1),h=SIMD.float32x4.mul(SIMD.float32x4.swizzle(c,2,3,0,1),g),h=SIMD.float32x4.swizzle(h,1,0,3,2),d=SIMD.float32x4.swizzle(d,2,3,0,1),e=SIMD.float32x4.add(SIMD.float32x4.mul(d,h),e),j=SIMD.float32x4.mul(b,h),h=SIMD.float32x4.swizzle(h,2,3,0,1),e=SIMD.float32x4.sub(e,SIMD.float32x4.mul(d,h)),j=SIMD.float32x4.sub(SIMD.float32x4.mul(b,h),j),j=SIMD.float32x4.swizzle(j,2,3,0,
1),h=SIMD.float32x4.mul(b,c),h=SIMD.float32x4.swizzle(h,1,0,3,2),j=SIMD.float32x4.add(SIMD.float32x4.mul(g,h),j),m=SIMD.float32x4.sub(SIMD.float32x4.mul(d,h),m),h=SIMD.float32x4.swizzle(h,2,3,0,1),j=SIMD.float32x4.sub(SIMD.float32x4.mul(g,h),j),m=SIMD.float32x4.sub(m,SIMD.float32x4.mul(d,h)),h=SIMD.float32x4.mul(b,g),h=SIMD.float32x4.swizzle(h,1,0,3,2),f=SIMD.float32x4.sub(f,SIMD.float32x4.mul(d,h)),j=SIMD.float32x4.add(SIMD.float32x4.mul(c,h),j),h=SIMD.float32x4.swizzle(h,2,3,0,1),f=SIMD.float32x4.add(SIMD.float32x4.mul(d,
h),f),j=SIMD.float32x4.sub(j,SIMD.float32x4.mul(c,h)),h=SIMD.float32x4.mul(b,d),h=SIMD.float32x4.swizzle(h,1,0,3,2),f=SIMD.float32x4.add(SIMD.float32x4.mul(g,h),f),m=SIMD.float32x4.sub(m,SIMD.float32x4.mul(c,h)),h=SIMD.float32x4.swizzle(h,2,3,0,1),f=SIMD.float32x4.sub(f,SIMD.float32x4.mul(g,h)),m=SIMD.float32x4.add(SIMD.float32x4.mul(c,h),m),w=SIMD.float32x4.mul(b,e),w=SIMD.float32x4.add(SIMD.float32x4.swizzle(w,2,3,0,1),w),w=SIMD.float32x4.add(SIMD.float32x4.swizzle(w,1,0,3,2),w),h=SIMD.float32x4.reciprocalApproximation(w),
w=SIMD.float32x4.sub(SIMD.float32x4.add(h,h),SIMD.float32x4.mul(w,SIMD.float32x4.mul(h,h))),w=SIMD.float32x4.swizzle(w,0,0,0,0),e=SIMD.float32x4.mul(w,e),f=SIMD.float32x4.mul(w,f),j=SIMD.float32x4.mul(w,j),m=SIMD.float32x4.mul(w,m),SIMD.float32x4.store(a,0,e),SIMD.float32x4.store(a,4,f),SIMD.float32x4.store(a,8,j),SIMD.float32x4.store(a,12,m),this},e.LookAtLHToRefSIMD=function(a,b,c,d){d=d.m;b=SIMD.float32x4(b.x,b.y,b.z,0);a=SIMD.float32x4(a.x,a.y,a.z,0);var g=SIMD.float32x4(c.x,c.y,c.z,0),h=SIMD.float32x4.sub(b,
a);c=SIMD.float32x4.mul(h,h);c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3)));h=SIMD.float32x4.mul(h,SIMD.float32x4.reciprocalSqrtApproximation(c));c=SIMD.float32x4.mul(g,g);c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3)));g=SIMD.float32x4.mul(g,SIMD.float32x4.reciprocalSqrtApproximation(c));g=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,1,2,0,3),SIMD.float32x4.swizzle(g,
2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,2,0,1,3),SIMD.float32x4.swizzle(g,1,2,0,3)));c=SIMD.float32x4.mul(g,g);c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3)));var g=SIMD.float32x4.mul(g,SIMD.float32x4.reciprocalSqrtApproximation(c)),e=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,1,2,0,3),SIMD.float32x4.swizzle(h,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(g,2,0,1,3),SIMD.float32x4.swizzle(h,1,2,
0,3)));c=SIMD.float32x4.mul(g,g);c=SIMD.float32x4.add(c,SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(c,2,0,1,3)));var g=SIMD.float32x4.mul(g,SIMD.float32x4.reciprocalSqrtApproximation(c)),f=SIMD.float32x4.splat(0),g=SIMD.float32x4.neg(g),j=SIMD.float32x4.shuffle(g,e,0,1,4,5),m=SIMD.float32x4.shuffle(h,f,0,1,4,5);c=SIMD.float32x4.shuffle(j,m,0,2,4,6);b=SIMD.float32x4.shuffle(j,m,1,3,5,7);j=SIMD.float32x4.shuffle(g,e,2,3,6,7);m=SIMD.float32x4.shuffle(h,f,2,3,6,7);h=SIMD.float32x4.shuffle(j,
m,0,2,4,6);g=SIMD.float32x4(0,0,0,1);e=SIMD.float32x4(1,0,0,0);f=SIMD.float32x4(0,1,0,0);j=SIMD.float32x4(0,0,1,0);a=SIMD.float32x4.neg(a);a=SIMD.float32x4.withW(a,1);SIMD.float32x4.store(d,0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(e,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(e,1,1,1,1),b),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(e,2,2,2,2),h),SIMD.float32x4.mul(SIMD.float32x4.swizzle(e,3,3,3,3),g)))));SIMD.float32x4.store(d,4,
SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,1,1,1,1),b),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,2,2,2,2),h),SIMD.float32x4.mul(SIMD.float32x4.swizzle(f,3,3,3,3),g)))));SIMD.float32x4.store(d,8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(j,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(j,1,1,1,1),b),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(j,
2,2,2,2),h),SIMD.float32x4.mul(SIMD.float32x4.swizzle(j,3,3,3,3),g)))));SIMD.float32x4.store(d,12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(a,0,0,0,0),c),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(a,1,1,1,1),b),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(a,2,2,2,2),h),SIMD.float32x4.mul(SIMD.float32x4.swizzle(a,3,3,3,3),g)))))},e);c.SIMDMatrix=a;var b=c.Matrix.prototype.multiplyToArray,d=c.Matrix.prototype.invertToRef,j=c.Matrix.LookAtLHToRef,
g=c.Vector3.TransformCoordinatesToRef,h=c.Vector3.TransformCoordinatesFromFloatsToRef,m=function(){},e=(Object.defineProperty(m,"IsEnabled",{get:function(){return m._isEnabled},enumerable:!0,configurable:!0}),m.DisableSIMD=function(){c.Matrix.prototype.multiplyToArray=b;c.Matrix.prototype.invertToRef=d;c.Matrix.LookAtLHToRef=j;c.Vector3.TransformCoordinatesToRef=g;c.Vector3.TransformCoordinatesFromFloatsToRef=h;m._isEnabled=!1},m.EnableSIMD=function(){void 0!==window.SIMD&&(c.Matrix.prototype.multiplyToArray=
a.prototype.multiplyToArraySIMD,c.Matrix.prototype.invertToRef=a.prototype.invertToRefSIMD,c.Matrix.LookAtLHToRef=a.LookAtLHToRefSIMD,c.Vector3.TransformCoordinatesToRef=f.TransformCoordinatesToRefSIMD,c.Vector3.TransformCoordinatesFromFloatsToRef=f.TransformCoordinatesFromFloatsToRefSIMD,Object.defineProperty(c.Vector3.prototype,"x",{get:function(){return this._data[0]},set:function(a){this._data||(this._data=new Float32Array(3));this._data[0]=a}}),Object.defineProperty(c.Vector3.prototype,"y",{get:function(){return this._data[1]},
set:function(a){this._data[1]=a}}),Object.defineProperty(c.Vector3.prototype,"z",{get:function(){return this._data[2]},set:function(a){this._data[2]=a}}),m._isEnabled=!0)},m._isEnabled=!1,m);c.SIMDHelper=e}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,c,e,g){this._pos=e;this._size=g;this._root=a;this._parent=c};f=(Object.defineProperty(e.prototype,"pos",{get:function(){return this._pos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentSize",{get:function(){return this._contentSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"UVs",{get:function(){var a=this._root._size.width,d=this._root._size.height,e=new c.Vector2(this._pos.x/a,this._pos.y/d),a=new c.Vector2((this._pos.x+
this._contentSize.width-1)/a,(this._pos.y+this._contentSize.height-1)/d),d=[];return d.push(e),d.push(new c.Vector2(a.x,e.y)),d.push(a),d.push(new c.Vector2(e.x,a.y)),d},enumerable:!0,configurable:!0}),e.prototype.freeContent=function(){this.contentSize&&(this._contentSize=null,this.attemptDefrag())},Object.defineProperty(e.prototype,"isUsed",{get:function(){return null!=this._contentSize||null!=this._leftNode},enumerable:!0,configurable:!0}),e.prototype.findAndSplitNode=function(a){var c=this.findNode(a);
return c?(c.splitNode(a),c):null},e.prototype.findNode=function(a){var c=null;return this.isUsed?(this._leftNode&&(c=this._leftNode.findNode(a)),!c&&this._rightNode&&(c=this._rightNode.findNode(a)),!c&&this._bottomNode&&(c=this._bottomNode.findNode(a))):this._initialSize&&a.width<=this._initialSize.width&&a.height<=this._initialSize.height?c=this:a.width<=this._size.width&&a.height<=this._size.height&&(c=this),c},e.prototype.splitNode=function(a){return!this._contentSize&&this._initialSize?(this._leftNode=
new e(this._root,this,new c.Vector2(this._pos.x,this._pos.y),new c.Size(this._initialSize.width,this._initialSize.height)),this._leftNode.splitNode(a)):(this._contentSize=a.clone(),this._initialSize=a.clone(),a.width!==this._size.width&&(this._rightNode=new e(this._root,this,new c.Vector2(this._pos.x+a.width,this._pos.y),new c.Size(this._size.width-a.width,a.height))),a.height!==this._size.height&&(this._bottomNode=new e(this._root,this,new c.Vector2(this._pos.x,this._pos.y+a.height),new c.Size(this._size.width,
this._size.height-a.height))),this)},e.prototype.attemptDefrag=function(){!this.isUsed&&this.isRecursiveFree&&(this.clearNode(),this._parent&&this._parent.attemptDefrag())},e.prototype.clearNode=function(){this._bottomNode=this._rightNode=this._initialSize=null},Object.defineProperty(e.prototype,"isRecursiveFree",{get:function(){return!this.contentSize&&(!this._leftNode||this._leftNode.isRecursiveFree)&&(!this._rightNode||this._rightNode.isRecursiveFree)&&(!this._bottomNode||this._bottomNode.isRecursiveFree)},
enumerable:!0,configurable:!0}),e.prototype.evalFreeSize=function(a){var c=0;return this.isUsed||(c=this._initialSize?this._initialSize.surface:this._size.surface),this._rightNode&&(c+=this._rightNode.evalFreeSize(0)),this._bottomNode&&(c+=this._bottomNode.evalFreeSize(0)),c+a},e);c.PackedRect=f;var a;a=function(a){f.call(this,null,null,c.Vector2.Zero(),a);this._root=this};a=(__extends(a,f),a.prototype.addRect=function(a){return this.findAndSplitNode(a)},Object.defineProperty(a.prototype,"freeSpace",
{get:function(){var a=0;return a=this.evalFreeSize(a),a/(this._size.width*this._size.height)},enumerable:!0,configurable:!0}),a);c.RectPackingMap=a}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){};c.DynamicFloatArrayElementInfo=f;var e;e=function(a,c){this.compareValueOffset=null;this.sortingAscending=!0;this._stride=a;this.buffer=new Float32Array(a*c);this._firstFree=this._lastUsed=0;this._allEntries=Array(c);this._freeEntries=Array(c);for(var e=0;c>e;e++){var g=new f;g.offset=e*a;this._allEntries[e]=g;this._freeEntries[c-e-1]=g}};e=(e.prototype.allocElement=function(){0===this._freeEntries.length&&this._growBuffer();var a=this._freeEntries.pop();return this._lastUsed=
Math.max(a.offset,this._lastUsed),a.offset===this._firstFree&&(0<this._freeEntries.length?this._firstFree=this._freeEntries[this._freeEntries.length-1].offset:this._firstFree+=this._stride),a},e.prototype.freeElement=function(a){this._firstFree=Math.min(a.offset,this._firstFree);this._freeEntries.push(a)},e.prototype.pack=function(){if(0===this._freeEntries.length)return this.buffer;if(this._lastUsed<this._firstFree)return this.buffer.subarray(0,this._lastUsed+this._stride);var a=this._stride,c=new f;
c.offset=this.totalElementCount*a;this._freeEntries.push(c);for(var c=this._freeEntries.sort(function(a,b){return a.offset-b.offset}),e=this._allEntries.sort(function(a,b){return a.offset-b.offset}),g=c[0].offset,h=1,m=(this.usedElementCount+1)*a,l=c[0].offset,k=1;k<c.length&&!(g>=m);k++){var n=c[k].offset,l=n-l;if(l!==a){for(var l=l/a-1,q=n-a,p=Math.min(h,l),r=0;p>r;r++){var t=g/a,s=q/a,u=e[s];this._moveElement(u,g);var v=e[t];v.offset=q;e[t]=u;e[s]=v;q-=a;g+=a}l>=h?(g=q+a,h=1+p):h=(n-g)/a+1}else++h;
l=n}h=this.buffer.subarray(0,g);return this._lastUsed=g-a,this._firstFree=g,c.pop(),this._freeEntries=c.sort(function(a,b){return b.offset-a.offset}),this._allEntries=e,h},e.prototype._moveElement=function(a,c){for(var e=0;e<this._stride;e++)this.buffer[c+e]=this.buffer[a.offset+e];a.offset=c},e.prototype._growBuffer=function(){var a=Math.floor(1.5*this.totalElementCount),c=new Float32Array(a*this._stride);c.set(this.buffer);for(var e=this.totalElementCount,a=a-this.totalElementCount,g=0;a>g;g++){var h=
new f;h.offset=(e+g)*this.stride;this._allEntries.push(h);this._freeEntries[a-g-1]=h}this._firstFree=e*this.stride;this.buffer=c},Object.defineProperty(e.prototype,"totalElementCount",{get:function(){return this._allEntries.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"freeElementCount",{get:function(){return this._freeEntries.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usedElementCount",{get:function(){return this._allEntries.length-this._freeEntries.length},
enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stride",{get:function(){return this._stride},enumerable:!0,configurable:!0}),e.prototype.sort=function(){if(!this.compareValueOffset)throw Error("The DynamicFloatArray.sort() method needs a valid 'compareValueOffset' property");var b=this.usedElementCount;if(!this._sortTable||this._sortTable.length<b){var c=Math.min(this.totalElementCount,2*b);this._sortTable=Array(c);this._sortedTable=Array(c)}this.pack();for(var e=0,c=this.stride,
g=0;b>g;g++,e+=c){var h=this._sortTable[g];h||(h=new a,this._sortTable[g]=h);h.compareData=this.buffer[e+this.compareValueOffset];h.offset=e;h.swapedOffset=null;this._sortedTable[g]=h}this.sortingAscending?this._sortedTable.sort(function(a,b){return a.compareData-b.compareData}):this._sortedTable.sort(function(a,b){return b.compareData-a.compareData});for(g=0;b>g;g++){var e=this._sortedTable[g],h=this._sortTable[g],f=e.offset;if(e.swapedOffset){for(f=e;f.swapedOffset;)f=this._sortTable[f.swapedOffset/
c];f=f.offset}h.swapedOffset=f;if(f!==h.offset)for(var l=h.offset,k=0;c>k;k++){var n=this.buffer[l+k];this.buffer[l+k]=this.buffer[f+k];this.buffer[f+k]=n}this._allEntries[e.offset/c].offset=h.offset}return this._allEntries.sort(function(a,b){return a.offset-b.offset}),!0},e);c.DynamicFloatArray=e;var a;a=function(){this.compareData=this.offset=this.swapedOffset=null}}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){};c.CharInfo=f;var e,a=c.Texture,b=function(b,e,g,h,f){void 0===h&&(h=200);void 0===f&&(f=c.Texture.TRILINEAR_SAMPLINGMODE);a.call(this,null,g,!0,!1,f);this._charInfos={};this._curCharCount=0;this._lastUpdateCharCount=-1;this._usedCounter=1;this.name=b;this.wrapV=this.wrapU=c.Texture.CLAMP_ADDRESSMODE;this._canvas=document.createElement("canvas");this._context=this._canvas.getContext("2d");this._context.font=e;this._context.fillStyle="white";b=this.getFontHeight(e);
this._lineHeight=b.height;this._offset=b.offset-1;b=this._context.measureText("W").width;this._spaceWidth=this._context.measureText(" ").width;h=Math.sqrt(this._lineHeight*b*h);h=Math.pow(2,Math.ceil(Math.log(h)/Math.log(2)));this._texture=g.getEngine().createDynamicTexture(h,h,!1,f);g=this.getSize();this._canvas=document.createElement("canvas");this._canvas.width=g.width;this._canvas.height=g.height;this._context=this._canvas.getContext("2d");this._context.textBaseline="top";this._context.font=e;
this._context.fillStyle="white";this._context.imageSmoothingEnabled=!1;this._currentFreePosition=c.Vector2.Zero();for(e=32;127>e;e++)g=String.fromCharCode(e),this.getChar(g);this.update()};e=(__extends(b,a),Object.defineProperty(b.prototype,"spaceWidth",{get:function(){return this._spaceWidth},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"lineHeight",{get:function(){return this._lineHeight},enumerable:!0,configurable:!0}),b.GetCachedFontTexture=function(a,e){a.__fontTextureCache__||
(a.__fontTextureCache__=new c.StringDictionary);var g=a.__fontTextureCache__,h=e.toLocaleLowerCase(),f=g.get(h);return f?(++f._usedCounter,f):(f=new b(null,h,a,200,c.Texture.NEAREST_SAMPLINGMODE),g.add(h,f),f)},b.ReleaseCachedFontTexture=function(a,b){var c=a.__fontTextureCache__;if(c){var h=b.toLocaleLowerCase(),e=c.get(h);0===--e._usedCounter&&(c.remove(h),e.dispose())}},b.prototype.getChar=function(a){if(1!==a.length)return null;var b=this._charInfos[a];if(b)return b;var b=new f,g=this._context.measureText(a),
h=this.getSize(),g=g.width;return this._currentFreePosition.x+g+2>h.width&&(this._currentFreePosition.x=0,this._currentFreePosition.y+=this._lineHeight+2,this._currentFreePosition.y>h.height)?this.getChar("!"):(this._context.fillText(a,this._currentFreePosition.x-0.5,this._currentFreePosition.y-this._offset-0.5),b.topLeftUV=new c.Vector2(this._currentFreePosition.x/h.width,this._currentFreePosition.y/h.height),b.bottomRightUV=new c.Vector2(b.topLeftUV.x+g/h.width,b.topLeftUV.y+(this._lineHeight+2)/
h.height),b.charWidth=g,this._charInfos[a]=b,this._curCharCount++,this._currentFreePosition.x+=g+2,b)},b.prototype.measureText=function(a,b){void 0===b&&(b=4);for(var g=0,h=0,e=1,f=0,k=0;k<a.length;k++){var n=a[k];"\n"!==n?"\t"!==n?" ">n||(h+=this.getChar(n).charWidth,++f):(n=f+b,n-=n%b,h+=(n-f)*this.spaceWidth,f=n):(g=Math.max(g,h),h=f=0,++e)}return g=Math.max(g,h),new c.Size(g,e*this._lineHeight)},b.prototype.getFontHeight=function(a){var b=document.createElement("canvas"),c=b.getContext("2d");
c.fillRect(0,0,b.width,b.height);c.textBaseline="top";c.fillStyle="white";c.font=a;c.fillText("jH|",0,0);a=c.getImageData(0,0,b.width,b.height).data;for(var h=c=-1,e=0;e<b.height;e++)for(var f=0;f<b.width;f++){if(0!==a[4*(e*b.width+f)]){-1===c&&(c=e);break}if(f===b.width-1&&-1!==c){h=e;e=b.height;break}}return{height:h-c,offset:c-1}},Object.defineProperty(b.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),b.prototype.getContext=function(){return this._context},b.prototype.update=
function(){this._lastUpdateCharCount<this._curCharCount&&(this.getScene().getEngine().updateDynamicTexture(this._texture,this._canvas,!1,!0),this._lastUpdateCharCount=this._curCharCount)},b.prototype.clone=function(){return null},b);c.FontTexture=e}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Texture;f=function(a,b,d,f){void 0===f&&(f=c.Texture.TRILINEAR_SAMPLINGMODE);e.call(this,null,b,!0,!1,f);this.name=a;this._size=d;this.wrapV=this.wrapU=c.Texture.CLAMP_ADDRESSMODE;this._rectPackingMap=new c.RectPackingMap(new c.Size(d.width,d.height));this._texture=b.getEngine().createRenderTargetTexture(d,{generateMipMaps:!this.noMipmap,type:c.Engine.TEXTURETYPE_UNSIGNED_INT})};f=(__extends(f,e),f.prototype.allocateRect=function(a){return this._rectPackingMap.addRect(a)},f.prototype.freeRect=
function(a){a&&a.freeContent()},Object.defineProperty(f.prototype,"freeSpace",{get:function(){return this._rectPackingMap.freeSpace},enumerable:!0,configurable:!0}),f.prototype.bindTextureForRect=function(a,b){return this.bindTextureForPosSize(a.pos,a.contentSize,b)},f.prototype.bindTextureForPosSize=function(a,b,d){var e=this.getScene().getEngine();e.bindFramebuffer(this._texture);this._replacedViewport=e.setDirectViewport(a.x,a.y,b.width,b.height);d&&e.scissorClear(a.x,a.y,b.width,b.height,new c.Color4(0,
0,0,0))},f.prototype.unbindTexture=function(a){a&&c.Tools.DumpFramebuffer(this._size.width,this._size.height,this.getScene().getEngine());a=this.getScene().getEngine();this._replacedViewport&&(a.setViewport(this._replacedViewport),this._replacedViewport=null);a.unBindFramebuffer(this._texture)},Object.defineProperty(f.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),f.prototype.clone=function(){return null},f);c.MapTexture=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(){this.radius=0;this.center=c.Vector2.Zero();this.extent=c.Vector2.Zero()};f=(e.CreateFromSize=function(a){var b=new e;return e.CreateFromSizeToRef(a,b),b},e.CreateFromRadius=function(a){var b=new e;return e.CreateFromRadiusToRef(a,b),b},e.CreateFromPoints=function(a){var b=new e;return e.CreateFromPointsToRef(a,b),b},e.CreateFromSizeToRef=function(a,b){a||(a=c.Size.Zero());b.center.x=+a.width/2;b.center.y=+a.height/2;b.extent.x=b.center.x;b.extent.y=b.center.y;b.radius=
b.extent.length()},e.CreateFromRadiusToRef=function(a,b){b.center.x=b.center.y=0;var c=+a;b.extent.x=c;b.extent.y=c;b.radius=c},e.CreateFromPointsToRef=function(a,b){for(var c=Number.MAX_VALUE,f=Number.MAX_VALUE,g=Number.MIN_VALUE,h=Number.MIN_VALUE,m=0;m<a.length;m++)var l=a[m],c=Math.min(l.x,c),g=Math.max(l.x,g),f=Math.min(l.y,f),h=Math.max(l.y,h);e.CreateFromMinMaxToRef(c,g,f,h,b)},e.CreateFromMinMaxToRef=function(a,b,d,e,g){g.center=new c.Vector2(a+(b-a)/2,d+(e-d)/2);g.extent=new c.Vector2(b-
g.center.x,e-g.center.y);g.radius=g.extent.length()},e.prototype.clone=function(){var a=new e;return a.center=this.center.clone(),a.radius=this.radius,a.extent=this.extent.clone(),a},e.prototype.max=function(){var a=c.Vector2.Zero();return this.maxToRef(a),a},e.prototype.maxToRef=function(a){a.x=this.center.x+this.extent.x;a.y=this.center.y+this.extent.y},e.prototype.transform=function(a){var b=new e;return this.transformToRef(a,b),b},e.prototype.union=function(a){var b=new e;return this.unionToRef(a,
b),b},e.prototype.transformToRef=function(a,b){var d=e._transform;d[0].x=this.center.x+this.extent.x;d[0].y=this.center.y+this.extent.y;d[1].x=this.center.x+this.extent.x;d[1].y=this.center.y-this.extent.y;d[2].x=this.center.x-this.extent.x;d[2].y=this.center.y-this.extent.y;d[3].x=this.center.x-this.extent.x;d[3].y=this.center.y+this.extent.y;for(var f=0;4>f;f++)c.Vector2.TransformToRef(d[f],a,d[f]);e.CreateFromPointsToRef(d,b)},e.prototype.unionToRef=function(a,b){var c=Math.max(this.center.x+this.extent.x,
a.center.x+a.extent.x),f=Math.max(this.center.y+this.extent.y,a.center.y+a.extent.y),g=Math.min(this.center.x-this.extent.x,a.center.x-a.extent.x),h=Math.min(this.center.y-this.extent.y,a.center.y-a.extent.y);e.CreateFromMinMaxToRef(g,c,h,f,b)},e.prototype.doesIntersect=function(a){a=a.subtract(this.center);return a.lengthSquared()<=this.radius*this.radius?Math.abs(a.x)<=this.extent.x&&Math.abs(a.y)<=this.extent.y:!1},e._transform=[c.Vector2.Zero(),c.Vector2.Zero(),c.Vector2.Zero(),c.Vector2.Zero()],
e);c.BoundingInfo2D=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(){};f=(e.prototype.isLocked=function(){return this._isLocked},e.prototype.lock=function(){return this._isLocked?!0:(this.onLock(),this._isLocked=!0,!1)},e.prototype.onLock=function(){},e);c.LockableBase=f;var a=function(a,c){void 0===c&&(c=!1);f.call(this);this._color=a;c&&this.lock()},e=(__extends(a,f),a.prototype.isTransparent=function(){return this._color&&1>this._color.a},Object.defineProperty(a.prototype,"color",{get:function(){return this._color},set:function(a){this.isLocked()||
(this._color=a)},enumerable:!0,configurable:!0}),a.prototype.toString=function(){return this._color.toHexString()},a=__decorate([c.className("SolidColorBrush2D")],a));c.SolidColorBrush2D=e;a=function(a,d,e,g,h,m){void 0===e&&(e=c.Vector2.Zero());void 0===g&&(g=0);void 0===h&&(h=1);void 0===m&&(m=!1);f.call(this);this._color1=a;this._color2=d;this._translation=e;this._rotation=g;this._scale=h;m&&this.lock()};e=(__extends(a,f),a.prototype.isTransparent=function(){return this._color1&&1>this._color1.a||
this._color2&&1>this._color2.a},Object.defineProperty(a.prototype,"color1",{get:function(){return this._color1},set:function(a){this.isLocked()||(this._color1=a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"color2",{get:function(){return this._color2},set:function(a){this.isLocked()||(this._color2=a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"translation",{get:function(){return this._translation},set:function(a){this.isLocked()||(this._translation=a)},
enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rotation",{get:function(){return this._rotation},set:function(a){this.isLocked()||(this._rotation=a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"scale",{get:function(){return this._scale},set:function(a){this.isLocked()||(this._scale=a)},enumerable:!0,configurable:!0}),a.prototype.toString=function(){return"C1:"+this._color1+";C2:"+this._color2+";T:"+this._translation.toString()+";R:"+this._rotation+";S:"+this._scale+
";"},a.BuildKey=function(a,c,e,g,h){return"C1:"+a+";C2:"+c+";T:"+e.toString()+";R:"+g+";S:"+h+";"},a=__decorate([c.className("GradientColorBrush2D")],a));c.GradientColorBrush2D=e}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){};c.Prim2DClassInfo=f;var e,a=function(){};e=(a.PROPKIND_MODEL=1,a.PROPKIND_INSTANCE=2,a.PROPKIND_DYNAMIC=3,a);c.Prim2DPropInfo=e;a=function(){};c.PropertyChangedInfo=a;var b,d=function(a,b,d){this._baseClass=a;this._type=b;this._subClasses=[];this._levelContent=new c.StringDictionary;this._classContentFactory=d};b=(Object.defineProperty(d.prototype,"classContent",{get:function(){return this._classContent||(this._classContent=this._classContentFactory(this._baseClass?
this._baseClass.classContent:null)),this._classContent},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"levelContent",{get:function(){return this._levelContent},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"fullContent",{get:function(){if(!this._fullContent){for(var a=new c.StringDictionary,b=this;b;)b.levelContent.forEach(function(b,c){return a.add(b,
c)}),b=b._baseClass;this._fullContent=a}return this._fullContent},enumerable:!0,configurable:!0}),d.prototype.getLevelOf=function(a){if(a===this._type)return this;var b=Object.getPrototypeOf(a);return this.getOrAddType(Object.getPrototypeOf(b),b)||this.getLevelOf(b),this.getOrAddType(b,a)},d.prototype.getOrAddType=function(a,b){if(a===this._type){for(var c=0,g=this._subClasses;c<g.length;c++){var e=g[c];if(e.type===b)return e.node}e=new d(this,b,this._classContentFactory);e={type:b,node:e};return this._subClasses.push(e),
e.node}c=0;for(g=this._subClasses;c<g.length;c++)if(e=g[c],e=e.node.getOrAddType(a,b))return e;return null},d.get=function(a){var b=a.__classTreeInfo;return b?b.getLevelOf(a):null},d.getOrRegister=function(a,b){var c=a.__classTreeInfo;return c||(c=new d(null,a,b),a.__classTreeInfo=c),c},d);c.ClassTreeInfo=b;var j,g=function(){this._flags=0;this._modelKey=null;this._instanceDirtyFlags=0;this._levelBoundingInfo=new c.BoundingInfo2D;this.animations=[]};j=(Object.defineProperty(g.prototype,"isDisposed",
{get:function(){return this._isFlagSet(g.flagIsDisposed)},enumerable:!0,configurable:!0}),g.prototype.dispose=function(){return this.isDisposed?!1:(this.animations.splice(0),this._setFlags(g.flagIsDisposed),!0)},g.prototype.getAnimatables=function(){return[]},Object.defineProperty(g.prototype,"modelKey",{get:function(){var a=this;if(!this._isFlagSet(g.flagModelDirty)&&this._modelKey)return this._modelKey;var b="Class:"+c.Tools.getClassName(this)+";";return this.propDic.forEach(function(d,g){if(g.kind===
e.PROPKIND_MODEL){var f=a[g.name];f&&f.constructor===Array&&(f=f[0]?c.Tools.hashCodeFromStream(c.Tools.arrayOrStringFeeder(f)):0);b+=g.name+":"+(null!=f?g.typeLevelCompare?c.Tools.getClassName(f):f.toString():"[null]")+";"}}),this._clearFlags(g.flagModelDirty),this._modelKey=b,b},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"isDirty",{get:function(){return 0!==this._instanceDirtyFlags||this._areSomeFlagsSet(g.flagModelDirty|g.flagPositioningDirty|g.flagLayoutDirty)},enumerable:!0,
configurable:!0}),Object.defineProperty(g.prototype,"propDic",{get:function(){if(!this._propInfo){var a=b.get(Object.getPrototypeOf(this));if(!a)throw Error("Can't access the propDic member in class definition, is this class SmartPropertyPrim based?");this._propInfo=a.fullContent}return this._propInfo},enumerable:!0,configurable:!0}),g._createPropInfo=function(a,c,d,g,j,q){a=b.getOrRegister(a,function(){return new f}).getLevelOf(a);var p=a.levelContent.get(d.toString());if(p)throw Error("The ID "+
d+" is already taken by another property declaration named: "+p.name);return p=new e,p.id=d,p.flagId=Math.pow(2,d),p.kind=q,p.name=c,p.dirtyBoundingInfo=g,p.typeLevelCompare=j,a.levelContent.add(c,p),p},g._checkUnchanged=function(a,b){if(null===a&&null===b||void 0===a&&void 0===b)return!0;if(null!=a&&null!=b)if("function"==typeof a.equals){if(a.equals(b))return!0}else if(a===b)return!0;return!1},g.prototype.markAsDirty=function(a){if(!this.isDisposed){var b=a.indexOf(".");-1!==b&&(a=a.substr(0,b));
(b=this.propDic.get(a))&&this._handlePropChanged(void 0,this[a],a,b,b.typeLevelCompare)}},g.prototype._boundingBoxDirty=function(){if(this._setFlags(g.flagLevelBoundingInfoDirty),this instanceof c.Prim2DBase)for(var a=this;a&&(a._boundingSize=null,a._setFlags(g.flagBoundingInfoDirty),a.isSizeAuto&&a.onPrimitivePropertyDirty(c.Prim2DBase.sizeProperty.flagId),!(a instanceof c.Group2D&&a.isRenderableGroup));)a=a.parent},g.prototype._handlePropChanged=function(a,b,d,f,j){f.dirtyBoundingInfo&&this._boundingBoxDirty();
var q=g.propChangedInfo;q.oldValue=a;q.newValue=b;q.propertyName=d;d=f.flagId;if(this.propertyChanged.notifyObservers(q,d),this instanceof c.Group2D&&this.handleGroupChanged(f),this instanceof c.Prim2DBase)q=this._parent,null!=q&&q.layoutEngine&&0!==(q.layoutEngine.layoutDirtyOnPropertyChangedMask&f.flagId)&&q._setLayoutDirty();q=!1;j&&(null!=a&&null!=b)&&(q=a.__proto__===b.__proto__);q||f.kind!==e.PROPKIND_MODEL?(q||f.kind===e.PROPKIND_INSTANCE||f.kind===e.PROPKIND_DYNAMIC)&&this.onPrimitivePropertyDirty(d):
this.onPrimitivePropertyDirty(g.flagModelDirty)},g.prototype.onPrimitivePropertyDirty=function(a){this.isDirty||this.onPrimBecomesDirty();this._instanceDirtyFlags|=a},g.prototype.handleGroupChanged=function(){},g.prototype.checkPropertiesDirty=function(a){return 0!==(this._instanceDirtyFlags&a)},g.prototype.clearPropertiesDirty=function(a){return this._instanceDirtyFlags&=~a,this._instanceDirtyFlags},g.prototype._resetPropertiesDirty=function(){this._instanceDirtyFlags=0},Object.defineProperty(g.prototype,
"levelBoundingInfo",{get:function(){return this._isFlagSet(g.flagLevelBoundingInfoDirty)&&(this.updateLevelBoundingInfo(),this._clearFlags(g.flagLevelBoundingInfoDirty)),this._levelBoundingInfo},enumerable:!0,configurable:!0}),g.prototype.updateLevelBoundingInfo=function(){},g.prototype.onPrimBecomesDirty=function(){},g._hookProperty=function(a,b,c,d,e){return function(f,j,r){var t=g._createPropInfo(f,j,a,d,c,e);b&&b(t);var s=r.get,u=r.set;r.set=function(a){if(!this.isDisposed){var b=s.call(this);
g._checkUnchanged(b,a)||(u.call(this,a),this._handlePropChanged(b,a,j,t,c))}}}},g.prototype.addExternalData=function(a,b){return this._externalData||(this._externalData=new c.StringDictionary),this._externalData.add(a,b)},g.prototype.getExternalData=function(a){return this._externalData?this._externalData.get(a):null},g.prototype.getOrAddExternalDataWithFactory=function(a,b){return this._externalData||(this._externalData=new c.StringDictionary),this._externalData.getOrAddWithFactory(a,b)},g.prototype.removeExternalData=
function(a){return this._externalData?this._externalData.remove(a):!1},g.prototype._isFlagSet=function(a){return 0!==(this._flags&a)},g.prototype._areAllFlagsSet=function(a){return(this._flags&a)===a},g.prototype._areSomeFlagsSet=function(a){return 0!==(this._flags&a)},g.prototype._clearFlags=function(a){this._flags&=~a},g.prototype._setFlags=function(a){var b=this._flags;return this._flags|=a,b},g.prototype._changeFlags=function(a,b){b?this._flags|=a:this._flags&=~a},g.propChangedInfo=new a,g.flagIsDisposed=
1,g.flagLevelBoundingInfoDirty=2,g.flagModelDirty=4,g.flagLayoutDirty=8,g.flagLevelVisible=16,g.flagBoundingInfoDirty=32,g.flagIsPickable=64,g.flagIsVisible=128,g.flagVisibilityChanged=256,g.flagPositioningDirty=512,g.flagTrackedGroup=1024,g=__decorate([c.className("SmartPropertyPrim")],g));c.SmartPropertyPrim=j;c.modelLevelProperty=function(a,b,c,d){return void 0===c&&(c=!1),void 0===d&&(d=!1),j._hookProperty(a,b,c,d,e.PROPKIND_MODEL)};c.instanceLevelProperty=function(a,b,c,d){return void 0===c&&
(c=!1),void 0===d&&(d=!1),j._hookProperty(a,b,c,d,e.PROPKIND_INSTANCE)};c.dynamicLevelProperty=function(a,b,c,d){return void 0===c&&(c=!1),void 0===d&&(d=!1),j._hookProperty(a,b,c,d,e.PROPKIND_DYNAMIC)}}(BABYLON||(BABYLON={}));
!function(c){c.PrepareRender2DContext=function(){this.forceRefreshPrimitive=!1};var f,e=function(a){this._renderMode=a;this.useInstancing=!1;this.partDataStartIndex=this.partDataEndIndex=this.groupInfoPartData=null};f=(Object.defineProperty(e.prototype,"renderMode",{get:function(){return this._renderMode},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RenderModeOpaque",{get:function(){return e._renderModeOpaque},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RenderModeAlphaTest",
{get:function(){return e._renderModeAlphaTest},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RenderModeTransparent",{get:function(){return e._renderModeTransparent},enumerable:!0,configurable:!0}),e._renderModeOpaque=1,e._renderModeAlphaTest=2,e._renderModeTransparent=3,e);c.Render2DContext=f;var a=function(){this.primitivePointerPos=c.Vector2.Zero();this.tilt=c.Vector2.Zero();this.cancelBubble=!1};f=(Object.defineProperty(a,"PointerOver",{get:function(){return a._pointerOver},enumerable:!0,
configurable:!0}),Object.defineProperty(a,"PointerEnter",{get:function(){return a._pointerEnter},enumerable:!0,configurable:!0}),Object.defineProperty(a,"PointerDown",{get:function(){return a._pointerDown},enumerable:!0,configurable:!0}),Object.defineProperty(a,"PointerMouseWheel",{get:function(){return a._pointerMouseWheel},enumerable:!0,configurable:!0}),Object.defineProperty(a,"PointerMove",{get:function(){return a._pointerMove},enumerable:!0,configurable:!0}),Object.defineProperty(a,"PointerUp",
{get:function(){return a._pointerUp},enumerable:!0,configurable:!0}),Object.defineProperty(a,"PointerOut",{get:function(){return a._pointerOut},enumerable:!0,configurable:!0}),Object.defineProperty(a,"PointerLeave",{get:function(){return a._pointerLeave},enumerable:!0,configurable:!0}),Object.defineProperty(a,"PointerGotCapture",{get:function(){return a._pointerGotCapture},enumerable:!0,configurable:!0}),Object.defineProperty(a,"PointerLostCapture",{get:function(){return a._pointerLostCapture},enumerable:!0,
configurable:!0}),Object.defineProperty(a,"MouseWheelPrecision",{get:function(){return a._mouseWheelPrecision},enumerable:!0,configurable:!0}),a.prototype.updateRelatedTarget=function(a,b){this.relatedTarget=a;this.relatedTargetPointerPos=b},a.getEventTypeName=function(b){switch(b){case a.PointerOver:return"PointerOver";case a.PointerEnter:return"PointerEnter";case a.PointerDown:return"PointerDown";case a.PointerMouseWheel:return"PointerMouseWheel";case a.PointerMove:return"PointerMove";case a.PointerUp:return"PointerUp";
case a.PointerOut:return"PointerOut";case a.PointerLeave:return"PointerLeave";case a.PointerGotCapture:return"PointerGotCapture";case a.PointerLostCapture:return"PointerLostCapture"}},a._pointerOver=1,a._pointerEnter=2,a._pointerDown=4,a._pointerMouseWheel=8,a._pointerMove=16,a._pointerUp=32,a._pointerOut=64,a._pointerLeave=128,a._pointerGotCapture=256,a._pointerLostCapture=512,a._mouseWheelPrecision=3,a);c.PrimitivePointerInfo=f;var b,d=function(a){this._changedCallback=a;this._horizontal=d.AlignLeft;
this._vertical=d.AlignBottom};b=(Object.defineProperty(d,"AlignLeft",{get:function(){return d._AlignLeft},enumerable:!0,configurable:!0}),Object.defineProperty(d,"AlignTop",{get:function(){return d._AlignTop},enumerable:!0,configurable:!0}),Object.defineProperty(d,"AlignRight",{get:function(){return d._AlignRight},enumerable:!0,configurable:!0}),Object.defineProperty(d,"AlignBottom",{get:function(){return d._AlignBottom},enumerable:!0,configurable:!0}),Object.defineProperty(d,"AlignCenter",{get:function(){return d._AlignCenter},
enumerable:!0,configurable:!0}),Object.defineProperty(d,"AlignStretch",{get:function(){return d._AlignStretch},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"horizontal",{get:function(){return this._horizontal},set:function(a){this._horizontal!==a&&(this._horizontal=a,this._changedCallback())},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"vertical",{get:function(){return this._vertical},set:function(a){this._vertical!==a&&(this._vertical=a,this._changedCallback())},
enumerable:!0,configurable:!0}),d.prototype.setHorizontal=function(a){switch(a.trim().toLocaleLowerCase()){case "left":return void(this.horizontal=d.AlignLeft);case "right":return void(this.horizontal=d.AlignRight);case "center":return void(this.horizontal=d.AlignCenter);case "stretch":return void(this.horizontal=d.AlignStretch)}},d.prototype.setVertical=function(a){switch(a.trim().toLocaleLowerCase()){case "top":return void(this.vertical=d.AlignTop);case "bottom":return void(this.vertical=d.AlignBottom);
case "center":return void(this.vertical=d.AlignCenter);case "stretch":return void(this.vertical=d.AlignStretch)}},d.prototype.fromString=function(a){a=a.trim().split(",");for(var b=0;b<a.length;b++){var c=a[b],c=c.toLocaleLowerCase().trim(),d=c.indexOf("h:");-1===d&&(d=c.indexOf("horizontal:"));-1===d?(d=c.indexOf("v:"),-1===d&&(d=c.indexOf("vertical:")),-1===d||(c=c.substr(c.indexOf(":")+1),this.setVertical(c))):(c=c.substr(c.indexOf(":")+1),this.setHorizontal(c))}},d._AlignLeft=1,d._AlignTop=1,
d._AlignRight=2,d._AlignBottom=2,d._AlignCenter=3,d._AlignStretch=4,d);c.PrimitiveAlignment=b;var j;j=function(a,b){this.prim=a;this.intersectionLocation=b};c.PrimitiveIntersectedInfo=j;var g,h=function(a,b){this._parentAccess=a;this._changedCallback=b;this._pixels=Array(4);this._percentages=Array(4);this._setType(0,h.Auto);this._setType(1,h.Auto);this._setType(2,h.Auto);this._setType(3,h.Auto);this._pixels[0]=0;this._pixels[1]=0;this._pixels[2]=0;this._pixels[3]=0};g=(h.prototype.fromString=function(a){this._clear();
a=a.trim().split(",");for(var b=!1,c=0;c<a.length;c++)b=this._extractString(a[c],!1)||b;if(!b)throw Error("Can't parse the string to create a PrimitiveMargin object, format must be: 'top: <value>, left:<value>, right:<value>, bottom:<value>");0===(15&this._flags)&&(this._flags|=h.Pixel<<0);0===(240&this._flags)&&(this._flags|=h.Pixel<<4);0===(3840&this._flags)&&(this._flags|=h.Pixel<<8);0===(61440&this._flags)&&(this._flags|=h.Pixel<<12);this._changedCallback()},h.prototype.fromStrings=function(a,
b,c,d){return this._clear(),this._setStringValue(a,0,!1),this._setStringValue(b,1,!1),this._setStringValue(c,2,!1),this._setStringValue(d,3,!1),this._changedCallback(),this},h.prototype.fromPixels=function(a,b,c,d){return this._clear(),this._pixels[0]=a,this._pixels[1]=b,this._pixels[2]=c,this._pixels[3]=d,this._changedCallback(),this},h.prototype.fromUniformPixels=function(a){return this._clear(),this._pixels[0]=a,this._pixels[1]=a,this._pixels[2]=a,this._pixels[3]=a,this._changedCallback(),this},
h.prototype.auto=function(){return this._clear(),this._flags=h.Auto<<0|h.Auto<<4|h.Auto<<8|h.Auto<<12,this._pixels[0]=0,this._pixels[1]=0,this._pixels[2]=0,this._pixels[3]=0,this._changedCallback(),this},h.prototype._clear=function(){this._flags=0;this._pixels[0]=0;this._pixels[1]=0;this._pixels[2]=0;this._pixels[3]=0;this._percentages[0]=null;this._percentages[1]=null;this._percentages[2]=null;this._percentages[3]=null},h.prototype._extractString=function(a,b){var c=a.trim().toLocaleLowerCase();
return 0===c.indexOf("top:")?(c=c.substr(4).trim(),this._setStringValue(c,0,b)):0===c.indexOf("left:")?(c=c.substr(5).trim(),this._setStringValue(c,1,b)):0===c.indexOf("right:")?(c=c.substr(6).trim(),this._setStringValue(c,2,b)):0===c.indexOf("bottom:")?(c=c.substr(7).trim(),this._setStringValue(c,3,b)):!1},h.prototype._setStringValue=function(a,b,c){a=a.trim().toLocaleLowerCase();if("auto"===a){if(this._isType(b,h.Auto))return!0;this._setType(b,h.Auto);this._pixels[b]=0}else{if("inherit"!==a){var d=
a.indexOf("%");if(-1!==d)return a=a.substr(0,d),a=Math.round(Number(a))/100,this._isType(b,h.Percentage)&&this._percentages[b]===a?!0:(this._setType(b,h.Percentage),isNaN(a)?!1:(this._percentages[b]=a,c&&this._changedCallback(),!0));d=a.indexOf("px");a=-1!==d?a.substr(0,d).trim():a;a=Number(a);return this._isType(b,h.Pixel)&&this._pixels[b]===a?!0:isNaN(a)?!1:(this._pixels[b]=a,this._setType(b,h.Pixel),c&&this._changedCallback(),!0)}if(this._isType(b,h.Inherit))return!0;this._setType(b,h.Inherit);
this._pixels[b]=null}c&&this._changedCallback()},h.prototype._setPixels=function(a,b,c){a=Math.round(a);this._isType(b,h.Pixel)&&this._pixels[b]===a||(this._setType(b,h.Pixel),this._pixels[b]=a,c&&this._changedCallback())},h.prototype._setPercentage=function(a,b,c){a=Math.min(1,a);a=Math.max(0,a);a=Math.round(100*a)/100;this._isType(b,h.Percentage)&&this._percentages[b]===a||(this._setType(b,h.Percentage),this._percentages[b]=a,c&&this._changedCallback())},h.prototype._getStringValue=function(a){switch(this._flags>>
4*a&15){case h.Auto:return"auto";case h.Pixel:return this._pixels[a]+"px";case h.Percentage:return 100*this._percentages[a]+"%";case h.Inherit:return"inherit"}return""},h.prototype._isType=function(a,b){return(this._flags>>4*a&15)===b},h.prototype._getType=function(a,b){var c=this._flags>>4*a&15;return b&&c===h.Inherit?(c=this._parentAccess())?c._getType(a,!0):h.Auto:c},h.prototype._setType=function(a,b){this._flags&=~(15<<4*a);this._flags|=b<<4*a},h.prototype.setTop=function(a){"string"==typeof a?
this._setStringValue(a,0,!0):this.topPixels=a},h.prototype.setLeft=function(a){"string"==typeof a?this._setStringValue(a,1,!0):this.leftPixels=a},h.prototype.setRight=function(a){"string"==typeof a?this._setStringValue(a,2,!0):this.rightPixels=a},h.prototype.setBottom=function(a){"string"==typeof a?this._setStringValue(a,3,!0):this.bottomPixels=a},Object.defineProperty(h.prototype,"top",{get:function(){return this._getStringValue(0)},set:function(a){this._setStringValue(a,0,!0)},enumerable:!0,configurable:!0}),
Object.defineProperty(h.prototype,"left",{get:function(){return this._getStringValue(1)},set:function(a){this._setStringValue(a,1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"right",{get:function(){return this._getStringValue(2)},set:function(a){this._setStringValue(a,2,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"bottom",{get:function(){return this._getStringValue(3)},set:function(a){this._setStringValue(a,3,!0)},enumerable:!0,configurable:!0}),
Object.defineProperty(h.prototype,"topPixels",{get:function(){return this._pixels[0]},set:function(a){this._setPixels(a,0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"leftPixels",{get:function(){return this._pixels[1]},set:function(a){this._setPixels(a,1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"rightPixels",{get:function(){return this._pixels[2]},set:function(a){this._setPixels(a,2,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,
"bottomPixels",{get:function(){return this._pixels[3]},set:function(a){this._setPixels(a,3,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"topPercentage",{get:function(){return this._percentages[0]},set:function(a){this._setPercentage(a,0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"leftPercentage",{get:function(){return this._percentages[1]},set:function(a){this._setPercentage(a,1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,
"rightPercentage",{get:function(){return this._percentages[2]},set:function(a){this._setPercentage(a,2,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"bottomPercentage",{get:function(){return this._percentages[3]},set:function(a){this._setPercentage(a,3,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"topMode",{get:function(){return this._getType(0,!1)},set:function(a){this._setType(0,a)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,
"leftMode",{get:function(){return this._getType(1,!1)},set:function(a){this._setType(1,a)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"rightMode",{get:function(){return this._getType(2,!1)},set:function(a){this._setType(2,a)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"bottomMode",{get:function(){return this._getType(3,!1)},set:function(a){this._setType(3,a)},enumerable:!0,configurable:!0}),h.prototype._computePixels=function(a,b,c){var d=this._getType(a,
!1);if(d===h.Inherit)return void this._parentAccess()._computePixels(a,b,c);d===h.Percentage&&(this._pixels[a]=(0===a||3===a?b.height:b.width)*this._percentages[a],c&&this._changedCallback())},h.prototype.computeWithAlignment=function(a,c,d,g,e){var f=this._getType(0,!0),j=this._getType(1,!0),l=this._getType(2,!0),m=this._getType(3,!0),w=c&&null!=c.width?c.width:0;c=c&&null!=c.height?c.height:0;f=f===h.Auto;j=j===h.Auto;l=l===h.Auto;m=m===h.Auto;switch(d.horizontal){case b.AlignLeft:j?g.x=0:(this._computePixels(1,
a,!0),g.x=this.leftPixels);e.width=w;break;case b.AlignRight:l?g.x=Math.round(a.width-w):(this._computePixels(2,a,!0),g.x=Math.round(a.width-(w+this.rightPixels)));e.width=w;break;case b.AlignStretch:j?g.x=0:(this._computePixels(1,a,!0),g.x=this.leftPixels);w=0;l||(this._computePixels(2,a,!0),w=this.rightPixels);e.width=a.width-(g.x+w);break;case b.AlignCenter:j||this._computePixels(1,a,!0),l||this._computePixels(2,a,!0),l=(j?0:this.leftPixels)-(l?0:this.rightPixels),g.x=Math.round((a.width-w)/2+
l),e.width=w}switch(d.vertical){case b.AlignTop:f?g.y=a.height-c:(this._computePixels(0,a,!0),g.y=Math.round(a.height-(c+this.topPixels)));e.height=c;break;case b.AlignBottom:m?g.y=0:(this._computePixels(3,a,!0),g.y=this.bottomPixels);e.height=c;break;case b.AlignStretch:m?g.y=0:(this._computePixels(3,a,!0),g.y=this.bottomPixels);d=0;f||(this._computePixels(0,a,!0),d=this.topPixels);e.height=a.height-(g.y+d);break;case b.AlignCenter:f||this._computePixels(0,a,!0),m||this._computePixels(3,a,!0),l=
(m?0:this.bottomPixels)-(f?0:this.topPixels),g.y=Math.round((a.height-c)/2+l),e.height=c}},h.prototype.compute=function(a,b,c){this._computePixels(0,a,!0);this._computePixels(1,a,!0);this._computePixels(2,a,!0);this._computePixels(3,a,!0);b.x=this.leftPixels;c.width=a.width-(b.x+this.rightPixels);b.y=this.bottomPixels;c.height=a.height-(b.y+this.topPixels)},h.prototype.computeArea=function(a,b){this._computePixels(0,a,!0);this._computePixels(1,a,!0);this._computePixels(2,a,!0);this._computePixels(3,
a,!0);b.width=this.leftPixels+a.width+this.rightPixels;b.height=this.bottomPixels+a.height+this.topPixels},h.Auto=1,h.Inherit=2,h.Percentage=4,h.Pixel=8,h);c.PrimitiveThickness=g;f=function(){this.intersectHidden=this.findFirstOnly=!1;this.pickPosition=c.Vector2.Zero()};f=(Object.defineProperty(f.prototype,"isIntersected",{get:function(){return this.intersectedPrimitives&&0<this.intersectedPrimitives.length},enumerable:!0,configurable:!0}),f.prototype.isPrimIntersected=function(a){for(var b=0,c=this.intersectedPrimitives;b<
c.length;b++){var d=c[b];if(d.prim===a)return d.intersectionLocation}return null},f.prototype._exit=function(a){a&&(this._globalPickPosition=null)},f);c.IntersectInfo2D=f;var m=c.SmartPropertyPrim,l=function(a){null==a&&(a={});m.call(this);var b,d;if(l._isCanvasInit)b=this,d=null,this._canvasPreInit(a);else if(null!=a.parent){if(d=a.parent,b=a.parent.owner,!b)throw Error("Parent "+d.id+" of "+a.id+" doesn't have a valid owner!");if(!(this instanceof c.Group2D||this instanceof c.Sprite2D&&null!==a.id&&
0===a.id.indexOf("__cachedSpriteOfGroup__")||b.cachingStrategy!==c.Canvas2D.CACHESTRATEGY_TOPLEVELGROUPS||d!==b))throw Error("Can't create a primitive with the canvas as direct parent when the caching strategy is TOPLEVELGROUPS. You need to create a Group below the canvas and use it as the parent for the primitive");}(this._layoutEngine=c.CanvasLayoutEngine.Singleton,this._size=null,this._actualSize=null,this._boundingSize=null,this._layoutArea=c.Size.Zero(),this._layoutAreaPos=c.Vector2.Zero(),this._marginOffset=
c.Vector2.Zero(),this._parentMargingOffset=c.Vector2.Zero(),this._parentContentArea=c.Size.Zero(),this._contentArea=new c.Size(null,null),this._pointerEventObservable=new c.Observable,this._siblingDepthOffset=this._hierarchyDepthOffset=0,this._boundingInfo=new c.BoundingInfo2D,this._owner=b,this._parent=null,this._margin=null,this._padding=null,this._marginAlignment=null,this._id=a.id,this.propertyChanged=new c.Observable,this._children=[],this._localTransform=new c.Matrix,this._globalTransform=null,
this._invGlobalTransform=null,this._globalTransformProcessStep=0,this._globalTransformStep=0,this._hierarchyDepth=0,this._renderGroup=null,this._setFlags(c.SmartPropertyPrim.flagIsPickable|c.SmartPropertyPrim.flagBoundingInfoDirty),null!=d&&(d.addChild(this),this._patchHierarchy(d.owner)),this.owner&&this instanceof c.Group2D)&&this.detectGroupStates();if(null!=a.children){b=0;for(d=a.children;b<d.length;b++){var g=d[b];this.addChild(g);g._patchHierarchy(this.owner)}}if(null!=a.position?this.position=
a.position:null!=a.x||null!=a.y?this.position=new c.Vector2(a.x||0,a.y||0):this._position=null,this.rotation=null==a.rotation?0:a.rotation,this.scale=null==a.scale?1:a.scale,this.levelVisible=null==a.isVisible?!0:a.isVisible,this.origin=a.origin||new c.Vector2(0.5,0.5),null!=a.layoutEngine)"string"==typeof a.layoutEngine?(b=a.layoutEngine.toLocaleLowerCase().trim(),"canvas"===b||"canvaslayoutengine"===b?this.layoutEngine=c.CanvasLayoutEngine.Singleton:0===b.indexOf("stackpanel")||0===b.indexOf("horizontalstackpanel")?
this.layoutEngine=c.StackPanelLayoutEngine.Horizontal:0===b.indexOf("verticalstackpanel")&&(this.layoutEngine=c.StackPanelLayoutEngine.Vertical)):a.layoutEngine instanceof c.LayoutEngineBase&&(this.layoutEngine=a.layoutEngine);a.marginTop&&this.margin.setTop(a.marginTop);a.marginLeft&&this.margin.setLeft(a.marginLeft);a.marginRight&&this.margin.setRight(a.marginRight);a.marginBottom&&this.margin.setBottom(a.marginBottom);a.margin&&("string"==typeof a.margin?this.margin.fromString(a.margin):this.margin.fromUniformPixels(a.margin));
a.marginHAlignment&&(this.marginAlignment.horizontal=a.marginHAlignment);a.marginVAlignment&&(this.marginAlignment.vertical=a.marginVAlignment);a.marginAlignment&&this.marginAlignment.fromString(a.marginAlignment);a.paddingTop&&this.padding.setTop(a.paddingTop);a.paddingLeft&&this.padding.setLeft(a.paddingLeft);a.paddingRight&&this.padding.setRight(a.paddingRight);a.paddingBottom&&this.padding.setBottom(a.paddingBottom);a.padding&&this.padding.fromString(a.padding);this._parentLayoutDirty();this._positioningDirty()};
f=(__extends(l,m),Object.defineProperty(l.prototype,"actionManager",{get:function(){return this._actionManager||(this._actionManager=new c.ActionManager(this.owner.scene)),this._actionManager},enumerable:!0,configurable:!0}),l.prototype.traverseUp=function(a){for(var b=this;null!=b;){if(a(b))return b;b=b._parent}return null},Object.defineProperty(l.prototype,"owner",{get:function(){return this._owner},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"parent",{get:function(){return this._parent},
enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"actualPosition",{get:function(){return null!=this._actualPosition?this._actualPosition:null!=this._position?this._position:l._nullPosition},set:function(a){this._actualPosition=a},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,
"actualX",{get:function(){return this.actualPosition.x},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"actualY",{get:function(){return this.actualPosition.y},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"position",{get:function(){return this._position},set:function(a){this._checkPositionChange()&&(this._position=a)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"x",{get:function(){return this._position?this._position.x:null},set:function(a){this._checkPositionChange()&&
(this._position||(this._position=c.Vector2.Zero()),this._position.x!==a&&(this._position.x=a,this.markAsDirty("position")))},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"y",{get:function(){return this._position?this._position.y:null},set:function(a){this._checkPositionChange()&&(this._position||(this._position=c.Vector2.Zero()),this._position.y!==a&&(this._position.y=a,this.markAsDirty("position")))},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"size",{get:function(){if(!this._size||
null==this._size.width||null==this._size.height){if(l.boundinbBoxReentrency)return l.nullSize;if(this._boundingSize)return this._boundingSize;l.boundinbBoxReentrency=!0;this.boundingInfo;return l.boundinbBoxReentrency=!1,this._boundingSize}return this._size},set:function(a){this._size=a},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"width",{get:function(){return this.size?this.size.width:null},set:function(a){return this.size?void(this.size.width!==a&&(this.size.width=a,this.markAsDirty("size"),
this._positioningDirty())):void(this.size=new c.Size(a,0))},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"height",{get:function(){return this.size?this.size.height:null},set:function(a){return this.size?void(this.size.height!==a&&(this.size.height=a,this.markAsDirty("size"),this._positioningDirty())):void(this.size=new c.Size(0,a))},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"rotation",{get:function(){return this._rotation},set:function(a){this._rotation=
a},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"scale",{get:function(){return this._scale},set:function(a){this._scale=a},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this._size},set:function(a){this._actualSize.equals(a)||(this._actualSize=a)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"actualZOffset",{get:function(){return this._zOrder||1-this._hierarchyDepthOffset},
enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"minSize",{get:function(){return this._minSize},set:function(a){this._minSize&&a&&this._minSize.equals(a)||(this._minSize=a,this._parentLayoutDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"maxSize",{get:function(){return this._maxSize},set:function(a){this._maxSize&&a&&this._maxSize.equals(a)||(this._maxSize=a,this._parentLayoutDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,
"origin",{get:function(){return this._origin},set:function(a){this._origin=a},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"levelVisible",{get:function(){return this._isFlagSet(c.SmartPropertyPrim.flagLevelVisible)},set:function(a){this._changeFlags(c.SmartPropertyPrim.flagLevelVisible,a)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isVisible",{get:function(){return this._isFlagSet(c.SmartPropertyPrim.flagIsVisible)},set:function(a){this._changeFlags(c.SmartPropertyPrim.flagIsVisible,
a)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"zOrder",{get:function(){return this._zOrder},set:function(a){this._zOrder=a;this.onZOrderChanged()},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"margin",{get:function(){var a=this;return this._margin||(this._margin=new g(function(){return a.parent?a.parent.margin:null},function(){return a._positioningDirty()})),this._margin},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"_hasMargin",{get:function(){return null!==
this._margin||null!==this._marginAlignment},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"padding",{get:function(){var a=this;return this._padding||(this._padding=new g(function(){return a.parent?a.parent.padding:null},function(){return a._positioningDirty()})),this._padding},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"_hasPadding",{get:function(){return null!==this._padding},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"marginAlignment",
{get:function(){var a=this;return this._marginAlignment||(this._marginAlignment=new b(function(){return a._positioningDirty()})),this._marginAlignment},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"layoutEngine",{get:function(){return this._layoutEngine||(this._layoutEngine=c.CanvasLayoutEngine.Singleton),this._layoutEngine},set:function(a){this._layoutEngine!==a&&this._changeLayoutEngine(a)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"layoutArea",{get:function(){return this._layoutArea},
set:function(a){this._layoutArea.equals(a)||(this._positioningDirty(),this._layoutArea=a)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"layoutAreaPos",{get:function(){return this._layoutAreaPos},set:function(a){this._layoutAreaPos.equals(a)||(this._positioningDirty(),this._layoutAreaPos=a)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isPickable",{get:function(){return this._isFlagSet(c.SmartPropertyPrim.flagIsPickable)},set:function(a){this._changeFlags(c.SmartPropertyPrim.flagIsPickable,
a)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"hierarchyDepth",{get:function(){return this._hierarchyDepth},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"renderGroup",{get:function(){return this._renderGroup},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"globalTransform",{get:function(){return this._globalTransform},enumerable:!0,configurable:!0}),l.prototype.getGlobalPosition=function(){var a=new c.Vector2(0,0);return this.getGlobalPositionByRef(a),
a},l.prototype.getGlobalPositionByRef=function(a){a.x=this.globalTransform.m[12];a.y=this.globalTransform.m[13]},Object.defineProperty(l.prototype,"invGlobalTransform",{get:function(){return this._invGlobalTransform},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"localTransform",{get:function(){return this._updateLocalTransform(),this._localTransform},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"boundingInfo",{get:function(){if(this._isFlagSet(c.SmartPropertyPrim.flagBoundingInfoDirty)){for(var a=
this._boundingInfo=this.levelBoundingInfo.clone(),b=new c.BoundingInfo2D,d=0,g=this._children;d<g.length;d++){var h=g[d];h.boundingInfo.transformToRef(h.localTransform,b);a.unionToRef(b,a)}this._boundingSize=c.Size.Zero();a=this._boundingInfo.max();this._boundingSize=new c.Size(this._size&&null!=this._size.width?this._size.width:Math.ceil(a.x),this._size&&null!=this._size.height?this._size.height:Math.ceil(a.y));this._clearFlags(c.SmartPropertyPrim.flagBoundingInfoDirty)}return this._boundingInfo},
enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isSizeAuto",{get:function(){return null==this._size},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isPositionAuto",{get:function(){return null==this._position},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"pointerEventObservable",{get:function(){return this._pointerEventObservable},enumerable:!0,configurable:!0}),l.prototype.findById=function(a){if(this._id===a)return this;for(var b=0,c=this._children;b<
c.length;b++){var d=c[b].findById(a);if(null!=d)return d}},l.prototype.onZOrderChanged=function(){},l.prototype.levelIntersect=function(){return!1},l.prototype.setPointerEventCapture=function(a){return this.owner._setPointerCapture(a,this)},l.prototype.releasePointerEventsCapture=function(a){return this.owner._releasePointerCapture(a,this)},l.prototype.intersect=function(a){if(!a)return!1;var b=!a._globalPickPosition;if(b&&(a._globalPickPosition=c.Vector2.Zero(),c.Vector2.TransformToRef(a.pickPosition,
this.globalTransform,a._globalPickPosition),a._localPickPosition=a.pickPosition.clone(),a.intersectedPrimitives=[],a.topMostIntersectedPrimitive=null),!a.intersectHidden&&!this.isVisible)return!1;if(this.isPickable&&!this.boundingInfo.doesIntersect(a._localPickPosition))return a._exit(b),!1;var d=!1;if(this.isPickable&&(d=this.levelIntersect(a))){var g=new j(this,a._localPickPosition.clone());if(a.intersectedPrimitives.push(g),(!a.topMostIntersectedPrimitive||a.topMostIntersectedPrimitive.prim.actualZOffset>
g.prim.actualZOffset)&&(a.topMostIntersectedPrimitive=g),a.findFirstOnly)return a._exit(b),!0}if(!d||!a.findFirstOnly){d=0;for(g=this._children;d<g.length;d++){var h=g[d];if(h.isPickable&&(a.intersectHidden||h.isVisible)&&(c.Vector2.TransformToRef(a._globalPickPosition,h.invGlobalTransform,a._localPickPosition),h.intersect(a)&&a.findFirstOnly))return a._exit(b),!0}}return a._exit(b),a.isIntersected},l.prototype.moveChild=function(a,b){if(a.parent!==this)return!1;var c,d,g=this._children.indexOf(a),
h=b?this._children.indexOf(b):-1;b?(c=this._children[h]._siblingDepthOffset,d=this._children[h+1]._siblingDepthOffset):(c=1,d=this._children[1]._siblingDepthOffset);a._siblingDepthOffset=(d-c)/2;this._children.splice(h+1,0,this._children.splice(g,1)[0])},l.prototype.addChild=function(a){a._parent=this;this._boundingBoxDirty();this._patchHierarchyDepth(a);this._children.push(a)},l.prototype.dispose=function(){if(!m.prototype.dispose.call(this))return!1;if(this._actionManager&&(this._actionManager.dispose(),
this._actionManager=null),this._parent){var a=this._parent._children.indexOf(this);void 0!==a&&this._parent._children.splice(a,1);this._parent=null}if(this._children)for(;0<this._children.length;)this._children[this._children.length-1].dispose();return!0},l.prototype.onPrimBecomesDirty=function(){this._renderGroup&&this._renderGroup._addPrimToDirtyList(this)},l.prototype._needPrepare=function(){return this._areSomeFlagsSet(c.SmartPropertyPrim.flagVisibilityChanged|c.SmartPropertyPrim.flagModelDirty)||
0!==this._instanceDirtyFlags||this._globalTransformProcessStep!==this._globalTransformStep},l.prototype._prepareRender=function(a){this._prepareRenderPre(a);this._prepareRenderPost(a)},l.prototype._prepareRenderPre=function(){},l.prototype._prepareRenderPost=function(a){this instanceof c.Group2D&&this.isRenderableGroup||(0<this._children.length&&(this._globalTransformProcessStep!==this._globalTransformStep||this.checkPropertiesDirty(l.isVisibleProperty.flagId))&&this._children.forEach(function(b){b instanceof
c.Group2D&&b.isRenderableGroup||b._prepareRender(a)}),this._clearFlags(c.SmartPropertyPrim.flagModelDirty),this._instanceDirtyFlags=0)},l.prototype._canvasPreInit=function(){},l.CheckParent=function(){},l.prototype.updateCachedStatesOf=function(a,b){for(var c=0;c<a.length;c++)a[c].updateCachedStates(b)},l.prototype._parentLayoutDirty=function(){this._parent&&!this._parent.isDisposed&&this._parent._setLayoutDirty()},l.prototype._setLayoutDirty=function(){this.isDirty||this.onPrimBecomesDirty();this._setFlags(c.SmartPropertyPrim.flagLayoutDirty)},
l.prototype._checkPositionChange=function(){return this.parent&&!1===this.parent.layoutEngine.isChildPositionAllowed?(console.log("Can't manually set the position of "+this.id+", the Layout Engine of its parent doesn't allow it"),!1):!0},l.prototype._positioningDirty=function(){this.isDirty||this.onPrimBecomesDirty();this._setFlags(c.SmartPropertyPrim.flagPositioningDirty)},l.prototype._changeLayoutEngine=function(a){this._layoutEngine=a},l.prototype._updateLocalTransform=function(){var a=!1,b=null;
this._parent?(b=this._parent._marginOffset,a=!b.equals(this._parentMargingOffset),this._parentMargingOffset.copyFrom(b)):b=l._v0;var d=l.actualPositionProperty.flagId|l.rotationProperty.flagId|l.scaleProperty.flagId|l.originProperty.flagId;if(a||this.checkPropertiesDirty(d)){a=c.Quaternion.RotationAxis(new c.Vector3(0,0,1),this._rotation);if(0===this._origin.x&&0===this._origin.y)this._localTransform=b=c.Matrix.Compose(new c.Vector3(this._scale,this._scale,1),a,new c.Vector3(this.actualPosition.x+
b.x,this.actualPosition.y+b.y,0));else{var g=this.actualSize;c.Matrix.TranslationToRef(-g.width*this._origin.x,-g.height*this._origin.y,0,l._t0);a.toRotationMatrix(l._t1);l._t0.multiplyToRef(l._t1,l._t2);c.Matrix.ScalingToRef(this._scale,this._scale,1,l._t0);l._t2.multiplyToRef(l._t0,l._t1);c.Matrix.TranslationToRef(g.width*this._origin.x+this.actualPosition.x+b.x,g.height*this._origin.y+this.actualPosition.y+b.y,0,l._t2);l._t1.multiplyToRef(l._t2,this._localTransform)}return this.clearPropertiesDirty(d),
!0}return!1},l.prototype.updateCachedStates=function(a){if(!this.isDisposed){this._parent&&(this._parent._globalTransformProcessStep!==this.owner._globalTransformProcessStep||this._parent._areSomeFlagsSet(c.SmartPropertyPrim.flagLayoutDirty|c.SmartPropertyPrim.flagPositioningDirty))&&this._parent.updateCachedStates(!1);var b=this.checkPropertiesDirty(l.sizeProperty.flagId);!this._isFlagSet(c.SmartPropertyPrim.flagLayoutDirty)&&b&&this.size&&(null!=this.size.width&&(this.actualSize.width=this.size.width),
null!=this.size.height&&(this.actualSize.height=this.size.height),this.clearPropertiesDirty(l.sizeProperty.flagId));var d=this._isFlagSet(c.SmartPropertyPrim.flagPositioningDirty);this._isFlagSet(c.SmartPropertyPrim.flagLayoutDirty)&&(this._layoutEngine.updateLayout(this),this._clearFlags(c.SmartPropertyPrim.flagLayoutDirty));d=d&&!this._isFlagSet(c.SmartPropertyPrim.flagPositioningDirty);if(!d&&(b||this._isFlagSet(c.SmartPropertyPrim.flagPositioningDirty)||this._parent&&!this._parent.contentArea.equals(this._parentContentArea))&&
(this._updatePositioning(),this._clearFlags(c.SmartPropertyPrim.flagPositioningDirty),d=!0),d&&this._parent&&this._parentContentArea.copyFrom(this._parent.contentArea),this===this.owner||this._globalTransformProcessStep!==this.owner._globalTransformProcessStep){b=this.isVisible;this.isVisible=(!this._parent||this._parent.isVisible)&&this.levelVisible;this._changeFlags(c.SmartPropertyPrim.flagVisibilityChanged,b!==this.isVisible);b=this._updateLocalTransform();d=null!=this._parent?this._parent._globalTransformStep!==
this._parentTransformStep:!1;if(!this._globalTransform||b||d)b=this._parent?this._parent._globalTransform:null,this._globalTransform=this._parent?this._localTransform.multiply(b):this._localTransform,this._invGlobalTransform=c.Matrix.Invert(this._globalTransform),this._globalTransformStep=this.owner._globalTransformProcessStep+1,this._parentTransformStep=this._parent?this._parent._globalTransformStep:0;this._globalTransformProcessStep=this.owner._globalTransformProcessStep}if(a){a=0;for(b=this._children;a<
b.length;a++)d=b[a],d.updateCachedStates(!(d instanceof c.Group2D&&d.isRenderableGroup))}}},l.prototype._updatePositioning=function(){this._hasMargin||null!=this.actualSize.width&&null!=this.actualSize.height||(null==this.actualSize.width&&(this.marginAlignment.horizontal=b.AlignStretch),null==this.actualSize.height&&(this.marginAlignment.vertical=b.AlignStretch));this._hasMargin&&(this.margin.computeWithAlignment(this.layoutArea,this.size,this.marginAlignment,this._marginOffset,l._size),this.actualPosition=
this._marginOffset.add(this._layoutAreaPos),null!=this.size.width&&(this.size.width=l._size.width),null!=this.size.height&&(this.size.height=l._size.height),this.actualSize.copyFrom(l._size.clone()));this._hasPadding?(this._getInitialContentAreaToRef(this.actualSize,l._icPos,l._icArea),l._icArea.width=Math.max(0,l._icArea.width),l._icArea.height=Math.max(0,l._icArea.height),this.padding.compute(l._icArea,this._marginOffset,l._size),this._marginOffset.x+=l._icPos.x,this._marginOffset.y+=l._icPos.y,
this._contentArea.copyFrom(l._size)):(this._getInitialContentAreaToRef(this.actualSize,l._icPos,l._icArea),l._icArea.width=Math.max(0,l._icArea.width),l._icArea.height=Math.max(0,l._icArea.height),this._marginOffset.copyFrom(l._icPos),this._contentArea.copyFrom(l._icArea))},Object.defineProperty(l.prototype,"contentArea",{get:function(){return this._isFlagSet(c.SmartPropertyPrim.flagPositioningDirty)&&(this._updatePositioning(),this._clearFlags(c.SmartPropertyPrim.flagPositioningDirty)),this._contentArea},
enumerable:!0,configurable:!0}),l.prototype._patchHierarchy=function(a){if(this._owner=a,null==this._renderGroup){this instanceof c.Group2D&&(this.detectGroupStates(),this._trackedNode&&!this._isFlagSet(c.SmartPropertyPrim.flagTrackedGroup)&&this.owner._registerTrackedNode(this));if(this._parent&&(this._renderGroup=this.parent.traverseUp(function(a){return a instanceof c.Group2D&&a.isRenderableGroup}),this._parentLayoutDirty()),this._renderGroup&&this.isDirty){var b=this._renderGroup._renderableData._primDirtyList;
-1===b.indexOf(this)&&b.push(this)}for(var b=0,d=this._children;b<d.length;b++){var g=d[b];this._patchHierarchyDepth(g);g._patchHierarchy(a)}}},l.prototype._patchHierarchyDepth=function(a){a._hierarchyDepth=this._hierarchyDepth+1;a._hierarchyDepthOffset=this._hierarchyDepthOffset+(this._children.length+1)*this._siblingDepthOffset;a._siblingDepthOffset=this._siblingDepthOffset/c.Canvas2D.hierarchyLevelMaxSiblingCount},l.prototype._getInitialContentAreaToRef=function(a,b,c){c.width=a.width;c.height=
a.height;b.x=b.y=0},l.PRIM2DBASE_PROPCOUNT=15,l._nullPosition=c.Vector2.Zero(),l.boundinbBoxReentrency=!1,l.nullSize=c.Size.Zero(),l._isCanvasInit=!1,l._t0=new c.Matrix,l._t1=new c.Matrix,l._t2=new c.Matrix,l._v0=c.Vector2.Zero(),l._icPos=c.Vector2.Zero(),l._icArea=c.Size.Zero(),l._size=c.Size.Zero(),__decorate([c.instanceLevelProperty(1,function(a){return l.actualPositionProperty=a},!1,!0)],l.prototype,"actualPosition",null),__decorate([c.dynamicLevelProperty(1,function(a){return l.positionProperty=
a},!1,!0)],l.prototype,"position",null),__decorate([c.dynamicLevelProperty(2,function(a){return l.sizeProperty=a},!1,!0)],l.prototype,"size",null),__decorate([c.instanceLevelProperty(3,function(a){return l.rotationProperty=a},!1,!0)],l.prototype,"rotation",null),__decorate([c.instanceLevelProperty(4,function(a){return l.scaleProperty=a},!1,!0)],l.prototype,"scale",null),__decorate([c.dynamicLevelProperty(5,function(a){return l.originProperty=a},!1,!0)],l.prototype,"origin",null),__decorate([c.dynamicLevelProperty(6,
function(a){return l.levelVisibleProperty=a})],l.prototype,"levelVisible",null),__decorate([c.instanceLevelProperty(7,function(a){return l.isVisibleProperty=a})],l.prototype,"isVisible",null),__decorate([c.instanceLevelProperty(8,function(a){return l.zOrderProperty=a})],l.prototype,"zOrder",null),__decorate([c.dynamicLevelProperty(9,function(a){return l.marginProperty=a})],l.prototype,"margin",null),__decorate([c.dynamicLevelProperty(10,function(a){return l.paddingProperty=a})],l.prototype,"padding",
null),__decorate([c.dynamicLevelProperty(11,function(a){return l.marginAlignmentProperty=a})],l.prototype,"marginAlignment",null),l=__decorate([c.className("Prim2DBase")],l));c.Prim2DBase=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(a,b,d){this._partCount=d;this.owner=a;this.modelRenderCache=b;this.modelRenderCache.addRef();this.partIndexFromId=new c.StringDictionary;this._usedShaderCategories=Array(d);this._strides=Array(d);this._transparentData=this._alphaTestData=this._opaqueData=null;this.opaqueDirty=this.alphaTestDirty=this.transparentDirty=this.transparentOrderDirty=!1};f=(f.prototype.dispose=function(){if(this._isDisposed)return!1;this.modelRenderCache&&this.modelRenderCache.dispose();var a=
this.owner.owner.engine;return this.opaqueData&&(this.opaqueData.forEach(function(b){return b.dispose(a)}),this.opaqueData=null),this.partIndexFromId=null,this._isDisposed=!0,!0},Object.defineProperty(f.prototype,"hasOpaqueData",{get:function(){return null!=this._opaqueData},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"hasAlphaTestData",{get:function(){return null!=this._alphaTestData},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"hasTransparentData",{get:function(){return null!=
this._transparentData},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"opaqueData",{get:function(){if(!this._opaqueData){this._opaqueData=Array(this._partCount);for(var a=0;a<this._partCount;a++)this._opaqueData[a]=new e(this._strides[a])}return this._opaqueData},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"alphaTestData",{get:function(){if(!this._alphaTestData){this._alphaTestData=Array(this._partCount);for(var a=0;a<this._partCount;a++)this._alphaTestData[a]=
new e(this._strides[a])}return this._alphaTestData},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"transparentData",{get:function(){if(!this._transparentData){this._transparentData=Array(this._partCount);for(var b=0;b<this._partCount;b++)this._transparentData[b]=new a(this._strides[b],this.modelRenderCache._partData[b]._zBiasOffset)}return this._transparentData},enumerable:!0,configurable:!0}),f.prototype.sortTransparentData=function(){if(this.transparentOrderDirty){for(var a=
0;a<this._transparentData.length;a++)this._transparentData[a]._partData.sort();this.transparentOrderDirty=!1}},Object.defineProperty(f.prototype,"usedShaderCategories",{get:function(){return this._usedShaderCategories},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"strides",{get:function(){return this._strides},enumerable:!0,configurable:!0}),f);c.GroupInstanceInfo=f;c.TransparentSegment=function(){};var e;f=function(a){this._partBuffer=this._partData=null;this._partBufferSize=
0;this._partData=new c.DynamicFloatArray(a/4,50);this._isDisposed=!1};e=(f.prototype.dispose=function(a){return this._isDisposed?!1:(this._partBuffer&&(a._releaseBuffer(this._partBuffer),this._partBuffer=null),this._partData=null,void(this._isDisposed=!0))},f);c.GroupInfoPartData=e;var a,b=e;f=function(a,c){b.call(this,a);this._partData.compareValueOffset=c;this._partData.sortingAscending=!1};a=(__extends(f,b),f);c.TransparentGroupInfoPartData=a;var d=function(a,b){this._engine=a;this._modelKey=b;
this._refCounter=this._nextKey=1;this._instancesData=new c.StringDictionary;this._partData=null};f=(d.prototype.dispose=function(){if(0!==--this._refCounter)return!1;var a=this._engine.getExternalData("__BJSCANVAS2D__");return a&&a.DisposeModelRenderCache(this),!0},Object.defineProperty(d.prototype,"isDisposed",{get:function(){return 0>=this._refCounter},enumerable:!0,configurable:!0}),d.prototype.addRef=function(){return++this._refCounter},Object.defineProperty(d.prototype,"modelKey",{get:function(){return this._modelKey},
enumerable:!0,configurable:!0}),d.prototype.render=function(){return!0},d.prototype.addInstanceDataParts=function(a){var b=this._nextKey.toString();if(!this._instancesData.add(b,a))throw Error("Key: "+b+" is already allocated");return++this._nextKey,b},d.prototype.removeInstanceData=function(a){this._instancesData.remove(a)},d.prototype.getPartIndexFromId=function(a){for(var b=0;b<this._partData.length;b++)if(this._partData[b]._partId===a)return b;return null},d.prototype.loadInstancingAttributes=
function(a,b){var c=this.getPartIndexFromId(a);return null===c?null:this._partsClassInfo[c].classContent.getInstancingAttributeInfos(b,this._partData[c]._partUsedCategories)},d.prototype.setupUniforms=function(a,b,c,e){var f=this._partData[b],k=f._partDataStride/4*e;this._partsClassInfo[b].fullContent.forEach(function(b,g){if(!g.category||-1!==f._partUsedCategories.indexOf(g.category))switch(g.dataType){case 4:var e=g.instanceOffset.get(f._partJoinedUsedCategories);a.setFloat(g.attributeName,c.buffer[k+
e]);break;case 0:e=g.instanceOffset.get(f._partJoinedUsedCategories);d.v2.x=c.buffer[k+e+0];d.v2.y=c.buffer[k+e+1];a.setVector2(g.attributeName,d.v2);break;case 5:case 1:e=g.instanceOffset.get(f._partJoinedUsedCategories);d.v3.x=c.buffer[k+e+0];d.v3.y=c.buffer[k+e+1];d.v3.z=c.buffer[k+e+2];a.setVector3(g.attributeName,d.v3);break;case 6:case 2:e=g.instanceOffset.get(f._partJoinedUsedCategories),d.v4.x=c.buffer[k+e+0],d.v4.y=c.buffer[k+e+1],d.v4.z=c.buffer[k+e+2],d.v4.w=c.buffer[k+e+3],a.setVector4(g.attributeName,
d.v4)}})},d.v2=c.Vector2.Zero(),d.v3=c.Vector3.Zero(),d.v4=c.Vector4.Zero(),d);c.ModelRenderCache=f;c.ModelRenderCachePartData=function(){}}(BABYLON||(BABYLON={}));
!function(c){function f(a,d){return function(g,f,j){var q=c.ClassTreeInfo.getOrRegister(g,function(a){return new e(a)}).getLevelOf(g);d=d||f;var p=q.levelContent.get(f);if(p)throw Error("The ID "+f+" is already taken by another instance data");p=new b;p.attributeName=d;p.category=a||null;p.category&&(p.delimitedCategory=";"+p.category+";");q.levelContent.add(f,p);j.get=function(){return null};j.set=function(a){if(!p.category||-1!==e._CurCategories.indexOf(p.delimitedCategory))if(p.size?p.instanceOffset.contains(e._CurCategories)||
q.classContent.mapProperty(p,!1):(p.setSize(a),q.classContent.mapProperty(p,!0)),this.dataBuffer&&this.dataElements){var b=this.dataElements[this.curElement].offset+p.instanceOffset.get(e._CurCategories);p.writeData(this.dataBuffer.buffer,b,a)}}}}var e,a=function(a){this._baseInfo=a;this._nextOffset=new c.StringDictionary;this._attributes=[]};e=(a.prototype.mapProperty=function(b,c){var d=this._nextOffset.getOrAdd(a._CurCategories,0);b.instanceOffset.add(a._CurCategories,this._getBaseOffset(a._CurCategories)+
d);this._nextOffset.set(a._CurCategories,d+b.size/4);c&&this._attributes.push(b)},a.prototype.getInstancingAttributeInfos=function(a,b){for(var d=";"+b.join(";")+";",g=[],e=this;e;){for(var f=0,j=e._attributes;f<j.length;f++){var r=j[f];if(!r.category||-1!==b.indexOf(r.category)){var t=a.getAttributeLocationByName(r.attributeName),s=new c.InstancingAttributeInfo;s.index=t;s.attributeSize=r.size/4;s.offset=4*r.instanceOffset.get(d);s.attributeName=r.attributeName;g.push(s)}}e=e._baseInfo}return g},
a.prototype.getShaderAttributes=function(a){for(var b=[],c=this;c;){for(var d=0,g=c._attributes;d<g.length;d++){var e=g[d];e.category&&-1===a.indexOf(e.category)||b.push(e.attributeName)}c=c._baseInfo}return b},a.prototype._getBaseOffset=function(a){for(var b=0,c=this._baseInfo;c;)b+=c._nextOffset.getOrAdd(a,0),c=c._baseInfo;return b},a);c.InstanceClassInfo=e;var b,d=function(){this.instanceOffset=new c.StringDictionary};b=(d.prototype.setSize=function(a){if(a instanceof c.Vector2)return this.size=
8,void(this.dataType=0);if(a instanceof c.Vector3)return this.size=12,void(this.dataType=1);if(a instanceof c.Vector4)return this.size=16,void(this.dataType=2);if(a instanceof c.Matrix)throw Error("Matrix type is not supported by WebGL Instance Buffer, you have to use four Vector4 properties instead");return"number"==typeof a?(this.size=4,void(this.dataType=4)):a instanceof c.Color3?(this.size=12,void(this.dataType=5)):a instanceof c.Color4?(this.size=16,void(this.dataType=6)):a instanceof c.Size?
(this.size=8,void(this.dataType=7)):void 0},d.prototype.writeData=function(a,b,c){switch(this.dataType){case 0:a[b+0]=c.x;a[b+1]=c.y;break;case 1:a[b+0]=c.x;a[b+1]=c.y;a[b+2]=c.z;break;case 2:a[b+0]=c.x;a[b+1]=c.y;a[b+2]=c.z;a[b+3]=c.w;break;case 5:a[b+0]=c.r;a[b+1]=c.g;a[b+2]=c.b;break;case 6:a[b+0]=c.r;a[b+1]=c.g;a[b+2]=c.b;a[b+3]=c.a;break;case 4:a[b]=c;break;case 3:for(var d=0;16>d;d++)a[b+d]=c.m[d];break;case 7:a[b+0]=c.width,a[b+1]=c.height}},d);c.InstancePropInfo=b;c.instanceData=f;d=function(a,
b){this.id=a;this.curElement=0;this.dataElementCount=b};d=(Object.defineProperty(d.prototype,"zBias",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"transformX",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"transformY",{get:function(){return null},enumerable:!0,configurable:!0}),d.prototype.getClassTreeInfo=function(){return this.typeInfo||(this.typeInfo=c.ClassTreeInfo.get(Object.getPrototypeOf(this))),
this.typeInfo},d.prototype.allocElements=function(){if(this.dataBuffer){for(var a=Array(this.dataElementCount),b=0;b<this.dataElementCount;b++)a[b]=this.dataBuffer.allocElement();this.dataElements=a}},d.prototype.freeElements=function(){if(this.dataElements){for(var a=0,b=this.dataElements;a<b.length;a++)this.dataBuffer.freeElement(b[a]);this.dataElements=null}},Object.defineProperty(d.prototype,"dataElementCount",{get:function(){return this._dataElementCount},set:function(a){a!==this._dataElementCount&&
(this.freeElements(),this._dataElementCount=a,this.allocElements())},enumerable:!0,configurable:!0}),__decorate([f()],d.prototype,"zBias",null),__decorate([f()],d.prototype,"transformX",null),__decorate([f()],d.prototype,"transformY",null),d);c.InstanceDataBase=d;var j=c.Prim2DBase,g=function(a){j.call(this,a);this._isAlphaTest=this._isTransparent=!1;this._transparentPrimitiveInfo=null},d=(__extends(g,j),Object.defineProperty(g.prototype,"isAlphaTest",{get:function(){return this._isAlphaTest},set:function(a){this._isAlphaTest=
a},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"isTransparent",{get:function(){return this._isTransparent},set:function(a){this._isTransparent=a},enumerable:!0,configurable:!0}),g.prototype.dispose=function(){return j.prototype.dispose.call(this)?(this._transparentPrimitiveInfo&&(this.renderGroup._renderableData.removeTransparentPrimitiveInfo(this._transparentPrimitiveInfo),this._transparentPrimitiveInfo=null),this._modelRenderInstanceID&&(this._modelRenderCache.removeInstanceData(this._modelRenderInstanceID),
this._modelRenderInstanceID=null),this._modelRenderCache&&(this._modelRenderCache.dispose(),this._modelRenderCache=null),this._instanceDataParts&&(this._instanceDataParts.forEach(function(a){a.freeElements()}),this._instanceDataParts=null),!0):!1},g.prototype._prepareRenderPre=function(a){j.prototype._prepareRenderPre.call(this,a);this._isFlagSet(c.SmartPropertyPrim.flagModelDirty)&&this._modelRenderInstanceID&&(this._modelRenderCache.removeInstanceData(this._modelRenderInstanceID),this._modelRenderInstanceID=
null);var b=!1;this._modelRenderCache&&!this._isFlagSet(c.SmartPropertyPrim.flagModelDirty)||(b=this._createModelRenderCache());var d=null,g=!1;this._modelRenderInstanceID||(g=!0,d=this._createModelDataParts());b&&this.setupModelRenderCache(this._modelRenderCache);(this._isFlagSet(c.SmartPropertyPrim.flagVisibilityChanged)||a.forceRefreshPrimitive||g||0!==this._instanceDirtyFlags||this._globalTransformProcessStep!==this._globalTransformStep)&&(this.isTransparent,this._updateInstanceDataParts(d))},
g.prototype._createModelRenderCache=function(){var a=this,b=!1;return this._modelRenderCache&&this._modelRenderCache.dispose(),this._modelRenderCache=this.owner._engineData.GetOrAddModelCache(this.modelKey,function(c){c=a.createModelRenderCache(c);return b=!0,c}),this._clearFlags(c.SmartPropertyPrim.flagModelDirty),b||this._modelRenderCache.addRef(),b},g.prototype._createModelDataParts=function(){var a=this,b=this.createInstanceDataParts();this._instanceDataParts=b;this._modelRenderCache._partData||
this._setupModelRenderCache(b);for(var d=this.renderGroup._renderableData._renderGroupInstancesInfo.getOrAddWithFactory(this.modelKey,function(){for(var b=new c.GroupInstanceInfo(a.renderGroup,a._modelRenderCache,a._modelRenderCache._partData.length),d=0;d<a._modelRenderCache._partData.length;d++){var g=a._instanceDataParts[d];b.partIndexFromId.add(g.id.toString(),d);b.usedShaderCategories[d]=";"+a.getUsedShaderCategories(g).join(";")+";";b.strides[d]=a._modelRenderCache._partData[d]._partDataStride}return b}),
g=null,g=this.isTransparent?d.transparentData:this.isAlphaTest?d.alphaTestData:d.opaqueData,e=0;e<b.length;e++){var f=b[e];f.dataBuffer=g[e]._partData;f.allocElements()}return this._modelRenderInstanceID=this._modelRenderCache.addInstanceDataParts(this._instanceDataParts),d},g.prototype._setupModelRenderCache=function(a){var b=[];this._modelRenderCache._partData=[];for(var d=0;d<a.length;d++){var g=a[d],f=new c.ModelRenderCachePartData;this._modelRenderCache._partData.push(f);var j=this.getUsedShaderCategories(g),
p=g.getClassTreeInfo(),r=this.isVisible;this.isVisible=!0;var t=";"+j.join(";")+";";f._partJoinedUsedCategories=t;e._CurCategories=t;var s=this.beforeRefreshForLayoutConstruction(g);this.refreshInstanceDataPart(g);this.afterRefreshForLayoutConstruction(g,s);this.isVisible=r;var u=0;p.fullContent.forEach(function(a,b){b.category&&-1===j.indexOf(b.category)||("zBias"===b.attributeName&&(f._zBiasOffset=b.instanceOffset.get(t)),b.size?u+=b.size:console.log("ERROR: Couldn't detect the size of the Property "+
b.attributeName+" from type "+c.Tools.getClassName(p.type)+". Property is ignored."))});f._partDataStride=u;f._partUsedCategories=j;f._partId=g.id;b.push(p)}this._modelRenderCache._partsClassInfo=b},g.prototype.onZOrderChanged=function(){this.isTransparent&&this._transparentPrimitiveInfo&&(this.renderGroup._renderableData.transparentPrimitiveZChanged(this._transparentPrimitiveInfo),this.renderGroup._renderableData._renderGroupInstancesInfo.get(this.modelKey).transparentOrderDirty=!0)},g.prototype._updateInstanceDataParts=
function(a){a||(a=this.renderGroup._renderableData._renderGroupInstancesInfo.get(this.modelKey));this.isTransparent&&this._isFlagSet(c.SmartPropertyPrim.flagVisibilityChanged)&&(this.isVisible?this._transparentPrimitiveInfo||(this._transparentPrimitiveInfo=this.renderGroup._renderableData.addNewTransparentPrimitiveInfo(this,a)):this._transparentPrimitiveInfo&&(this.renderGroup._renderableData.removeTransparentPrimitiveInfo(this._transparentPrimitiveInfo),this._transparentPrimitiveInfo=null),a.transparentOrderDirty=
!0);for(var b=0,d=this._instanceDataParts;b<d.length;b++){var g=d[b];this._isFlagSet(c.SmartPropertyPrim.flagVisibilityChanged)&&!g.dataElements&&g.allocElements();e._CurCategories=a.usedShaderCategories[a.partIndexFromId.get(g.id.toString())];this.refreshInstanceDataPart(g)||g.dataElements&&g.freeElements()}this._instanceDirtyFlags=0;this.isTransparent?a.transparentDirty=!0:this.isAlphaTest?a.alphaTestDirty=!0:a.opaqueDirty=!0;this._clearFlags(c.SmartPropertyPrim.flagVisibilityChanged)},g.prototype._getFirstIndexInDataBuffer=
function(){for(var a=0,b=this._instanceDataParts;a<b.length;a++){var c=b[a];if(c)return c.dataElements[0].offset/c.dataBuffer.stride}return null},g.prototype._getLastIndexInDataBuffer=function(){for(var a=0,b=this._instanceDataParts;a<b.length;a++){var c=b[a];if(c)return c.dataElements[c.dataElements.length-1].offset/c.dataBuffer.stride}return null},g.prototype._getNextPrimZOrder=function(){for(var a=this._instanceDataParts.length,b=0;a>b;b++){var c=this._instanceDataParts[b];if(c){var a=c.dataBuffer.stride,
d=c.dataElements[c.dataElements.length-1].offset;return c.dataBuffer.totalElementCount*a<=d?null:c.dataBuffer[d+a+this.modelRenderCache._partData[b]._zBiasOffset]}}return null},g.prototype._getPrevPrimZOrder=function(){for(var a=this._instanceDataParts.length,b=0;a>b;b++){var c=this._instanceDataParts[b];if(c){var a=c.dataBuffer.stride,d=c.dataElements[0].offset;return 0===d?null:c.dataBuffer[d-a+this.modelRenderCache._partData[b]._zBiasOffset]}}return null},g.prototype.transformPointWithOriginByRef=
function(a,b,c){var d=this.actualSize;c.x=a.x-(this.origin.x+(b?b.x:0))*d.width;c.y=a.y-(this.origin.y+(b?b.y:0))*d.height},g.prototype.transformPointWithOriginToRef=function(a,b,c){return this.transformPointWithOriginByRef(a,b,c),c},g.prototype.getDataPartEffectInfo=function(a,b,d){void 0===d&&(d=null);var g=c.Tools.first(this._instanceDataParts,function(b){return b.id===a});if(!g)return null;var e=this.owner.supportInstancedArray;if(null!=d){if(d&&!1===e)return null;e=d}d=g.getClassTreeInfo();g=
this.getUsedShaderCategories(g);d=d.classContent.getShaderAttributes(g);var f="";return g.forEach(function(a){f+="#define "+a+"\n"}),e&&(f+="#define Instanced\n"),{attributes:e?b.concat(d):b,uniforms:e?[]:d,defines:f}},Object.defineProperty(g.prototype,"modelRenderCache",{get:function(){return this._modelRenderCache},enumerable:!0,configurable:!0}),g.prototype.createModelRenderCache=function(){return null},g.prototype.setupModelRenderCache=function(){},g.prototype.createInstanceDataParts=function(){return null},
g.prototype.getUsedShaderCategories=function(){return[]},g.prototype.beforeRefreshForLayoutConstruction=function(){},g.prototype.afterRefreshForLayoutConstruction=function(){},g.prototype.refreshInstanceDataPart=function(a){return this.isVisible?(a.isVisible=this.isVisible,1===a.dataElementCount&&(a.curElement=0,this.updateInstanceDataPart(a)),!0):!1},g.prototype.updateInstanceDataPart=function(a,b){void 0===b&&(b=null);var d=this._globalTransform.multiply(this.renderGroup.invGlobalTransform),g=this.renderGroup.viewportSize,
e=this.actualZOffset,f=0,j=0;b&&(f=b.x*d.m[0]+b.y*d.m[4],j=b.x*d.m[1]+b.y*d.m[5]);var r=g.width,t=g.height,g=1/e,f=new c.Vector4(2*d.m[0]/r,2*d.m[4]/r,0,2*(d.m[12]+f)/r-1),d=new c.Vector4(2*d.m[1]/t,2*d.m[5]/t,0,2*(d.m[13]+j)/t-1);a.transformX=f;a.transformY=d;a.zBias=new c.Vector2(e,g)},g.RENDERABLEPRIM2D_PROPCOUNT=c.Prim2DBase.PRIM2DBASE_PROPCOUNT+5,__decorate([c.dynamicLevelProperty(c.Prim2DBase.PRIM2DBASE_PROPCOUNT+0,function(a){return g.isAlphaTestProperty=a})],g.prototype,"isAlphaTest",null),
__decorate([c.dynamicLevelProperty(c.Prim2DBase.PRIM2DBASE_PROPCOUNT+1,function(a){return g.isTransparentProperty=a})],g.prototype,"isTransparent",null),g=__decorate([c.className("RenderablePrim2D")],g));c.RenderablePrim2D=d}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.RenderablePrim2D,a=function(a){e.call(this,a);a||(a={});var b=null;a.border&&(b="string"==typeof a.border?c.Canvas2D.GetBrushFromString(a.border):a.border);var d=null;a.fill&&(d="string"==typeof a.fill?c.Canvas2D.GetBrushFromString(a.fill):a.fill);this.border=b;this.fill=d;this.borderThickness=a.borderThickness};f=(__extends(a,e),Object.defineProperty(a.prototype,"border",{get:function(){return this._border},set:function(a){this._border=a;this._updateTransparencyStatus()},enumerable:!0,
configurable:!0}),Object.defineProperty(a.prototype,"fill",{get:function(){return this._fill},set:function(a){this._fill=a;this._updateTransparencyStatus()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"borderThickness",{get:function(){return this._borderThickness},set:function(a){this._borderThickness=a},enumerable:!0,configurable:!0}),a.prototype.getUsedShaderCategories=function(b){var d=e.prototype.getUsedShaderCategories.call(this,b);if(b.id===a.SHAPE2D_FILLPARTID){var h=
this.fill;h instanceof c.SolidColorBrush2D&&d.push(a.SHAPE2D_CATEGORY_FILLSOLID);h instanceof c.GradientColorBrush2D&&d.push(a.SHAPE2D_CATEGORY_FILLGRADIENT)}b.id===a.SHAPE2D_BORDERPARTID&&(d.push(a.SHAPE2D_CATEGORY_BORDER),b=this.border,b instanceof c.SolidColorBrush2D&&d.push(a.SHAPE2D_CATEGORY_BORDERSOLID),b instanceof c.GradientColorBrush2D&&d.push(a.SHAPE2D_CATEGORY_BORDERGRADIENT));return d},a.prototype.refreshInstanceDataPart=function(b){if(!e.prototype.refreshInstanceDataPart.call(this,b))return!1;
if(b.id===a.SHAPE2D_FILLPARTID){if(this.fill){var d=this.fill;d instanceof c.SolidColorBrush2D?b.fillSolidColor=d.color:d instanceof c.GradientColorBrush2D&&(b.fillGradientColor1=d.color1,b.fillGradientColor2=d.color2,d=c.Matrix.Compose(new c.Vector3(d.scale,d.scale,d.scale),c.Quaternion.RotationAxis(new c.Vector3(0,0,1),d.rotation),new c.Vector3(d.translation.x,d.translation.y,0)),d=new c.Vector4(d.m[1],d.m[5],d.m[9],d.m[13]),b.fillGradientTY=d)}}else b.id===a.SHAPE2D_BORDERPARTID&&this.border&&
(b.borderThickness=this.borderThickness,d=this.border,d instanceof c.SolidColorBrush2D?b.borderSolidColor=d.color:d instanceof c.GradientColorBrush2D&&(b.borderGradientColor1=d.color1,b.borderGradientColor2=d.color2,d=c.Matrix.Compose(new c.Vector3(d.scale,d.scale,d.scale),c.Quaternion.RotationAxis(new c.Vector3(0,0,1),d.rotation),new c.Vector3(d.translation.x,d.translation.y,0)),d=new c.Vector4(d.m[1],d.m[5],d.m[9],d.m[13]),b.borderGradientTY=d));return!0},a.prototype._updateTransparencyStatus=function(){this.isTransparent=
this._border&&this._border.isTransparent()||this._fill&&this._fill.isTransparent()},a.SHAPE2D_BORDERPARTID=1,a.SHAPE2D_FILLPARTID=2,a.SHAPE2D_CATEGORY_BORDER="Border",a.SHAPE2D_CATEGORY_BORDERSOLID="BorderSolid",a.SHAPE2D_CATEGORY_BORDERGRADIENT="BorderGradient",a.SHAPE2D_CATEGORY_FILLSOLID="FillSolid",a.SHAPE2D_CATEGORY_FILLGRADIENT="FillGradient",a.SHAPE2D_PROPCOUNT=c.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+5,__decorate([c.modelLevelProperty(c.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+1,function(b){return a.borderProperty=
b},!0)],a.prototype,"border",null),__decorate([c.modelLevelProperty(c.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+2,function(b){return a.fillProperty=b},!0)],a.prototype,"fill",null),__decorate([c.instanceLevelProperty(c.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+3,function(b){return a.borderThicknessProperty=b})],a.prototype,"borderThickness",null),a=__decorate([c.className("Shape2D")],a));c.Shape2D=f;var b=c.InstanceDataBase,d=function(){b.apply(this,arguments)};f=(__extends(d,b),Object.defineProperty(d.prototype,
"fillSolidColor",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"fillGradientColor1",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"fillGradientColor2",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"fillGradientTY",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"borderThickness",{get:function(){return null},
enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"borderSolidColor",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"borderGradientColor1",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"borderGradientColor2",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"borderGradientTY",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([c.instanceData(f.SHAPE2D_CATEGORY_FILLSOLID)],
d.prototype,"fillSolidColor",null),__decorate([c.instanceData(f.SHAPE2D_CATEGORY_FILLGRADIENT)],d.prototype,"fillGradientColor1",null),__decorate([c.instanceData(f.SHAPE2D_CATEGORY_FILLGRADIENT)],d.prototype,"fillGradientColor2",null),__decorate([c.instanceData(f.SHAPE2D_CATEGORY_FILLGRADIENT)],d.prototype,"fillGradientTY",null),__decorate([c.instanceData(f.SHAPE2D_CATEGORY_BORDER)],d.prototype,"borderThickness",null),__decorate([c.instanceData(f.SHAPE2D_CATEGORY_BORDERSOLID)],d.prototype,"borderSolidColor",
null),__decorate([c.instanceData(f.SHAPE2D_CATEGORY_BORDERGRADIENT)],d.prototype,"borderGradientColor1",null),__decorate([c.instanceData(f.SHAPE2D_CATEGORY_BORDERGRADIENT)],d.prototype,"borderGradientColor2",null),__decorate([c.instanceData(f.SHAPE2D_CATEGORY_BORDERGRADIENT)],d.prototype,"borderGradientTY",null),d);c.Shape2DInstanceData=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Prim2DBase,a=function(b){null==b&&(b={});null==b.origin&&(b.origin=new c.Vector2(0,0));e.call(this,b);var d=b.size||b.width||b.height?b.size||new c.Size(b.width||0,b.height||0):null;(this._trackedNode=null==b.trackNode?null:b.trackNode)&&this.owner&&this.owner._registerTrackedNode(this);this._cacheBehavior=null==b.cacheBehavior?a.GROUPCACHEBEHAVIOR_FOLLOWCACHESTRATEGY:b.cacheBehavior;this.size=d;this._viewportPosition=c.Vector2.Zero()};f=(__extends(a,e),a._createCachedCanvasGroup=
function(b){return new a({parent:b,id:"__cachedCanvasGroup__",position:c.Vector2.Zero(),origin:c.Vector2.Zero(),size:null,isVisible:!0})},a.prototype.applyCachedTexture=function(a,b){if(this._bindCacheTarget(),a)for(var d=a.uvs,e=this._renderableData._cacheNode.UVs,f=0;4>f;f++)d[2*f+0]=e[f].x,d[2*f+1]=e[f].y;b&&(b.diffuseTexture=this._renderableData._cacheTexture,b.emissiveColor=new c.Color3(1,1,1));this._renderableData._cacheTexture.hasAlpha=!0;this._unbindCacheTarget()},Object.defineProperty(a.prototype,
"cachedRect",{get:function(){return this._renderableData?this._renderableData._cacheNode:null},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cacheTexture",{get:function(){return this._renderableData?this._renderableData._cacheTexture:null},enumerable:!0,configurable:!0}),a.prototype.dispose=function(){return e.prototype.dispose.call(this)?(null!=this._trackedNode&&(this.owner._unregisterTrackedNode(this),this._trackedNode=null),this._renderableData&&(this._renderableData.dispose(),
this._renderableData=null),!0):!1},Object.defineProperty(a.prototype,"isRenderableGroup",{get:function(){return this._isRenderableGroup},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isCachedGroup",{get:function(){return this._isCachedGroup},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"size",{get:function(){return this._size},set:function(a){this._size=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"viewportSize",{get:function(){return this._viewportSize},
enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"actualSize",{get:function(){var b;this._size?b=new c.Size(Math.ceil(this._size.width),Math.ceil(this._size.height)):(b=this.boundingInfo.max(),b=new c.Size(Math.ceil(b.x),Math.ceil(b.y)));return b.equals(this._actualSize)||(this.onPrimitivePropertyDirty(a.actualSizeProperty.flagId),this._actualSize=b,this.handleGroupChanged(a.actualSizeProperty)),b},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cacheBehavior",
{get:function(){return this._cacheBehavior},enumerable:!0,configurable:!0}),a.prototype._addPrimToDirtyList=function(a){this._renderableData._primDirtyList.push(a)},a.prototype._renderCachedCanvas=function(){this.updateCachedStates(!0);var a=new c.PrepareRender2DContext;this._prepareGroupRender(a);this._groupRender()},Object.defineProperty(a.prototype,"trackedNode",{get:function(){return this._trackedNode},set:function(a){null!=a?(this._isFlagSet(c.SmartPropertyPrim.flagTrackedGroup)||this.owner._registerTrackedNode(this),
this._trackedNode=a):(this._isFlagSet(c.SmartPropertyPrim.flagTrackedGroup)&&this.owner._unregisterTrackedNode(this),this._trackedNode=null)},enumerable:!0,configurable:!0}),a.prototype.levelIntersect=function(){return!0},a.prototype.updateLevelBoundingInfo=function(){var a;a=this.size?this.size:new c.Size(0,0);c.BoundingInfo2D.CreateFromSizeToRef(a,this._levelBoundingInfo)},a.prototype._prepareGroupRender=function(a){var b=null;if((0<this._renderableData._primDirtyList.length||a.forceRefreshPrimitive)&&
(b=this._renderableData._primDirtyList.sort(function(a,b){return a.hierarchyDepth-b.hierarchyDepth}),this.updateCachedStatesOf(b,!0)),this._isCachedGroup){var d=this.actualSize.clone();d.equals(this._viewportSize)||(a.forceRefreshPrimitive=!0);this._viewportSize=d}else{var e=this._globalTransform.getTranslation(),d=this.actualSize.clone(),f=this.owner._renderingSize;d.height=Math.min(d.height,f.height-e.y);d.width=Math.min(d.width,f.width-e.x);f=e.y;this._viewportPosition.x=e.x;this._viewportPosition.y=
f;e=d.width;d=d.height;this._viewportSize?(this._viewportSize.width===e&&this._viewportSize.height===d||(a.forceRefreshPrimitive=!0),this._viewportSize.width=e,this._viewportSize.height=d):this._viewportSize=new c.Size(e,d)}if(0<this._renderableData._primDirtyList.length||a.forceRefreshPrimitive)if(this._cacheGroupDirty=this._isCachedGroup,a.forceRefreshPrimitive){b=0;for(d=this._children;b<d.length;b++)d[b]._prepareRender(a)}else b||(b=this._renderableData._primDirtyList.sort(function(a,b){return a.hierarchyDepth-
b.hierarchyDepth})),b.forEach(function(b){!b.isDisposed&&b._needPrepare()&&b._prepareRender(a)}),this._renderableData._primDirtyList.forEach(function(a){return a._resetPropertiesDirty()}),this._renderableData._primDirtyList.splice(0);this._renderableData._childrenRenderableGroups.forEach(function(b){b._prepareGroupRender(a)})},a.prototype._groupRender=function(){for(var a=this,b=this.owner.engine,d=0,e=0,f=this._renderableData._childrenRenderableGroups;e<f.length;e++)f[e]._groupRender();if(!this.isCachedGroup||
this._cacheGroupDirty){if(this.isCachedGroup)this._bindCacheTarget();else var k=b.setDirectViewport(this._viewportPosition.x,this._viewportPosition.y,this._viewportSize.width,this._viewportSize.height);e=!0===b.getAlphaTesting();f=!0===b.getDepthWrite();b.setAlphaTesting(!1);b.setDepthWrite(!0);var n=new c.Render2DContext(c.Render2DContext.RenderModeOpaque);this._renderableData._renderGroupInstancesInfo.forEach(function(c,e){var f=a._prepareContext(b,n,e);if(null!==f&&(!a.owner.supportInstancedArray||
0<f))f=!e.modelRenderCache.render(e,n),e.opaqueDirty=f,d+=f?1:0});b.setAlphaTesting(!0);b.setDepthWrite(!0);n=new c.Render2DContext(c.Render2DContext.RenderModeAlphaTest);this._renderableData._renderGroupInstancesInfo.forEach(function(c,e){var f=a._prepareContext(b,n,e);if(null!==f&&(!a.owner.supportInstancedArray||0<f))f=!e.modelRenderCache.render(e,n),e.opaqueDirty=f,d+=f?1:0});b.setAlphaTesting(!0);b.setDepthWrite(!1);this._renderableData._transparentListChanged&&this._updateTransparentData();
d+=this._renderTransparentData();this._cacheGroupDirty=0!==d;this.isCachedGroup?this._unbindCacheTarget():k&&b.setViewport(k);b.setAlphaTesting(e);b.setDepthWrite(f)}},a.prototype._updateTransparentData=function(){var a=this._renderableData;if(null!==a._firstChangedPrim){a._transparentPrimitives.sort(function(a,b){return b._primitive.actualZOffset-a._primitive.actualZOffset});a._transparentSegments.splice(0);for(var b=null,d=0;d<a._transparentPrimitives.length;d++){var e=a._transparentPrimitives[d];
e._groupInstanceInfo.transparentOrderDirty&&e._groupInstanceInfo.sortTransparentData();e._transparentSegment=null;if(b){var f=a._transparentPrimitives[d];if(b.groupInsanceInfo===f._groupInstanceInfo){var k=f._primitive.actualZOffset;f._transparentSegment=b;k<b.endZ&&(b.endZ=k,b.endDataIndex=f._primitive._getLastIndexInDataBuffer()+1)}}e._transparentSegment||(b=new c.TransparentSegment,b.groupInsanceInfo=e._groupInstanceInfo,f=e._primitive,b.startZ=f.actualZOffset,b.startDataIndex=f._getFirstIndexInDataBuffer(),
b.endDataIndex=f._getLastIndexInDataBuffer()+1,b.endZ=b.startZ,e._transparentSegment=b,a._transparentSegments.push(b));b=e._transparentSegment}a._firstChangedPrim=null;a._transparentListChanged=!1}},a.prototype._renderTransparentData=function(){for(var a=0,b=new c.Render2DContext(c.Render2DContext.RenderModeTransparent),d=this._renderableData,e=d._transparentSegments.length,f=0;e>f;f++){var k=d._transparentSegments[f],n=k.groupInsanceInfo,q=n.modelRenderCache;b.useInstancing=!1;b.partDataStartIndex=
k.startDataIndex;b.partDataEndIndex=k.endDataIndex;b.groupInfoPartData=n.transparentData;k=!q.render(n,b);a+=k?1:0}return a},a.prototype._prepareContext=function(a,b,d){var e,f,k=null;switch(b.renderMode){case c.Render2DContext.RenderModeOpaque:if(!d.hasOpaqueData)return null;e=function(a){d.opaqueDirty=a};f=function(){return d.opaqueDirty};k=b.groupInfoPartData=d.opaqueData;break;case c.Render2DContext.RenderModeAlphaTest:if(!d.hasAlphaTestData)return null;e=function(a){d.alphaTestDirty=a};f=function(){return d.alphaTestDirty};
k=b.groupInfoPartData=d.alphaTestData;break;default:throw Error("_prepareContext is only for opaque or alphaTest");}var n=0;if(this.owner.supportInstancedArray){b.useInstancing=!0;for(var q=0;q<k.length;q++){b=k[q];var p=b._partData,r=p.pack(),n=n+p.usedElementCount,p=4*p.usedElementCount*p.stride;!b._partBuffer||b._partBufferSize<p?(b._partBuffer&&a.deleteInstancesBuffer(b._partBuffer),b._partBuffer=a.createInstancesBuffer(p),b._partBufferSize=p,e(!1),a.updateArrayBuffer(r)):f()&&(a.bindArrayBuffer(b._partBuffer),
a.updateArrayBuffer(r))}e(!1)}else{for(q=b.partDataStartIndex=0;!b.groupInfoPartData[q];)q++;b.partDataEndIndex=b.groupInfoPartData[q]._partData.usedElementCount}return n},a.prototype._bindCacheTarget=function(){var a,b,d=this._renderableData;if(d._cacheNode){var e=d._cacheNode.contentSize,f=Math.ceil(this.actualSize.width),k=Math.ceil(this.actualSize.height);(e.width<f||e.height<k)&&(a=Math.floor(1.07*e.width),b=Math.floor(1.07*e.height),d._cacheTexture.freeRect(d._cacheNode),d._cacheNode=null)}d._cacheNode||
(a=this.owner._allocateGroupCache(this,this.renderGroup,a?new c.Size(a,b):null),d._cacheNode=a.node,d._cacheTexture=a.texture,d._cacheRenderSprite=a.sprite);d._cacheTexture.bindTextureForPosSize(d._cacheNode.pos,this.actualSize,!0)},a.prototype._unbindCacheTarget=function(){this._renderableData._cacheTexture&&this._renderableData._cacheTexture.unbindTexture()},a.prototype.handleGroupChanged=function(b){var d=this._renderableData;this.isCachedGroup&&d._cacheRenderSprite&&(b.id===c.Prim2DBase.actualPositionProperty.id?
d._cacheRenderSprite.actualPosition=this.actualPosition.clone():b.id===c.Prim2DBase.rotationProperty.id?d._cacheRenderSprite.rotation=this.rotation:b.id===c.Prim2DBase.scaleProperty.id?d._cacheRenderSprite.scale=this.scale:b.id===c.Prim2DBase.originProperty.id?d._cacheRenderSprite.origin=this.origin.clone():b.id===a.actualSizeProperty.id&&(d._cacheRenderSprite.size=this.actualSize.clone()))},a.prototype.detectGroupStates=function(){var d=this instanceof c.Canvas2D,g=this.owner.cachingStrategy;g===
c.Canvas2D.CACHESTRATEGY_DONTCACHE?(this._isRenderableGroup=d,this._isCachedGroup=!1):g===c.Canvas2D.CACHESTRATEGY_CANVAS?d?(this._isRenderableGroup=!0,this._isCachedGroup=!0):(this._isRenderableGroup="__cachedCanvasGroup__"===this.id,this._isCachedGroup=!1):g===c.Canvas2D.CACHESTRATEGY_TOPLEVELGROUPS?d?(this._isRenderableGroup=!0,this._isCachedGroup=!1):1===this.hierarchyDepth?(this._isRenderableGroup=!0,this._isCachedGroup=!0):(this._isRenderableGroup=!1,this._isCachedGroup=!1):g===c.Canvas2D.CACHESTRATEGY_ALLGROUPS&&
(d=this.cacheBehavior,d!==a.GROUPCACHEBEHAVIOR_DONTCACHEOVERRIDE&&d!==a.GROUPCACHEBEHAVIOR_CACHEINPARENTGROUP||(this._isRenderableGroup=d===a.GROUPCACHEBEHAVIOR_DONTCACHEOVERRIDE,this._isCachedGroup=!1),d===a.GROUPCACHEBEHAVIOR_FOLLOWCACHESTRATEGY&&(this._isRenderableGroup=!0,this._isCachedGroup=!0));if(this._isRenderableGroup&&(this._renderableData||(this._renderableData=new b)),this._isCachedGroup)for(d=this.parent;d;){if(d instanceof a&&d._isRenderableGroup){-1===d._renderableData._childrenRenderableGroups.indexOf(this)&&
d._renderableData._childrenRenderableGroups.push(this);break}d=d.parent}},a.GROUP2D_PROPCOUNT=c.Prim2DBase.PRIM2DBASE_PROPCOUNT+5,a.GROUPCACHEBEHAVIOR_FOLLOWCACHESTRATEGY=0,a.GROUPCACHEBEHAVIOR_DONTCACHEOVERRIDE=1,a.GROUPCACHEBEHAVIOR_CACHEINPARENTGROUP=2,__decorate([c.instanceLevelProperty(c.Prim2DBase.PRIM2DBASE_PROPCOUNT+1,function(b){return a.sizeProperty=b},!1,!0)],a.prototype,"size",null),__decorate([c.instanceLevelProperty(c.Prim2DBase.PRIM2DBASE_PROPCOUNT+2,function(b){return a.actualSizeProperty=
b})],a.prototype,"actualSize",null),a=__decorate([c.className("Group2D")],a));c.Group2D=f;var b;f=function(){this._primDirtyList=[];this._childrenRenderableGroups=[];this._renderGroupInstancesInfo=new c.StringDictionary;this._transparentPrimitives=[];this._transparentSegments=[];this._firstChangedPrim=null;this._transparentListChanged=!1;this._cacheRenderSprite=this._cacheTexture=this._cacheNode=null};b=(f.prototype.dispose=function(){this._cacheRenderSprite&&(this._cacheRenderSprite.dispose(),this._cacheRenderSprite=
null);this._cacheTexture&&this._cacheNode&&(this._cacheTexture.freeRect(this._cacheNode),this._cacheTexture=null,this._cacheNode=null);this._primDirtyList&&(this._primDirtyList.splice(0),this._primDirtyList=null);this._renderGroupInstancesInfo&&(this._renderGroupInstancesInfo.forEach(function(a,b){b.dispose()}),this._renderGroupInstancesInfo=null)},f.prototype.addNewTransparentPrimitiveInfo=function(a,b){var c=new d;return c._primitive=a,c._groupInstanceInfo=b,c._transparentSegment=null,this._transparentPrimitives.push(c),
this._transparentListChanged=!0,this.updateSmallestZChangedPrim(c),c},f.prototype.removeTransparentPrimitiveInfo=function(a){var b=this._transparentPrimitives.indexOf(a);-1!==b&&(this._transparentPrimitives.splice(b,1),this._transparentListChanged=!0,this.updateSmallestZChangedPrim(a))},f.prototype.transparentPrimitiveZChanged=function(a){this._transparentListChanged=!0;this.updateSmallestZChangedPrim(a)},f.prototype.updateSmallestZChangedPrim=function(a){a._primitive&&a._primitive.actualZOffset>
(this._firstChangedPrim?this._firstChangedPrim._primitive.actualZOffset:Number.MIN_VALUE)&&(this._firstChangedPrim=a)},f);c.RenderableGroupData=b;var d;d=function(){};c.TransparentPrimitiveInfo=d}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.ModelRenderCache,a=function(a,b){e.call(this,a,b);this.effectsReady=!1;this.fillIB=this.fillVB=null;this.fillIndicesCount=0;this.borderIB=this.borderVB=this.effectFillInstanced=this.effectFill=this.instancingFillAttributes=null;this.borderIndicesCount=0;this.effectBorderInstanced=this.effectBorder=this.instancingBorderAttributes=null};f=(__extends(a,e),a.prototype.render=function(a,b){if(!this.effectsReady){if(this.effectFill&&(!this.effectFill.isReady()||this.effectFillInstanced&&
!this.effectFillInstanced.isReady())||this.effectBorder&&(!this.effectBorder.isReady()||this.effectBorderInstanced&&!this.effectBorderInstanced.isReady()))return!1;this.effectsReady=!0}var d=a.owner.owner.engine,g=0;this.effectFill&&this.effectBorder&&(g=d.getDepthFunction(),d.setDepthFunctionToLessOrEqual());var e=d.getAlphaMode();if(this.effectFill){var f=a.partIndexFromId.get(c.Shape2D.SHAPE2D_FILLPARTID.toString()),j=b.groupInfoPartData[f];b.renderMode!==c.Render2DContext.RenderModeOpaque&&d.setAlphaMode(c.Engine.ALPHA_COMBINE);
var r=b.useInstancing?this.effectFillInstanced:this.effectFill;if(d.enableEffect(r),d.bindBuffersDirectly(this.fillVB,this.fillIB,[1],4,r),b.useInstancing)this.instancingFillAttributes||(this.instancingFillAttributes=this.loadInstancingAttributes(c.Shape2D.SHAPE2D_FILLPARTID,r)),d.updateAndBindInstancesBuffer(j._partBuffer,null,this.instancingFillAttributes),d.draw(!0,0,this.fillIndicesCount,j._partData.usedElementCount),d.unbindInstanceAttributes();else for(var t=b.partDataStartIndex;t<b.partDataEndIndex;t++)this.setupUniforms(r,
f,j._partData,t),d.draw(!0,0,this.fillIndicesCount)}if(this.effectBorder)if(f=a.partIndexFromId.get(c.Shape2D.SHAPE2D_BORDERPARTID.toString()),j=b.groupInfoPartData[f],b.renderMode!==c.Render2DContext.RenderModeOpaque&&d.setAlphaMode(c.Engine.ALPHA_COMBINE),r=b.useInstancing?this.effectBorderInstanced:this.effectBorder,d.enableEffect(r),d.bindBuffersDirectly(this.borderVB,this.borderIB,[1],4,r),b.useInstancing)this.instancingBorderAttributes||(this.instancingBorderAttributes=this.loadInstancingAttributes(c.Shape2D.SHAPE2D_BORDERPARTID,
r)),d.updateAndBindInstancesBuffer(j._partBuffer,null,this.instancingBorderAttributes),d.draw(!0,0,this.borderIndicesCount,j._partData.usedElementCount),d.unbindInstanceAttributes();else for(t=b.partDataStartIndex;t<b.partDataEndIndex;t++)this.setupUniforms(r,f,j._partData,t),d.draw(!0,0,this.borderIndicesCount);return d.setAlphaMode(e),this.effectFill&&this.effectBorder&&d.setDepthFunction(g),!0},a.prototype.dispose=function(){return e.prototype.dispose.call(this)?(this.fillVB&&(this._engine._releaseBuffer(this.fillVB),
this.fillVB=null),this.fillIB&&(this._engine._releaseBuffer(this.fillIB),this.fillIB=null),this.effectFill&&(this._engine._releaseEffect(this.effectFill),this.effectFill=null),this.effectFillInstanced&&(this._engine._releaseEffect(this.effectFillInstanced),this.effectFillInstanced=null),this.borderVB&&(this._engine._releaseBuffer(this.borderVB),this.borderVB=null),this.borderIB&&(this._engine._releaseBuffer(this.borderIB),this.borderIB=null),this.effectBorder&&(this._engine._releaseEffect(this.effectBorder),
this.effectBorder=null),this.effectBorderInstanced&&(this._engine._releaseEffect(this.effectBorderInstanced),this.effectBorderInstanced=null),!0):!1},a);c.Rectangle2DRenderCache=f;var b,d=c.Shape2DInstanceData,a=function(a){d.call(this,a,1)};b=(__extends(a,d),Object.defineProperty(a.prototype,"properties",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([c.instanceData()],a.prototype,"properties",null),a);c.Rectangle2DInstanceData=b;var j=c.Shape2D,g=function(a){if(null==a&&
(a={}),j.call(this,a),null!=a.size)this.size=a.size;else if(a.width||a.height)this.size=new c.Size(a.width,a.height);var b=null==a.borderThickness?1:a.borderThickness;this.roundRadius=null==a.roundRadius?0:a.roundRadius;this.borderThickness=b},a=(__extends(g,j),Object.defineProperty(g.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size},set:function(a){this._actualSize=a},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"notRounded",{get:function(){return this._notRounded},
set:function(a){this._notRounded=a},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"roundRadius",{get:function(){return this._roundRadius},set:function(a){this._roundRadius=a;this.notRounded=0===a;this._positioningDirty()},enumerable:!0,configurable:!0}),g.prototype.levelIntersect=function(a){if(this.notRounded)return!0;var b=this.size;g._i0.x=a._localPickPosition.x;g._i0.y=a._localPickPosition.y;a=this.roundRadius;var c=a*a;return g._i1.x=a,g._i1.y=a,g._i0.x<=g._i1.x&&g._i0.y<=
g._i1.y?(g._i2.x=g._i0.x-g._i1.x,g._i2.y=g._i0.y-g._i1.y,g._i2.lengthSquared()<=c):(g._i1.x=a,g._i1.y=b.height-a,g._i0.x<=g._i1.x&&g._i0.y>=g._i1.y?(g._i2.x=g._i0.x-g._i1.x,g._i2.y=g._i0.y-g._i1.y,g._i2.lengthSquared()<=c):(g._i1.x=b.width-a,g._i1.y=b.height-a,g._i0.x>=g._i1.x&&g._i0.y>=g._i1.y?(g._i2.x=g._i0.x-g._i1.x,g._i2.y=g._i0.y-g._i1.y,g._i2.lengthSquared()<=c):(g._i1.x=b.width-a,g._i1.y=a,g._i0.x>=g._i1.x&&g._i0.y<=g._i1.y?(g._i2.x=g._i0.x-g._i1.x,g._i2.y=g._i0.y-g._i1.y,g._i2.lengthSquared()<=
c):!0)))},g.prototype.updateLevelBoundingInfo=function(){c.BoundingInfo2D.CreateFromSizeToRef(this.actualSize,this._levelBoundingInfo)},g.prototype.createModelRenderCache=function(a){return new f(this.owner.engine,a)},g.prototype.setupModelRenderCache=function(a){var b=this.owner.engine;if(this.fill){for(var d=4*(this.notRounded?1:g.roundSubdivisions)+1,e=new Float32Array(d),f=0;d>f;f++)e[f]=f;a.fillVB=b.createVertexBuffer(e);d-=1;e=new Float32Array(3*d);for(f=0;d>f;f++)e[3*f+0]=0,e[3*f+2]=f+1,e[3*
f+1]=f+2;e[3*d-2]=1;a.fillIB=b.createIndexBuffer(e);a.fillIndicesCount=3*d;(f=this.getDataPartEffectInfo(c.Shape2D.SHAPE2D_FILLPARTID,["index"],!0))&&(a.effectFillInstanced=b.createEffect("rect2d",f.attributes,f.uniforms,[],f.defines,null));f=this.getDataPartEffectInfo(c.Shape2D.SHAPE2D_FILLPARTID,["index"],!1);a.effectFill=b.createEffect("rect2d",f.attributes,f.uniforms,[],f.defines,null)}if(this.border){d=8*(this.notRounded?1:g.roundSubdivisions);e=new Float32Array(d);for(f=0;d>f;f++)e[f]=f;a.borderVB=
b.createVertexBuffer(e);for(var j=d/2,e=new Float32Array(3*d),f=0;j>f;f++){var p=f,r=(f+1)%j;e[6*f+0]=j+r;e[6*f+1]=j+p;e[6*f+2]=p;e[6*f+3]=r;e[6*f+4]=j+r;e[6*f+5]=p}a.borderIB=b.createIndexBuffer(e);a.borderIndicesCount=3*d;(f=this.getDataPartEffectInfo(c.Shape2D.SHAPE2D_BORDERPARTID,["index"],!0))&&(a.effectBorderInstanced=b.createEffect("rect2d",f.attributes,f.uniforms,[],f.defines,null));f=this.getDataPartEffectInfo(c.Shape2D.SHAPE2D_BORDERPARTID,["index"],!1);a.effectBorder=b.createEffect("rect2d",
f.attributes,f.uniforms,[],f.defines,null)}return a},g.prototype._getInitialContentAreaToRef=function(a,b,c){if(this._notRounded)j.prototype._getInitialContentAreaToRef.call(this,a,b,c);else{var d=Math.round(1.3*(this.roundRadius-this.roundRadius/Math.sqrt(2)));b.x=b.y=d;c.width=Math.max(0,a.width-2*d);c.height=Math.max(0,a.height-2*d)}},g.prototype.createInstanceDataParts=function(){var a=[];return this.border&&a.push(new b(c.Shape2D.SHAPE2D_BORDERPARTID)),this.fill&&a.push(new b(c.Shape2D.SHAPE2D_FILLPARTID)),
a},g.prototype.refreshInstanceDataPart=function(a){if(!j.prototype.refreshInstanceDataPart.call(this,a))return!1;if(a.id===c.Shape2D.SHAPE2D_BORDERPARTID){var b=this.actualSize;a.properties=new c.Vector3(b.width,b.height,this.roundRadius||0)}else a.id===c.Shape2D.SHAPE2D_FILLPARTID&&(b=this.actualSize,a.properties=new c.Vector3(b.width,b.height,this.roundRadius||0));return!0},g._i0=c.Vector2.Zero(),g._i1=c.Vector2.Zero(),g._i2=c.Vector2.Zero(),g.roundSubdivisions=16,__decorate([c.instanceLevelProperty(c.Shape2D.SHAPE2D_PROPCOUNT+
1,function(a){return g.actualSizeProperty=a},!1,!0)],g.prototype,"actualSize",null),__decorate([c.modelLevelProperty(c.Shape2D.SHAPE2D_PROPCOUNT+2,function(a){return g.notRoundedProperty=a})],g.prototype,"notRounded",null),__decorate([c.instanceLevelProperty(c.Shape2D.SHAPE2D_PROPCOUNT+3,function(a){return g.roundRadiusProperty=a})],g.prototype,"roundRadius",null),g=__decorate([c.className("Rectangle2D")],g));c.Rectangle2D=a}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.ModelRenderCache,a=function(a,b){e.call(this,a,b);this.effectsReady=!1;this.fillIB=this.fillVB=null;this.fillIndicesCount=0;this.borderIB=this.borderVB=this.effectFill=this.effectFillInstanced=this.instancingFillAttributes=null;this.borderIndicesCount=0;this.effectBorder=this.effectBorderInstanced=this.instancingBorderAttributes=null};f=(__extends(a,e),a.prototype.render=function(a,b){if(!this.effectsReady){if(this.effectFill&&(!this.effectFill.isReady()||this.effectFillInstanced&&
!this.effectFillInstanced.isReady())||this.effectBorder&&(!this.effectBorder.isReady()||this.effectBorderInstanced&&!this.effectBorderInstanced.isReady()))return!1;this.effectsReady=!0}var d=a.owner.owner.engine,g=0;this.effectFill&&this.effectBorder&&(g=d.getDepthFunction(),d.setDepthFunctionToLessOrEqual());var e=d.getAlphaMode();if(this.effectFill){var f=a.partIndexFromId.get(c.Shape2D.SHAPE2D_FILLPARTID.toString()),j=b.groupInfoPartData[f];b.renderMode!==c.Render2DContext.RenderModeOpaque&&d.setAlphaMode(c.Engine.ALPHA_COMBINE);
var r=b.useInstancing?this.effectFillInstanced:this.effectFill;if(d.enableEffect(r),d.bindBuffersDirectly(this.fillVB,this.fillIB,[1],4,r),b.useInstancing)this.instancingFillAttributes||(this.instancingFillAttributes=this.loadInstancingAttributes(c.Shape2D.SHAPE2D_FILLPARTID,r)),d.updateAndBindInstancesBuffer(j._partBuffer,null,this.instancingFillAttributes),d.draw(!0,0,this.fillIndicesCount,j._partData.usedElementCount),d.unbindInstanceAttributes();else for(var t=b.partDataStartIndex;t<b.partDataEndIndex;t++)this.setupUniforms(r,
f,j._partData,t),d.draw(!0,0,this.fillIndicesCount)}if(this.effectBorder)if(f=a.partIndexFromId.get(c.Shape2D.SHAPE2D_BORDERPARTID.toString()),j=b.groupInfoPartData[f],b.renderMode!==c.Render2DContext.RenderModeOpaque&&d.setAlphaMode(c.Engine.ALPHA_COMBINE),r=b.useInstancing?this.effectBorderInstanced:this.effectBorder,d.enableEffect(r),d.bindBuffersDirectly(this.borderVB,this.borderIB,[1],4,r),b.useInstancing)this.instancingBorderAttributes||(this.instancingBorderAttributes=this.loadInstancingAttributes(c.Shape2D.SHAPE2D_BORDERPARTID,
r)),d.updateAndBindInstancesBuffer(j._partBuffer,null,this.instancingBorderAttributes),d.draw(!0,0,this.borderIndicesCount,j._partData.usedElementCount),d.unbindInstanceAttributes();else for(t=b.partDataStartIndex;t<b.partDataEndIndex;t++)this.setupUniforms(r,f,j._partData,t),d.draw(!0,0,this.borderIndicesCount);return d.setAlphaMode(e),this.effectFill&&this.effectBorder&&d.setDepthFunction(g),!0},a.prototype.dispose=function(){return e.prototype.dispose.call(this)?(this.fillVB&&(this._engine._releaseBuffer(this.fillVB),
this.fillVB=null),this.fillIB&&(this._engine._releaseBuffer(this.fillIB),this.fillIB=null),this.effectFill&&(this._engine._releaseEffect(this.effectFill),this.effectFill=null),this.effectFillInstanced&&(this._engine._releaseEffect(this.effectFillInstanced),this.effectFillInstanced=null),this.borderVB&&(this._engine._releaseBuffer(this.borderVB),this.borderVB=null),this.borderIB&&(this._engine._releaseBuffer(this.borderIB),this.borderIB=null),this.effectBorder&&(this._engine._releaseEffect(this.effectBorder),
this.effectBorder=null),this.effectBorderInstanced&&(this._engine._releaseEffect(this.effectBorderInstanced),this.effectBorderInstanced=null),!0):!1},a);c.Ellipse2DRenderCache=f;var b,d=c.Shape2DInstanceData,a=function(a){d.call(this,a,1)};b=(__extends(a,d),Object.defineProperty(a.prototype,"properties",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([c.instanceData()],a.prototype,"properties",null),a);c.Ellipse2DInstanceData=b;var j=c.Shape2D,g=function(a){if(null==a&&(a=
{}),j.call(this,a),null!=a.size)this.size=a.size;else if(a.width||a.height)this.size=new c.Size(a.width,a.height);this.subdivisions=null==a.subdivisions?64:a.subdivisions},a=(__extends(g,j),Object.defineProperty(g.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size},set:function(a){this._actualSize=a},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"subdivisions",{get:function(){return this._subdivisions},set:function(a){this._subdivisions=a},
enumerable:!0,configurable:!0}),g.prototype.levelIntersect=function(a){var b=this.size.width/2,c=this.size.height/2,d=a._localPickPosition.x-b;a=a._localPickPosition.y-c;return 1>=d*d/(b*b)+a*a/(c*c)},g.prototype.updateLevelBoundingInfo=function(){c.BoundingInfo2D.CreateFromSizeToRef(this.actualSize,this._levelBoundingInfo)},g.prototype.createModelRenderCache=function(a){return new f(this.owner.engine,a)},g.prototype.setupModelRenderCache=function(a){var b=this.owner.engine;if(this.fill){for(var d=
this.subdivisions+1,g=new Float32Array(d),e=0;d>e;e++)g[e]=e;a.fillVB=b.createVertexBuffer(g);d-=1;g=new Float32Array(3*d);for(e=0;d>e;e++)g[3*e+0]=0,g[3*e+2]=e+1,g[3*e+1]=e+2;g[3*d-2]=1;a.fillIB=b.createIndexBuffer(g);a.fillIndicesCount=3*d;(e=this.getDataPartEffectInfo(c.Shape2D.SHAPE2D_FILLPARTID,["index"],!0))&&(a.effectFillInstanced=b.createEffect({vertex:"ellipse2d",fragment:"ellipse2d"},e.attributes,e.uniforms,[],e.defines,null));e=this.getDataPartEffectInfo(c.Shape2D.SHAPE2D_FILLPARTID,["index"],
!1);a.effectFill=b.createEffect({vertex:"ellipse2d",fragment:"ellipse2d"},e.attributes,e.uniforms,[],e.defines,null)}if(this.border){d=2*this.subdivisions;g=new Float32Array(d);for(e=0;d>e;e++)g[e]=e;a.borderVB=b.createVertexBuffer(g);for(var f=d/2,g=new Float32Array(3*d),e=0;f>e;e++){var j=e,r=(e+1)%f;g[6*e+0]=f+r;g[6*e+1]=f+j;g[6*e+2]=j;g[6*e+3]=r;g[6*e+4]=f+r;g[6*e+5]=j}a.borderIB=b.createIndexBuffer(g);a.borderIndicesCount=3*d;(e=this.getDataPartEffectInfo(c.Shape2D.SHAPE2D_BORDERPARTID,["index"],
!0))&&(a.effectBorderInstanced=b.createEffect("ellipse2d",e.attributes,e.uniforms,[],e.defines,null));e=this.getDataPartEffectInfo(c.Shape2D.SHAPE2D_BORDERPARTID,["index"],!1);a.effectBorder=b.createEffect("ellipse2d",e.attributes,e.uniforms,[],e.defines,null)}return a},g.prototype.createInstanceDataParts=function(){var a=[];return this.border&&a.push(new b(c.Shape2D.SHAPE2D_BORDERPARTID)),this.fill&&a.push(new b(c.Shape2D.SHAPE2D_FILLPARTID)),a},g.prototype.refreshInstanceDataPart=function(a){if(!j.prototype.refreshInstanceDataPart.call(this,
a))return!1;if(a.id===c.Shape2D.SHAPE2D_BORDERPARTID){var b=this.actualSize;a.properties=new c.Vector3(b.width,b.height,this.subdivisions)}else a.id===c.Shape2D.SHAPE2D_FILLPARTID&&(b=this.actualSize,a.properties=new c.Vector3(b.width,b.height,this.subdivisions));return!0},__decorate([c.instanceLevelProperty(c.Shape2D.SHAPE2D_PROPCOUNT+1,function(a){return g.acutalSizeProperty=a},!1,!0)],g.prototype,"actualSize",null),__decorate([c.modelLevelProperty(c.Shape2D.SHAPE2D_PROPCOUNT+2,function(a){return g.subdivisionsProperty=
a})],g.prototype,"subdivisions",null),g=__decorate([c.className("Ellipse2D")],g));c.Ellipse2D=a}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.ModelRenderCache,a=function(){e.apply(this,arguments);this.effectsReady=!1;this.effectInstanced=this.effect=this.texture=this.instancingAttributes=this.ib=this.vb=null};f=(__extends(a,e),a.prototype.render=function(a,b){if(!this.effectsReady){if(this.effect&&(!this.effect.isReady()||this.effectInstanced&&!this.effectInstanced.isReady()))return!1;this.effectsReady=!0}var d=a.owner.owner.engine,g=b.useInstancing?this.effectInstanced:this.effect;d.enableEffect(g);g.setTexture("diffuseSampler",
this.texture);d.bindBuffersDirectly(this.vb,this.ib,[1],4,g);var e=d.getAlphaMode();b.renderMode!==c.Render2DContext.RenderModeOpaque&&d.setAlphaMode(c.Engine.ALPHA_COMBINE);var h=b.groupInfoPartData[0];if(b.useInstancing)this.instancingAttributes||(this.instancingAttributes=this.loadInstancingAttributes(j.SPRITE2D_MAINPARTID,g)),d.updateAndBindInstancesBuffer(h._partBuffer,null,this.instancingAttributes),d.draw(!0,0,6,h._partData.usedElementCount),d.unbindInstanceAttributes();else for(var f=b.partDataStartIndex;f<
b.partDataEndIndex;f++)this.setupUniforms(g,0,h._partData,f),d.draw(!0,0,6);return d.setAlphaMode(e),!0},a.prototype.dispose=function(){return e.prototype.dispose.call(this)?(this.vb&&(this._engine._releaseBuffer(this.vb),this.vb=null),this.ib&&(this._engine._releaseBuffer(this.ib),this.ib=null),this.texture&&(this.texture.dispose(),this.texture=null),this.effect&&(this._engine._releaseEffect(this.effect),this.effect=null),this.effectInstanced&&(this._engine._releaseEffect(this.effectInstanced),this.effectInstanced=
null),!0):!1},a);c.Sprite2DRenderCache=f;var b,d=c.InstanceDataBase,a=function(a){d.call(this,a,1)};b=(__extends(a,d),Object.defineProperty(a.prototype,"topLeftUV",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"sizeUV",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"textureSize",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"properties",{get:function(){return null},
enumerable:!0,configurable:!0}),__decorate([c.instanceData()],a.prototype,"topLeftUV",null),__decorate([c.instanceData()],a.prototype,"sizeUV",null),__decorate([c.instanceData()],a.prototype,"textureSize",null),__decorate([c.instanceData()],a.prototype,"properties",null),a);c.Sprite2DInstanceData=b;var j,g=c.RenderablePrim2D,h=function(a,b){if(b||(b={}),g.call(this,b),this.texture=a,this.texture.wrapU=c.Texture.CLAMP_ADDRESSMODE,this.texture.wrapV=c.Texture.CLAMP_ADDRESSMODE,this.size=b.spriteSize||
null,this.spriteLocation=b.spriteLocation||new c.Vector2(0,0),this.spriteFrame=0,this.invertY=null==b.invertY?!1:b.invertY,this.alignToPixel=null==b.alignToPixel?!0:b.alignToPixel,this._isTransparent=!0,!this.size){var d=a.getSize();this.size=new c.Size(d.width,d.height)}};j=(__extends(h,g),Object.defineProperty(h.prototype,"texture",{get:function(){return this._texture},set:function(a){this._texture=a},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"actualSize",{get:function(){return this._actualSize?
this._actualSize:this.size},set:function(a){this._actualSize=a},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"spriteLocation",{get:function(){return this._location},set:function(a){this._location=a},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"spriteFrame",{get:function(){return this._spriteFrame},set:function(a){this._spriteFrame=a},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"invertY",{get:function(){return this._invertY},set:function(a){this._invertY=
a},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"alignToPixel",{get:function(){return this._alignToPixel},set:function(a){this._alignToPixel=a},enumerable:!0,configurable:!0}),h.prototype.updateLevelBoundingInfo=function(){c.BoundingInfo2D.CreateFromSizeToRef(this.size,this._levelBoundingInfo)},h.prototype.getAnimatables=function(){var a=[];return this.texture&&this.texture.animations&&0<this.texture.animations.length&&a.push(this.texture),a},h.prototype.levelIntersect=function(){return!0},
h._createCachedCanvasSprite=function(a,b,d,g){return new h(b,{parent:a,id:"__cachedCanvasSprite__",position:c.Vector2.Zero(),origin:c.Vector2.Zero(),spriteSize:d,spriteLocation:g,alignToPixel:!0})},h.prototype.createModelRenderCache=function(a){return new f(this.owner.engine,a)},h.prototype.setupModelRenderCache=function(a){for(var b=this.owner.engine,c=new Float32Array(4),d=0;4>d;d++)c[d]=d;a.vb=b.createVertexBuffer(c);c=new Float32Array(6);c[0]=0;c[1]=2;c[2]=1;c[3]=0;c[4]=3;c[5]=2;a.ib=b.createIndexBuffer(c);
a.texture=this.texture;c=this.getDataPartEffectInfo(h.SPRITE2D_MAINPARTID,["index"],!0);return c&&(a.effectInstanced=b.createEffect("sprite2d",c.attributes,c.uniforms,["diffuseSampler"],c.defines,null)),c=this.getDataPartEffectInfo(h.SPRITE2D_MAINPARTID,["index"],!1),a.effect=b.createEffect("sprite2d",c.attributes,c.uniforms,["diffuseSampler"],c.defines,null),a},h.prototype.createInstanceDataParts=function(){return[new b(h.SPRITE2D_MAINPARTID)]},h.prototype.refreshInstanceDataPart=function(a){if(!g.prototype.refreshInstanceDataPart.call(this,
a))return!1;if(a.id===h.SPRITE2D_MAINPARTID){a=this._instanceDataParts[0];var b=this.texture.getBaseSize(),d=this.spriteLocation,e=this.actualSize;a.topLeftUV=new c.Vector2(d.x/b.width,d.y/b.height);d=new c.Vector2(e.width/b.width,e.height/b.height);a.sizeUV=d;h._prop.x=this.spriteFrame;h._prop.y=this.invertY?1:0;h._prop.z=this.alignToPixel?1:0;a.properties=h._prop;a.textureSize=new c.Vector2(b.width,b.height)}return!0},h.SPRITE2D_MAINPARTID=1,h._prop=c.Vector3.Zero(),__decorate([c.modelLevelProperty(c.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+
1,function(a){return h.textureProperty=a})],h.prototype,"texture",null),__decorate([c.instanceLevelProperty(c.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+2,function(a){return h.actualSizeProperty=a},!1,!0)],h.prototype,"actualSize",null),__decorate([c.instanceLevelProperty(c.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+3,function(a){return h.spriteLocationProperty=a})],h.prototype,"spriteLocation",null),__decorate([c.instanceLevelProperty(c.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+4,function(a){return h.spriteFrameProperty=
a})],h.prototype,"spriteFrame",null),__decorate([c.instanceLevelProperty(c.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+5,function(a){return h.invertYProperty=a})],h.prototype,"invertY",null),h=__decorate([c.className("Sprite2D")],h));c.Sprite2D=j}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.ModelRenderCache,a=function(){e.apply(this,arguments);this.effectsReady=!1;this.effectInstanced=this.effect=this.fontTexture=this.instancingAttributes=this.ib=this.vb=null};f=(__extends(a,e),a.prototype.render=function(a,b){if(!this.effectsReady){if(this.effect&&(!this.effect.isReady()||this.effectInstanced&&!this.effectInstanced.isReady()))return!1;this.effectsReady=!0}var d=a.owner.owner.engine;this.fontTexture.update();var g=b.useInstancing?this.effectInstanced:this.effect;
d.enableEffect(g);g.setTexture("diffuseSampler",this.fontTexture);d.bindBuffersDirectly(this.vb,this.ib,[1],4,g);var e=d.getAlphaMode();d.setAlphaMode(c.Engine.ALPHA_COMBINE,!0);var h=b.groupInfoPartData[0];if(b.useInstancing)this.instancingAttributes||(this.instancingAttributes=this.loadInstancingAttributes(j.TEXT2D_MAINPARTID,g)),d.updateAndBindInstancesBuffer(h._partBuffer,null,this.instancingAttributes),d.draw(!0,0,6,h._partData.usedElementCount),d.unbindInstanceAttributes();else for(var f=b.partDataStartIndex;f<
b.partDataEndIndex;f++)this.setupUniforms(g,0,h._partData,f),d.draw(!0,0,6);return d.setAlphaMode(e),!0},a.prototype.dispose=function(){return e.prototype.dispose.call(this)?(this.vb&&(this._engine._releaseBuffer(this.vb),this.vb=null),this.ib&&(this._engine._releaseBuffer(this.ib),this.ib=null),this.fontTexture&&(this.fontTexture.dispose(),this.fontTexture=null),this.effect&&(this._engine._releaseEffect(this.effect),this.effect=null),this.effectInstanced&&(this._engine._releaseEffect(this.effectInstanced),
this.effectInstanced=null),!0):!1},a);c.Text2DRenderCache=f;var b,d=c.InstanceDataBase,a=function(a,b){d.call(this,a,b)};b=(__extends(a,d),Object.defineProperty(a.prototype,"topLeftUV",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"sizeUV",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"textureSize",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"color",
{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([c.instanceData()],a.prototype,"topLeftUV",null),__decorate([c.instanceData()],a.prototype,"sizeUV",null),__decorate([c.instanceData()],a.prototype,"textureSize",null),__decorate([c.instanceData()],a.prototype,"color",null),a);c.Text2DInstanceData=b;var j,g=c.RenderablePrim2D,h=function(a,b){b||(b={});g.call(this,b);this.fontName=null==b.fontName?"12pt Arial":b.fontName;this.defaultFontColor=null==b.defaultFontColor?new c.Color4(1,
1,1,1):b.defaultFontColor;this._tabulationSize=null==b.tabulationSize?4:b.tabulationSize;this._textSize=null;this.text=a;this.size=null==b.size?null:b.size;this.isAlphaTest=!0};j=(__extends(h,g),Object.defineProperty(h.prototype,"fontName",{get:function(){return this._fontName},set:function(a){if(this._fontName)throw Error("Font Name change is not supported right now.");this._fontName=a},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"defaultFontColor",{get:function(){return this._defaultFontColor},
set:function(a){this._defaultFontColor=a},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"text",{get:function(){return this._text},set:function(a){this._text=a;this._size=this._textSize=null;this._updateCharCount();this.textSize},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"size",{get:function(){return null!=this._size?this._size:this.textSize},set:function(a){this._size=a},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"actualSize",{get:function(){return this._actualSize?
this._actualSize:this.size},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"textSize",{get:function(){if(!this._textSize){if(!this.owner)return h.nullSize;var a=this.fontTexture.measureText(this._text,this._tabulationSize);a.equals(this._textSize)||(this.onPrimitivePropertyDirty(c.Prim2DBase.sizeProperty.flagId),this._positioningDirty());this._textSize=a}return this._textSize},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"fontTexture",{get:function(){return this._fontTexture?
this._fontTexture:(this._fontTexture=c.FontTexture.GetCachedFontTexture(this.owner.scene,this.fontName),this._fontTexture)},enumerable:!0,configurable:!0}),h.prototype.dispose=function(){return g.prototype.dispose.call(this)?(this._fontTexture&&(c.FontTexture.ReleaseCachedFontTexture(this.owner.scene,this.fontName),this._fontTexture=null),!0):!1},h.prototype.updateLevelBoundingInfo=function(){c.BoundingInfo2D.CreateFromSizeToRef(this.actualSize,this._levelBoundingInfo)},h.prototype.levelIntersect=
function(){return!0},h.prototype.createModelRenderCache=function(a){return new f(this.owner.engine,a)},h.prototype.setupModelRenderCache=function(a){var b=this.owner.engine;a.fontTexture=this.fontTexture;for(var c=new Float32Array(4),d=0;4>d;d++)c[d]=d;a.vb=b.createVertexBuffer(c);c=new Float32Array(6);c[0]=0;c[1]=2;c[2]=1;c[3]=0;c[4]=3;c[5]=2;a.ib=b.createIndexBuffer(c);c=this.getDataPartEffectInfo(h.TEXT2D_MAINPARTID,["index"],!0);return c&&(a.effectInstanced=b.createEffect("text2d",c.attributes,
c.uniforms,["diffuseSampler"],c.defines,null)),c=this.getDataPartEffectInfo(h.TEXT2D_MAINPARTID,["index"],!1),a.effect=b.createEffect("text2d",c.attributes,c.uniforms,["diffuseSampler"],c.defines,null),a},h.prototype.createInstanceDataParts=function(){return[new b(h.TEXT2D_MAINPARTID,this._charCount)]},h.prototype.beforeRefreshForLayoutConstruction=function(){if(!this._charCount){var a=this._text;return this.text="A",a}},h.prototype.afterRefreshForLayoutConstruction=function(a,b){void 0!==b&&(this.text=
b)},h.prototype.refreshInstanceDataPart=function(a){if(!g.prototype.refreshInstanceDataPart.call(this,a))return!1;if(a.id===h.TEXT2D_MAINPARTID){var b=this.fontTexture,d=b.getSize(),e=c.Vector2.Zero(),f=this.fontTexture.lineHeight;e.y=(this.textSize.height/f-1)*f;f=0;a.dataElementCount=this._charCount;for(var j=a.curElement=0,r=this.text;j<r.length;j++){var t=r[j];("\n"===t&&(e.x=0,e.y-=b.lineHeight),"\t"!==t)?" ">t||(this.updateInstanceDataPart(a,e),t=b.getChar(t),e.x+=t.charWidth,a.topLeftUV=t.topLeftUV,
t=t.bottomRightUV.subtract(t.topLeftUV),a.sizeUV=t,a.textureSize=new c.Vector2(d.width,d.height),a.color=this.defaultFontColor,++a.curElement):(t=f+this._tabulationSize,t-=t%this._tabulationSize,e.x+=(t-f)*b.spaceWidth,f=t)}}return!0},h.prototype._updateCharCount=function(){for(var a=0,b=0,c=this._text;b<c.length;b++){var d=c[b];"\r"===d||"\n"===d||"\t"===d||" ">d||++a}this._charCount=a},h.TEXT2D_MAINPARTID=1,__decorate([c.modelLevelProperty(c.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+1,function(a){return h.fontProperty=
a},!1,!0)],h.prototype,"fontName",null),__decorate([c.dynamicLevelProperty(c.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+2,function(a){return h.defaultFontColorProperty=a})],h.prototype,"defaultFontColor",null),__decorate([c.instanceLevelProperty(c.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+3,function(a){return h.textProperty=a},!1,!0)],h.prototype,"text",null),__decorate([c.instanceLevelProperty(c.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+4,function(a){return h.sizeProperty=a})],h.prototype,"size",
null),h=__decorate([c.className("Text2D")],h));c.Text2D=j}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.ModelRenderCache,a=function(a,b){e.call(this,a,b);this.effectsReady=!1;this.fillIB=this.fillVB=null;this.fillIndicesCount=0;this.borderIB=this.borderVB=this.effectFillInstanced=this.effectFill=this.instancingFillAttributes=null;this.borderIndicesCount=0;this.effectBorderInstanced=this.effectBorder=this.instancingBorderAttributes=null};f=(__extends(a,e),a.prototype.render=function(a,b){if(!this.effectsReady){if(this.effectFill&&(!this.effectFill.isReady()||this.effectFillInstanced&&
!this.effectFillInstanced.isReady())||this.effectBorder&&(!this.effectBorder.isReady()||this.effectBorderInstanced&&!this.effectBorderInstanced.isReady()))return!1;this.effectsReady=!0}var d=a.owner.owner.engine,g=0;this.effectFill&&this.effectBorder&&(g=d.getDepthFunction(),d.setDepthFunctionToLessOrEqual());var e=d.getAlphaMode();if(this.effectFill){var f=a.partIndexFromId.get(c.Shape2D.SHAPE2D_FILLPARTID.toString()),j=b.groupInfoPartData[f];b.renderMode!==c.Render2DContext.RenderModeOpaque&&d.setAlphaMode(c.Engine.ALPHA_COMBINE);
var r=b.useInstancing?this.effectFillInstanced:this.effectFill;if(d.enableEffect(r),d.bindBuffersDirectly(this.fillVB,this.fillIB,[2],8,r),b.useInstancing)this.instancingFillAttributes||(this.instancingFillAttributes=this.loadInstancingAttributes(c.Shape2D.SHAPE2D_FILLPARTID,r)),d.updateAndBindInstancesBuffer(j._partBuffer,null,this.instancingFillAttributes),d.draw(!0,0,this.fillIndicesCount,j._partData.usedElementCount),d.unbindInstanceAttributes();else for(var t=b.partDataStartIndex;t<b.partDataEndIndex;t++)this.setupUniforms(r,
f,j._partData,t),d.draw(!0,0,this.fillIndicesCount)}if(this.effectBorder)if(f=a.partIndexFromId.get(c.Shape2D.SHAPE2D_BORDERPARTID.toString()),j=b.groupInfoPartData[f],b.renderMode!==c.Render2DContext.RenderModeOpaque&&d.setAlphaMode(c.Engine.ALPHA_COMBINE),r=b.useInstancing?this.effectBorderInstanced:this.effectBorder,d.enableEffect(r),d.bindBuffersDirectly(this.borderVB,this.borderIB,[2],8,r),b.useInstancing)this.instancingBorderAttributes||(this.instancingBorderAttributes=this.loadInstancingAttributes(c.Shape2D.SHAPE2D_BORDERPARTID,
r)),d.updateAndBindInstancesBuffer(j._partBuffer,null,this.instancingBorderAttributes),d.draw(!0,0,this.borderIndicesCount,j._partData.usedElementCount),d.unbindInstanceAttributes();else for(t=b.partDataStartIndex;t<b.partDataEndIndex;t++)this.setupUniforms(r,f,j._partData,t),d.draw(!0,0,this.borderIndicesCount);return d.setAlphaMode(e),this.effectFill&&this.effectBorder&&d.setDepthFunction(g),!0},a.prototype.dispose=function(){return e.prototype.dispose.call(this)?(this.fillVB&&(this._engine._releaseBuffer(this.fillVB),
this.fillVB=null),this.fillIB&&(this._engine._releaseBuffer(this.fillIB),this.fillIB=null),this.effectFill&&(this._engine._releaseEffect(this.effectFill),this.effectFill=null),this.effectFillInstanced&&(this._engine._releaseEffect(this.effectFillInstanced),this.effectFillInstanced=null),this.borderVB&&(this._engine._releaseBuffer(this.borderVB),this.borderVB=null),this.borderIB&&(this._engine._releaseBuffer(this.borderIB),this.borderIB=null),this.effectBorder&&(this._engine._releaseEffect(this.effectBorder),
this.effectBorder=null),this.effectBorderInstanced&&(this._engine._releaseEffect(this.effectBorderInstanced),this.effectBorderInstanced=null),!0):!1},a);c.Lines2DRenderCache=f;var b,d=c.Shape2DInstanceData,a=function(a){d.call(this,a,1)};b=(__extends(a,d),Object.defineProperty(a.prototype,"boundingMin",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"boundingMax",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([c.instanceData(c.Shape2D.SHAPE2D_CATEGORY_FILLGRADIENT)],
a.prototype,"boundingMin",null),__decorate([c.instanceData(c.Shape2D.SHAPE2D_CATEGORY_FILLGRADIENT)],a.prototype,"boundingMax",null),a);c.Lines2DInstanceData=b;var j=c.Shape2D,g=function(a,b){b||(b={});j.call(this,b);this._borderIB=this._borderVB=this._fillIB=this._fillVB=null;this._size=c.Size.Zero();this._boundingMax=this._boundingMin=null;var d=null==b.fillThickness?1:b.fillThickness,g=null==b.startCap?0:b.startCap,e=null==b.endCap?0:b.endCap,f=null==b.closed?!1:b.closed;this.points=a;this.fillThickness=
d;this.startCap=g;this.endCap=e;this.closed=f},a=(__extends(g,j),Object.defineProperty(g,"NoCap",{get:function(){return g._noCap},enumerable:!0,configurable:!0}),Object.defineProperty(g,"RoundCap",{get:function(){return g._roundCap},enumerable:!0,configurable:!0}),Object.defineProperty(g,"TriangleCap",{get:function(){return g._triangleCap},enumerable:!0,configurable:!0}),Object.defineProperty(g,"SquareAnchorCap",{get:function(){return g._squareAnchorCap},enumerable:!0,configurable:!0}),Object.defineProperty(g,
"RoundAnchorCap",{get:function(){return g._roundAnchorCap},enumerable:!0,configurable:!0}),Object.defineProperty(g,"DiamondAnchorCap",{get:function(){return g._diamondAnchorCap},enumerable:!0,configurable:!0}),Object.defineProperty(g,"ArrowCap",{get:function(){return g._arrowCap},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"points",{get:function(){return this._points},set:function(a){this._points=a;this._boundingBoxDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,
"fillThickness",{get:function(){return this._fillThickness},set:function(a){this._fillThickness=a},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"closed",{get:function(){return this._closed},set:function(a){this._closed=a},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"startCap",{get:function(){return this._startCap},set:function(a){this._startCap=a},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"endCap",{get:function(){return this._endCap},
set:function(a){this._endCap=a},enumerable:!0,configurable:!0}),g.prototype.levelIntersect=function(a){var b=this;null==this._contour&&this._computeLines2D();var d=this.points.length,e=this.closed?d+1:d,f=a._localPickPosition;this.transformPointWithOriginToRef(this._contour[0],null,g._prevA);this.transformPointWithOriginToRef(this._contour[1],null,g._prevB);for(a=1;e>a;a++){if((this.transformPointWithOriginToRef(this._contour[2*(a%d)+0],null,g._curA),this.transformPointWithOriginToRef(this._contour[2*
(a%d)+1],null,g._curB),c.Vector2.PointInTriangle(f,g._prevA,g._prevB,g._curA))||c.Vector2.PointInTriangle(f,g._curA,g._prevB,g._curB))return!0;g._prevA.x=g._curA.x;g._prevA.y=g._curA.y;g._prevB.x=g._curB.x;g._prevB.y=g._curB.y}d=function(a,d){for(var e=a.length,h=0;e>h;h+=3)if(g._curA.x=d[2*a[h+0]+0],g._curA.y=d[2*a[h+0]+1],b.transformPointWithOriginToRef(g._curA,null,g._curB),g._curA.x=d[2*a[h+1]+0],g._curA.y=d[2*a[h+1]+1],b.transformPointWithOriginToRef(g._curA,null,g._prevA),g._curA.x=d[2*a[h+
2]+0],g._curA.y=d[2*a[h+2]+1],b.transformPointWithOriginToRef(g._curA,null,g._prevB),c.Vector2.PointInTriangle(f,g._prevA,g._prevB,g._curB))return!0;return!1};return this._startCapTriIndices&&(d(this._startCapTriIndices,this._startCapContour)||d(this._endCapTriIndices,this._endCapContour))?!0:!1},Object.defineProperty(g.prototype,"boundingMin",{get:function(){return this._boundingMin||this._computeLines2D(),this._boundingMin},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"boundingMax",
{get:function(){return this._boundingMax||this._computeLines2D(),this._boundingMax},enumerable:!0,configurable:!0}),g.prototype.getUsedShaderCategories=function(a){a=j.prototype.getUsedShaderCategories.call(this,a);var b=a.indexOf(c.Shape2D.SHAPE2D_CATEGORY_BORDER);return-1!==b&&a.splice(b,1),a},g.prototype.updateLevelBoundingInfo=function(){this._boundingMin||this._computeLines2D();c.BoundingInfo2D.CreateFromMinMaxToRef(this._boundingMin.x,this._boundingMax.x,this._boundingMin.y,this._boundingMax.y,
this._levelBoundingInfo)},g.prototype.createModelRenderCache=function(a){return new f(this.owner.engine,a)},g.prototype._perp=function(a,b){b.x=a.y;b.y=-a.x},g.prototype._direction=function(a,b,c){a.subtractToRef(b,c);c.normalize()},g.prototype._computeMiter=function(a,b,d,e){return d.addToRef(e,a),a.normalize(),b.x=-a.y,b.y=a.x,g._miterTps.x=-d.y,g._miterTps.y=d.x,1/c.Vector2.Dot(b,g._miterTps)},g.prototype._intersect=function(a,b,c,d,g,e,f,j){var t=(a-c)*(e-j)-(b-d)*(g-f);if(0===t)return!1;b=((g-
f)*(a*d-b*c)-(a-c)*(g*j-e*f))/t;return b<Math.min(a,c)||b>Math.max(a,c)?!1:!(b<Math.min(g,f)||b>Math.max(g,f))},g.prototype._updateMinMax=function(a,b){b>=a.length||(this._boundingMin.x=Math.min(this._boundingMin.x,a[b]),this._boundingMax.x=Math.max(this._boundingMax.x,a[b]),this._boundingMin.y=Math.min(this._boundingMin.y,a[b+1]),this._boundingMax.y=Math.max(this._boundingMax.y,a[b+1]))},g.prototype._store=function(a,b,d,e,f,j,p,r,t){var s=null!=r&&!isNaN(r),u=d*(s?8:4);if(!(u>=a.length)){0===d?
this._perp(j,g._startDir):d===e-1&&(this._perp(j,g._endDir),g._endDir.x*=-1,g._endDir.y*=-1);d=!1;if(a[u+0]=f.x+j.x*p,a[u+1]=f.y+j.y*p,a[u+2]=f.x+j.x*-p,a[u+3]=f.y+j.y*-p,this._updateMinMax(a,u),this._updateMinMax(a,u+2),void 0!==t)t*=s?8:4,this._intersect(a[u+0],a[u+1],a[t+0],a[t+1],a[u+2],a[u+3],a[t+2],a[t+3])&&(d=!0,t=a[u+0],a[u+0]=a[u+2],a[u+2]=t,t=a[u+1],a[u+1]=a[u+3],a[u+3]=t);s&&(p+=r,a[u+4]=f.x+j.x*(d?-p:p),a[u+5]=f.y+j.y*(d?-p:p),a[u+6]=f.x+j.x*(d?p:-p),a[u+7]=f.y+j.y*(d?p:-p),this._updateMinMax(a,
u+4),this._updateMinMax(a,u+6));b&&(u+=s?4:0,b.push(new c.Vector2(a[u+0],a[u+1])),b.push(new c.Vector2(a[u+2],a[u+3])))}},g.prototype._getCapSize=function(a,b){void 0===b&&(b=!1);var c=g._roundCapSubDiv,d=0,e=0;switch(a){case g.NoCap:!this.closed&&b?(d=4,e=6):d=e=0;break;case g.RoundCap:b?(d=c,e=3*(c-2)):(d=c/2+1,e=3*(c/2));break;case g.ArrowCap:b?(d=12,e=24):(d=3,e=3);break;case g.TriangleCap:b?(d=6,e=12):(d=3,e=3);break;case g.DiamondAnchorCap:b?(d=10,e=24):(d=5,e=9);break;case g.SquareAnchorCap:b?
(d=12,e=30):(d=4,e=6);break;case g.RoundAnchorCap:b?(d=2*c,e=6*(c-1)):(d=c+1,e=3*(c+1))}return{vbsize:2*d,ibsize:e}},g.prototype._storeVertex=function(a,b,c,d,e,f,j){var r=Math.cos(e);e=Math.sin(e);g._tpsV.x=r*f.x+-e*f.y+d.x;g._tpsV.y=e*f.x+r*f.y+d.y;d=b+2*c;return a[d+0]=g._tpsV.x,a[d+1]=g._tpsV.y,j&&(j.push(g._tpsV.x),j.push(g._tpsV.y)),this._updateMinMax(a,d),(b+2*c)/2},g.prototype._storeIndex=function(a,b,c,d){a[b+c]=d},g.prototype._buildCap=function(a,b,d,e,f,j,p,r,t,s){var u=g._roundCapSubDiv,
v=new c.Vector2(1,0);t=Math.atan2(t.y,t.x)-Math.atan2(v.y,v.x);var v=j/2,w=null!=p;switch(r){case g.NoCap:if(w&&!this.closed){var w=r=0,x=this._storeVertex(a,b,r++,f,t,new c.Vector2(0,v+p),s),B=this._storeVertex(a,b,r++,f,t,new c.Vector2(p,v+p),s),y=this._storeVertex(a,b,r++,f,t,new c.Vector2(p,-(v+p)),s),u=this._storeVertex(a,b,r++,f,t,new c.Vector2(0,-(v+p)),s);this._storeIndex(d,e,w++,x);this._storeIndex(d,e,w++,B);this._storeIndex(d,e,w++,y);this._storeIndex(d,e,w++,x);this._storeIndex(d,e,w++,
y);this._storeIndex(d,e,w++,u)}break;case g.ArrowCap:v*=2;case g.TriangleCap:if(w){var C=r===g.TriangleCap?p:Math.sqrt(2*p*p),x=this._storeVertex(a,b,0,f,t,new c.Vector2(0,v),null),B=this._storeVertex(a,b,1,f,t,new c.Vector2(v,0),null),y=this._storeVertex(a,b,2,f,t,new c.Vector2(0,-v),null),u=this._storeVertex(a,b,3,f,t,new c.Vector2(0,v+C),s),D=this._storeVertex(a,b,4,f,t,new c.Vector2(v+C,0),s),A=this._storeVertex(a,b,5,f,t,new c.Vector2(0,-(v+C)),s),w=0;if(this._storeIndex(d,e,w++,x),this._storeIndex(d,
e,w++,u),this._storeIndex(d,e,w++,D),this._storeIndex(d,e,w++,x),this._storeIndex(d,e,w++,D),this._storeIndex(d,e,w++,B),this._storeIndex(d,e,w++,A),this._storeIndex(d,e,w++,y),this._storeIndex(d,e,w++,B),this._storeIndex(d,e,w++,A),this._storeIndex(d,e,w++,B),this._storeIndex(d,e,w++,D),r===g.ArrowCap){x=j/2;j=this._storeVertex(a,b,9,f,t,new c.Vector2(0,-(x+p)),null);r=this._storeVertex(a,b,11,f,t,new c.Vector2(-p,-(v+C)),s);var I=this._storeVertex(a,b,10,f,t,new c.Vector2(-p,-(x+p)),s),z=this._storeVertex(a,
b,6,f,t,new c.Vector2(0,x+p),null),E=this._storeVertex(a,b,7,f,t,new c.Vector2(-p,x+p),s),F=this._storeVertex(a,b,8,f,t,new c.Vector2(-p,v+C),s);this._storeIndex(d,e,w++,z);this._storeIndex(d,e,w++,E);this._storeIndex(d,e,w++,F);this._storeIndex(d,e,w++,z);this._storeIndex(d,e,w++,F);this._storeIndex(d,e,w++,u);this._storeIndex(d,e,w++,j);this._storeIndex(d,e,w++,r);this._storeIndex(d,e,w++,I);this._storeIndex(d,e,w++,j);this._storeIndex(d,e,w++,A);this._storeIndex(d,e,w++,r)}}else x=this._storeVertex(a,
b,0,f,t,new c.Vector2(0,v),s),B=this._storeVertex(a,b,1,f,t,new c.Vector2(v,0),s),y=this._storeVertex(a,b,2,f,t,new c.Vector2(0,-v),s),this._storeIndex(d,e,0,x),this._storeIndex(d,e,1,B),this._storeIndex(d,e,2,y);break;case g.RoundCap:if(w){y=-Math.PI/2;D=Math.PI/(u/2-1);for(A=w=0;u/2>A;A++)x=this._storeVertex(a,b,2*A+0,f,t,new c.Vector2(Math.cos(y)*v,Math.sin(y)*v),null),B=this._storeVertex(a,b,2*A+1,f,t,new c.Vector2(Math.cos(y)*(v+p),Math.sin(y)*(v+p)),s),0<A&&(this._storeIndex(d,e,w++,x-2),this._storeIndex(d,
e,w++,B-2),this._storeIndex(d,e,w++,B),this._storeIndex(d,e,w++,x-2),this._storeIndex(d,e,w++,B),this._storeIndex(d,e,w++,x)),y+=D}else{C=this._storeVertex(a,b,0,f,t,new c.Vector2(0,0),null);y=-Math.PI/2;D=Math.PI/(u/2-1);this._storeVertex(a,b,1,f,t,new c.Vector2(Math.cos(y)*v,Math.sin(y)*v),null);y+=D;for(A=1;u/2>A;A++)B=this._storeVertex(a,b,A+1,f,t,new c.Vector2(Math.cos(y)*v,Math.sin(y)*v),s),this._storeIndex(d,e,3*A+0,C),this._storeIndex(d,e,3*A+1,B-1),this._storeIndex(d,e,3*A+2,B),y+=D}break;
case g.SquareAnchorCap:r=0;C=w?null:s;x=this._storeVertex(a,b,r++,f,t,new c.Vector2(0,j),C);B=this._storeVertex(a,b,r++,f,t,new c.Vector2(2*j,j),C);y=this._storeVertex(a,b,r++,f,t,new c.Vector2(2*j,-j),C);u=this._storeVertex(a,b,r++,f,t,new c.Vector2(0,-j),C);w?(D=this._storeVertex(a,b,r++,f,t,new c.Vector2(0,v+p),null),A=this._storeVertex(a,b,r++,f,t,new c.Vector2(-p,v+p),s),z=this._storeVertex(a,b,r++,f,t,new c.Vector2(-p,j+p),s),E=this._storeVertex(a,b,r++,f,t,new c.Vector2(2*j+p,j+p),s),F=this._storeVertex(a,
b,r++,f,t,new c.Vector2(2*j+p,-(j+p)),s),j=this._storeVertex(a,b,r++,f,t,new c.Vector2(-p,-(j+p)),s),I=this._storeVertex(a,b,r++,f,t,new c.Vector2(-p,-(v+p)),s),r=this._storeVertex(a,b,r++,f,t,new c.Vector2(0,-(v+p)),null),w=0,this._storeIndex(d,e,w++,A),this._storeIndex(d,e,w++,x),this._storeIndex(d,e,w++,D),this._storeIndex(d,e,w++,A),this._storeIndex(d,e,w++,z),this._storeIndex(d,e,w++,x),this._storeIndex(d,e,w++,x),this._storeIndex(d,e,w++,z),this._storeIndex(d,e,w++,E),this._storeIndex(d,e,w++,
x),this._storeIndex(d,e,w++,E),this._storeIndex(d,e,w++,B),this._storeIndex(d,e,w++,B),this._storeIndex(d,e,w++,E),this._storeIndex(d,e,w++,F),this._storeIndex(d,e,w++,B),this._storeIndex(d,e,w++,F),this._storeIndex(d,e,w++,y),this._storeIndex(d,e,w++,y),this._storeIndex(d,e,w++,F),this._storeIndex(d,e,w++,j),this._storeIndex(d,e,w++,y),this._storeIndex(d,e,w++,j),this._storeIndex(d,e,w++,u),this._storeIndex(d,e,w++,j),this._storeIndex(d,e,w++,I),this._storeIndex(d,e,w++,u),this._storeIndex(d,e,w++,
I),this._storeIndex(d,e,w++,r),this._storeIndex(d,e,w++,u)):(this._storeIndex(d,e,0,x),this._storeIndex(d,e,1,B),this._storeIndex(d,e,2,y),this._storeIndex(d,e,3,x),this._storeIndex(d,e,4,y),this._storeIndex(d,e,5,u));break;case g.RoundAnchorCap:v=Math.sqrt(j*j-v*v);x=new c.Vector2(v,0);y=c.Tools.ToRadians(-150);D=c.Tools.ToRadians(300)/(u-1);if(w)for(A=w=0;u>A;A++)x=this._storeVertex(a,b,2*A+0,f,t,new c.Vector2(v+Math.cos(y)*j,Math.sin(y)*j),null),B=this._storeVertex(a,b,2*A+1,f,t,new c.Vector2(v+
Math.cos(y)*(j+p),Math.sin(y)*(j+p)),s),0<A&&(this._storeIndex(d,e,w++,x-2),this._storeIndex(d,e,w++,B-2),this._storeIndex(d,e,w++,B),this._storeIndex(d,e,w++,x-2),this._storeIndex(d,e,w++,B),this._storeIndex(d,e,w++,x)),y+=D;else{C=this._storeVertex(a,b,0,f,t,x,null);this._storeVertex(a,b,1,f,t,new c.Vector2(v+Math.cos(y)*j,Math.sin(y)*j),null);y+=D;for(A=1;u>A;A++)B=this._storeVertex(a,b,A+1,f,t,new c.Vector2(v+Math.cos(y)*j,Math.sin(y)*j),s),this._storeIndex(d,e,3*A+0,C),this._storeIndex(d,e,3*
A+1,B-1),this._storeIndex(d,e,3*A+2,B),y+=D;this._storeIndex(d,e,3*u+0,C);this._storeIndex(d,e,3*u+1,C+1);this._storeIndex(d,e,3*u+2,C+u)}break;case g.DiamondAnchorCap:r=0,C=w?null:s,x=this._storeVertex(a,b,r++,f,t,new c.Vector2(0,v),C),B=this._storeVertex(a,b,r++,f,t,new c.Vector2(v,j),C),y=this._storeVertex(a,b,r++,f,t,new c.Vector2(3*v,0),C),u=this._storeVertex(a,b,r++,f,t,new c.Vector2(v,-j),C),D=this._storeVertex(a,b,r++,f,t,new c.Vector2(0,-v),C),w?(C=Math.sqrt(2*p*p),A=this._storeVertex(a,
b,r++,f,t,new c.Vector2(-C,v),s),z=this._storeVertex(a,b,r++,f,t,new c.Vector2(v,j+C),s),E=this._storeVertex(a,b,r++,f,t,new c.Vector2(3*v+C,0),s),F=this._storeVertex(a,b,r++,f,t,new c.Vector2(v,-(j+C)),s),j=this._storeVertex(a,b,r++,f,t,new c.Vector2(-C,-v),s),w=0,this._storeIndex(d,e,w++,A),this._storeIndex(d,e,w++,z),this._storeIndex(d,e,w++,x),this._storeIndex(d,e,w++,x),this._storeIndex(d,e,w++,z),this._storeIndex(d,e,w++,B),this._storeIndex(d,e,w++,B),this._storeIndex(d,e,w++,z),this._storeIndex(d,
e,w++,E),this._storeIndex(d,e,w++,B),this._storeIndex(d,e,w++,E),this._storeIndex(d,e,w++,y),this._storeIndex(d,e,w++,y),this._storeIndex(d,e,w++,E),this._storeIndex(d,e,w++,F),this._storeIndex(d,e,w++,y),this._storeIndex(d,e,w++,F),this._storeIndex(d,e,w++,u),this._storeIndex(d,e,w++,u),this._storeIndex(d,e,w++,F),this._storeIndex(d,e,w++,j),this._storeIndex(d,e,w++,u),this._storeIndex(d,e,w++,j),this._storeIndex(d,e,w++,D)):(this._storeIndex(d,e,0,x),this._storeIndex(d,e,1,B),this._storeIndex(d,
e,2,y),this._storeIndex(d,e,3,x),this._storeIndex(d,e,4,y),this._storeIndex(d,e,5,D),this._storeIndex(d,e,6,D),this._storeIndex(d,e,7,y),this._storeIndex(d,e,8,u))}return null},g.prototype._buildLine=function(a,b,d,e){var g=c.Vector2.Zero(),f=c.Vector2.Zero(),j=c.Vector2.Zero(),r=c.Vector2.Zero(),t=null;this.closed&&this.points.push(this.points[0]);for(var s=this.points.length,u=1;s>u;u++){var v=this.points[u],w=u<this.points.length-1?this.points[u+1]:null;(this._direction(v,this.points[u-1],g),t||
(t=c.Vector2.Zero(),this._perp(g,t)),1===u&&this._store(a,b,0,s,this.points[0],t,d,e),w)?(this._direction(w,v,f),v=this._computeMiter(j,r,g,f),this._store(a,b,u,s,this.points[u],r,v*d,v*e,u-1)):(this._perp(g,t),this._store(a,b,u,s,this.points[u],t,d,e,u-1))}if(2<this.points.length&&this.closed&&(u=this.points[0],v=this.points[1],this._direction(u,this.points[s-2],g),this._direction(v,u,f),this._perp(g,t),g=this._computeMiter(j,r,g,f),this._store(a,null,0,s,this.points[0],r,g*d,g*e,1),b))d=null==e?
0:4,b[0].x=a[d+0],b[0].y=a[d+1],b[1].x=a[d+2],b[1].y=a[d+3];this.closed&&this.points.splice(s-1)},g.prototype.setupModelRenderCache=function(a){var b=this.owner.engine;if(null===this._fillVB&&this._computeLines2D(),this.fill){a.fillVB=b.createVertexBuffer(this._fillVB);a.fillIB=b.createIndexBuffer(this._fillIB);a.fillIndicesCount=this._fillIB.length;var d=this.getDataPartEffectInfo(c.Shape2D.SHAPE2D_FILLPARTID,["position"],!0);d&&(a.effectFillInstanced=b.createEffect("lines2d",d.attributes,d.uniforms,
[],d.defines,null));d=this.getDataPartEffectInfo(c.Shape2D.SHAPE2D_FILLPARTID,["position"],!1);a.effectFill=b.createEffect("lines2d",d.attributes,d.uniforms,[],d.defines,null)}this.border&&(a.borderVB=b.createVertexBuffer(this._borderVB),a.borderIB=b.createIndexBuffer(this._borderIB),a.borderIndicesCount=this._borderIB.length,(d=this.getDataPartEffectInfo(c.Shape2D.SHAPE2D_BORDERPARTID,["position"],!0))&&(a.effectBorderInstanced=b.createEffect({vertex:"lines2d",fragment:"lines2d"},d.attributes,d.uniforms,
[],d.defines,null)),d=this.getDataPartEffectInfo(c.Shape2D.SHAPE2D_BORDERPARTID,["position"],!1),a.effectBorder=b.createEffect({vertex:"lines2d",fragment:"lines2d"},d.attributes,d.uniforms,[],d.defines,null));return this._fillVB=null,this._fillIB=null,this._borderVB=null,this._borderIB=null,a},g.prototype._computeLines2D=function(){this._boundingMin=new c.Vector2(Number.MAX_VALUE,Number.MAX_VALUE);this._boundingMax=new c.Vector2(Number.MIN_VALUE,Number.MIN_VALUE);var a=[],b=[],d=[];if(this.fill){var e=
this._getCapSize(this.startCap),f=this._getCapSize(this.endCap),j=this.points.length,p=4*j+e.vbsize+f.vbsize,p=this._fillVB=new Float32Array(p),r=this.fillThickness/2,t=this.points.length;this._buildLine(p,this.border?null:a,r);for(var r=2*t,s=2*(j-(this.closed?0:1)),f=this._fillIB=new Float32Array(3*s+e.ibsize+f.ibsize),u=0;s>u;u+=2)f[3*u+0]=u+0,f[3*u+1]=u+1,f[3*u+2]=(u+2)%r,f[3*u+3]=u+1,f[3*u+4]=(u+3)%r,f[3*u+5]=(u+2)%r;this._buildCap(p,4*j,f,3*s,this.points[0],this.fillThickness,null,this.startCap,
g._startDir,this.border?null:b);this._buildCap(p,4*j+e.vbsize,f,3*s+e.ibsize,this.points[t-1],this.fillThickness,null,this.endCap,g._endDir,this.border?null:b)}if(this.border){e=this._getCapSize(this.startCap,!0);f=this._getCapSize(this.endCap,!0);j=this.points.length;p=8*j+e.vbsize+f.vbsize;p=this._borderVB=new Float32Array(p);r=this.fillThickness/2;s=this.borderThickness;t=this.points.length;this._buildLine(p,a,r,s);r=4*t;s=4*(j-(this.closed?0:1));f=this._borderIB=new Float32Array(3*s+e.ibsize+
f.ibsize);for(u=0;s>u;u+=4)f[3*u+0]=u+0,f[3*u+1]=u+2,f[3*u+2]=(u+6)%r,f[3*u+3]=u+0,f[3*u+4]=(u+6)%r,f[3*u+5]=(u+4)%r,f[3*u+6]=u+3,f[3*u+7]=u+1,f[3*u+8]=(u+5)%r,f[3*u+9]=u+3,f[3*u+10]=(u+5)%r,f[3*u+11]=(u+7)%r;this._buildCap(p,8*j,f,3*s,this.points[0],this.fillThickness,this.borderThickness,this.startCap,g._startDir,b);this._buildCap(p,8*j+e.vbsize,f,3*s+e.ibsize,this.points[t-1],this.fillThickness,this.borderThickness,this.endCap,g._endDir,d)}if(this._contour=a,0<b.length)this._startCapTriIndices=
Earcut.earcut(b,null,2),this._startCapContour=b;0<d.length&&(a=Earcut.earcut(d,null,2),this._endCapContour=d,this._endCapTriIndices=a);d=this._boundingMax.subtract(this._boundingMin);this._size.width=d.x;this._size.height=d.y},Object.defineProperty(g.prototype,"size",{get:function(){return null==this._size&&this._computeLines2D(),this._size},enumerable:!0,configurable:!0}),g.prototype.createInstanceDataParts=function(){var a=[];return this.border&&a.push(new b(c.Shape2D.SHAPE2D_BORDERPARTID)),this.fill&&
a.push(new b(c.Shape2D.SHAPE2D_FILLPARTID)),a},g.prototype.refreshInstanceDataPart=function(a){if(!j.prototype.refreshInstanceDataPart.call(this,a))return!1;a.id===c.Shape2D.SHAPE2D_BORDERPARTID?this.border instanceof c.GradientColorBrush2D&&(a.boundingMin=this.boundingMin,a.boundingMax=this.boundingMax):a.id===c.Shape2D.SHAPE2D_FILLPARTID&&this.fill instanceof c.GradientColorBrush2D&&(a.boundingMin=this.boundingMin,a.boundingMax=this.boundingMax);return!0},g._prevA=c.Vector2.Zero(),g._prevB=c.Vector2.Zero(),
g._curA=c.Vector2.Zero(),g._curB=c.Vector2.Zero(),g._miterTps=c.Vector2.Zero(),g._startDir=c.Vector2.Zero(),g._endDir=c.Vector2.Zero(),g._tpsV=c.Vector2.Zero(),g._noCap=0,g._roundCap=1,g._triangleCap=2,g._squareAnchorCap=3,g._roundAnchorCap=4,g._diamondAnchorCap=5,g._arrowCap=6,g._roundCapSubDiv=36,__decorate([c.modelLevelProperty(c.Shape2D.SHAPE2D_PROPCOUNT+1,function(a){return g.pointsProperty=a})],g.prototype,"points",null),__decorate([c.modelLevelProperty(c.Shape2D.SHAPE2D_PROPCOUNT+2,function(a){return g.fillThicknessProperty=
a})],g.prototype,"fillThickness",null),__decorate([c.modelLevelProperty(c.Shape2D.SHAPE2D_PROPCOUNT+3,function(a){return g.closedProperty=a})],g.prototype,"closed",null),__decorate([c.modelLevelProperty(c.Shape2D.SHAPE2D_PROPCOUNT+4,function(a){return g.startCapProperty=a})],g.prototype,"startCap",null),__decorate([c.modelLevelProperty(c.Shape2D.SHAPE2D_PROPCOUNT+5,function(a){return g.endCapProperty=a})],g.prototype,"endCap",null),g=__decorate([c.className("Lines2D")],g));c.Lines2D=a}(BABYLON||(BABYLON=
{}));
!function(c){var f,e=function(){this._modelCache=new c.StringDictionary};f=(e.prototype.GetOrAddModelCache=function(a,b){return this._modelCache.getOrAddWithFactory(a,b)},e.prototype.DisposeModelRenderCache=function(a){return a.isDisposed?(this._modelCache.remove(a.modelKey),!0):!1},e);c.Canvas2DEngineBoundData=f;var a,b=c.Group2D,d=function(a,e){var j=this;b.call(this,e);this.worldSpaceToNodeLocal=function(a){var b=j._worldSpaceNode;if(b)return b=b.getWorldMatrix().clone(),b.invert(),a=c.Vector3.TransformCoordinates(a,b),
b=j._renderScaleFactor,a=new c.Vector2(a.x*b,a.y*b),b=j.actualSize,j.origin,a.x+=0.5*b.width,a.y+=0.5*b.width,a};this._notifDebugMode=!1;this._mapCounter=0;c.Prim2DBase._isCanvasInit=!1;e||(e={});var l=null==e.renderScaleFactor?1:e.renderScaleFactor;this._cachingStrategy!==d.CACHESTRATEGY_TOPLEVELGROUPS&&(this._background=new c.Rectangle2D({parent:this,id:"###CANVAS BACKGROUND###",size:e.size}),this._background.zOrder=1,this._background.isPickable=!1,this._background.origin=c.Vector2.Zero(),this._background.levelVisible=
!1,null!=e.backgroundRoundRadius&&(this.backgroundRoundRadius=e.backgroundRoundRadius),null!=e.backgroundBorder&&("string"==typeof e.backgroundBorder?this.backgroundBorder=d.GetBrushFromString(e.backgroundBorder):this.backgroundBorder=e.backgroundBorder),null!=e.backgroundBorderThickNess&&(this.backgroundBorderThickness=e.backgroundBorderThickNess),null!=e.backgroundFill&&("string"==typeof e.backgroundFill?this.backgroundFill=d.GetBrushFromString(e.backgroundFill):this.backgroundFill=e.backgroundFill),
this._background._patchHierarchy(this));var k=a.getEngine();this.__engineData=k.getOrAddExternalDataWithFactory("__BJSCANVAS2D__",function(){return new f});this._renderScaleFactor=l;this._primPointerInfo=new c.PrimitivePointerInfo;this._capturedPointers=new c.StringDictionary;this._pickStartingPosition=c.Vector2.Zero();this._hierarchyLevelMaxSiblingCount=50;this._hierarchyDepthOffset=0;this._siblingDepthOffset=1/this._hierarchyLevelMaxSiblingCount;this._scene=a;this._engine=k;this._renderingSize=
new c.Size(0,0);this._trackedGroups=[];this._patchHierarchy(this);var n=null==e.enableInteraction?!0:e.enableInteraction;this._fitRenderingDevice=!e.size;e.size?(e.size.height*=l,e.size.width*=l):e.size=new c.Size(k.getRenderWidth(),k.getRenderHeight());a.onDisposeObservable.add(function(){j.dispose()});this._isScreenSpace?this._afterRenderObserver=this._scene.onAfterRenderObservable.add(function(){j._engine.clear(null,!1,!0);j._render()}):this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add(function(){j._render()});
this._supprtInstancedArray=null!==this._engine.getCaps().instancedArrays;this._setupInteraction(n)};a=(__extends(d,b),d.prototype._canvasPreInit=function(a){this._cachingStrategy=null==a.cachingStrategy?d.CACHESTRATEGY_DONTCACHE:a.cachingStrategy;this._isScreenSpace=null==a.isScreenSpace?!0:a.isScreenSpace},d.prototype._setupInteraction=function(a){var b=this;if(a!==this._interactionEnabled)if(this._interactionEnabled=a,this._isScreenSpace){if(!a)return void(this._scenePrePointerObserver&&(this.scene.onPrePointerObservable.remove(this._scenePrePointerObserver),
this._scenePrePointerObserver=null));this._scenePrePointerObserver=this.scene.onPrePointerObservable.add(function(a,c){var d=1/b.engine.getHardwareScalingLevel(),d=a.localPosition.multiplyByFloats(d,d);b._handlePointerEventForInteraction(a,d,c)})}else{var c=this.scene;a?(c.constantlyUpdateMeshUnderPointer=!0,this._scenePointerObserver=c.onPointerObservable.add(function(a,c){if(a.pickInfo.hit&&a.pickInfo.pickedMesh===b._worldSpaceNode&&b.worldSpaceToNodeLocal){var d=b.worldSpaceToNodeLocal(a.pickInfo.pickedPoint);
b._handlePointerEventForInteraction(a,d,c)}})):this._scenePointerObserver&&(this.scene.onPointerObservable.remove(this._scenePointerObserver),this._scenePointerObserver=null)}},d.prototype._setPointerCapture=function(a,b){if(this.isPointerCaptured(a))return!1;try{this.engine.getRenderingCanvas().setPointerCapture(a)}catch(d){}return this._primPointerInfo.updateRelatedTarget(b,c.Vector2.Zero()),this._bubbleNotifyPrimPointerObserver(b,c.PrimitivePointerInfo.PointerGotCapture,null),this._capturedPointers.add(a.toString(),
b),!0},d.prototype._releasePointerCapture=function(a,b){if(this._capturedPointers.get(a.toString())!==b)return!1;try{this.engine.getRenderingCanvas().releasePointerCapture(a)}catch(d){}return this._primPointerInfo.updateRelatedTarget(b,c.Vector2.Zero()),this._bubbleNotifyPrimPointerObserver(b,c.PrimitivePointerInfo.PointerLostCapture,null),this._capturedPointers.remove(a.toString()),!0},d.prototype.isPointerCaptured=function(a){return this._capturedPointers.contains(a.toString())},d.prototype.getCapturedPrimitive=
function(a){return 0===this._capturedPointers.count?null:this._capturedPointers.get(a.toString())},d.prototype._handlePointerEventForInteraction=function(a,b){if(!this.isDisposed){this._updatePointerInfo(a,b);var d=this.getCapturedPrimitive(this._primPointerInfo.pointerId);if(this._updateIntersectionList(this._primPointerInfo.canvasPointerPos,null!==d),this._updateOverStatus(),this._actualOverPrimitive||d){var e=d||this._actualOverPrimitive.prim,d=d?this._primPointerInfo.canvasPointerPos.subtract(new c.Vector2(e.globalTransform.m[12],
e.globalTransform.m[13])):this._actualOverPrimitive.intersectionLocation;this._primPointerInfo.updateRelatedTarget(e,d);a.type===c.PointerEventTypes.POINTERWHEEL?this._bubbleNotifyPrimPointerObserver(e,c.PrimitivePointerInfo.PointerMouseWheel,a.event):a.type===c.PointerEventTypes.POINTERMOVE?this._bubbleNotifyPrimPointerObserver(e,c.PrimitivePointerInfo.PointerMove,a.event):a.type===c.PointerEventTypes.POINTERDOWN?this._bubbleNotifyPrimPointerObserver(e,c.PrimitivePointerInfo.PointerDown,a.event):
a.type===c.PointerEventTypes.POINTERUP&&this._bubbleNotifyPrimPointerObserver(e,c.PrimitivePointerInfo.PointerUp,a.event)}}},d.prototype._updatePointerInfo=function(a,b){var d=this._primPointerInfo;d.canvasPointerPos||(d.canvasPointerPos=c.Vector2.Zero());var e=this._scene.cameraToUseForPointers||this._scene.activeCamera,f=this._scene.getEngine();if(this._isScreenSpace){var e=e.viewport.toGlobal(f.getRenderWidth(),f.getRenderHeight()),j=b.y-e.y;d.canvasPointerPos.x=b.x-e.x-this.actualPosition.x;d.canvasPointerPos.y=
f.getRenderHeight()-j-this.actualPosition.y}else d.canvasPointerPos.x=b.x,d.canvasPointerPos.y=b.y;(d.mouseWheelDelta=0,a.type===c.PointerEventTypes.POINTERWHEEL)?(f=a.event,f.wheelDelta?d.mouseWheelDelta=f.wheelDelta/(40*c.PrimitivePointerInfo.MouseWheelPrecision):f.detail&&(d.mouseWheelDelta=-f.detail/c.PrimitivePointerInfo.MouseWheelPrecision)):(f=a.event,d.ctrlKey=f.ctrlKey,d.altKey=f.altKey,d.shiftKey=f.shiftKey,d.metaKey=f.metaKey,d.button=f.button,d.buttons=f.buttons,d.pointerId=f.pointerId,
d.width=f.width,d.height=f.height,d.presssure=f.pressure,d.tilt.x=f.tiltX,d.tilt.y=f.tiltY,d.isCaptured=null!==this.getCapturedPrimitive(f.pointerId))},d.prototype._updateIntersectionList=function(a,b){if(this.scene.getRenderId()!==this._intersectionRenderId){this._globalTransform||this.updateCachedStates(!0);var c=d._interInfo;if(c.pickPosition.x=a.x,c.pickPosition.y=a.y,c.findFirstOnly=!1,!b&&!this.boundingInfo.doesIntersect(c.pickPosition))return this._previousIntersectionList=this._actualIntersectionList,
this._actualIntersectionList=null,this._previousOverPrimitive=this._actualOverPrimitive,void(this._actualOverPrimitive=null);this.intersect(c);this._previousIntersectionList=this._actualIntersectionList;this._actualIntersectionList=c.intersectedPrimitives;this._previousOverPrimitive=this._actualOverPrimitive;this._actualOverPrimitive=c.topMostIntersectedPrimitive;this._intersectionRenderId=this.scene.getRenderId()}},d.prototype._updateOverStatus=function(){if(this.scene.getRenderId()!==this._hoverStatusRenderId&&
this._previousIntersectionList&&this._actualIntersectionList){var a=this._previousOverPrimitive?this._previousOverPrimitive.prim:null,b=this._actualOverPrimitive?this._actualOverPrimitive.prim:null;if(a!==b){var d=this.getCapturedPrimitive(this._primPointerInfo.pointerId);(d&&d===a||!d&&a)&&(this._primPointerInfo.updateRelatedTarget(a,this._previousOverPrimitive.intersectionLocation),this._bubbleNotifyPrimPointerObserver(a,c.PrimitivePointerInfo.PointerOut,null));(d&&d===b||!d&&b)&&(this._primPointerInfo.updateRelatedTarget(b,
this._actualOverPrimitive.intersectionLocation),this._bubbleNotifyPrimPointerObserver(b,c.PrimitivePointerInfo.PointerOver,null))}this._hoverStatusRenderId=this.scene.getRenderId()}},d.prototype._updatePrimPointerPos=function(a){if(this._primPointerInfo.isCaptured)this._primPointerInfo.primitivePointerPos=this._primPointerInfo.relatedTargetPointerPos;else for(var b=0,c=this._actualIntersectionList;b<c.length;b++){var d=c[b];if(d.prim===a)return void(this._primPointerInfo.primitivePointerPos=d.intersectionLocation)}},
d.prototype._debugExecObserver=function(a,b){if(this._notifDebugMode){for(var d="",e=0;e<a.hierarchyDepth;e++)d+="  ";e=this._primPointerInfo;d+="[RID:"+this.scene.getRenderId()+"] ["+a.hierarchyDepth+"] event:"+c.PrimitivePointerInfo.getEventTypeName(b)+", id: "+a.id+" ("+c.Tools.getClassName(a)+"), primPos: "+e.primitivePointerPos.toString()+", canvasPos: "+e.canvasPointerPos.toString();console.log(d)}},d.prototype._bubbleNotifyPrimPointerObserver=function(a,b,d){var e=this._primPointerInfo;0!==
(b&(c.PrimitivePointerInfo.PointerOver|c.PrimitivePointerInfo.PointerOut))&&this._notifParents(a,b);for(var f=!1;a;){if(!f&&(this._updatePrimPointerPos(a),this._debugExecObserver(a,b),a._pointerEventObservable.notifyObservers(e,b),this._triggerActionManager(a,e,b,d),e.cancelBubble)){if(0===(b&(c.PrimitivePointerInfo.PointerOver|c.PrimitivePointerInfo.PointerOut)))break;f=!0}f&&this._updatePrimPointerPos(a);b===c.PrimitivePointerInfo.PointerOver?(this._debugExecObserver(a,c.PrimitivePointerInfo.PointerEnter),
a._pointerEventObservable.notifyObservers(e,c.PrimitivePointerInfo.PointerEnter)):b===c.PrimitivePointerInfo.PointerOut&&(this._debugExecObserver(a,c.PrimitivePointerInfo.PointerLeave),a._pointerEventObservable.notifyObservers(e,c.PrimitivePointerInfo.PointerLeave));a=a.parent}},d.prototype._triggerActionManager=function(a,b,d,e){var f=this;if(this._globalTransform||this.updateCachedStates(!0),0!==(d&c.PrimitivePointerInfo.PointerDown)){if(this._pickStartingPosition=b.primitivePointerPos.clone(),
this._pickStartingTime=(new Date).getTime(),this._pickedDownPrim=null,a.actionManager){if(this._pickedDownPrim=a,a.actionManager.hasPickTriggers){d=c.ActionEvent.CreateNewFromPrimitive(a,b.primitivePointerPos,e);switch(e.button){case 0:a.actionManager.processTrigger(c.ActionManager.OnLeftPickTrigger,d);break;case 1:a.actionManager.processTrigger(c.ActionManager.OnCenterPickTrigger,d);break;case 2:a.actionManager.processTrigger(c.ActionManager.OnRightPickTrigger,d)}a.actionManager.processTrigger(c.ActionManager.OnPickDownTrigger,
d)}a.actionManager.hasSpecificTrigger(c.ActionManager.OnLongPressTrigger)&&window.setTimeout(function(){var b=f._primPointerInfo,d=f.getCapturedPrimitive(b.pointerId);f._updateIntersectionList(b.canvasPointerPos,null!==d);d=new c.IntersectInfo2D;d.pickPosition=b.canvasPointerPos.clone();d.findFirstOnly=!1;f.intersect(d);null!==d.isPrimIntersected(a)&&a.actionManager&&0!==f._pickStartingTime&&(new Date).getTime()-f._pickStartingTime>c.ActionManager.LongPressDelay&&Math.abs(f._pickStartingPosition.x-
d.pickPosition.x)<c.ActionManager.DragMovementThreshold&&Math.abs(f._pickStartingPosition.y-d.pickPosition.y)<c.ActionManager.DragMovementThreshold&&(f._pickStartingTime=0,a.actionManager.processTrigger(c.ActionManager.OnLongPressTrigger,c.ActionEvent.CreateNewFromPrimitive(a,b.primitivePointerPos,e)))},c.ActionManager.LongPressDelay)}}else 0!==(d&c.PrimitivePointerInfo.PointerUp)?(this._pickStartingTime=0,d=c.ActionEvent.CreateNewFromPrimitive(a,b.primitivePointerPos,e),a.actionManager&&(a.actionManager.processTrigger(c.ActionManager.OnPickUpTrigger,
d),Math.abs(this._pickStartingPosition.x-b.canvasPointerPos.x)<c.ActionManager.DragMovementThreshold&&Math.abs(this._pickStartingPosition.y-b.canvasPointerPos.y)<c.ActionManager.DragMovementThreshold&&a.actionManager.processTrigger(c.ActionManager.OnPickTrigger,d)),this._pickedDownPrim&&this._pickedDownPrim.actionManager&&this._pickedDownPrim!==a&&this._pickedDownPrim.actionManager.processTrigger(c.ActionManager.OnPickOutTrigger,d)):0!==(d&c.PrimitivePointerInfo.PointerOver)?a.actionManager&&(d=c.ActionEvent.CreateNewFromPrimitive(a,
b.primitivePointerPos,e),a.actionManager.processTrigger(c.ActionManager.OnPointerOverTrigger,d)):0!==(d&c.PrimitivePointerInfo.PointerOut)&&a.actionManager&&(d=c.ActionEvent.CreateNewFromPrimitive(a,b.primitivePointerPos,e),a.actionManager.processTrigger(c.ActionManager.OnPointerOutTrigger,d))},d.prototype._notifParents=function(a,b){for(var d=this._primPointerInfo,e=this;e;)this._updatePrimPointerPos(e),b===c.PrimitivePointerInfo.PointerOver?(this._debugExecObserver(e,c.PrimitivePointerInfo.PointerEnter),
e._pointerEventObservable.notifyObservers(d,c.PrimitivePointerInfo.PointerEnter)):b===c.PrimitivePointerInfo.PointerOut&&(this._debugExecObserver(e,c.PrimitivePointerInfo.PointerLeave),e._pointerEventObservable.notifyObservers(d,c.PrimitivePointerInfo.PointerLeave)),e=e.parent},d.prototype.dispose=function(){return b.prototype.dispose.call(this)?(this.interactionEnabled&&this._setupInteraction(!1),this._beforeRenderObserver&&(this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver),
this._beforeRenderObserver=null),this._afterRenderObserver&&(this._scene.onAfterRenderObservable.remove(this._afterRenderObserver),this._afterRenderObserver=null),void(this._groupCacheMaps&&(this._groupCacheMaps.forEach(function(a){return a.dispose()}),this._groupCacheMaps=null))):!1},Object.defineProperty(d.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"engine",{get:function(){return this._engine},enumerable:!0,configurable:!0}),
Object.defineProperty(d.prototype,"cachingStrategy",{get:function(){return this._cachingStrategy},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"worldSpaceCanvasNode",{get:function(){return this._worldSpaceNode},set:function(a){this._worldSpaceNode=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"supportInstancedArray",{get:function(){return this._supprtInstancedArray},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"backgroundFill",{get:function(){return this._background&&
this._background.isVisible?this._background.fill:null},set:function(a){this.checkBackgroundAvailability();a!==this._background.fill&&(this._background.fill=a,this._background.levelVisible=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"backgroundBorder",{get:function(){return this._background&&this._background.isVisible?this._background.border:null},set:function(a){this.checkBackgroundAvailability();a!==this._background.border&&(this._background.border=a,this._background.levelVisible=
!0)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"backgroundBorderThickness",{get:function(){return this._background&&this._background.isVisible?this._background.borderThickness:null},set:function(a){this.checkBackgroundAvailability();a!==this._background.borderThickness&&(this._background.borderThickness=a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"backgroundRoundRadius",{get:function(){return this._background&&this._background.isVisible?this._background.roundRadius:
null},set:function(a){this.checkBackgroundAvailability();a!==this._background.roundRadius&&(this._background.roundRadius=a,this._background.levelVisible=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"interactionEnabled",{get:function(){return this._interactionEnabled},set:function(a){this._setupInteraction(a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"_engineData",{get:function(){return this.__engineData},enumerable:!0,configurable:!0}),d.prototype.checkBackgroundAvailability=
function(){if(this._cachingStrategy===d.CACHESTRATEGY_TOPLEVELGROUPS)throw Error("Can't use Canvas Background with the caching strategy TOPLEVELGROUPS");},d.prototype.onPrimBecomesDirty=function(){this._addPrimToDirtyList(this)},d.prototype._updateTrackedNodes=function(){var a=this.scene.cameraToUseForPointers||this.scene.activeCamera;a.getViewMatrix().multiplyToRef(a.getProjectionMatrix(),d._m);for(var b=this.engine.getRenderHeight(),a=a.viewport.toGlobal(this.engine.getRenderWidth(),b),e=0,f=this._trackedGroups;e<
f.length;e++){var j=f[e];if(!j.isDisposed&&j.isVisible){var n=j.trackedNode.getWorldMatrix(),n=c.Vector3.Project(d._v,n,d._m,a);j.x=Math.round(n.x);j.y=Math.round(b-n.y)}}},d.prototype._updateCanvasState=function(){if(this.scene.getRenderId()!==this._updateRenderId){var a=!1,b=this.engine.getRenderWidth();b!==this._renderingSize.width&&(a=!0);this._renderingSize.width=b;b=this.engine.getRenderHeight();b!==this._renderingSize.height&&(a=!0);this._renderingSize.height=b;a&&this._fitRenderingDevice&&
(this.size=this._renderingSize,this._background&&(this._background.size=this.size),this._setLayoutDirty());a=new c.PrepareRender2DContext;++this._globalTransformProcessStep;this.updateCachedStates(!1);this._prepareGroupRender(a);this._updateRenderId=this.scene.getRenderId()}},d.prototype._render=function(){this._updateTrackedNodes();this._updateCanvasState();this._primPointerInfo.canvasPointerPos&&(this._updateIntersectionList(this._primPointerInfo.canvasPointerPos,!1),this._updateOverStatus());this.engine.setState(!1);
this._groupRender();this._cachingStrategy===d.CACHESTRATEGY_CANVAS&&this._cachedCanvasGroup&&this._cachedCanvasGroup._renderCachedCanvas()},d.prototype._allocateGroupCache=function(a,b,e){var f=a.actualSize,f=new c.Size(Math.ceil(f.width),Math.ceil(f.height));e&&(f.width=Math.max(e.width,f.width),f.height=Math.max(e.height,f.height));this._groupCacheMaps||(this._groupCacheMaps=[]);e=null;for(var j=0,n=this._groupCacheMaps;j<n.length;j++){var q=n[j],p=q.allocateRect(f);if(p){e={node:p,texture:q};break}}e||
(e=new c.Size(d._groupTextureCacheSize,d._groupTextureCacheSize),(f.width>e.width||f.height>e.height)&&(e.width=Math.pow(2,Math.ceil(Math.log(f.width)/Math.log(2))),e.height=Math.pow(2,Math.ceil(Math.log(f.height)/Math.log(2)))),q=new c.MapTexture("groupsMapChache"+this._mapCounter+"forCanvas"+this.id,this._scene,e),this._groupCacheMaps.push(q),p=q.allocateRect(f),e={node:p,texture:q});if(a!==this||this._isScreenSpace)p=e.node,this._cachingStrategy===d.CACHESTRATEGY_CANVAS?(this._cachedCanvasGroup=
c.Group2D._createCachedCanvasGroup(this),b=new c.Sprite2D(q,{parent:this._cachedCanvasGroup,id:"__cachedCanvasSprite__",spriteSize:p.contentSize,spriteLocation:p.pos}),b.zOrder=1,b.origin=c.Vector2.Zero()):(b=new c.Sprite2D(q,{parent:b,id:"__cachedSpriteOfGroup__"+a.id,x:a.actualPosition.x,y:a.actualPosition.y,spriteSize:p.contentSize,spriteLocation:p.pos}),b.origin=a.origin.clone(),e.sprite=b);return e},d.prototype._registerTrackedNode=function(a){a._isFlagSet(c.SmartPropertyPrim.flagTrackedGroup)||
(this._trackedGroups.push(a),a._setFlags(c.SmartPropertyPrim.flagTrackedGroup))},d.prototype._unregisterTrackedNode=function(a){if(a._isFlagSet(c.SmartPropertyPrim.flagTrackedGroup)){var b=this._trackedGroups.indexOf(a);-1!==b&&this._trackedGroups.splice(b,1);a._clearFlags(c.SmartPropertyPrim.flagTrackedGroup)}},d.GetSolidColorBrush=function(a){return d._solidColorBrushes.getOrAddWithFactory(a.toHexString(),function(){return new c.SolidColorBrush2D(a.clone(),!0)})},d.GetSolidColorBrushFromHex=function(a){return d._solidColorBrushes.getOrAddWithFactory(a,
function(){return new c.SolidColorBrush2D(c.Color4.FromHexString(a),!0)})},d.GetGradientColorBrush=function(a,b,e,f,j){return void 0===e&&(e=c.Vector2.Zero()),void 0===f&&(f=0),void 0===j&&(j=1),d._gradientColorBrushes.getOrAddWithFactory(c.GradientColorBrush2D.BuildKey(a,b,e,f,j),function(){return new c.GradientColorBrush2D(a,b,e,f,j,!0)})},d.GetBrushFromString=function(a){a=a.trim();var b=a.split(",");if(1===b.length){b=null;if(0===a.indexOf("solid:"))b=a.substr(6).trim();else{if(0!==a.indexOf("#"))return null;
b=a}return d.GetSolidColorBrushFromHex(b)}0===b[0].indexOf("gradient:")&&(b[0]=b[0].substr(9).trim());try{var e=c.Color4.FromHexString(b[0].trim()),f=c.Color4.FromHexString(b[1].trim()),j=c.Vector2.Zero();if(2<b.length){var n=b[2].trim();if("["!==n.charAt(0)||"]"!==n.charAt(n.length-1))return null;var q=n.indexOf(":"),p=parseFloat(n.substr(1,q)),r=parseFloat(n.substr(q+1,n.length-(q+1))),j=new c.Vector2(p,r)}a=0;3<b.length&&(a=c.Tools.ToRadians(parseFloat(b[3].trim())));n=1;return 4<b.length&&(n=
parseFloat(b[4].trim())),d.GetGradientColorBrush(e,f,j,a,n)}catch(t){return null}},d.CACHESTRATEGY_TOPLEVELGROUPS=1,d.CACHESTRATEGY_ALLGROUPS=2,d.CACHESTRATEGY_CANVAS=3,d.CACHESTRATEGY_DONTCACHE=4,d.hierarchyLevelMaxSiblingCount=50,d._interInfo=new c.IntersectInfo2D,d._v=c.Vector3.Zero(),d._m=c.Matrix.Identity(),d._groupTextureCacheSize=1024,d._solidColorBrushes=new c.StringDictionary,d._gradientColorBrushes=new c.StringDictionary,d=__decorate([c.className("Canvas2D")],d));c.Canvas2D=a;var j=function(b,
d,e){c.Prim2DBase._isCanvasInit=!0;if(e.isScreenSpace=!1,e.size=d.clone(),e.cachingStrategy=null==e.cachingStrategy?a.CACHESTRATEGY_CANVAS:e.cachingStrategy,e.cachingStrategy!==a.CACHESTRATEGY_CANVAS)throw Error("Right now only the CACHESTRATEGY_CANVAS cache Strategy is supported for WorldSpace Canvas. More will come soon!");a.call(this,b,e);c.Prim2DBase._isCanvasInit=!1;var f=e?e.id||null:null;if(!e||null==e.customWorldSpaceNode){var j=new c.WorldSpaceCanvas2DNode(f,b,this);d=c.VertexData.CreatePlane({width:d.width,
height:d.height,sideOrientation:e&&e.sideOrientation||c.Mesh.DEFAULTSIDE});b=new c.StandardMaterial(f+"_Material",b);this.applyCachedTexture(d,b);d.applyToMesh(j,!1);b.specularColor=new c.Color3(0,0,0);b.disableLighting=!0;b.useAlphaFromDiffuseTexture=!0;j.position=e&&e.worldPosition||c.Vector3.Zero();j.rotationQuaternion=e&&e.worldRotation||c.Quaternion.Identity();j.material=b;this._worldSpaceNode=j}else this._worldSpaceNode=e.customWorldSpaceNode,this.applyCachedTexture(null,null)},e=(__extends(j,
a),j=__decorate([c.className("WorldSpaceCanvas2D")],j));c.WorldSpaceCanvas2D=e;j=function(b,d){c.Prim2DBase._isCanvasInit=!0;a.call(this,b,d)};e=(__extends(j,a),j=__decorate([c.className("ScreenSpaceCanvas2D")],j));c.ScreenSpaceCanvas2D=e}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Mesh;f=function(a,b,c){e.call(this,a,b);this._canvas=c};f=(__extends(f,e),f.prototype.dispose=function(){e.prototype.dispose.call(this);this._canvas&&(this._canvas.dispose(),this._canvas=null)},f);c.WorldSpaceCanvas2DNode=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(){this.layoutDirtyOnPropertyChangedMask=0};f=(e.prototype.updateLayout=function(){},Object.defineProperty(e.prototype,"isChildPositionAllowed",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.isLocked=function(){return this._isLocked},e.prototype.lock=function(){return this._isLocked?!1:(this._isLocked=!0,!0)},e=__decorate([c.className("LayoutEngineBase")],e));c.LayoutEngineBase=f;var a=function(){f.apply(this,arguments)},e=(__extends(a,f),a.prototype.updateLayout=
function(a){if(a._isFlagSet(c.SmartPropertyPrim.flagLayoutDirty)){for(var b=0,e=a.children;b<e.length;b++)this._doUpdate(e[b]);a._clearFlags(c.SmartPropertyPrim.flagLayoutDirty)}},a.prototype._doUpdate=function(a){a instanceof c.Canvas2D?a.layoutArea=a.actualSize:a.parent instanceof c.Canvas2D?a.layoutArea=a.owner.actualSize:a.layoutArea=a.parent.contentArea},Object.defineProperty(a.prototype,"isChildPositionAllowed",{get:function(){return!0},enumerable:!0,configurable:!0}),a.Singleton=new a,a=__decorate([c.className("CanvasLayoutEngine")],
a));c.CanvasLayoutEngine=e;var b=function(){f.call(this);this._isHorizontal=!0;this.layoutDirtyOnPropertyChangedMask=c.Prim2DBase.sizeProperty.flagId},e=(__extends(b,f),Object.defineProperty(b,"Horizontal",{get:function(){return b._horizontal||(b._horizontal=new b,b._horizontal.isHorizontal=!0,b._horizontal.lock()),b._horizontal},enumerable:!0,configurable:!0}),Object.defineProperty(b,"Vertical",{get:function(){return b._vertical||(b._vertical=new b,b._vertical.isHorizontal=!1,b._vertical.lock()),
b._vertical},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isHorizontal",{get:function(){return this._isHorizontal},set:function(a){this.isLocked()||(this._isHorizontal=a)},enumerable:!0,configurable:!0}),b.prototype.updateLayout=function(a){if(a._isFlagSet(c.SmartPropertyPrim.flagLayoutDirty)){for(var b=0,e=0,h=this.isHorizontal,f=0,l=0,k=a.children;l<k.length;l++){var n=k[l],q=n.layoutArea;n.margin.computeArea(n.actualSize,q);f=Math.max(f,h?q.height:q.width)}l=0;for(k=a.children;l<
k.length;l++)n=k[l],n.layoutAreaPos=new c.Vector2(b,e),q=n.layoutArea,h?(b+=q.width,n.layoutArea=new c.Size(q.width,f)):(e+=q.height,n.layoutArea=new c.Size(f,q.height));a._clearFlags(c.SmartPropertyPrim.flagLayoutDirty)}},Object.defineProperty(b.prototype,"isChildPositionAllowed",{get:function(){return!1},enumerable:!0,configurable:!0}),b._horizontal=null,b._vertical=null,b=__decorate([c.className("StackPanelLayoutEngine")],b));c.StackPanelLayoutEngine=e}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Material,a=function(a,d,f,g){e.call(this,a,d);this._textures={};this._floats={};this._floatsArrays={};this._colors3={};this._colors4={};this._vectors2={};this._vectors3={};this._vectors4={};this._matrices={};this._matrices3x3={};this._matrices2x2={};this._cachedWorldViewMatrix=new c.Matrix;this._shaderPath=f;g.needAlphaBlending=g.needAlphaBlending||!1;g.needAlphaTesting=g.needAlphaTesting||!1;g.attributes=g.attributes||["position","normal","uv"];g.uniforms=g.uniforms||["worldViewProjection"];
g.samplers=g.samplers||[];g.defines=g.defines||[];this._options=g};f=(__extends(a,e),a.prototype.needAlphaBlending=function(){return this._options.needAlphaBlending},a.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},a.prototype._checkUniform=function(a){-1===this._options.uniforms.indexOf(a)&&this._options.uniforms.push(a)},a.prototype.setTexture=function(a,c){return-1===this._options.samplers.indexOf(a)&&this._options.samplers.push(a),this._textures[a]=c,this},a.prototype.setFloat=
function(a,c){return this._checkUniform(a),this._floats[a]=c,this},a.prototype.setFloats=function(a,c){return this._checkUniform(a),this._floatsArrays[a]=c,this},a.prototype.setColor3=function(a,c){return this._checkUniform(a),this._colors3[a]=c,this},a.prototype.setColor4=function(a,c){return this._checkUniform(a),this._colors4[a]=c,this},a.prototype.setVector2=function(a,c){return this._checkUniform(a),this._vectors2[a]=c,this},a.prototype.setVector3=function(a,c){return this._checkUniform(a),this._vectors3[a]=
c,this},a.prototype.setVector4=function(a,c){return this._checkUniform(a),this._vectors4[a]=c,this},a.prototype.setMatrix=function(a,c){return this._checkUniform(a),this._matrices[a]=c,this},a.prototype.setMatrix3x3=function(a,c){return this._checkUniform(a),this._matrices3x3[a]=c,this},a.prototype.setMatrix2x2=function(a,c){return this._checkUniform(a),this._matrices2x2[a]=c,this},a.prototype.isReady=function(a,d){var e=this.getScene(),g=e.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===
e.getRenderId())return!0;var h=[],f=new c.EffectFallbacks;d&&h.push("#define INSTANCES");for(var l=0;l<this._options.defines.length;l++)h.push(this._options.defines[l]);a&&a.useBones&&a.computeBonesUsingShaders&&(h.push("#define NUM_BONE_INFLUENCERS "+a.numBoneInfluencers),h.push("#define BonesPerMesh "+(a.skeleton.bones.length+1)),f.addCPUSkinningFallback(0,a));g.getAlphaTesting()&&h.push("#define ALPHATEST");l=this._effect;h=h.join("\n");return this._effect=g.createEffect(this._shaderPath,this._options.attributes,
this._options.uniforms,this._options.samplers,h,f,this.onCompiled,this.onError),this._effect.isReady()?(l!==this._effect&&e.resetCachedMaterial(),this._renderId=e.getRenderId(),!0):!1},a.prototype.bindOnlyWorldMatrix=function(a){var c=this.getScene();-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",a);-1!==this._options.uniforms.indexOf("worldView")&&(a.multiplyToRef(c.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix));
-1!==this._options.uniforms.indexOf("worldViewProjection")&&this._effect.setMatrix("worldViewProjection",a.multiply(c.getTransformMatrix()))},a.prototype.bind=function(a,c){if(this.bindOnlyWorldMatrix(a),this.getScene().getCachedMaterial()!==this){-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix());-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix());-1!==this._options.uniforms.indexOf("viewProjection")&&
this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix());c&&c.useBones&&c.computeBonesUsingShaders&&this._effect.setMatrices("mBones",c.skeleton.getTransformMatrices(c));for(var f in this._textures)this._effect.setTexture(f,this._textures[f]);for(f in this._floats)this._effect.setFloat(f,this._floats[f]);for(f in this._floatsArrays)this._effect.setArray(f,this._floatsArrays[f]);for(f in this._colors3)this._effect.setColor3(f,this._colors3[f]);for(f in this._colors4){var g=this._colors4[f];
this._effect.setFloat4(f,g.r,g.g,g.b,g.a)}for(f in this._vectors2)this._effect.setVector2(f,this._vectors2[f]);for(f in this._vectors3)this._effect.setVector3(f,this._vectors3[f]);for(f in this._vectors4)this._effect.setVector4(f,this._vectors4[f]);for(f in this._matrices)this._effect.setMatrix(f,this._matrices[f]);for(f in this._matrices3x3)this._effect.setMatrix3x3(f,this._matrices3x3[f]);for(f in this._matrices2x2)this._effect.setMatrix2x2(f,this._matrices2x2[f])}e.prototype.bind.call(this,a,c)},
a.prototype.clone=function(b){return new a(b,this.getScene(),this._shaderPath,this._options)},a.prototype.dispose=function(a,c){if(c)for(var f in this._textures)this._textures[f].dispose();this._textures={};e.prototype.dispose.call(this,a,c)},a.prototype.serialize=function(){var a=c.SerializationHelper.Serialize(this);a.customType="BABYLON.ShaderMaterial";a.options=this._options;a.shaderPath=this._shaderPath;a.textures={};for(var d in this._textures)a.textures[d]=this._textures[d].serialize();a.floats=
{};for(d in this._floats)a.floats[d]=this._floats[d];a.floatArrays={};for(d in this._floatsArrays)a.floatArrays[d]=this._floatsArrays[d];a.colors3={};for(d in this._colors3)a.colors3[d]=this._colors3[d].asArray();a.colors4={};for(d in this._colors4)a.colors4[d]=this._colors4[d].asArray();a.vectors2={};for(d in this._vectors2)a.vectors2[d]=this._vectors2[d].asArray();a.vectors3={};for(d in this._vectors3)a.vectors3[d]=this._vectors3[d].asArray();a.vectors4={};for(d in this._vectors4)a.vectors4[d]=
this._vectors4[d].asArray();a.matrices={};for(d in this._matrices)a.matrices[d]=this._matrices[d].asArray();a.matrices3x3={};for(d in this._matrices3x3)a.matrices3x3[d]=this._matrices3x3[d];a.matrices2x2={};for(d in this._matrices2x2)a.matrices2x2[d]=this._matrices2x2[d];return a},a.Parse=function(b,d,e){var g=c.SerializationHelper.Parse(function(){return new a(b.name,d,b.shaderPath,b.options)},b,d,e),h;for(h in b.textures)g.setTexture(h,c.Texture.Parse(b.textures[h],d,e));for(h in b.floats)g.setFloat(h,
b.floats[h]);for(h in b.floatsArrays)g.setFloats(h,b.floatsArrays[h]);for(h in b.colors3)g.setColor3(h,c.Color3.FromArray(b.colors3[h]));for(h in b.colors4)g.setColor4(h,c.Color4.FromArray(b.colors4[h]));for(h in b.vectors2)g.setVector2(h,c.Vector2.FromArray(b.vectors2[h]));for(h in b.vectors3)g.setVector3(h,c.Vector3.FromArray(b.vectors3[h]));for(h in b.vectors4)g.setVector4(h,c.Vector4.FromArray(b.vectors4[h]));for(h in b.matrices)g.setMatrix(h,c.Matrix.FromArray(b.matrices[h]));for(h in b.matrices3x3)g.setMatrix3x3(h,
b.matrices3x3[h]);for(h in b.matrices2x2)g.setMatrix2x2(h,b.matrices2x2[h]);return g},a);c.ShaderMaterial=f}(BABYLON||(BABYLON={}));
!function(c){var f=c.Internals||(c.Internals={}),e=function(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)},a=e("DXT1"),b=e("DXT3"),d=e("DXT5"),j=function(){},e=(j.GetDDSInfo=function(a){a=new Int32Array(a,0,31);var b=1;return a[2]&131072&&(b=Math.max(1,a[7])),{width:a[4],height:a[3],mipmapCount:b,isFourCC:4===(a[20]&4),isRGB:64===(a[20]&64),isLuminance:131072===(a[20]&131072),isCube:512===(a[28]&512)}},j.GetRGBAArrayBuffer=function(a,b,c,d,e){d=new Uint8Array(d);
e=new Uint8Array(e);var f=0;for(b-=1;0<=b;b--)for(var j=0;a>j;j++){var p=c+4*(j+b*a);d[f+2]=e[p];d[f+1]=e[p+1];d[f]=e[p+2];d[f+3]=e[p+3];f+=4}return d},j.GetRGBArrayBuffer=function(a,b,c,d,e){d=new Uint8Array(d);e=new Uint8Array(e);var f=0;for(b-=1;0<=b;b--)for(var j=0;a>j;j++){var p=c+3*(j+b*a);d[f+2]=e[p];d[f+1]=e[p+1];d[f]=e[p+2];f+=3}return d},j.GetLuminanceArrayBuffer=function(a,b,c,d,e){d=new Uint8Array(d);e=new Uint8Array(e);var f=0;for(b-=1;0<=b;b--)for(var j=0;a>j;j++)d[f]=e[c+(j+b*a)],f++;
return d},j.UploadDDSLevels=function(e,f,m,l,k,n){var q,p,r,t,s,u,v,w=new Int32Array(m,0,31);if(542327876!=w[0])return void c.Tools.Error("Invalid magic number in DDS header");if(!l.isFourCC&&!l.isRGB&&!l.isLuminance)return void c.Tools.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(l.isFourCC)switch(q=w[21]){case a:q=8;p=f.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case b:q=16;p=f.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case d:q=16;p=f.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return void console.error("Unsupported FourCC code:",
String.fromCharCode(255&q,q>>8&255,q>>16&255,q>>24&255))}f=1;w[2]&131072&&!1!==k&&(f=Math.max(1,w[7]));for(var x=w[22],B=0;n>B;B++){var y=1===n?e.TEXTURE_2D:e.TEXTURE_CUBE_MAP_POSITIVE_X+B;k=w[4];r=w[3];s=w[1]+4;for(v=0;f>v;++v)l.isRGB?24===x?(t=3*k*r,u=j.GetRGBArrayBuffer(k,r,s,t,m),e.texImage2D(y,v,e.RGB,k,r,0,e.RGB,e.UNSIGNED_BYTE,u)):(t=4*k*r,u=j.GetRGBAArrayBuffer(k,r,s,t,m),e.texImage2D(y,v,e.RGBA,k,r,0,e.RGBA,e.UNSIGNED_BYTE,u)):l.isLuminance?(t=e.getParameter(e.UNPACK_ALIGNMENT),t=Math.floor((k+
t-1)/t)*t*(r-1)+k,u=j.GetLuminanceArrayBuffer(k,r,s,t,m),e.texImage2D(y,v,e.LUMINANCE,k,r,0,e.LUMINANCE,e.UNSIGNED_BYTE,u)):(t=Math.max(4,k)/4*Math.max(4,r)/4*q,u=new Uint8Array(m,s,t),e.compressedTexImage2D(y,v,p,k,r,0,u)),s+=t,k*=0.5,r*=0.5,k=Math.max(1,k),r=Math.max(1,r)}},j);f.DDSTools=e;!0}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(e,a){return void 0===e&&(e=!0),void 0===a&&(a=10),this._useDeltaForWorldStep=e,this.name="CannonJSPlugin",this._physicsMaterials=[],this._fixedTimeStep=1/60,this._currentCollisionGroup=2,this._minus90X=new c.Quaternion(-0.7071067811865475,0,0,0.7071067811865475),this._plus90X=new c.Quaternion(0.7071067811865475,0,0,0.7071067811865475),this._tmpPosition=c.Vector3.Zero(),this._tmpQuaternion=new c.Quaternion,this._tmpDeltaPosition=c.Vector3.Zero(),this._tmpDeltaRotation=
new c.Quaternion,this._tmpUnityRotation=new c.Quaternion,this.isSupported()?(this.world=new CANNON.World,this.world.broadphase=new CANNON.NaiveBroadphase,void(this.world.solver.iterations=a)):void c.Tools.Error("CannonJS is not available. Please make sure you included the js file.")};f=(f.prototype.setGravity=function(c){this.world.gravity.copy(c)},f.prototype.setTimeStep=function(c){this._fixedTimeStep=c},f.prototype.executeStep=function(c){this.world.step(this._fixedTimeStep,this._useDeltaForWorldStep?
1E3*c:0,3)},f.prototype.applyImpulse=function(c,a,b){b=new CANNON.Vec3(b.x,b.y,b.z);a=new CANNON.Vec3(a.x,a.y,a.z);c.physicsBody.applyImpulse(a,b)},f.prototype.applyForce=function(c,a,b){b=new CANNON.Vec3(b.x,b.y,b.z);a=new CANNON.Vec3(a.x,a.y,a.z);c.physicsBody.applyImpulse(a,b)},f.prototype.generatePhysicsBody=function(c){if(c.parent)return void(c.physicsBody&&(this.removePhysicsBody(c),c.forceUpdate()));if(c.isBodyInitRequired()){var a=this._createShape(c),b=c.physicsBody;b&&this.removePhysicsBody(c);
var d=this._addMaterial("mat-"+c.uniqueId,c.getParam("friction"),c.getParam("restitution")),d={mass:c.getParam("mass"),material:d},f=c.getParam("nativeOptions"),g;for(g in f)f.hasOwnProperty(g)&&(d[g]=f[g]);c.physicsBody=new CANNON.Body(d);c.physicsBody.addEventListener("collide",c.onCollide);this.world.addEventListener("preStep",c.beforeStep);this.world.addEventListener("postStep",c.afterStep);c.physicsBody.addShape(a);this.world.add(c.physicsBody);b&&["force","torque","velocity","angularVelocity"].forEach(function(a){c.physicsBody[a].copy(b[a])});
this._processChildMeshes(c)}this._updatePhysicsBodyTransformation(c)},f.prototype._processChildMeshes=function(e){var a=this,b=e.object.getChildMeshes?e.object.getChildMeshes():[];if(b.length){var d=function(b,c){var f=c.getPhysicsImpostor();f&&f.parent!==e&&(b=c.position,f.physicsBody&&(a.removePhysicsBody(f),f.physicsBody=null),f.parent=e,f.resetUpdateFlags(),e.physicsBody.addShape(a._createShape(f),new CANNON.Vec3(b.x,b.y,b.z)),e.physicsBody.mass+=f.getParam("mass"));c.getChildMeshes().forEach(d.bind(a,
c.position))};b.forEach(d.bind(this,c.Vector3.Zero()))}},f.prototype.removePhysicsBody=function(c){c.physicsBody.removeEventListener("collide",c.onCollide);this.world.removeEventListener("preStep",c.beforeStep);this.world.removeEventListener("postStep",c.afterStep);this.world.remove(c.physicsBody)},f.prototype.generateJoint=function(e){var a=e.mainImpostor.physicsBody,b=e.connectedImpostor.physicsBody;if(a&&b){var d,f=e.joint.jointData,g={pivotA:f.mainPivot?(new CANNON.Vec3).copy(f.mainPivot):null,
pivotB:f.connectedPivot?(new CANNON.Vec3).copy(f.connectedPivot):null,axisA:f.mainAxis?(new CANNON.Vec3).copy(f.mainAxis):null,axisB:f.connectedAxis?(new CANNON.Vec3).copy(f.connectedAxis):null,maxForce:f.nativeParams.maxForce,collideConnected:!!f.collision};switch(e.joint.type){case c.PhysicsJoint.HingeJoint:case c.PhysicsJoint.Hinge2Joint:d=new CANNON.HingeConstraint(a,b,g);break;case c.PhysicsJoint.DistanceJoint:d=new CANNON.DistanceConstraint(a,b,f.maxDistance||2);break;case c.PhysicsJoint.SpringJoint:d=
new CANNON.Spring(a,b,{restLength:f.length,stiffness:f.stiffness,damping:f.damping,localAnchorA:g.pivotA,localAnchorB:g.pivotB});break;case c.PhysicsJoint.LockJoint:d=new CANNON.LockConstraint(a,b,g);break;default:d=new CANNON.PointToPointConstraint(a,g.pivotA,b,g.pivotA,g.maxForce)}d.collideConnected=!!f.collision;e.joint.physicsJoint=d;e.joint.type!==c.PhysicsJoint.SpringJoint?this.world.addConstraint(d):e.mainImpostor.registerAfterPhysicsStep(function(){d.applyForce()})}},f.prototype.removeJoint=
function(c){this.world.removeConstraint(c.joint.physicsJoint)},f.prototype._addMaterial=function(c,a,b){var d,f;for(d=0;d<this._physicsMaterials.length;d++)if(f=this._physicsMaterials[d],f.friction===a&&f.restitution===b)return f;c=new CANNON.Material(c);return c.friction=a,c.restitution=b,this._physicsMaterials.push(c),c},f.prototype._checkWithEpsilon=function(e){return e<c.PhysicsEngine.Epsilon?c.PhysicsEngine.Epsilon:e},f.prototype._createShape=function(e){var a,b=e.object,d=e.getObjectExtendSize();
switch(e.type){case c.PhysicsEngine.SphereImpostor:b=d.y;e=d.z;a=new CANNON.Sphere(Math.max(this._checkWithEpsilon(d.x),this._checkWithEpsilon(b),this._checkWithEpsilon(e))/2);break;case c.PhysicsImpostor.CylinderImpostor:a=new CANNON.Cylinder(this._checkWithEpsilon(d.x)/2,this._checkWithEpsilon(d.x)/2,this._checkWithEpsilon(d.y),16);break;case c.PhysicsImpostor.BoxImpostor:d=d.scale(0.5);a=new CANNON.Box(new CANNON.Vec3(this._checkWithEpsilon(d.x),this._checkWithEpsilon(d.y),this._checkWithEpsilon(d.z)));
break;case c.PhysicsImpostor.PlaneImpostor:c.Tools.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead");a=new CANNON.Plane;break;case c.PhysicsImpostor.MeshImpostor:d=b.getVerticesData?b.getVerticesData(c.VertexBuffer.PositionKind):[];b=b.getIndices?b.getIndices():[];c.Tools.Warn("MeshImpostor only collides against spheres.");a=new CANNON.Trimesh(d,b);break;case c.PhysicsImpostor.HeightmapImpostor:a=this._createHeightmap(b);break;case c.PhysicsImpostor.ParticleImpostor:a=
new CANNON.Particle}return a},f.prototype._createHeightmap=function(e,a){for(var b=e.getVerticesData(c.VertexBuffer.PositionKind),d=[],f=a||~~(Math.sqrt(b.length/3)-1),g=2*Math.min(e.getBoundingInfo().boundingBox.extendSize.x,e.getBoundingInfo().boundingBox.extendSize.z)/f,h=e.getBoundingInfo().boundingBox.extendSize.y,m=0;m<b.length;m+=3){var l=Math.round(b[m+0]/g+f/2),k=Math.round(-1*(b[m+2]/g-f/2)),n=b[m+1]+h;d[l]||(d[l]=[]);d[l][k]||(d[l][k]=n);d[l][k]=Math.max(n,d[l][k])}for(l=0;f>=l;++l){if(!d[l]){for(b=
1;!d[(l+b)%f];)b++;d[l]=d[(l+b)%f].slice()}for(k=0;f>=k;++k)if(!d[l][k]){for(var q,b=1;void 0===q;)q=d[l][(k+b++)%f];d[l][k]=q}}d=new CANNON.Heightfield(d,{elementSize:g});return d.minY=h,d},f.prototype._updatePhysicsBodyTransformation=function(e){var a=e.object;a.computeWorldMatrix&&a.computeWorldMatrix(!0);var b=e.getObjectCenter();e.getObjectExtendSize();this._tmpDeltaPosition.copyFrom(a.position.subtract(b));this._tmpPosition.copyFrom(b);var d=a.rotationQuaternion;if(e.type!==c.PhysicsImpostor.PlaneImpostor&&
e.type!==c.PhysicsImpostor.HeightmapImpostor&&e.type!==c.PhysicsImpostor.CylinderImpostor||(d=d.multiply(this._minus90X),e.setDeltaRotation(this._plus90X)),e.type===c.PhysicsEngine.HeightmapImpostor){var f=a.rotationQuaternion;a.rotationQuaternion=this._tmpUnityRotation;a.computeWorldMatrix(!0);var g=b.clone(),h=a.getPivotMatrix()||c.Matrix.Translation(0,0,0);a.rotationQuaternion=f;f=c.Matrix.Translation(a.getBoundingInfo().boundingBox.extendSize.x,0,-a.getBoundingInfo().boundingBox.extendSize.z);
a.setPivotMatrix(f);a.computeWorldMatrix(!0);b=a.getBoundingInfo().boundingBox.center.subtract(b).subtract(a.position).negate();this._tmpPosition.copyFromFloats(b.x,b.y-a.getBoundingInfo().boundingBox.extendSize.y,b.z);this._tmpDeltaPosition.copyFrom(a.getBoundingInfo().boundingBox.center.subtract(g));this._tmpDeltaPosition.y+=a.getBoundingInfo().boundingBox.extendSize.y;a.setPivotMatrix(h);a.computeWorldMatrix(!0)}else e.type===c.PhysicsEngine.MeshImpostor&&(this._tmpDeltaPosition.copyFromFloats(0,
0,0),this._tmpPosition.copyFrom(a.position));e.setDeltaPosition(this._tmpDeltaPosition);e.physicsBody.position.copy(this._tmpPosition);e.physicsBody.quaternion.copy(d)},f.prototype.setTransformationFromPhysicsBody=function(c){c.object.position.copyFrom(c.physicsBody.position);c.object.rotationQuaternion.copyFrom(c.physicsBody.quaternion)},f.prototype.setPhysicsBodyTransformation=function(c,a,b){c.physicsBody.position.copy(a);c.physicsBody.quaternion.copy(b)},f.prototype.isSupported=function(){return void 0!==
window.CANNON},f.prototype.setLinearVelocity=function(c,a){c.physicsBody.velocity.copy(a)},f.prototype.setAngularVelocity=function(c,a){c.physicsBody.angularVelocity.copy(a)},f.prototype.getLinearVelocity=function(e){return(e=e.physicsBody.velocity)?new c.Vector3(e.x,e.y,e.z):null},f.prototype.getAngularVelocity=function(e){return(e=e.physicsBody.angularVelocity)?new c.Vector3(e.x,e.y,e.z):null},f.prototype.setBodyMass=function(c,a){c.physicsBody.mass=a;c.physicsBody.updateMassProperties()},f.prototype.sleepBody=
function(c){c.physicsBody.sleep()},f.prototype.wakeUpBody=function(c){c.physicsBody.wakeUp()},f.prototype.updateDistanceJoint=function(c,a){c.physicsJoint.distance=a},f.prototype.enableMotor=function(c,a){a||c.physicsJoint.enableMotor()},f.prototype.disableMotor=function(c,a){a||c.physicsJoint.disableMotor()},f.prototype.setMotor=function(c,a,b,d){d||(c.physicsJoint.enableMotor(),c.physicsJoint.setMotorSpeed(a),b&&this.setLimit(c,b))},f.prototype.setLimit=function(c,a,b){c.physicsJoint.motorEquation.maxForce=
a;c.physicsJoint.motorEquation.minForce=void 0===b?-a:b},f.prototype.dispose=function(){},f);c.CannonJSPlugin=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(e){this.name="OimoJSPlugin";this._tmpImpostorsArray=[];this._tmpPositionVector=c.Vector3.Zero();this.world=new OIMO.World(1/60,2,e,!0);this.world.clear();this.world.isNoStat=!0};f=(f.prototype.setGravity=function(c){this.world.gravity.copy(c)},f.prototype.setTimeStep=function(c){this.world.timeStep=c},f.prototype.executeStep=function(c,a){var b=this;a.forEach(function(a){a.beforeStep()});this.world.step();a.forEach(function(a){a.afterStep();b._tmpImpostorsArray[a.uniqueId]=
a});for(var d=this.world.contacts;null!==d;)if(!d.touching||d.body1.sleeping||d.body2.sleeping){var f=this._tmpImpostorsArray[+d.body1.name],g=this._tmpImpostorsArray[+d.body2.name];f&&g?(f.onCollide({body:g.physicsBody}),g.onCollide({body:f.physicsBody}),d=d.next):d=d.next}else d=d.next},f.prototype.applyImpulse=function(c,a,b){var d=c.physicsBody.massInfo.mass;c.physicsBody.applyImpulse(b.scale(OIMO.INV_SCALE),a.scale(OIMO.INV_SCALE*d))},f.prototype.applyForce=function(e,a,b){c.Tools.Warn("Oimo doesn't support applying force. Using impule instead.");
this.applyImpulse(e,a,b)},f.prototype.generatePhysicsBody=function(e){function a(a){return Math.max(a,c.PhysicsEngine.Epsilon)}var b=this;if(e.parent)return void(e.physicsBody&&(this.removePhysicsBody(e),e.forceUpdate()));if(e.isBodyInitRequired()){var d={name:e.uniqueId,config:[e.getParam("mass")||1,e.getParam("friction"),e.getParam("restitution")],size:[],type:[],pos:[],rot:[],move:0!==e.getParam("mass"),world:this.world},f=[e],g=e.object;g.getChildMeshes&&g.getChildMeshes().forEach(function(a){a.physicsImpostor&&
(f.push(a.physicsImpostor),a.physicsImpostor._init())});f.forEach(function(g){var f=g.object.rotationQuaternion,j=(new OIMO.Euler).setFromQuaternion({x:e.object.rotationQuaternion.x,y:e.object.rotationQuaternion.y,z:e.object.rotationQuaternion.z,s:e.object.rotationQuaternion.w}),k=g.getObjectExtendSize();if(g===e){var n=e.getObjectCenter();e.object.position.subtractToRef(n,b._tmpPositionVector);d.pos.push(n.x);d.pos.push(n.y);d.pos.push(n.z);d.rot.push(j.x/(OIMO.degtorad||OIMO.TO_RAD));d.rot.push(j.y/
(OIMO.degtorad||OIMO.TO_RAD));d.rot.push(j.z/(OIMO.degtorad||OIMO.TO_RAD))}else d.pos.push(g.object.position.x),d.pos.push(g.object.position.y),d.pos.push(g.object.position.z),d.rot.push(0),d.rot.push(0),d.rot.push(0);switch(g.type){case c.PhysicsImpostor.ParticleImpostor:c.Tools.Warn("No Particle support in Oimo.js. using SphereImpostor instead");case c.PhysicsImpostor.SphereImpostor:j=k.y;n=k.z;k=Math.max(a(k.x),a(j),a(n))/2;d.type.push("sphere");d.size.push(k);d.size.push(k);d.size.push(k);break;
case c.PhysicsImpostor.CylinderImpostor:j=a(k.x)/2;n=a(k.y);d.type.push("cylinder");d.size.push(j);d.size.push(n);d.size.push(n);break;default:j=a(k.x),n=a(k.y),k=a(k.z),d.type.push("box"),d.size.push(j),d.size.push(n),d.size.push(k)}g.object.rotationQuaternion=f});e.physicsBody=(new OIMO.Body(d)).body}else this._tmpPositionVector.copyFromFloats(0,0,0);e.setDeltaPosition(this._tmpPositionVector)},f.prototype.removePhysicsBody=function(c){this.world.removeRigidBody(c.physicsBody)},f.prototype.generateJoint=
function(e){var a=e.mainImpostor.physicsBody,b=e.connectedImpostor.physicsBody;if(a&&b){var d=e.joint.jointData,f=d.nativeParams||{},b={body1:a,body2:b,axe1:f.axe1||(d.mainAxis?d.mainAxis.asArray():null),axe2:f.axe2||(d.connectedAxis?d.connectedAxis.asArray():null),pos1:f.pos1||(d.mainPivot?d.mainPivot.asArray():null),pos2:f.pos2||(d.connectedPivot?d.connectedPivot.asArray():null),min:f.min,max:f.max,collision:f.collision||d.collision,spring:f.spring,world:this.world};switch(e.joint.type){case c.PhysicsJoint.BallAndSocketJoint:a=
"jointBall";break;case c.PhysicsJoint.SpringJoint:c.Tools.Warn("Oimo.js doesn't support Spring Constraint. Simulating using DistanceJoint instead"),b.min=d.length||b.min,b.max=Math.max(b.min,b.max);case c.PhysicsJoint.DistanceJoint:a="jointDistance";b.max=d.maxDistance;break;case c.PhysicsJoint.PrismaticJoint:a="jointPrisme";break;case c.PhysicsJoint.SliderJoint:a="jointSlide";break;case c.PhysicsJoint.WheelJoint:a="jointWheel";break;default:a="jointHinge"}b.type=a;e.joint.physicsJoint=(new OIMO.Link(b)).joint}},
f.prototype.removeJoint=function(e){try{this.world.removeJoint(e.joint.physicsJoint)}catch(a){c.Tools.Warn(a)}},f.prototype.isSupported=function(){return void 0!==OIMO},f.prototype.setTransformationFromPhysicsBody=function(c){if(!c.physicsBody.sleeping){if(c.physicsBody.shapes.next){var a=this._getLastShape(c.physicsBody);c.object.position.x=a.position.x*OIMO.WORLD_SCALE;c.object.position.y=a.position.y*OIMO.WORLD_SCALE;c.object.position.z=a.position.z*OIMO.WORLD_SCALE}else c.object.position.copyFrom(c.physicsBody.getPosition());
c.object.rotationQuaternion.copyFrom(c.physicsBody.getQuaternion());c.object.rotationQuaternion.normalize()}},f.prototype.setPhysicsBodyTransformation=function(c,a,b){c=c.physicsBody;c.position.init(a.x*OIMO.INV_SCALE,a.y*OIMO.INV_SCALE,a.z*OIMO.INV_SCALE);c.orientation.init(b.w,b.x,b.y,b.z);c.syncShapes();c.awake()},f.prototype._getLastShape=function(c){for(c=c.shapes;c.next;)c=c.next;return c},f.prototype.setLinearVelocity=function(c,a){c.physicsBody.linearVelocity.init(a.x,a.y,a.z)},f.prototype.setAngularVelocity=
function(c,a){c.physicsBody.angularVelocity.init(a.x,a.y,a.z)},f.prototype.getLinearVelocity=function(e){return(e=e.physicsBody.linearVelocity)?new c.Vector3(e.x,e.y,e.z):null},f.prototype.getAngularVelocity=function(e){return(e=e.physicsBody.angularVelocity)?new c.Vector3(e.x,e.y,e.z):null},f.prototype.setBodyMass=function(c,a){var b=0===a;c.physicsBody.shapes.density=b?1:a;c.physicsBody.setupMass(b?2:1)},f.prototype.sleepBody=function(c){c.physicsBody.sleep()},f.prototype.wakeUpBody=function(c){c.physicsBody.awake()},
f.prototype.updateDistanceJoint=function(c,a,b){c.physicsJoint.limitMotoe.upperLimit=a;void 0!==b&&(c.physicsJoint.limitMotoe.lowerLimit=b)},f.prototype.setMotor=function(c,a,b,d){(c=d?c.physicsJoint.rotationalLimitMotor2:c.physicsJoint.rotationalLimitMotor1||c.physicsJoint.rotationalLimitMotor||c.physicsJoint.limitMotor)&&c.setMotor(a,b)},f.prototype.setLimit=function(c,a,b,d){(c=d?c.physicsJoint.rotationalLimitMotor2:c.physicsJoint.rotationalLimitMotor1||c.physicsJoint.rotationalLimitMotor||c.physicsJoint.limitMotor)&&
c.setLimit(a,void 0===b?-a:b)},f.prototype.dispose=function(){this.world.clear()},f);c.OimoJSPlugin=f}(BABYLON||(BABYLON={}));!function(c){var f,e=c.PostProcess;f=function(a,b,c,f,g,h){e.call(this,a,"displayPass",["passSampler"],["passSampler"],b,c,f,g,h)};f=(__extends(f,e),f);c.DisplayPassPostProcess=f}(BABYLON||(BABYLON={}));
!function(c){c.SimplificationSettings=function(a,b,c){this.quality=a;this.distance=b;this.optimizeMesh=c};var f;f=function(){this.running=!1;this._simplificationArray=[]};f=(f.prototype.addTask=function(a){this._simplificationArray.push(a)},f.prototype.executeNext=function(){var a=this._simplificationArray.pop();a?(this.running=!0,this.runSimplification(a)):this.running=!1},f.prototype.runSimplification=function(a){var b=this;if(a.parallelProcessing)a.settings.forEach(function(c){b.getSimplifier(a).simplify(c,
function(d){a.mesh.addLODLevel(c.distance,d);d.isVisible=!0;c.quality===a.settings[a.settings.length-1].quality&&a.successCallback&&a.successCallback();b.executeNext()})});else{var d=this.getSimplifier(a);c.AsyncLoop.Run(a.settings.length,function(b){var c=a.settings[b.index];d.simplify(c,function(d){a.mesh.addLODLevel(c.distance,d);d.isVisible=!0;b.executeNext()})},function(){a.successCallback&&a.successCallback();b.executeNext()})}},f.prototype.getSimplifier=function(a){switch(a.simplificationType){default:return new g(a.mesh)}},
f);c.SimplificationQueue=f;f=c.SimplificationType||(c.SimplificationType={});f[f.QUADRATIC=0]="QUADRATIC";var e;e=function(a){this.vertices=a;this.error=Array(4);this.deletePending=this.isDirty=this.deleted=!1;this.borderFactor=0};c.DecimationTriangle=e;var a;f=function(a,c){this.position=a;this.id=c;this.isBorder=!0;this.q=new b;this.triangleStart=this.triangleCount=0;this.originalOffsets=[]};a=(f.prototype.updatePosition=function(a){this.position.copyFrom(a)},f);c.DecimationVertex=a;var b,d=function(a){this.data=
Array(10);for(var b=0;10>b;++b)a&&a[b]?this.data[b]=a[b]:this.data[b]=0};b=(d.prototype.det=function(a,b,c,d,e,g,f,j,t){return this.data[a]*this.data[e]*this.data[t]+this.data[c]*this.data[d]*this.data[j]+this.data[b]*this.data[g]*this.data[f]-this.data[c]*this.data[e]*this.data[f]-this.data[a]*this.data[g]*this.data[j]-this.data[b]*this.data[d]*this.data[t]},d.prototype.addInPlace=function(a){for(var b=0;10>b;++b)this.data[b]+=a.data[b]},d.prototype.addArrayInPlace=function(a){for(var b=0;10>b;++b)this.data[b]+=
a[b]},d.prototype.add=function(a){for(var b=new d,c=0;10>c;++c)b.data[c]=this.data[c]+a.data[c];return b},d.FromData=function(a,b,c,e){return new d(d.DataFromNumbers(a,b,c,e))},d.DataFromNumbers=function(a,b,c,d){return[a*a,a*b,a*c,a*d,b*b,b*c,b*d,c*c,c*d,d*d]},d);c.QuadraticMatrix=b;var j;j=function(a,b){this.vertexId=a;this.triangleId=b};c.Reference=j;var g;f=function(a){this._mesh=a;this.initialized=!1;this.syncIterations=5E3;this.aggressiveness=7;this.decimationIterations=100;this.boundingBoxEpsilon=
c.Epsilon};g=(f.prototype.simplify=function(a,b){var d=this;this.initDecimatedMesh();c.AsyncLoop.Run(this._mesh.subMeshes.length,function(b){d.initWithMesh(b.index,function(){d.runDecimation(a,b.index,function(){b.executeNext()})},a.optimizeMesh)},function(){setTimeout(function(){b(d._reconstructedMesh)},0)})},f.prototype.isTriangleOnBoundingBox=function(a){var b=this,c=0;return a.vertices.forEach(function(a){var d=0;a=a.position;var e=b._mesh.getBoundingInfo().boundingBox;(e.maximum.x-a.x<b.boundingBoxEpsilon||
a.x-e.minimum.x>b.boundingBoxEpsilon)&&++d;e.maximum.y!==a.y&&a.y!==e.minimum.y||++d;e.maximum.z!==a.z&&a.z!==e.minimum.z||++d;1<d&&++c}),1<c&&console.log(a,c),1<c},f.prototype.runDecimation=function(a,b,d){var e=this,g=~~(this.triangles.length*a.quality),f=0,j=this.triangles.length;c.AsyncLoop.Run(this.decimationIterations,function(a){if(g>=j-f)a.breakLoop();else{var b=a.index,d=function(){a.executeNext()};setTimeout(function(){0===b%5&&e.updateMesh(0===b);for(var a=0;a<e.triangles.length;++a)e.triangles[a].isDirty=
!1;var h=1E-9*Math.pow(b+3,e.aggressiveness);c.AsyncLoop.SyncAsyncForLoop(e.triangles.length,e.syncIterations,function(a){var b=e.triangles[~~((e.triangles.length/2+a)%e.triangles.length)];if(b&&!(b.error[3]>h||b.deleted||b.isDirty))for(var d=0;3>d;++d)if(b.error[d]<h){var g=[],j=[];a=b.vertices[d];var l=b.vertices[(d+1)%3];if(!a.isBorder&&!l.isBorder){var m=c.Vector3.Zero(),n=c.Vector3.Zero(),p=c.Vector2.Zero(),r=new c.Color4(0,0,0,1);e.calculateError(a,l,m,n,p,r);n=[];if(!e.isFlipped(a,l,m,g,b.borderFactor,
n)&&!e.isFlipped(l,a,m,j,b.borderFactor,n)&&!(0>g.indexOf(!0)||0>j.indexOf(!0))){var t=[];if(!(n.forEach(function(a){-1===t.indexOf(a)&&(a.deletePending=!0,t.push(a))}),0!==t.length%2)){a.q=l.q.add(a.q);a.updatePosition(m);b=e.references.length;f=e.updateTriangles(a,a,g,f);f=e.updateTriangles(a,l,j,f);g=e.references.length-b;if(g<=a.triangleCount){if(g)for(j=0;g>j;j++)e.references[a.triangleStart+j]=e.references[b+j]}else a.triangleStart=b;a.triangleCount=g;break}}}}},d,function(){return g>=j-f})},
0)}},function(){setTimeout(function(){e.reconstructMesh(b);d()},0)})},f.prototype.initWithMesh=function(b,d,g){var f=this;this.vertices=[];this.triangles=[];var j=this._mesh.getVerticesData(c.VertexBuffer.PositionKind),q=this._mesh.getIndices(),p=this._mesh.subMeshes[b],r=[];c.AsyncLoop.SyncAsyncForLoop(p.verticesCount,this.syncIterations/4>>0,function(b){b+=p.verticesStart;var d=c.Vector3.FromArray(j,3*b),e;a:{if(g)for(e=0;e<f.vertices.length;++e)if(f.vertices[e].position.equals(d)){e=f.vertices[e];
break a}e=null}d=e||new a(d,f.vertices.length);d.originalOffsets.push(b);d.id===f.vertices.length&&f.vertices.push(d);r.push(d.id)},function(){c.AsyncLoop.SyncAsyncForLoop(p.indexCount/3,f.syncIterations,function(a){a=3*(p.indexStart/3+a);var b=new e([f.vertices[r[q[a+0]-p.verticesStart]],f.vertices[r[q[a+1]-p.verticesStart]],f.vertices[r[q[a+2]-p.verticesStart]]]);b.originalOffset=a;f.triangles.push(b)},function(){f.init(d)})})},f.prototype.init=function(a){var d=this;c.AsyncLoop.SyncAsyncForLoop(this.triangles.length,
this.syncIterations,function(a){a=d.triangles[a];a.normal=c.Vector3.Cross(a.vertices[1].position.subtract(a.vertices[0].position),a.vertices[2].position.subtract(a.vertices[0].position)).normalize();for(var e=0;3>e;e++)a.vertices[e].q.addArrayInPlace(b.DataFromNumbers(a.normal.x,a.normal.y,a.normal.z,-c.Vector3.Dot(a.normal,a.vertices[0].position)))},function(){c.AsyncLoop.SyncAsyncForLoop(d.triangles.length,d.syncIterations,function(a){a=d.triangles[a];for(var b=0;3>b;++b)a.error[b]=d.calculateError(a.vertices[b],
a.vertices[(b+1)%3]);a.error[3]=Math.min(a.error[0],a.error[1],a.error[2])},function(){d.initialized=!0;a()})})},f.prototype.reconstructMesh=function(a){var b,d=[];for(b=0;b<this.vertices.length;++b)this.vertices[b].triangleCount=0;var e,g;for(b=0;b<this.triangles.length;++b)if(!this.triangles[b].deleted){e=this.triangles[b];for(g=0;3>g;++g)e.vertices[g].triangleCount=1;d.push(e)}var f=this._reconstructedMesh.getVerticesData(c.VertexBuffer.PositionKind)||[],j=this._reconstructedMesh.getVerticesData(c.VertexBuffer.NormalKind)||
[],r=this._reconstructedMesh.getVerticesData(c.VertexBuffer.UVKind)||[],t=this._reconstructedMesh.getVerticesData(c.VertexBuffer.ColorKind)||[],s=this._mesh.getVerticesData(c.VertexBuffer.NormalKind),u=this._mesh.getVerticesData(c.VertexBuffer.UVKind),v=this._mesh.getVerticesData(c.VertexBuffer.ColorKind),w=0;for(b=0;b<this.vertices.length;++b){var x=this.vertices[b];x.id=w;x.triangleCount&&x.originalOffsets.forEach(function(a){f.push(x.position.x);f.push(x.position.y);f.push(x.position.z);j.push(s[3*
a]);j.push(s[3*a+1]);j.push(s[3*a+2]);u&&u.length?(r.push(u[2*a]),r.push(u[2*a+1])):v&&v.length&&(t.push(v[4*a]),t.push(v[4*a+1]),t.push(v[4*a+2]),t.push(v[4*a+3]));++w})}g=this._reconstructedMesh.getTotalIndices();var B=this._reconstructedMesh.getTotalVertices(),y=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var C=this._reconstructedMesh.getIndices(),D=this._mesh.getIndices();for(b=0;b<d.length;++b)e=d[b],[0,1,2].forEach(function(a){var b=e.vertices[a].originalOffsets.indexOf(D[e.originalOffset+
a]);0>b&&(b=0);C.push(e.vertices[a].id+b+B)});this._reconstructedMesh.setIndices(C);this._reconstructedMesh.setVerticesData(c.VertexBuffer.PositionKind,f);this._reconstructedMesh.setVerticesData(c.VertexBuffer.NormalKind,j);0<r.length&&this._reconstructedMesh.setVerticesData(c.VertexBuffer.UVKind,r);0<t.length&&this._reconstructedMesh.setVerticesData(c.VertexBuffer.ColorKind,t);b=this._mesh.subMeshes[a];0<a&&(this._reconstructedMesh.subMeshes=[],y.forEach(function(a){new c.SubMesh(a.materialIndex,
a.verticesStart,a.verticesCount,a.indexStart,a.indexCount,a.getMesh())}),new c.SubMesh(b.materialIndex,B,w,g,3*d.length,this._reconstructedMesh))},f.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new c.Mesh(this._mesh.name+"Decimated",this._mesh.getScene());this._reconstructedMesh.material=this._mesh.material;this._reconstructedMesh.parent=this._mesh.parent;this._reconstructedMesh.isVisible=!1;this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},f.prototype.isFlipped=
function(a,b,d,e,g,f){for(g=0;g<a.triangleCount;++g){var j=this.triangles[this.references[a.triangleStart+g].triangleId];if(!j.deleted){var r=this.references[a.triangleStart+g].vertexId,t=j.vertices[(r+1)%3],r=j.vertices[(r+2)%3];if(t!==b&&r!==b){t=t.position.subtract(d);t=t.normalize();r=r.position.subtract(d);if(r=r.normalize(),0.999<Math.abs(c.Vector3.Dot(t,r)))return!0;t=c.Vector3.Cross(t,r).normalize();if(e[g]=!1,0.2>c.Vector3.Dot(t,j.normal))return!0}else e[g]=!0,f.push(j)}}return!1},f.prototype.updateTriangles=
function(a,b,c,d){for(var e=0;e<b.triangleCount;++e){var g=this.references[b.triangleStart+e],f=this.triangles[g.triangleId];f.deleted||(c[e]&&f.deletePending?(f.deleted=!0,d++):(f.vertices[g.vertexId]=a,f.isDirty=!0,f.error[0]=this.calculateError(f.vertices[0],f.vertices[1])+f.borderFactor/2,f.error[1]=this.calculateError(f.vertices[1],f.vertices[2])+f.borderFactor/2,f.error[2]=this.calculateError(f.vertices[2],f.vertices[0])+f.borderFactor/2,f.error[3]=Math.min(f.error[0],f.error[1],f.error[2]),
this.references.push(g)))}return d},f.prototype.identifyBorder=function(){for(var a=0;a<this.vertices.length;++a){var b,c=[],d=[],e=this.vertices[a];for(b=0;b<e.triangleCount;++b)for(var g=this.triangles[this.references[e.triangleStart+b].triangleId],f=0;3>f;f++){for(var j=0,t=g.vertices[f];j<c.length&&d[j]!==t.id;)++j;j===c.length?(c.push(1),d.push(t.id)):c[j]++}for(b=0;b<c.length;++b)1===c[b]?this.vertices[d[b]].isBorder=!0:this.vertices[d[b]].isBorder=!1}},f.prototype.updateMesh=function(a){void 0===
a&&(a=!1);var b;if(!a){var c=[];for(b=0;b<this.triangles.length;++b)this.triangles[b].deleted||c.push(this.triangles[b]);this.triangles=c}for(b=0;b<this.vertices.length;++b)this.vertices[b].triangleCount=0,this.vertices[b].triangleStart=0;var d,e;for(b=0;b<this.triangles.length;++b){c=this.triangles[b];for(d=0;3>d;++d)e=c.vertices[d],e.triangleCount++}for(b=c=0;b<this.vertices.length;++b)this.vertices[b].triangleStart=c,c+=this.vertices[b].triangleCount,this.vertices[b].triangleCount=0;var g=Array(3*
this.triangles.length);for(b=0;b<this.triangles.length;++b){c=this.triangles[b];for(d=0;3>d;++d)e=c.vertices[d],g[e.triangleStart+e.triangleCount]=new j(d,b),e.triangleCount++}this.references=g;a&&this.identifyBorder()},f.prototype.vertexError=function(a,b){var c=b.x,d=b.y,e=b.z;return a.data[0]*c*c+2*a.data[1]*c*d+2*a.data[2]*c*e+2*a.data[3]*c+a.data[4]*d*d+2*a.data[5]*d*e+2*a.data[6]*d+a.data[7]*e*e+2*a.data[8]*e+a.data[9]},f.prototype.calculateError=function(a,b,d){var e=a.q.add(b.q),g=a.isBorder&&
b.isBorder,f=0,f=e.det(0,1,2,1,4,5,2,5,7);if(0===f||g){var g=a.position.add(b.position).divide(new c.Vector3(2,2,2)),j=this.vertexError(e,a.position),r=this.vertexError(e,b.position),e=this.vertexError(e,g),f=Math.min(j,r,e);f===j?d&&d.copyFrom(a.position):f===r?d&&d.copyFrom(b.position):d&&d.copyFrom(g)}else d||(d=c.Vector3.Zero()),d.x=-1/f*e.det(1,2,3,4,5,6,5,7,8),d.y=1/f*e.det(0,2,3,1,5,6,2,7,8),d.z=-1/f*e.det(0,1,3,1,4,6,2,5,8),f=this.vertexError(e,d);return f},f);c.QuadraticErrorSimplification=
g}(BABYLON||(BABYLON={}));
!function(c){var f=[],e=function(a,b){if(!f[a.id]){if(a instanceof c.Geometry.Primitives.Box)b.boxes.push(a.serialize());else if(a instanceof c.Geometry.Primitives.Sphere)b.spheres.push(a.serialize());else if(a instanceof c.Geometry.Primitives.Cylinder)b.cylinders.push(a.serialize());else if(a instanceof c.Geometry.Primitives.Torus)b.toruses.push(a.serialize());else if(a instanceof c.Geometry.Primitives.Ground)b.grounds.push(a.serialize());else if(a instanceof c.Geometry.Primitives.Plane)b.planes.push(a.serialize());else if(a instanceof
c.Geometry.Primitives.TorusKnot)b.torusKnots.push(a.serialize());else{if(a instanceof c.Geometry.Primitives._Primitive)throw Error("Unknown primitive type");b.vertexData.push(a.serializeVerticeData())}f[a.id]=!0}},a=function(a,b){var g={};g.name=a.name;g.id=a.id;c.Tags.HasTags(a)&&(g.tags=c.Tags.GetTags(a));g.position=a.position.asArray();a.rotationQuaternion?g.rotationQuaternion=a.rotationQuaternion.asArray():a.rotation&&(g.rotation=a.rotation.asArray());g.scaling=a.scaling.asArray();g.localMatrix=
a.getPivotMatrix().asArray();g.isEnabled=a.isEnabled();g.isVisible=a.isVisible;g.infiniteDistance=a.infiniteDistance;g.pickable=a.isPickable;g.receiveShadows=a.receiveShadows;g.billboardMode=a.billboardMode;g.visibility=a.visibility;g.checkCollisions=a.checkCollisions;a.parent&&(g.parentId=a.parent.id);var f=a._geometry;if(f){var m=f.id;g.geometryId=m;a.getScene().getGeometryByID(m)||e(f,b.geometries);g.subMeshes=[];for(f=0;f<a.subMeshes.length;f++)m=a.subMeshes[f],g.subMeshes.push({materialIndex:m.materialIndex,
verticesStart:m.verticesStart,verticesCount:m.verticesCount,indexStart:m.indexStart,indexCount:m.indexCount})}a.material?g.materialId=a.material.id:a.material=null;a.skeleton&&(g.skeletonId=a.skeleton.id);a.getPhysicsImpostor()&&(g.physicsMass=a.getPhysicsMass(),g.physicsFriction=a.getPhysicsFriction(),g.physicsRestitution=a.getPhysicsRestitution(),g.physicsImpostor=a.getPhysicsImpostor().type);g.instances=[];for(f=0;f<a.instances.length;f++){var m=a.instances[f],l={name:m.name,position:m.position.asArray(),
scaling:m.scaling.asArray()};m.rotationQuaternion?l.rotationQuaternion=m.rotationQuaternion.asArray():m.rotation&&(l.rotation=m.rotation.asArray());g.instances.push(l);c.Animation.AppendSerializedAnimations(m,l);l.ranges=m.serializeAnimationRanges()}return c.Animation.AppendSerializedAnimations(a,g),g.ranges=a.serializeAnimationRanges(),g.layerMask=a.layerMask,a.actionManager&&(g.actions=a.actionManager.serialize(a.name)),g},b;b=function(){};b=(b.ClearCache=function(){f=[]},b.Serialize=function(b){var j=
{};j.useDelayedTextureLoading=b.useDelayedTextureLoading;j.autoClear=b.autoClear;j.clearColor=b.clearColor.asArray();j.ambientColor=b.ambientColor.asArray();j.gravity=b.gravity.asArray();j.collisionsEnabled=b.collisionsEnabled;j.workerCollisions=b.workerCollisions;b.fogMode&&0!==b.fogMode&&(j.fogMode=b.fogMode,j.fogColor=b.fogColor.asArray(),j.fogStart=b.fogStart,j.fogEnd=b.fogEnd,j.fogDensity=b.fogDensity);b.isPhysicsEnabled()&&(j.physicsEnabled=!0,j.physicsGravity=b.getPhysicsEngine().gravity.asArray(),
j.physicsEngine=b.getPhysicsEngine().getPhysicsPluginName());j.lights=[];var g,h;for(g=0;g<b.lights.length;g++)h=b.lights[g],j.lights.push(h.serialize());j.cameras=[];for(g=0;g<b.cameras.length;g++)j.cameras.push(b.cameras[g].serialize());b.activeCamera&&(j.activeCameraID=b.activeCamera.id);c.Animation.AppendSerializedAnimations(b,j);j.materials=[];j.multiMaterials=[];for(g=0;g<b.materials.length;g++)h=b.materials[g],j.materials.push(h.serialize());j.multiMaterials=[];for(g=0;g<b.multiMaterials.length;g++)j.multiMaterials.push(b.multiMaterials[g].serialize());
j.skeletons=[];for(g=0;g<b.skeletons.length;g++)j.skeletons.push(b.skeletons[g].serialize());j.geometries={};j.geometries.boxes=[];j.geometries.spheres=[];j.geometries.cylinders=[];j.geometries.toruses=[];j.geometries.grounds=[];j.geometries.planes=[];j.geometries.torusKnots=[];j.geometries.vertexData=[];f=[];h=b.getGeometries();for(g=0;g<h.length;g++){var m=h[g];m.isReady()&&e(m,j.geometries)}j.meshes=[];for(g=0;g<b.meshes.length;g++)h=b.meshes[g],h instanceof c.Mesh&&(h.delayLoadState!==c.Engine.DELAYLOADSTATE_LOADED&&
h.delayLoadState!==c.Engine.DELAYLOADSTATE_NONE||j.meshes.push(a(h,j)));j.particleSystems=[];for(g=0;g<b.particleSystems.length;g++)j.particleSystems.push(b.particleSystems[g].serialize());j.lensFlareSystems=[];for(g=0;g<b.lensFlareSystems.length;g++)j.lensFlareSystems.push(b.lensFlareSystems[g].serialize());j.shadowGenerators=[];for(g=0;g<b.lights.length;g++)h=b.lights[g],h.getShadowGenerator()&&j.shadowGenerators.push(h.getShadowGenerator().serialize());return b.actionManager&&(j.actions=b.actionManager.serialize("scene")),
j},b.SerializeMesh=function(b,f,g){void 0===f&&(f=!1);void 0===g&&(g=!1);var h={};if(b=b instanceof Array?b:[b],f||g)for(var m=0;m<b.length;++m)g&&b[m].getDescendants().forEach(function(a){a instanceof c.Mesh&&0>b.indexOf(a)&&b.push(a)}),f&&b[m].parent&&0>b.indexOf(b[m].parent)&&b.push(b[m].parent);return b.forEach(function(b){if(b.delayLoadState===c.Engine.DELAYLOADSTATE_LOADED||b.delayLoadState===c.Engine.DELAYLOADSTATE_NONE){b.material&&(b.material instanceof c.StandardMaterial?(h.materials=h.materials||
[],h.materials.some(function(a){return a.id===b.material.id})||h.materials.push(b.material.serialize())):b.material instanceof c.MultiMaterial&&(h.multiMaterials=h.multiMaterials||[],h.multiMaterials.some(function(a){return a.id===b.material.id})||h.multiMaterials.push(b.material.serialize())));var d=b._geometry;d&&(h.geometries||(h.geometries={},h.geometries.boxes=[],h.geometries.spheres=[],h.geometries.cylinders=[],h.geometries.toruses=[],h.geometries.grounds=[],h.geometries.planes=[],h.geometries.torusKnots=
[],h.geometries.vertexData=[]),e(d,h.geometries));b.skeleton&&(h.skeletons=h.skeletons||[],h.skeletons.push(b.skeleton.serialize()));h.meshes=h.meshes||[];h.meshes.push(a(b,h))}}),h},b);c.SceneSerializer=b}(BABYLON||(BABYLON={}));var Earcut;
!function(c){function f(a,b,c,d,e){var g;if(e===0<s(a,b,c,d))for(e=b;c>e;e+=d)g=p(e,a[e],a[e+1],g);else for(e=c-d;e>=b;e-=d)g=p(e,a[e],a[e+1],g);return g&&l(g,g.next)&&(r(g),g=g.next),g}function e(a,b){if(!a)return a;b||(b=a);var c,d=a;do if(c=!1,d.steiner||!l(d,d.next)&&0!==m(d.prev,d,d.next))d=d.next;else{if(r(d),d=b=d.prev,d===d.next)return null;c=!0}while(c||d!==b);return b}function a(b,c,d,g,f,p,t){if(b){if(!t&&p){var s=b,A=s;do null===A.z&&(A.z=j(A.x,A.y,g,f,p)),A.prevZ=A.prev,A=A.nextZ=A.next;
while(A!==s);A.prevZ.nextZ=null;A.prevZ=null;var s=A,I,z,E,F,J,G,L=1;do{A=s;F=s=null;for(J=0;A;){J++;z=A;for(I=G=0;L>I&&(G++,z=z.nextZ,z);I++);for(I=L;0<G||0<I&&z;)0===G?(E=z,z=z.nextZ,I--):0!==I&&z?A.z<=z.z?(E=A,A=A.nextZ,G--):(E=z,z=z.nextZ,I--):(E=A,A=A.nextZ,G--),F?F.nextZ=E:s=E,E.prevZ=F,F=E;A=z}F.nextZ=null;L*=2}while(1<J)}for(A=b;b.prev!==b.next;){E=b.prev;s=b.next;if(p)a:{z=b;I=g;var K=f,H=p;F=z.prev;J=z;G=z.next;if(0<=m(F,J,G))z=!1;else{var M=F.x>J.x?F.x>G.x?F.x:G.x:J.x>G.x?J.x:G.x,N=F.y>
J.y?F.y>G.y?F.y:G.y:J.y>G.y?J.y:G.y,L=j(F.x<J.x?F.x<G.x?F.x:G.x:J.x<G.x?J.x:G.x,F.y<J.y?F.y<G.y?F.y:G.y:J.y<G.y?J.y:G.y,I,K,H);I=j(M,N,I,K,H);for(K=z.nextZ;K&&K.z<=I;){if(K!==z.prev&&K!==z.next&&h(F.x,F.y,J.x,J.y,G.x,G.y,K.x,K.y)&&0<=m(K.prev,K,K.next)){z=!1;break a}K=K.nextZ}for(K=z.prevZ;K&&K.z>=L;){if(K!==z.prev&&K!==z.next&&h(F.x,F.y,J.x,J.y,G.x,G.y,K.x,K.y)&&0<=m(K.prev,K,K.next)){z=!1;break a}K=K.prevZ}z=!0}}else a:if(z=b,F=z.prev,J=z,G=z.next,0<=m(F,J,G))z=!1;else{for(L=z.next.next;L!==z.prev;){if(h(F.x,
F.y,J.x,J.y,G.x,G.y,L.x,L.y)&&0<=m(L.prev,L,L.next)){z=!1;break a}L=L.next}z=!0}if(z)c.push(E.i/d),c.push(b.i/d),c.push(s.i/d),r(b),A=b=s.next;else if(b=s,b===A){if(t)if(1===t){t=c;E=d;s=b;do A=s.prev,z=s.next.next,!l(A,z)&&k(A,s,s.next,z)&&n(A,z)&&n(z,A)&&(t.push(A.i/E),t.push(s.i/E),t.push(z.i/E),r(s),r(s.next),s=b=z),s=s.next;while(s!==b);b=s;a(b,c,d,g,f,p,2)}else{if(2===t)a:{t=b;do{for(E=t.next.next;E!==t.prev;){if(s=t.i!==E.i){s=t;A=E;z=void 0;if(z=s.next.i!==A.i)if(z=void 0,z=s.prev.i!==A.i){z=
z=void 0;b:{z=s;do{if(z.i!==s.i&&z.next.i!==s.i&&z.i!==A.i&&z.next.i!==A.i&&k(z,z.next,s,A)){z=!0;break b}z=z.next}while(z!==s);z=!1}if(z=!z)if(z=void 0,z=n(s,A))if(z=void 0,z=n(A,s)){z=s;F=!1;J=(s.x+A.x)/2;A=(s.y+A.y)/2;do z.y>A!=z.next.y>A&&J<(z.next.x-z.x)*(A-z.y)/(z.next.y-z.y)+z.x&&(F=!F),z=z.next;while(z!==s);z=F}}s=z}if(s){b=q(t,E);t=e(t,t.next);b=e(b,b.next);a(t,c,d,g,f,p,void 0);a(b,c,d,g,f,p,void 0);break a}E=E.next}t=t.next}while(t!==b)}}else a(e(b,void 0),c,d,g,f,p,1);break}}}}function b(a,
b){return a.x-b.x}function d(a,b){var c,d=b,e=a.x,g=a.y,f=-(1/0);do{if(g<=d.y&&g>=d.next.y){var j=d.x+(g-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(e>=j&&j>f){if(f=j,j===e){if(g===d.y)return d;if(g===d.next.y)return d.next}c=d.x<d.next.x?d:d.next}}d=d.next}while(d!==b);if(!c)return null;if(e===f)return c.prev;for(var l,j=c,k=c.x,m=c.y,q=1/0,d=c.next;d!==j;)e>=d.x&&d.x>=k&&h(m>g?e:f,g,k,m,m>g?f:e,g,d.x,d.y)&&(l=Math.abs(g-d.y)/(e-d.x),(q>l||l===q&&d.x>c.x)&&n(d,a)&&(c=d,q=l)),d=d.next;return c}function j(a,
b,c,d,e){return a=32767*(a-c)/e,b=32767*(b-d)/e,a=16711935&(a|a<<8),a=252645135&(a|a<<4),a=858993459&(a|a<<2),a=1431655765&(a|a<<1),b=16711935&(b|b<<8),b=252645135&(b|b<<4),b=858993459&(b|b<<2),b=1431655765&(b|b<<1),a|b<<1}function g(a){var b=a,c=a;do b.x<c.x&&(c=b),b=b.next;while(b!==a);return c}function h(a,b,c,d,e,g,f,h){return 0<=(e-f)*(b-h)-(a-f)*(g-h)&&0<=(a-f)*(d-h)-(c-f)*(b-h)&&0<=(c-f)*(g-h)-(e-f)*(d-h)}function m(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function l(a,b){return a.x===
b.x&&a.y===b.y}function k(a,b,c,d){return l(a,b)&&l(c,d)||l(a,d)&&l(c,b)?!0:0<m(a,b,c)!=0<m(a,b,d)&&0<m(c,d,a)!=0<m(c,d,b)}function n(a,b){return 0>m(a.prev,a,a.next)?0<=m(a,b,a.next)&&0<=m(a,a.prev,b):0>m(a,b,a.prev)||0>m(a,a.next,b)}function q(a,b){var c=new t(a.i,a.x,a.y),d=new t(b.i,b.x,b.y),e=a.next,g=b.prev;return a.next=b,b.prev=a,c.next=e,e.prev=c,d.next=c,c.prev=d,g.next=d,d.prev=g,d}function p(a,b,c,d){a=new t(a,b,c);return d?(a.next=d.next,a.prev=d,d.next.prev=a,d.next=a):(a.prev=a,a.next=
a),a}function r(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function t(a,b,c){this.i=a;this.x=b;this.y=c;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function s(a,b,c,d){for(var e=0,g=c-d;c>b;b+=d)e+=(a[g]-a[b])*(a[b+1]+a[g+1]),g=b;return e}c.earcut=function(c,h,j){j=j||2;var l=h&&h.length,k=l?h[0]*j:c.length,m=f(c,0,k,j,!0),n=[];if(!m)return n;var p,r,t,s;if(l){var E=j,F,J,G;s=[];l=0;for(F=h.length;F>l;l++)J=
h[l]*E,G=F-1>l?h[l+1]*E:c.length,J=f(c,J,G,E,!1),J===J.next&&(J.steiner=!0),s.push(g(J));s.sort(b);for(l=0;l<s.length;l++){h=s[l];E=m;if(E=d(h,E))h=q(E,h),e(h,h.next);m=e(m,m.next)}}if(c.length>80*j){p=t=c[0];r=l=c[1];for(E=j;k>E;E+=j)s=c[E],h=c[E+1],p>s&&(p=s),r>h&&(r=h),s>t&&(t=s),h>l&&(l=h);t=Math.max(t-p,l-r)}return a(m,n,j,p,r,t,void 0),n};c.deviation=function(a,b,c,d){var e=b&&b.length,g=Math.abs(s(a,0,e?b[0]*c:a.length,c));if(e)for(var e=0,f=b.length;f>e;e++)g-=Math.abs(s(a,b[e]*c,f-1>e?b[e+
1]*c:a.length,c));for(e=b=0;e<d.length;e+=3){var f=d[e]*c,h=d[e+1]*c,j=d[e+2]*c;b+=Math.abs((a[f]-a[j])*(a[h+1]-a[f+1])-(a[f]-a[h])*(a[j+1]-a[f+1]))}return 0===g&&0===b?0:Math.abs((b-g)/g)};c.flatten=function(a){for(var b=a[0][0].length,c={vertices:[],holes:[],dimensions:b},d=0,e=0;e<a.length;e++){for(var g=0;g<a[e].length;g++)for(var f=0;b>f;f++)c.vertices.push(a[e][g][f]);0<e&&(d+=a[e-1].length,c.holes.push(d))}return c}}(Earcut||(Earcut={}));
!function(c){var f=0,e,a=function(a,b,c){this.pos=a;this.normal=b;this.uv=c};e=(a.prototype.clone=function(){return new a(this.pos.clone(),this.normal.clone(),this.uv.clone())},a.prototype.flip=function(){this.normal=this.normal.scale(-1)},a.prototype.interpolate=function(b,d){return new a(c.Vector3.Lerp(this.pos,b.pos,d),c.Vector3.Lerp(this.normal,b.normal,d),c.Vector2.Lerp(this.uv,b.uv,d))},a);var b,d=function(a,b){this.normal=a;this.w=b};b=(d.FromPoints=function(a,b,e){e=e.subtract(a);b=b.subtract(a);
if(0===e.lengthSquared()||0===b.lengthSquared())return null;b=c.Vector3.Normalize(c.Vector3.Cross(e,b));return new d(b,c.Vector3.Dot(b,a))},d.prototype.clone=function(){return new d(this.normal.clone(),this.w)},d.prototype.flip=function(){this.normal.scaleInPlace(-1);this.w=-this.w},d.prototype.splitPolygon=function(a,b,e,g,f){var h,l,k=0,m=[];for(h=0;h<a.vertices.length;h++)l=c.Vector3.Dot(this.normal,a.vertices[h].pos)-this.w,l=l<-d.EPSILON?2:l>d.EPSILON?1:0,k|=l,m.push(l);switch(k){case 0:(0<c.Vector3.Dot(this.normal,
a.plane.normal)?b:e).push(a);break;case 1:g.push(a);break;case 2:f.push(a);break;case 3:b=[];e=[];for(h=0;h<a.vertices.length;h++){var x=(h+1)%a.vertices.length;l=m[h];var B=m[x],k=a.vertices[h],x=a.vertices[x];if(2!==l&&b.push(k),1!==l&&e.push(2!==l?k.clone():k),3===(l|B))l=(this.w-c.Vector3.Dot(this.normal,k.pos))/c.Vector3.Dot(this.normal,x.pos.subtract(k.pos)),l=k.interpolate(x,l),b.push(l),e.push(l.clone())}var y;3<=b.length&&(y=new j(b,a.shared),y.plane&&g.push(y));3<=e.length&&(y=new j(e,a.shared),
y.plane&&f.push(y))}},d.EPSILON=1E-5,d);var j,g=function(a,c){this.vertices=a;this.shared=c;this.plane=b.FromPoints(a[0].pos,a[1].pos,a[2].pos)};j=(g.prototype.clone=function(){var a=this.vertices.map(function(a){return a.clone()});return new g(a,this.shared)},g.prototype.flip=function(){this.vertices.reverse().map(function(a){a.flip()});this.plane.flip()},g);var h,m=function(a){this.back=this.front=this.plane=null;this.polygons=[];a&&this.build(a)};h=(m.prototype.clone=function(){var a=new m;return a.plane=
this.plane&&this.plane.clone(),a.front=this.front&&this.front.clone(),a.back=this.back&&this.back.clone(),a.polygons=this.polygons.map(function(a){return a.clone()}),a},m.prototype.invert=function(){for(var a=0;a<this.polygons.length;a++)this.polygons[a].flip();this.plane&&this.plane.flip();this.front&&this.front.invert();this.back&&this.back.invert();a=this.front;this.front=this.back;this.back=a},m.prototype.clipPolygons=function(a){if(!this.plane)return a.slice();for(var b=[],c=[],d=0;d<a.length;d++)this.plane.splitPolygon(a[d],
b,c,b,c);return this.front&&(b=this.front.clipPolygons(b)),c=this.back?this.back.clipPolygons(c):[],b.concat(c)},m.prototype.clipTo=function(a){this.polygons=a.clipPolygons(this.polygons);this.front&&this.front.clipTo(a);this.back&&this.back.clipTo(a)},m.prototype.allPolygons=function(){var a=this.polygons.slice();return this.front&&(a=a.concat(this.front.allPolygons())),this.back&&(a=a.concat(this.back.allPolygons())),a},m.prototype.build=function(a){if(a.length){this.plane||(this.plane=a[0].plane.clone());
for(var b=[],c=[],d=0;d<a.length;d++)this.plane.splitPolygon(a[d],this.polygons,this.polygons,b,c);b.length&&(this.front||(this.front=new m),this.front.build(b));c.length&&(this.back||(this.back=new m),this.back.build(c))}},m);var l,k=function(){this.polygons=[]};l=(k.FromMesh=function(a){var b,d,g,h,l,m,v,w,x,B=[];if(!(a instanceof c.Mesh))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";a.computeWorldMatrix(!0);l=a.getWorldMatrix();m=a.position.clone();v=a.rotation.clone();a.rotationQuaternion&&
(w=a.rotationQuaternion.clone());x=a.scaling.clone();var y=a.getIndices(),C=a.getVerticesData(c.VertexBuffer.PositionKind),D=a.getVerticesData(c.VertexBuffer.NormalKind),A=a.getVerticesData(c.VertexBuffer.UVKind);a=a.subMeshes;for(var I=0,z=a.length;z>I;I++)for(var E=a[I].indexStart,F=a[I].indexCount+a[I].indexStart;F>E;E+=3){h=[];for(var J=0;3>J;J++)d=new c.Vector3(D[3*y[E+J]],D[3*y[E+J]+1],D[3*y[E+J]+2]),b=new c.Vector2(A[2*y[E+J]],A[2*y[E+J]+1]),g=new c.Vector3(C[3*y[E+J]],C[3*y[E+J]+1],C[3*y[E+
J]+2]),g=c.Vector3.TransformCoordinates(g,l),d=c.Vector3.TransformNormal(d,l),b=new e(g,d,b),h.push(b);h=new j(h,{subMeshId:I,meshId:f,materialIndex:a[I].materialIndex});h.plane&&B.push(h)}B=k.FromPolygons(B);return B.matrix=l,B.position=m,B.rotation=v,B.scaling=x,B.rotationQuaternion=w,f++,B},k.FromPolygons=function(a){var b=new k;return b.polygons=a,b},k.prototype.clone=function(){var a=new k;return a.polygons=this.polygons.map(function(a){return a.clone()}),a.copyTransformAttributes(this),a},k.prototype.toPolygons=
function(){return this.polygons},k.prototype.union=function(a){var b=new h(this.clone().polygons);a=new h(a.clone().polygons);return b.clipTo(a),a.clipTo(b),a.invert(),a.clipTo(b),a.invert(),b.build(a.allPolygons()),k.FromPolygons(b.allPolygons()).copyTransformAttributes(this)},k.prototype.unionInPlace=function(a){var b=new h(this.polygons);a=new h(a.polygons);b.clipTo(a);a.clipTo(b);a.invert();a.clipTo(b);a.invert();b.build(a.allPolygons());this.polygons=b.allPolygons()},k.prototype.subtract=function(a){var b=
new h(this.clone().polygons);a=new h(a.clone().polygons);return b.invert(),b.clipTo(a),a.clipTo(b),a.invert(),a.clipTo(b),a.invert(),b.build(a.allPolygons()),b.invert(),k.FromPolygons(b.allPolygons()).copyTransformAttributes(this)},k.prototype.subtractInPlace=function(a){var b=new h(this.polygons);a=new h(a.polygons);b.invert();b.clipTo(a);a.clipTo(b);a.invert();a.clipTo(b);a.invert();b.build(a.allPolygons());b.invert();this.polygons=b.allPolygons()},k.prototype.intersect=function(a){var b=new h(this.clone().polygons);
a=new h(a.clone().polygons);return b.invert(),a.clipTo(b),a.invert(),b.clipTo(a),a.clipTo(b),b.build(a.allPolygons()),b.invert(),k.FromPolygons(b.allPolygons()).copyTransformAttributes(this)},k.prototype.intersectInPlace=function(a){var b=new h(this.polygons);a=new h(a.polygons);b.invert();a.clipTo(b);a.invert();b.clipTo(a);a.clipTo(b);b.build(a.allPolygons());b.invert();this.polygons=b.allPolygons()},k.prototype.inverse=function(){var a=this.clone();return a.inverseInPlace(),a},k.prototype.inverseInPlace=
function(){this.polygons.map(function(a){a.flip()})},k.prototype.copyTransformAttributes=function(a){return this.matrix=a.matrix,this.position=a.position,this.rotation=a.rotation,this.scaling=a.scaling,this.rotationQuaternion=a.rotationQuaternion,this},k.prototype.buildMeshGeometry=function(a,b,d){var e=this.matrix.clone();e.invert();var g,f;b=new c.Mesh(a,b);var h=[],j=[],l=[],k=[],m=c.Vector3.Zero(),y=c.Vector3.Zero(),C=c.Vector2.Zero(),D=this.polygons,A=[0,0,0],I={},z=0,E={};d&&D.sort(function(a,
b){return a.shared.meshId===b.shared.meshId?a.shared.subMeshId-b.shared.subMeshId:a.shared.meshId-b.shared.meshId});for(var F=0,J=D.length;J>F;F++){g=D[F];E[g.shared.meshId]||(E[g.shared.meshId]={});E[g.shared.meshId][g.shared.subMeshId]||(E[g.shared.meshId][g.shared.subMeshId]={indexStart:+(1/0),indexEnd:-(1/0),materialIndex:g.shared.materialIndex});a=E[g.shared.meshId][g.shared.subMeshId];for(var G=2,L=g.vertices.length;L>G;G++){A[0]=0;A[1]=G-1;A[2]=G;for(var K=0;3>K;K++){m.copyFrom(g.vertices[A[K]].pos);
y.copyFrom(g.vertices[A[K]].normal);C.copyFrom(g.vertices[A[K]].uv);var H=c.Vector3.TransformCoordinates(m,e),M=c.Vector3.TransformNormal(y,e);f=I[H.x+","+H.y+","+H.z];"undefined"!=typeof f&&l[3*f]===M.x&&l[3*f+1]===M.y&&l[3*f+2]===M.z&&k[2*f]===C.x&&k[2*f+1]===C.y||(h.push(H.x,H.y,H.z),k.push(C.x,C.y),l.push(y.x,y.y,y.z),f=I[H.x+","+H.y+","+H.z]=h.length/3-1);j.push(f);a.indexStart=Math.min(z,a.indexStart);a.indexEnd=Math.max(z,a.indexEnd);z++}}}if(b.setVerticesData(c.VertexBuffer.PositionKind,h),
b.setVerticesData(c.VertexBuffer.NormalKind,l),b.setVerticesData(c.VertexBuffer.UVKind,k),b.setIndices(j),d){e=0;b.subMeshes=[];for(var N in E){d=-1;for(var O in E[N])a=E[N][O],c.SubMesh.CreateFromIndices(a.materialIndex+e,a.indexStart,a.indexEnd-a.indexStart+1,b),d=Math.max(a.materialIndex,d);e+=++d}}return b},k.prototype.toMesh=function(a,b,c,d){a=this.buildMeshGeometry(a,c,d);return a.material=b,a.position.copyFrom(this.position),a.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(a.rotationQuaternion=
this.rotationQuaternion.clone()),a.scaling.copyFrom(this.scaling),a.computeWorldMatrix(!0),a},k);c.CSG=l}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.PostProcess;f=function(a,b,d,f){var g=this;e.call(this,a,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,f.postProcessScaleFactor,b,c.Texture.BILINEAR_SAMPLINGMODE,null,null);this._isRightEye=d;this._distortionFactors=f.distortionK;this._postProcessScaleFactor=f.postProcessScaleFactor;this._lensCenterOffset=f.lensCenterOffset;this.onSizeChangedObservable.add(function(){g.aspectRatio=0.5*g.width/g.height;g._scaleIn=new c.Vector2(2,2/g.aspectRatio);
g._scaleFactor=new c.Vector2(0.5*(1/g._postProcessScaleFactor),0.5*(1/g._postProcessScaleFactor)*g.aspectRatio);g._lensCenter=new c.Vector2(g._isRightEye?0.5-0.5*g._lensCenterOffset:0.5+0.5*g._lensCenterOffset,0.5)});this.onApplyObservable.add(function(a){a.setFloat2("LensCenter",g._lensCenter.x,g._lensCenter.y);a.setFloat2("Scale",g._scaleFactor.x,g._scaleFactor.y);a.setFloat2("ScaleIn",g._scaleIn.x,g._scaleIn.y);a.setFloat4("HmdWarpParam",g._distortionFactors[0],g._distortionFactors[1],g._distortionFactors[2],
g._distortionFactors[3])})};f=(__extends(f,e),f);c.VRDistortionCorrectionPostProcess=f}(BABYLON||(BABYLON={}));
!function(c){var f=c.JoystickAxis||(c.JoystickAxis={});f[f.X=0]="X";f[f.Y=1]="Y";f[f.Z=2]="Z";!0;var e=c.JoystickAxis,a=function(b){var d=this;b?this._leftJoystick=!0:this._leftJoystick=!1;this._joystickIndex=a._globalJoystickIndex;a._globalJoystickIndex++;this._axisTargetedByLeftAndRight=e.X;this._axisTargetedByUpAndDown=e.Y;this.reverseUpDown=this.reverseLeftRight=!1;this._touches=new c.StringDictionary;this.deltaPosition=c.Vector3.Zero();this._joystickSensibility=25;this._inversedSensibility=1/
(this._joystickSensibility/1E3);this._rotationSpeed=25;this._inverseRotationSpeed=1/(this._rotationSpeed/1E3);this._rotateOnAxisRelativeToMesh=!1;this._onResize=function(){a.vjCanvasWidth=window.innerWidth;a.vjCanvasHeight=window.innerHeight;a.vjCanvas.width=a.vjCanvasWidth;a.vjCanvas.height=a.vjCanvasHeight;a.halfWidth=a.vjCanvasWidth/2;a.halfHeight=a.vjCanvasHeight/2};a.vjCanvas||(window.addEventListener("resize",this._onResize,!1),a.vjCanvas=document.createElement("canvas"),a.vjCanvasWidth=window.innerWidth,
a.vjCanvasHeight=window.innerHeight,a.vjCanvas.width=window.innerWidth,a.vjCanvas.height=window.innerHeight,a.vjCanvas.style.width="100%",a.vjCanvas.style.height="100%",a.vjCanvas.style.position="absolute",a.vjCanvas.style.backgroundColor="transparent",a.vjCanvas.style.top="0px",a.vjCanvas.style.left="0px",a.vjCanvas.style.zIndex="5",a.vjCanvas.style.msTouchAction="none",a.vjCanvas.setAttribute("touch-action","none"),a.vjCanvasContext=a.vjCanvas.getContext("2d"),a.vjCanvasContext.strokeStyle="#ffffff",
a.vjCanvasContext.lineWidth=2,document.body.appendChild(a.vjCanvas));a.halfWidth=a.vjCanvas.width/2;a.halfHeight=a.vjCanvas.height/2;this.pressed=!1;this._joystickColor="cyan";this._joystickPointerID=-1;this._joystickPointerPos=new c.Vector2(0,0);this._joystickPreviousPointerPos=new c.Vector2(0,0);this._joystickPointerStartPos=new c.Vector2(0,0);this._deltaJoystickVector=new c.Vector2(0,0);this._onPointerDownHandlerRef=function(a){d._onPointerDown(a)};this._onPointerMoveHandlerRef=function(a){d._onPointerMove(a)};
this._onPointerOutHandlerRef=function(a){d._onPointerUp(a)};this._onPointerUpHandlerRef=function(a){d._onPointerUp(a)};a.vjCanvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1);a.vjCanvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1);a.vjCanvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1);a.vjCanvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1);a.vjCanvas.addEventListener("contextmenu",function(a){a.preventDefault()},!1);requestAnimationFrame(function(){d._drawVirtualJoystick()})},
f=(a.prototype.setJoystickSensibility=function(a){this._joystickSensibility=a;this._inversedSensibility=1/(this._joystickSensibility/1E3)},a.prototype._onPointerDown=function(b){b.preventDefault();(!0===this._leftJoystick?b.clientX<a.halfWidth:b.clientX>a.halfWidth)&&0>this._joystickPointerID?(this._joystickPointerID=b.pointerId,this._joystickPointerStartPos.x=b.clientX,this._joystickPointerStartPos.y=b.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=
this._joystickPointerStartPos.clone(),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(b.pointerId.toString(),b)):2>a._globalJoystickIndex&&this._action&&(this._action(),this._touches.add(b.pointerId.toString(),{x:b.clientX,y:b.clientY,prevX:b.clientX,prevY:b.clientY}))},a.prototype._onPointerMove=function(a){if(this._joystickPointerID==a.pointerId){this._joystickPointerPos.x=a.clientX;this._joystickPointerPos.y=a.clientY;this._deltaJoystickVector=this._joystickPointerPos.clone();
this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos);a=(this.reverseLeftRight?-1:1)*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case e.X:this.deltaPosition.x=Math.min(1,Math.max(-1,a));break;case e.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,a));break;case e.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,a))}a=(this.reverseUpDown?1:-1)*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case e.X:this.deltaPosition.x=
Math.min(1,Math.max(-1,a));break;case e.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,a));break;case e.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,a))}}else{var c=this._touches.get(a.pointerId.toString());c&&(c.x=a.clientX,c.y=a.clientY)}},a.prototype._onPointerUp=function(b){if(this._joystickPointerID==b.pointerId)a.vjCanvasContext.clearRect(this._joystickPointerStartPos.x-63,this._joystickPointerStartPos.y-63,126,126),a.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-41,this._joystickPreviousPointerPos.y-
41,82,82),this._joystickPointerID=-1,this.pressed=!1;else{var c=this._touches.get(b.pointerId.toString());c&&a.vjCanvasContext.clearRect(c.prevX-43,c.prevY-43,86,86)}this._deltaJoystickVector.x=0;this._deltaJoystickVector.y=0;this._touches.remove(b.pointerId.toString())},a.prototype.setJoystickColor=function(a){this._joystickColor=a},a.prototype.setActionOnTouch=function(a){this._action=a},a.prototype.setAxisForLeftRight=function(a){switch(a){case e.X:case e.Y:case e.Z:this._axisTargetedByLeftAndRight=
a;break;default:this._axisTargetedByLeftAndRight=e.X}},a.prototype.setAxisForUpDown=function(a){switch(a){case e.X:case e.Y:case e.Z:this._axisTargetedByUpAndDown=a;break;default:this._axisTargetedByUpAndDown=e.Y}},a.prototype._clearCanvas=function(){this._leftJoystick?a.vjCanvasContext.clearRect(0,0,a.vjCanvasWidth/2,a.vjCanvasHeight):a.vjCanvasContext.clearRect(a.vjCanvasWidth/2,0,a.vjCanvasWidth,a.vjCanvasHeight)},a.prototype._drawVirtualJoystick=function(){var b=this;this.pressed&&this._touches.forEach(function(c){c.pointerId===
b._joystickPointerID?(a.vjCanvasContext.clearRect(b._joystickPointerStartPos.x-63,b._joystickPointerStartPos.y-63,126,126),a.vjCanvasContext.clearRect(b._joystickPreviousPointerPos.x-41,b._joystickPreviousPointerPos.y-41,82,82),a.vjCanvasContext.beginPath(),a.vjCanvasContext.lineWidth=6,a.vjCanvasContext.strokeStyle=b._joystickColor,a.vjCanvasContext.arc(b._joystickPointerStartPos.x,b._joystickPointerStartPos.y,40,0,2*Math.PI,!0),a.vjCanvasContext.stroke(),a.vjCanvasContext.closePath(),a.vjCanvasContext.beginPath(),
a.vjCanvasContext.strokeStyle=b._joystickColor,a.vjCanvasContext.lineWidth=2,a.vjCanvasContext.arc(b._joystickPointerStartPos.x,b._joystickPointerStartPos.y,60,0,2*Math.PI,!0),a.vjCanvasContext.stroke(),a.vjCanvasContext.closePath(),a.vjCanvasContext.beginPath(),a.vjCanvasContext.strokeStyle=b._joystickColor,a.vjCanvasContext.arc(b._joystickPointerPos.x,b._joystickPointerPos.y,40,0,2*Math.PI,!0),a.vjCanvasContext.stroke(),a.vjCanvasContext.closePath(),b._joystickPreviousPointerPos=b._joystickPointerPos.clone()):
(a.vjCanvasContext.clearRect(c.prevX-43,c.prevY-43,86,86),a.vjCanvasContext.beginPath(),a.vjCanvasContext.fillStyle="white",a.vjCanvasContext.beginPath(),a.vjCanvasContext.strokeStyle="red",a.vjCanvasContext.lineWidth=6,a.vjCanvasContext.arc(c.x,c.y,40,0,2*Math.PI,!0),a.vjCanvasContext.stroke(),a.vjCanvasContext.closePath(),c.prevX=c.x,c.prevY=c.y)});requestAnimationFrame(function(){b._drawVirtualJoystick()})},a.prototype.releaseCanvas=function(){a.vjCanvas&&(a.vjCanvas.removeEventListener("pointerdown",
this._onPointerDownHandlerRef),a.vjCanvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),a.vjCanvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),a.vjCanvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(a.vjCanvas),a.vjCanvas=null)},a._globalJoystickIndex=0,a);c.VirtualJoystick=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.FreeCamera;f=function(a,b,c){e.call(this,a,b,c);this.inputs.addVirtualJoystick()};f=(__extends(f,e),f);c.VirtualJoysticksCamera=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){};f=(f.prototype.getLeftJoystick=function(){return this._leftjoystick},f.prototype.getRightJoystick=function(){return this._rightjoystick},f.prototype.checkInputs=function(){if(this._leftjoystick){var e=this.camera,a=50*e._computeLocalCameraSpeed(),b=c.Matrix.RotationYawPitchRoll(e.rotation.y,e.rotation.x,0),a=c.Vector3.TransformCoordinates(new c.Vector3(this._leftjoystick.deltaPosition.x*a,this._leftjoystick.deltaPosition.y*a,this._leftjoystick.deltaPosition.z*a),
b);e.cameraDirection=e.cameraDirection.add(a);e.cameraRotation=e.cameraRotation.addVector3(this._rightjoystick.deltaPosition);this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(0.9));this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(0.9))}},f.prototype.attachControl=function(){this._leftjoystick=new c.VirtualJoystick(!0);this._leftjoystick.setAxisForUpDown(c.JoystickAxis.Z);this._leftjoystick.setAxisForLeftRight(c.JoystickAxis.X);
this._leftjoystick.setJoystickSensibility(0.15);this._rightjoystick=new c.VirtualJoystick(!1);this._rightjoystick.setAxisForUpDown(c.JoystickAxis.X);this._rightjoystick.setAxisForLeftRight(c.JoystickAxis.Y);this._rightjoystick.reverseUpDown=!0;this._rightjoystick.setJoystickSensibility(0.05);this._rightjoystick.setJoystickColor("yellow")},f.prototype.detachControl=function(){this._leftjoystick.releaseCanvas();this._rightjoystick.releaseCanvas()},f.prototype.getTypeName=function(){return"FreeCameraVirtualJoystickInput"},
f.prototype.getSimpleName=function(){return"virtualJoystick"},f);c.FreeCameraVirtualJoystickInput=f;c.CameraInputTypes.FreeCameraVirtualJoystickInput=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.PostProcess;f=function(a,b,c,f,g,h){var m=this;e.call(this,a,"anaglyph",null,["leftSampler"],b,c[1],f,g,h);this._passedProcess=c[0]._rigPostProcess;this.onApplyObservable.add(function(a){a.setTextureFromPostProcess("leftSampler",m._passedProcess)})};f=(__extends(f,e),f);c.AnaglyphPostProcess=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(c){this._scene=c};f=(f.prototype.render=function(e,a,b){var d=this;void 0===b&&(b=!1);var f=this._scene,g=this._scene.getEngine(),h=null!==g.getCaps().instancedArrays&&null!==a.visibleInstances[e._id]&&void 0!==a.visibleInstances[e._id];if(this.isReady(e,h)){var m=e.getRenderingMesh(),l=e.getMaterial();if(g.enableEffect(this._effect),this._effect.setFloat("offset",b?0:m.outlineWidth),this._effect.setColor4("color",b?m.overlayColor:m.outlineColor,b?m.overlayAlpha:1),this._effect.setMatrix("viewProjection",
f.getTransformMatrix()),m.useBones&&m.computeBonesUsingShaders&&this._effect.setMatrices("mBones",m.skeleton.getTransformMatrices(m)),m._bind(e,this._effect,c.Material.TriangleFillMode),l&&l.needAlphaTesting())b=l.getAlphaTestTexture(),this._effect.setTexture("diffuseSampler",b),this._effect.setMatrix("diffuseMatrix",b.getTextureMatrix());m._processRendering(e,this._effect,c.Material.TriangleFillMode,a,h,function(a,b){d._effect.setMatrix("world",b)})}},f.prototype.isReady=function(e,a){var b=[],d=
[c.VertexBuffer.PositionKind,c.VertexBuffer.NormalKind],f=e.getMesh(),g=e.getMaterial();g&&g.needAlphaTesting()&&(b.push("#define ALPHATEST"),f.isVerticesDataPresent(c.VertexBuffer.UVKind)&&(d.push(c.VertexBuffer.UVKind),b.push("#define UV1")),f.isVerticesDataPresent(c.VertexBuffer.UV2Kind)&&(d.push(c.VertexBuffer.UV2Kind),b.push("#define UV2")));f.useBones&&f.computeBonesUsingShaders?(d.push(c.VertexBuffer.MatricesIndicesKind),d.push(c.VertexBuffer.MatricesWeightsKind),4<f.numBoneInfluencers&&(d.push(c.VertexBuffer.MatricesIndicesExtraKind),
d.push(c.VertexBuffer.MatricesWeightsExtraKind)),b.push("#define NUM_BONE_INFLUENCERS "+f.numBoneInfluencers),b.push("#define BonesPerMesh "+(f.skeleton.bones.length+1))):b.push("#define NUM_BONE_INFLUENCERS 0");a&&(b.push("#define INSTANCES"),d.push("world0"),d.push("world1"),d.push("world2"),d.push("world3"));b=b.join("\n");return this._cachedDefines!==b&&(this._cachedDefines=b,this._effect=this._scene.getEngine().createEffect("outline",d,"world mBones viewProjection diffuseMatrix offset color".split(" "),
["diffuseSampler"],b)),this._effect.isReady()},f);c.OutlineRenderer=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,b,c,d){this.name=a;this.meshesNames=b;this.rootUrl=c;this.sceneFilename=d;this.isCompleted=!1};f=(e.prototype.run=function(a,b,d){var e=this;c.SceneLoader.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,a,function(a,c,d){e.loadedMeshes=a;e.loadedParticleSystems=c;e.loadedSkeletons=d;e.isCompleted=!0;e.onSuccess&&e.onSuccess(e);b()},null,function(){e.onError&&e.onError(e);d()})},e);c.MeshAssetTask=f;var a,e=function(a,b){this.name=a;this.url=b;this.isCompleted=
!1};a=(e.prototype.run=function(a,b,d){var e=this;c.Tools.LoadFile(this.url,function(a){e.text=a;e.isCompleted=!0;e.onSuccess&&e.onSuccess(e);b()},null,a.database,!1,function(){e.onError&&e.onError(e);d()})},e);c.TextFileAssetTask=a;var b,e=function(a,b){this.name=a;this.url=b;this.isCompleted=!1};b=(e.prototype.run=function(a,b,d){var e=this;c.Tools.LoadFile(this.url,function(a){e.data=a;e.isCompleted=!0;e.onSuccess&&e.onSuccess(e);b()},null,a.database,!0,function(){e.onError&&e.onError(e);d()})},
e);c.BinaryFileAssetTask=b;var d,e=function(a,b){this.name=a;this.url=b;this.isCompleted=!1};d=(e.prototype.run=function(a,b,c){var d=this,e=new Image;e.onload=function(){d.image=e;d.isCompleted=!0;d.onSuccess&&d.onSuccess(d);b()};e.onerror=function(){d.onError&&d.onError(d);c()};e.src=this.url},e);c.ImageAssetTask=d;var j,e=function(a,b,d,e,f){void 0===f&&(f=c.Texture.TRILINEAR_SAMPLINGMODE);this.name=a;this.url=b;this.noMipmap=d;this.invertY=e;this.samplingMode=f;this.isCompleted=!1};j=(e.prototype.run=
function(a,b,d){var e=this;this.texture=new c.Texture(this.url,a,this.noMipmap,this.invertY,this.samplingMode,function(){e.isCompleted=!0;e.onSuccess&&e.onSuccess(e);b()},function(){e.onError&&e.onError(e);d()})},e);c.TextureAssetTask=j;e=function(a){this._tasks=[];this._waitingTasksCount=0;this.useDefaultLoadingScreen=!0;this._scene=a};e=(e.prototype.addMeshTask=function(a,b,c,d){a=new f(a,b,c,d);return this._tasks.push(a),a},e.prototype.addTextFileTask=function(b,c){var d=new a(b,c);return this._tasks.push(d),
d},e.prototype.addBinaryFileTask=function(a,c){var d=new b(a,c);return this._tasks.push(d),d},e.prototype.addImageTask=function(a,b){var c=new d(a,b);return this._tasks.push(c),c},e.prototype.addTextureTask=function(a,b,d,e,f){void 0===f&&(f=c.Texture.TRILINEAR_SAMPLINGMODE);a=new j(a,b,d,e,f);return this._tasks.push(a),a},e.prototype._decreaseWaitingTasksCount=function(){this._waitingTasksCount--;0===this._waitingTasksCount&&(this.onFinish&&this.onFinish(this._tasks),this._scene.getEngine().hideLoadingUI())},
e.prototype._runTask=function(a){var b=this;a.run(this._scene,function(){b.onTaskSuccess&&b.onTaskSuccess(a);b._decreaseWaitingTasksCount()},function(){b.onTaskError&&b.onTaskError(a);b._decreaseWaitingTasksCount()})},e.prototype.reset=function(){return this._tasks=[],this},e.prototype.load=function(){if(this._waitingTasksCount=this._tasks.length,0===this._waitingTasksCount)return this.onFinish&&this.onFinish(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();
for(var a=0;a<this._tasks.length;a++)this._runTask(this._tasks[a]);return this},e);c.AssetsManager=e}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(){this.compensateDistortion=!0};f=(Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftHMatrix",{get:function(){return c.Matrix.Translation(4*(this.hScreenSize/
4-this.lensSeparationDistance/2)/this.hScreenSize,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightHMatrix",{get:function(){return c.Matrix.Translation(-(4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize),0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftPreViewMatrix",{get:function(){return c.Matrix.Translation(0.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightPreViewMatrix",
{get:function(){return c.Matrix.Translation(-0.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),e.GetDefault=function(){var a=new e;return a.hResolution=1280,a.vResolution=800,a.hScreenSize=0.149759993,a.vScreenSize=0.0935999975,a.vScreenCenter=0.0467999987,a.eyeToScreenDistance=0.0410000011,a.lensSeparationDistance=0.063500002,a.interpupillaryDistance=0.064000003,a.distortionK=[1,0.219999999,0.239999995,0],a.chromaAbCorrection=[0.995999992,-0.00400000019,1.01400006,0],a.postProcessScaleFactor=
1.714605507808412,a.lensCenterOffset=0.151976421,a},e);c.VRCameraMetrics=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.FreeCamera;f=function(a,d,f,g){void 0===g&&(g=!0);e.call(this,a,d,f);this.rotationQuaternion=new c.Quaternion;a=c.VRCameraMetrics.GetDefault();a.compensateDistortion=g;this.setCameraRigMode(c.Camera.RIG_MODE_VR,{vrCameraMetrics:a});this.inputs.addDeviceOrientation()};f=(__extends(f,e),f.prototype.getTypeName=function(){return"VRDeviceOrientationFreeCamera"},f);c.VRDeviceOrientationFreeCamera=f;var a=c.ArcRotateCamera;f=function(b,d,e,g,f,m,l){void 0===l&&(l=!0);a.call(this,
b,d,e,g,f,m);b=c.VRCameraMetrics.GetDefault();b.compensateDistortion=l;this.setCameraRigMode(c.Camera.RIG_MODE_VR,{vrCameraMetrics:b});this.inputs.addVRDeviceOrientation()};f=(__extends(f,a),f.prototype.getTypeName=function(){return"VRDeviceOrientationArcRotateCamera"},f);c.VRDeviceOrientationArcRotateCamera=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.FreeCamera;f=function(a,b,d,f){void 0===f&&(f=!0);e.call(this,a,b,d);this._cacheState=this._sensorDevice=this._hmdDevice=null;this._vrEnabled=!1;a=c.VRCameraMetrics.GetDefault();a.compensateDistortion=f;this.setCameraRigMode(c.Camera.RIG_MODE_VR,{vrCameraMetrics:a});this._getWebVRDevices=this._getWebVRDevices.bind(this);this.rotationQuaternion=new c.Quaternion};f=(__extends(f,e),f.prototype._getWebVRDevices=function(a){var b=a.length,c=0;for(this._hmdDevice=this._sensorDevice=
null;b>c&&null===this._hmdDevice;)a[c]instanceof HMDVRDevice&&(this._hmdDevice=a[c]),c++;for(c=0;b>c&&null===this._sensorDevice;)a[c]instanceof PositionSensorVRDevice&&(!this._hmdDevice||a[c].hardwareUnitId===this._hmdDevice.hardwareUnitId)&&(this._sensorDevice=a[c]),c++;this._vrEnabled=!(!this._sensorDevice||!this._hmdDevice)},f.prototype._checkInputs=function(){this._vrEnabled&&(this._cacheState=this._sensorDevice.getState(),this.rotationQuaternion.copyFrom(this._cacheState.orientation),this.rotationQuaternion.z*=
-1,this.rotationQuaternion.w*=-1);e.prototype._checkInputs.call(this)},f.prototype.attachControl=function(a,b){e.prototype.attachControl.call(this,a,b);navigator.getVRDevices?navigator.getVRDevices().then(this._getWebVRDevices):navigator.mozGetVRDevices&&navigator.mozGetVRDevices(this._getWebVRDevices)},f.prototype.detachControl=function(a){e.prototype.detachControl.call(this,a);this._vrEnabled=!1},f.prototype.requestVRFullscreen=function(a){this._hmdDevice&&this.getEngine().switchFullscreen(a,{vrDisplay:this._hmdDevice})},
f.prototype.getTypeName=function(){return"WebVRFreeCamera"},f);c.WebVRFreeCamera=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(a){void 0===a&&(a=0);this.priority=a;this.apply=function(){return!0}};c.SceneOptimization=f;var e,a=function(a,b){var c=this;void 0===a&&(a=0);void 0===b&&(b=1024);f.call(this,a);this.priority=a;this.maximumSize=b;this.apply=function(a){for(var b=!0,d=0;d<a.textures.length;d++){var e=a.textures[d];if(e.canRescale){var g=e.getSize();Math.max(g.width,g.height)>c.maximumSize&&(e.scale(0.5),b=!1)}}return b}};e=(__extends(a,f),a);c.TextureOptimization=e;var b,a=function(a,
b){var c=this;void 0===a&&(a=0);void 0===b&&(b=2);f.call(this,a);this.priority=a;this.maximumScale=b;this._currentScale=1;this.apply=function(a){return c._currentScale++,a.getEngine().setHardwareScalingLevel(c._currentScale),c._currentScale>=c.maximumScale}};b=(__extends(a,f),a);c.HardwareScalingOptimization=b;var d,a=function(){f.apply(this,arguments);this.apply=function(a){return a.shadowsEnabled=!1,!0}};d=(__extends(a,f),a);c.ShadowsOptimization=d;var j,a=function(){f.apply(this,arguments);this.apply=
function(a){return a.postProcessesEnabled=!1,!0}};j=(__extends(a,f),a);c.PostProcessesOptimization=j;var g,a=function(){f.apply(this,arguments);this.apply=function(a){return a.lensFlaresEnabled=!1,!0}};g=(__extends(a,f),a);c.LensFlaresOptimization=g;var h,a=function(){f.apply(this,arguments);this.apply=function(a){return a.particlesEnabled=!1,!0}};h=(__extends(a,f),a);c.ParticlesOptimization=h;var m,a=function(){f.apply(this,arguments);this.apply=function(a){return a.renderTargetsEnabled=!1,!0}};
m=(__extends(a,f),a);c.RenderTargetsOptimization=m;var l,k=function(){var a=this;f.apply(this,arguments);this._canBeMerged=function(a){return!(a instanceof c.Mesh)?!1:a.isVisible&&a.isEnabled()?0<a.instances.length?!1:a.skeleton||a.hasLODLevels?!1:!a.parent:!1};this.apply=function(b,d){for(var e=b.meshes.slice(0),g=e.length,f=0;g>f;f++){var h=[],j=e[f];if(a._canBeMerged(j)){h.push(j);for(var l=f+1;g>l;l++){var m=e[l];a._canBeMerged(m)&&m.material===j.material&&m.checkCollisions===j.checkCollisions&&
(h.push(m),g--,e.splice(l,1),l--)}2>h.length||c.Mesh.MergeMeshes(h)}}return void 0!=d?d&&b.createOrUpdateSelectionOctree():k.UpdateSelectionTree&&b.createOrUpdateSelectionOctree(),!0}};l=(__extends(k,f),Object.defineProperty(k,"UpdateSelectionTree",{get:function(){return k._UpdateSelectionTree},set:function(a){k._UpdateSelectionTree=a},enumerable:!0,configurable:!0}),k._UpdateSelectionTree=!1,k);c.MergeMeshesOptimization=l;var n,q=function(a,b){void 0===a&&(a=60);void 0===b&&(b=2E3);this.targetFrameRate=
a;this.trackerDuration=b;this.optimizations=[]};n=(q.LowDegradationAllowed=function(a){a=new q(a);var b=0;return a.optimizations.push(new l(b)),a.optimizations.push(new d(b)),a.optimizations.push(new g(b)),b++,a.optimizations.push(new j(b)),a.optimizations.push(new h(b)),b++,a.optimizations.push(new e(b,1024)),a},q.ModerateDegradationAllowed=function(a){a=new q(a);var c=0;return a.optimizations.push(new l(c)),a.optimizations.push(new d(c)),a.optimizations.push(new g(c)),c++,a.optimizations.push(new j(c)),
a.optimizations.push(new h(c)),c++,a.optimizations.push(new e(c,512)),c++,a.optimizations.push(new m(c)),c++,a.optimizations.push(new b(c,2)),a},q.HighDegradationAllowed=function(a){a=new q(a);var c=0;return a.optimizations.push(new l(c)),a.optimizations.push(new d(c)),a.optimizations.push(new g(c)),c++,a.optimizations.push(new j(c)),a.optimizations.push(new h(c)),c++,a.optimizations.push(new e(c,256)),c++,a.optimizations.push(new m(c)),c++,a.optimizations.push(new b(c,4)),a},q);c.SceneOptimizerOptions=
n;var p=function(){},a=(p._CheckCurrentState=function(a,b,c,d,e){if(a.getEngine().getFps()>=b.targetFrameRate)return void(d&&d());for(var g=!0,f=!0,h=0;h<b.optimizations.length;h++){var j=b.optimizations[h];j.priority===c&&(f=!1,g=g&&j.apply(a))}return f?void(e&&e()):(g&&c++,void a.executeWhenReady(function(){setTimeout(function(){p._CheckCurrentState(a,b,c,d,e)},b.trackerDuration)}))},p.OptimizeAsync=function(a,b,c,d){b||(b=n.ModerateDegradationAllowed());a.executeWhenReady(function(){setTimeout(function(){p._CheckCurrentState(a,
b,0,c,d)},b.trackerDuration)})},p);c.SceneOptimizer=a}(BABYLON||(BABYLON={}));!function(c){(c.Internals||(c.Internals={})).MeshLODLevel=function(c,e){this.distance=c;this.mesh=e};!0}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Texture,a=function(a,d,f,g,h,m,l,k){void 0===m&&(m=!0);void 0===l&&(l=!1);void 0===k&&(k=c.Texture.TRILINEAR_SAMPLINGMODE);e.call(this,null,h,!m,l);this.format=g;this._texture=h.getEngine().createRawTexture(a,d,f,g,m,l,k);this.wrapV=this.wrapU=c.Texture.CLAMP_ADDRESSMODE};f=(__extends(a,e),a.prototype.update=function(a){this.getScene().getEngine().updateRawTexture(this._texture,a,this.format,this._invertY)},a.CreateLuminanceTexture=function(b,d,e,g,f,m,l){return void 0===f&&
(f=!0),void 0===m&&(m=!1),void 0===l&&(l=c.Texture.TRILINEAR_SAMPLINGMODE),new a(b,d,e,c.Engine.TEXTUREFORMAT_LUMINANCE,g,f,m,l)},a.CreateLuminanceAlphaTexture=function(b,d,e,g,f,m,l){return void 0===f&&(f=!0),void 0===m&&(m=!1),void 0===l&&(l=c.Texture.TRILINEAR_SAMPLINGMODE),new a(b,d,e,c.Engine.TEXTUREFORMAT_LUMINANCE_ALPHA,g,f,m,l)},a.CreateAlphaTexture=function(b,d,e,g,f,m,l){return void 0===f&&(f=!0),void 0===m&&(m=!1),void 0===l&&(l=c.Texture.TRILINEAR_SAMPLINGMODE),new a(b,d,e,c.Engine.TEXTUREFORMAT_ALPHA,
g,f,m,l)},a.CreateRGBTexture=function(b,d,e,g,f,m,l){return void 0===f&&(f=!0),void 0===m&&(m=!1),void 0===l&&(l=c.Texture.TRILINEAR_SAMPLINGMODE),new a(b,d,e,c.Engine.TEXTUREFORMAT_RGB,g,f,m,l)},a.CreateRGBATexture=function(b,d,e,g,f,m,l){return void 0===f&&(f=!0),void 0===m&&(m=!1),void 0===l&&(l=c.Texture.TRILINEAR_SAMPLINGMODE),new a(b,d,e,c.Engine.TEXTUREFORMAT_RGBA,g,f,m,l)},a);c.RawTexture=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.Vector2,a=function(a,b){e.call(this,a.x,a.y);this.index=b};f=(__extends(a,e),a);var b,a=function(){this.elements=[]};b=(a.prototype.add=function(a){var b=this,c=[];return a.forEach(function(a){if(0===c.length||!a.equalsWithEpsilon(c[0]))a=new f(a,b.elements.length),c.push(a),b.elements.push(a)}),c},a.prototype.computeBounds=function(){var a=new c.Vector2(this.elements[0].x,this.elements[0].y),b=new c.Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(c){c.x<
a.x?a.x=c.x:c.x>b.x&&(b.x=c.x);c.y<a.y?a.y=c.y:c.y>b.y&&(b.y=c.y)}),{min:a,max:b,width:b.x-a.x,height:b.y-a.y}},a);a=function(){};a=(a.Rectangle=function(a,b,e,f){return[new c.Vector2(a,b),new c.Vector2(e,b),new c.Vector2(e,f),new c.Vector2(a,f)]},a.Circle=function(a,b,e,f){void 0===b&&(b=0);void 0===e&&(e=0);void 0===f&&(f=32);for(var m=[],l=0,k=2*Math.PI/f,n=0;f>n;n++)m.push(new c.Vector2(b+Math.cos(l)*a,e+Math.sin(l)*a)),l-=k;return m},a.Parse=function(a){var b=a.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(a){return!isNaN(a)}),
e=[];for(a=0;a<(2147483646&b.length);a+=2)e.push(new c.Vector2(b[a],b[a+1]));return e},a.StartingAt=function(a,b){return c.Path2.StartingAt(a,b)},a);c.Polygon=a;a=function(a,e,g){this._points=new b;this._outlinepoints=new b;this._holes=[];this._epoints=[];this._eholes=[];this._name=a;this._scene=g;a=e instanceof c.Path2?e.getPoints():e;this._addToepoint(a);this._points.add(a);this._outlinepoints.add(a)};a=(a.prototype._addToepoint=function(a){for(var b=0;b<a.length;b++){var c=a[b];this._epoints.push(c.x,
c.y)}},a.prototype.addHole=function(a){this._points.add(a);var c=new b;return c.add(a),this._holes.push(c),this._eholes.push(this._epoints.length/2),this._addToepoint(a),this},a.prototype.build=function(a,b){var e=this;void 0===a&&(a=!1);var f=new c.Mesh(this._name,this._scene),m=[],l=[],k=[],n=this._points.computeBounds();this._points.elements.forEach(function(a){m.push(0,1,0);l.push(a.x,0,a.y);k.push((a.x-n.min.x)/n.width,(a.y-n.min.y)/n.height)});for(var q=[],p=Earcut.earcut(this._epoints,this._eholes,
2),r=0;r<p.length;r++)q.push(p[r]);if(0<b){p=l.length/3;this._points.elements.forEach(function(a){m.push(0,-1,0);l.push(a.x,-b,a.y);k.push(1-(a.x-n.min.x)/n.width,1-(a.y-n.min.y)/n.height)});for(var t=q.length,r=0;t>r;r+=3){var s=q[r+0],u=q[r+1];q.push(q[r+2]+p);q.push(u+p);q.push(s+p)}this.addSide(l,m,k,q,n,this._outlinepoints,b,!1);this._holes.forEach(function(a){e.addSide(l,m,k,q,n,a,b,!0)})}return f.setVerticesData(c.VertexBuffer.PositionKind,l,a),f.setVerticesData(c.VertexBuffer.NormalKind,m,
a),f.setVerticesData(c.VertexBuffer.UVKind,k,a),f.setIndices(q),f},a.prototype.addSide=function(a,b,e,f,m,l,k,n){for(var q=a.length/3,p=0,r=0;r<l.elements.length;r++){var t,s=l.elements[r];t=r+1>l.elements.length-1?l.elements[0]:l.elements[r+1];a.push(s.x,0,s.y);a.push(s.x,-k,s.y);a.push(t.x,0,t.y);a.push(t.x,-k,t.y);s=new c.Vector3(s.x,0,s.y);t=(new c.Vector3(t.x,0,t.y)).subtract(s);s=new c.Vector3(0,1,0);s=c.Vector3.Cross(t,s);s=s.normalize();e.push(p/m.width,0);e.push(p/m.width,1);p+=t.length();
e.push(p/m.width,0);e.push(p/m.width,1);n?(b.push(s.x,s.y,s.z),b.push(s.x,s.y,s.z),b.push(s.x,s.y,s.z),b.push(s.x,s.y,s.z),f.push(q),f.push(q+2),f.push(q+1),f.push(q+1),f.push(q+2),f.push(q+3)):(b.push(-s.x,-s.y,-s.z),b.push(-s.x,-s.y,-s.z),b.push(-s.x,-s.y,-s.z),b.push(-s.x,-s.y,-s.z),f.push(q),f.push(q+1),f.push(q+2),f.push(q+1),f.push(q+3),f.push(q+2));q+=4}},a);c.PolygonMeshBuilder=a}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,b,d){void 0===d&&(d=2);this.maxDepth=d;this.dynamicContent=[];this._maxBlockCapacity=b||64;this._selectionContent=new c.SmartArray(1024);this._creationFunc=a};f=(e.prototype.update=function(a,b,c){e._CreateBlocks(a,b,c,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},e.prototype.addMesh=function(a){for(var b=0;b<this.blocks.length;b++)this.blocks[b].addEntry(a)},e.prototype.select=function(a,b){this._selectionContent.reset();for(var c=0;c<this.blocks.length;c++)this.blocks[c].select(a,
this._selectionContent,b);return b?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e.prototype.intersects=function(a,b,c){this._selectionContent.reset();for(var e=0;e<this.blocks.length;e++)this.blocks[e].intersects(a,b,this._selectionContent,c);return c?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e.prototype.intersectsRay=
function(a){this._selectionContent.reset();for(var b=0;b<this.blocks.length;b++)this.blocks[b].intersectsRay(a,this._selectionContent);return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e._CreateBlocks=function(a,b,d,e,g,f,m,l){m.blocks=[];b=new c.Vector3((b.x-a.x)/2,(b.y-a.y)/2,(b.z-a.z)/2);for(var k=0;2>k;k++)for(var n=0;2>n;n++)for(var q=0;2>q;q++){var p=a.add(b.multiplyByFloats(k,n,q)),r=a.add(b.multiplyByFloats(k+1,n+1,q+1)),p=new c.OctreeBlock(p,
r,e,g+1,f,l);p.addEntries(d);m.blocks.push(p)}},e.CreationFuncForMeshes=function(a,b){!a.isBlocked&&a.getBoundingInfo().boundingBox.intersectsMinMax(b.minPoint,b.maxPoint)&&b.entries.push(a)},e.CreationFuncForSubMeshes=function(a,b){a.getBoundingInfo().boundingBox.intersectsMinMax(b.minPoint,b.maxPoint)&&b.entries.push(a)},e);c.Octree=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(c,a,b,d,f,g){this.entries=[];this._boundingVectors=[];this._capacity=b;this._depth=d;this._maxDepth=f;this._creationFunc=g;this._minPoint=c;this._maxPoint=a;this._boundingVectors.push(c.clone());this._boundingVectors.push(a.clone());this._boundingVectors.push(c.clone());this._boundingVectors[2].x=a.x;this._boundingVectors.push(c.clone());this._boundingVectors[3].y=a.y;this._boundingVectors.push(c.clone());this._boundingVectors[4].z=a.z;this._boundingVectors.push(a.clone());
this._boundingVectors[5].z=c.z;this._boundingVectors.push(a.clone());this._boundingVectors[6].x=c.x;this._boundingVectors.push(a.clone());this._boundingVectors[7].y=c.y};f=(Object.defineProperty(f.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!0,
configurable:!0}),f.prototype.addEntry=function(c){if(this.blocks)for(var a=0;a<this.blocks.length;a++)this.blocks[a].addEntry(c);else this._creationFunc(c,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},f.prototype.addEntries=function(c){for(var a=0;a<c.length;a++)this.addEntry(c[a])},f.prototype.select=function(e,a,b){if(c.BoundingBox.IsInFrustum(this._boundingVectors,e))if(this.blocks)for(var d=0;d<this.blocks.length;d++)this.blocks[d].select(e,a,
b);else b?a.concat(this.entries):a.concatWithNoDuplicate(this.entries)},f.prototype.intersects=function(e,a,b,d){if(c.BoundingBox.IntersectsSphere(this._minPoint,this._maxPoint,e,a))if(this.blocks)for(var f=0;f<this.blocks.length;f++)this.blocks[f].intersects(e,a,b,d);else d?b.concat(this.entries):b.concatWithNoDuplicate(this.entries)},f.prototype.intersectsRay=function(c,a){if(c.intersectsBoxMinMax(this._minPoint,this._maxPoint))if(this.blocks)for(var b=0;b<this.blocks.length;b++)this.blocks[b].intersectsRay(c,
a);else a.concatWithNoDuplicate(this.entries)},f.prototype.createInnerBlocks=function(){c.Octree._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},f);c.OctreeBlock=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.PostProcess;f=function(a,b,d,f,g,h,m,l){var k=this;void 0===h&&(h=c.Texture.BILINEAR_SAMPLINGMODE);e.call(this,a,"blur",["screenSize","direction","blurWidth"],null,f,g,h,m,l);this.direction=b;this.blurWidth=d;this.onApplyObservable.add(function(a){a.setFloat2("screenSize",k.width,k.height);a.setVector2("direction",k.direction);a.setFloat("blurWidth",k.blurWidth)})};f=(__extends(f,e),f);c.BlurPostProcess=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.PostProcess;f=function(a,b,d,f,g,h,m,l,k,n){var q=this;e.call(this,a,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],h,m,l,k,n);this.color=d;this.depth=f;this.colorLevel=g;this.onActivateObservable.add(function(a){q._refRexture=q._refRexture||new c.Texture(b,a.getScene())});this.onApplyObservable.add(function(a){a.setColor3("baseColor",q.color);a.setFloat("depth",q.depth);a.setFloat("colorLevel",q.colorLevel);a.setTexture("refractionSampler",q._refRexture)})};
f=(__extends(f,e),f.prototype.dispose=function(a){this._refRexture&&this._refRexture.dispose();e.prototype.dispose.call(this,a)},f);c.RefractionPostProcess=f}(BABYLON||(BABYLON={}));!function(c){var f,e=c.PostProcess;f=function(a,b,c,f,g,h){e.call(this,a,"blackAndWhite",null,null,b,c,f,g,h)};f=(__extends(f,e),f);c.BlackAndWhitePostProcess=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.PostProcess;f=function(a,b,c,f,g,h,m){var l=this;e.call(this,a,"convolution",["kernel","screenSize"],null,c,f,g,h,m);this.kernel=b;this.onApply=function(a){a.setFloat2("screenSize",l.width,l.height);a.setArray("kernel",l.kernel)}};f=(__extends(f,e),f.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],f.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],f.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],f.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],f.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],f.GaussianKernel=[0,
1,0,1,1,1,0,1,0],f);c.ConvolutionPostProcess=f}(BABYLON||(BABYLON={}));!function(c){var f,e=c.PostProcess;f=function(a,b,c,f,g,h,m){var l=this;e.call(this,a,"filter",["kernelMatrix"],null,c,f,g,h,m);this.kernelMatrix=b;this.onApply=function(a){a.setMatrix("kernelMatrix",l.kernelMatrix)}};f=(__extends(f,e),f);c.FilterPostProcess=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.PostProcess;f=function(a,b,c,f,g,h){var m=this;e.call(this,a,"fxaa",["texelSize"],null,b,c,f,g,h);this.onSizeChangedObservable.add(function(){m.texelWidth=1/m.width;m.texelHeight=1/m.height});this.onApplyObservable.add(function(a){a.setFloat2("texelSize",m.texelWidth,m.texelHeight)})};f=(__extends(f,e),f);c.FxaaPostProcess=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.PostProcess;f=function(a,b,d,f,g,h){var m=this;e.call(this,a,"stereoscopicInterlace",["stepSize"],["camASampler"],1,b[1],f,g,h,d?"#define IS_STEREOSCOPIC_HORIZ 1":void 0);this._passedProcess=b[0]._rigPostProcess;this._stepSize=new c.Vector2(1/this.width,1/this.height);this.onSizeChangedObservable.add(function(){m._stepSize=new c.Vector2(1/m.width,1/m.height)});this.onApplyObservable.add(function(a){a.setTextureFromPostProcess("camASampler",m._passedProcess);a.setFloat2("stepSize",
m._stepSize.x,m._stepSize.y)})};f=(__extends(f,e),f);c.StereoscopicInterlacePostProcess=f}(BABYLON||(BABYLON={}));!function(c){c.LensFlare=function(f,e,a,b,d){this.size=f;this.position=e;this.dispose=function(){this.texture&&this.texture.dispose();var a=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(a,1)};this.color=a||new c.Color3(1,1,1);this.texture=b?new c.Texture(b,d.getScene(),!0):null;this._system=d;d.lensFlares.push(this)}}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a,b,d){this.name=a;this.lensFlares=[];this.borderLimit=300;this.layerMask=268435455;this._vertexBuffers={};this._isEnabled=!0;this._scene=d;this._emitter=b;this.id=a;d.lensFlareSystems.push(this);this.meshesSelectionPredicate=function(a){return a.material&&a.isVisible&&a.isEnabled()&&a.isBlocker&&0!=(a.layerMask&d.activeCamera.layerMask)};a=d.getEngine();b=[];b.push(1,1);b.push(-1,1);b.push(-1,-1);b.push(1,-1);this._vertexBuffers[c.VertexBuffer.PositionKind]=new c.VertexBuffer(a,
b,c.VertexBuffer.PositionKind,!1,!1,2);b=[];b.push(0);b.push(1);b.push(2);b.push(0);b.push(2);b.push(3);this._indexBuffer=a.createIndexBuffer(b);this._effect=a.createEffect("lensFlare",[c.VertexBuffer.PositionKind],["color","viewportMatrix"],["textureSampler"],"")};f=(Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(a){this._isEnabled=a},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEmitter=function(){return this._emitter},
e.prototype.setEmitter=function(a){this._emitter=a},e.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},e.prototype.computeEffectivePosition=function(a){var b=this.getEmitterPosition();return b=c.Vector3.Project(b,c.Matrix.Identity(),this._scene.getTransformMatrix(),a),this._positionX=b.x,this._positionY=b.y,b=c.Vector3.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),0<b.z&&this._positionX>
a.x&&this._positionX<a.x+a.width&&this._positionY>a.y&&this._positionY<a.y+a.height},e.prototype._isVisible=function(){if(!this._isEnabled)return!1;var a=this.getEmitterPosition().subtract(this._scene.activeCamera.position),b=a.length();a.normalize();a=new c.Ray(this._scene.activeCamera.position,a);a=this._scene.pickWithRay(a,this.meshesSelectionPredicate,!0);return!a.hit||a.distance>b},e.prototype.render=function(){if(!this._effect.isReady())return!1;var a=this._scene.getEngine(),b=this._scene.activeCamera.viewport.toGlobal(a.getRenderWidth(!0),
a.getRenderHeight(!0));if(!this.computeEffectivePosition(b)||!this._isVisible())return!1;var d,e;d=this._positionX<this.borderLimit+b.x?this.borderLimit+b.x-this._positionX:this._positionX>b.x+b.width-this.borderLimit?this._positionX-b.x-b.width+this.borderLimit:0;e=this._positionY<this.borderLimit+b.y?this.borderLimit+b.y-this._positionY:this._positionY>b.y+b.height-this.borderLimit?this._positionY-b.y-b.height+this.borderLimit:0;d=d>e?d:e;d>this.borderLimit&&(d=this.borderLimit);d=1-d/this.borderLimit;
if(0>d)return!1;1<d&&(d=1);e=b.x+b.width/2;var g=b.y+b.height/2,f=e-this._positionX,m=g-this._positionY;a.enableEffect(this._effect);a.setState(!1);a.setDepthBuffer(!1);a.setAlphaMode(c.Engine.ALPHA_ONEONE);a.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect);for(var l=0;l<this.lensFlares.length;l++){var k=this.lensFlares[l],n=e-f*k.position,q=g-m*k.position,p=k.size,r=k.size*a.getAspectRatio(this._scene.activeCamera,!0),n=c.Matrix.FromValues(p/2,0,0,0,0,r/2,0,0,0,0,1,0,2*(n/b.width)-
1,1-2*(q/b.height),0,1);this._effect.setMatrix("viewportMatrix",n);this._effect.setTexture("textureSampler",k.texture);this._effect.setFloat4("color",k.color.r*d,k.color.g*d,k.color.b*d,1);a.draw(!0,0,6)}return a.setDepthBuffer(!0),a.setAlphaMode(c.Engine.ALPHA_DISABLE),!0},e.prototype.dispose=function(){var a=this._vertexBuffers[c.VertexBuffer.PositionKind];a&&(a.dispose(),this._vertexBuffers[c.VertexBuffer.PositionKind]=null);for(this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),
this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();a=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(a,1)},e.Parse=function(a,b,d){var f=b.getLastEntryByID(a.emitterId),g=a.name||"lensFlareSystem#"+a.emitterId;b=new e(g,f,b);b.id=a.id||g;b.borderLimit=a.borderLimit;for(g=0;g<a.flares.length;g++)f=a.flares[g],new c.LensFlare(f.size,f.position,c.Color3.FromArray(f.color),d+f.textureName,b);return b},e.prototype.serialize=function(){var a={};a.id=
this.id;a.name=this.name;a.emitterId=this.getEmitter().id;a.borderLimit=this.borderLimit;a.flares=[];for(var b=0;b<this.lensFlares.length;b++){var d=this.lensFlares[b];a.flares.push({size:d.size,position:d.position,color:d.color.asArray(),textureName:c.Tools.GetFilename(d.texture.name)})}return a},e);c.LensFlareSystem=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.FreeCamera;f=function(a,b,c){e.call(this,a,b,c);this.inputs.addDeviceOrientation()};f=(__extends(f,e),Object.defineProperty(f.prototype,"angularSensibility",{get:function(){return 0},set:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"moveSensibility",{get:function(){return 0},set:function(){},enumerable:!0,configurable:!0}),f.prototype.getTypeName=function(){return"DeviceOrientationCamera"},f);c.DeviceOrientationCamera=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.TouchCamera;f=function(a,b,c){e.call(this,a,b,c);this.inputs.addGamepad()};f=(__extends(f,e),Object.defineProperty(f.prototype,"gamepadAngularSensibility",{get:function(){var a=this.inputs.attached.gamepad;return a?a.gamepadAngularSensibility:void 0},set:function(a){var b=this.inputs.attached.gamepad;b&&(b.gamepadAngularSensibility=a)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"gamepadMoveSensibility",{get:function(){var a=this.inputs.attached.gamepad;
return a?a.gamepadMoveSensibility:void 0},set:function(a){var b=this.inputs.attached.gamepad;b&&(b.gamepadMoveSensibility=a)},enumerable:!0,configurable:!0}),f.prototype.getTypeName=function(){return"UniversalCamera"},f);c.UniversalCamera=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=function(a){var b=this;this.babylonGamepads=[];this.isMonitoring=this.oneGamepadConnected=!1;this.gamepadEventSupported="GamepadEvent"in window;this.gamepadSupportAvailable=navigator.getGamepads||!!navigator.webkitGetGamepads||!!navigator.msGetGamepads||!!navigator.webkitGamepads;this._callbackGamepadConnected=a;this.gamepadSupportAvailable&&(this.gamepadEventSupported?(this._onGamepadConnectedEvent=function(a){b._onGamepadConnected(a)},this._onGamepadDisonnectedEvent=function(a){b._onGamepadDisconnected(a)},
window.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisonnectedEvent,!1)):this._startMonitoringGamepads())};f=(e.prototype.dispose=function(){e.gamepadDOMInfo&&document.body.removeChild(e.gamepadDOMInfo);this._onGamepadConnectedEvent&&(window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),window.removeEventListener("gamepaddisconnected",this._onGamepadDisonnectedEvent,!1),this._onGamepadConnectedEvent=
null,this._onGamepadDisonnectedEvent=null)},e.prototype._onGamepadConnected=function(a){a=this._addNewGamepad(a.gamepad);this._callbackGamepadConnected&&this._callbackGamepadConnected(a);this._startMonitoringGamepads()},e.prototype._addNewGamepad=function(a){this.oneGamepadConnected||(this.oneGamepadConnected=!0,e.gamepadDOMInfo&&(document.body.removeChild(e.gamepadDOMInfo),e.gamepadDOMInfo=null));var c;return c=-1!==a.id.search("Xbox 360")||-1!==a.id.search("xinput")?new g(a.id,a.index,a):new b(a.id,
a.index,a),this.babylonGamepads.push(c),c},e.prototype._onGamepadDisconnected=function(a){for(var b in this.babylonGamepads)if(this.babylonGamepads[b].index==a.gamepad.index){this.babylonGamepads.splice(+b,1);break}0==this.babylonGamepads.length&&this._stopMonitoringGamepads()},e.prototype._startMonitoringGamepads=function(){this.isMonitoring||(this.isMonitoring=!0,this._checkGamepadsStatus())},e.prototype._stopMonitoringGamepads=function(){this.isMonitoring=!1},e.prototype._checkGamepadsStatus=function(){var a=
this;this._updateGamepadObjects();for(var b in this.babylonGamepads)this.babylonGamepads[b].update();this.isMonitoring&&(window.requestAnimationFrame?window.requestAnimationFrame(function(){a._checkGamepadsStatus()}):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(function(){a._checkGamepadsStatus()}):window.webkitRequestAnimationFrame&&window.webkitRequestAnimationFrame(function(){a._checkGamepadsStatus()}))},e.prototype._updateGamepadObjects=function(){for(var a=navigator.getGamepads?
navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],b=0;b<a.length;b++)if(a[b])if(a[b].index in this.babylonGamepads)this.babylonGamepads[b].browserGamepad=a[b];else{var c=this._addNewGamepad(a[b]);this._callbackGamepadConnected&&this._callbackGamepadConnected(c)}},e);c.Gamepads=f;c.StickValues=function(a,b){this.x=a;this.y=b};var a;f=function(a,b,c){this.id=a;this.index=b;this.browserGamepad=c;2<=this.browserGamepad.axes.length&&(this._leftStick={x:this.browserGamepad.axes[0],
y:this.browserGamepad.axes[1]});4<=this.browserGamepad.axes.length&&(this._rightStick={x:this.browserGamepad.axes[2],y:this.browserGamepad.axes[3]})};a=(f.prototype.onleftstickchanged=function(a){this._onleftstickchanged=a},f.prototype.onrightstickchanged=function(a){this._onrightstickchanged=a},Object.defineProperty(f.prototype,"leftStick",{get:function(){return this._leftStick},set:function(a){!this._onleftstickchanged||this._leftStick.x===a.x&&this._leftStick.y===a.y||this._onleftstickchanged(a);
this._leftStick=a},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"rightStick",{get:function(){return this._rightStick},set:function(a){!this._onrightstickchanged||this._rightStick.x===a.x&&this._rightStick.y===a.y||this._onrightstickchanged(a);this._rightStick=a},enumerable:!0,configurable:!0}),f.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[0],y:this.browserGamepad.axes[1]});this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[2],
y:this.browserGamepad.axes[3]})},f);c.Gamepad=a;var b;f=function(b,c,d){a.call(this,b,c,d);this.id=b;this.index=c;this.gamepad=d;this._buttons=Array(d.buttons.length)};b=(__extends(f,a),f.prototype.onbuttondown=function(a){this._onbuttondown=a},f.prototype.onbuttonup=function(a){this._onbuttonup=a},f.prototype._setButtonValue=function(a,b,c){return a!==b&&(this._onbuttondown&&1===a&&this._onbuttondown(c),this._onbuttonup&&0===a&&this._onbuttonup(c)),a},f.prototype.update=function(){a.prototype.update.call(this);
for(var b=0;b<this._buttons.length;b++)this._buttons[b]=this._setButtonValue(this.gamepad.buttons[b].value,this._buttons[b],b)},f);c.GenericPad=b;f=c.Xbox360Button||(c.Xbox360Button={});f[f.A=0]="A";f[f.B=1]="B";f[f.X=2]="X";f[f.Y=3]="Y";f[f.Start=4]="Start";f[f.Back=5]="Back";f[f.LB=6]="LB";f[f.RB=7]="RB";f[f.LeftStick=8]="LeftStick";f[f.RightStick=9]="RightStick";var d=c.Xbox360Button;f=c.Xbox360Dpad||(c.Xbox360Dpad={});f[f.Up=0]="Up";f[f.Down=1]="Down";f[f.Left=2]="Left";f[f.Right=3]="Right";!0;
var j=c.Xbox360Dpad,g;f=function(){a.apply(this,arguments);this._dPadRight=this._dPadLeft=this._dPadDown=this._dPadUp=this._buttonRightStick=this._buttonLeftStick=this._buttonRB=this._buttonLB=this._buttonStart=this._buttonBack=this._buttonY=this._buttonX=this._buttonB=this._buttonA=this._rightTrigger=this._leftTrigger=0};g=(__extends(f,a),f.prototype.onlefttriggerchanged=function(a){this._onlefttriggerchanged=a},f.prototype.onrighttriggerchanged=function(a){this._onrighttriggerchanged=a},Object.defineProperty(f.prototype,
"leftTrigger",{get:function(){return this._leftTrigger},set:function(a){this._onlefttriggerchanged&&this._leftTrigger!==a&&this._onlefttriggerchanged(a);this._leftTrigger=a},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(a){this._onrighttriggerchanged&&this._rightTrigger!==a&&this._onrighttriggerchanged(a);this._rightTrigger=a},enumerable:!0,configurable:!0}),f.prototype.onbuttondown=function(a){this._onbuttondown=
a},f.prototype.onbuttonup=function(a){this._onbuttonup=a},f.prototype.ondpaddown=function(a){this._ondpaddown=a},f.prototype.ondpadup=function(a){this._ondpadup=a},f.prototype._setButtonValue=function(a,b,c){return a!==b&&(this._onbuttondown&&1===a&&this._onbuttondown(c),this._onbuttonup&&0===a&&this._onbuttonup(c)),a},f.prototype._setDPadValue=function(a,b,c){return a!==b&&(this._ondpaddown&&1===a&&this._ondpaddown(c),this._ondpadup&&0===a&&this._ondpadup(c)),a},Object.defineProperty(f.prototype,
"buttonA",{get:function(){return this._buttonA},set:function(a){this._buttonA=this._setButtonValue(a,this._buttonA,d.A)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"buttonB",{get:function(){return this._buttonB},set:function(a){this._buttonB=this._setButtonValue(a,this._buttonB,d.B)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"buttonX",{get:function(){return this._buttonX},set:function(a){this._buttonX=this._setButtonValue(a,this._buttonX,d.X)},enumerable:!0,
configurable:!0}),Object.defineProperty(f.prototype,"buttonY",{get:function(){return this._buttonY},set:function(a){this._buttonY=this._setButtonValue(a,this._buttonY,d.Y)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(a){this._buttonStart=this._setButtonValue(a,this._buttonStart,d.Start)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(a){this._buttonBack=
this._setButtonValue(a,this._buttonBack,d.Back)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(a){this._buttonLB=this._setButtonValue(a,this._buttonLB,d.LB)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(a){this._buttonRB=this._setButtonValue(a,this._buttonRB,d.RB)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"buttonLeftStick",
{get:function(){return this._buttonLeftStick},set:function(a){this._buttonLeftStick=this._setButtonValue(a,this._buttonLeftStick,d.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(a){this._buttonRightStick=this._setButtonValue(a,this._buttonRightStick,d.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(a){this._dPadUp=
this._setDPadValue(a,this._dPadUp,j.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(a){this._dPadDown=this._setDPadValue(a,this._dPadDown,j.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(a){this._dPadLeft=this._setDPadValue(a,this._dPadLeft,j.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"dPadRight",
{get:function(){return this._dPadRight},set:function(a){this._dPadRight=this._setDPadValue(a,this._dPadRight,j.Right)},enumerable:!0,configurable:!0}),f.prototype.update=function(){a.prototype.update.call(this);this.buttonA=this.browserGamepad.buttons[0].value;this.buttonB=this.browserGamepad.buttons[1].value;this.buttonX=this.browserGamepad.buttons[2].value;this.buttonY=this.browserGamepad.buttons[3].value;this.buttonLB=this.browserGamepad.buttons[4].value;this.buttonRB=this.browserGamepad.buttons[5].value;
this.leftTrigger=this.browserGamepad.buttons[6].value;this.rightTrigger=this.browserGamepad.buttons[7].value;this.buttonBack=this.browserGamepad.buttons[8].value;this.buttonStart=this.browserGamepad.buttons[9].value;this.buttonLeftStick=this.browserGamepad.buttons[10].value;this.buttonRightStick=this.browserGamepad.buttons[11].value;this.dPadUp=this.browserGamepad.buttons[12].value;this.dPadDown=this.browserGamepad.buttons[13].value;this.dPadLeft=this.browserGamepad.buttons[14].value;this.dPadRight=
this.browserGamepad.buttons[15].value},f);c.Xbox360Pad=g}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.UniversalCamera;f=function(a,b,d){c.Tools.Warn("Deprecated. Please use Universal Camera instead.");e.call(this,a,b,d)};f=(__extends(f,e),Object.defineProperty(f.prototype,"gamepadAngularSensibility",{get:function(){var a=this.inputs.attached.gamepad;return a?a.gamepadAngularSensibility:void 0},set:function(a){var b=this.inputs.attached.gamepad;b&&(b.gamepadAngularSensibility=a)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"gamepadMoveSensibility",{get:function(){var a=
this.inputs.attached.gamepad;return a?a.gamepadMoveSensibility:void 0},set:function(a){var b=this.inputs.attached.gamepad;b&&(b.gamepadMoveSensibility=a)},enumerable:!0,configurable:!0}),f.prototype.getTypeName=function(){return"GamepadCamera"},f);c.GamepadCamera=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(e){this.SMOOTHING=0.75;this.FFT_SIZE=512;this.BARGRAPHAMPLITUDE=256;this.DEBUGCANVASPOS={x:20,y:20};this.DEBUGCANVASSIZE={width:320,height:200};this._scene=e;this._audioEngine=c.Engine.audioEngine;this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),
this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))};f=(f.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},f.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},f.prototype.getByteTimeDomainData=
function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},f.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},
f.prototype.drawDebugCanvas=function(){var c=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement("canvas"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position="absolute",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+"px",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+"px",this._debugCanvasContext=this._debugCanvas.getContext("2d"),document.body.appendChild(this._debugCanvas),
this._registerFunc=function(){c.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc)){var a=this.getByteFrequencyData();this._debugCanvasContext.fillStyle="rgb(0, 0, 0)";this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var b=0;b<this.getFrequencyBinCount();b++){var d=this.DEBUGCANVASSIZE.height*(a[b]/this.BARGRAPHAMPLITUDE),f=this.DEBUGCANVASSIZE.height-d-1,g=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),
h=360*(b/this.getFrequencyBinCount());this._debugCanvasContext.fillStyle="hsl("+h+", 100%, 50%)";this._debugCanvasContext.fillRect(b*g,f,g,d)}}},f.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null,document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},f.prototype.connectAudioNodes=function(c,a){this._audioEngine.canUseWebAudio&&(c.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(a))},
f.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},f);c.Analyser=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(e,a){var b=this;void 0===a&&(a=c.Engine.TEXTURETYPE_FLOAT);this._viewMatrix=c.Matrix.Zero();this._projectionMatrix=c.Matrix.Zero();this._transformMatrix=c.Matrix.Zero();this._worldViewProjection=c.Matrix.Zero();this._scene=e;var d=e.getEngine();this._depthMap=new c.RenderTargetTexture("depthMap",{width:d.getRenderWidth(),height:d.getRenderHeight()},this._scene,!1,!0,a);this._depthMap.wrapU=c.Texture.CLAMP_ADDRESSMODE;this._depthMap.wrapV=c.Texture.CLAMP_ADDRESSMODE;this._depthMap.refreshRate=
1;this._depthMap.renderParticles=!1;this._depthMap.renderList=null;this._depthMap.onClearObservable.add(function(a){a.clear(new c.Color4(1,1,1,1),!0,!0)});var f=function(a){var d=a.getRenderingMesh(),e=b._scene,f=e.getEngine();f.setState(a.getMaterial().backFaceCulling);var j=d._getInstancesRenderList(a._id);if(!j.mustReturn){var n=null!==f.getCaps().instancedArrays&&null!==j.visibleInstances[a._id];if(b.isReady(a,n)){f.enableEffect(b._effect);d._bind(a,b._effect,c.Material.TriangleFillMode);f=a.getMaterial();
if(b._effect.setMatrix("viewProjection",e.getTransformMatrix()),b._effect.setFloat("far",e.activeCamera.maxZ),f&&f.needAlphaTesting())e=f.getAlphaTestTexture(),b._effect.setTexture("diffuseSampler",e),b._effect.setMatrix("diffuseMatrix",e.getTextureMatrix());d.useBones&&d.computeBonesUsingShaders&&b._effect.setMatrices("mBones",d.skeleton.getTransformMatrices(d));d._processRendering(a,b._effect,c.Material.TriangleFillMode,j,n,function(a,c){return b._effect.setMatrix("world",c)})}}};this._depthMap.customRenderFunction=
function(a,b){var c;for(c=0;c<a.length;c++)f(a.data[c]);for(c=0;c<b.length;c++)f(b.data[c])}};f=(f.prototype.isReady=function(e,a){var b=e.getMaterial();if(b.disableDepthWrite)return!1;var d=[],f=[c.VertexBuffer.PositionKind],g=e.getMesh();g.getScene();b&&b.needAlphaTesting()&&(d.push("#define ALPHATEST"),g.isVerticesDataPresent(c.VertexBuffer.UVKind)&&(f.push(c.VertexBuffer.UVKind),d.push("#define UV1")),g.isVerticesDataPresent(c.VertexBuffer.UV2Kind)&&(f.push(c.VertexBuffer.UV2Kind),d.push("#define UV2")));
g.useBones&&g.computeBonesUsingShaders?(f.push(c.VertexBuffer.MatricesIndicesKind),f.push(c.VertexBuffer.MatricesWeightsKind),4<g.numBoneInfluencers&&(f.push(c.VertexBuffer.MatricesIndicesExtraKind),f.push(c.VertexBuffer.MatricesWeightsExtraKind)),d.push("#define NUM_BONE_INFLUENCERS "+g.numBoneInfluencers),d.push("#define BonesPerMesh "+(g.skeleton.bones.length+1))):d.push("#define NUM_BONE_INFLUENCERS 0");a&&(d.push("#define INSTANCES"),f.push("world0"),f.push("world1"),f.push("world2"),f.push("world3"));
b=d.join("\n");return this._cachedDefines!==b&&(this._cachedDefines=b,this._effect=this._scene.getEngine().createEffect("depth",f,["world","mBones","viewProjection","diffuseMatrix","far"],["diffuseSampler"],b)),this._effect.isReady()},f.prototype.getDepthMap=function(){return this._depthMap},f.prototype.dispose=function(){this._depthMap.dispose()},f);c.DepthRenderer=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.PostProcessRenderPipeline;f=function(a,b,d,f){var g=this;e.call(this,b.getEngine(),a);this.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect";this.SSAORenderEffect="SSAORenderEffect";this.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect";this.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect";this.SSAOCombineRenderEffect="SSAOCombineRenderEffect";this.totalStrength=1;this.radius=1E-4;this.area=0.0075;this.fallOff=1E-6;this.base=0.5;this._firstUpdate=!0;this._scene=b;this._createRandomTexture();
this._depthTexture=b.enableDepthRenderer().getDepthMap();var h=d.ssaoRatio||d;d=d.combineRatio||d;this._ratio={ssaoRatio:h,combineRatio:d};this._originalColorPostProcess=new c.PassPostProcess("SSAOOriginalSceneColor",d,null,c.Texture.BILINEAR_SAMPLINGMODE,b.getEngine(),!1);this._createSSAOPostProcess(h);this._createBlurPostProcess(h);this._createSSAOCombinePostProcess(d);this.addEffect(new c.PostProcessRenderEffect(b.getEngine(),this.SSAOOriginalSceneColorEffect,function(){return g._originalColorPostProcess},
!0));this.addEffect(new c.PostProcessRenderEffect(b.getEngine(),this.SSAORenderEffect,function(){return g._ssaoPostProcess},!0));this.addEffect(new c.PostProcessRenderEffect(b.getEngine(),this.SSAOBlurHRenderEffect,function(){return g._blurHPostProcess},!0));this.addEffect(new c.PostProcessRenderEffect(b.getEngine(),this.SSAOBlurVRenderEffect,function(){return g._blurVPostProcess},!0));this.addEffect(new c.PostProcessRenderEffect(b.getEngine(),this.SSAOCombineRenderEffect,function(){return g._ssaoCombinePostProcess},
!0));b.postProcessRenderPipelineManager.addPipeline(this);f&&b.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(a,f)};f=(__extends(f,e),f.prototype.getBlurHPostProcess=function(){return c.Tools.Error("SSAORenderinPipeline.getBlurHPostProcess() is deprecated, no more blur post-process exists"),null},f.prototype.getBlurVPostProcess=function(){return c.Tools.Error("SSAORenderinPipeline.getBlurVPostProcess() is deprecated, no more blur post-process exists"),null},f.prototype.dispose=function(a){void 0===
a&&(a=!1);for(var b=0;b<this._scene.cameras.length;b++){var c=this._scene.cameras[b];this._originalColorPostProcess.dispose(c);this._ssaoPostProcess.dispose(c);this._blurHPostProcess.dispose(c);this._blurVPostProcess.dispose(c);this._ssaoCombinePostProcess.dispose(c)}this._randomTexture.dispose();a&&this._scene.disableDepthRenderer();this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras)},f.prototype._createBlurPostProcess=function(a){for(var b=
this,d=[],e=-8;8>e;e++)d.push(2*e);this._blurHPostProcess=new c.PostProcess("BlurH","ssao",["outSize","samplerOffsets"],["depthSampler"],a,null,c.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16");this._blurHPostProcess.onApply=function(a){a.setFloat("outSize",b._ssaoCombinePostProcess.width);a.setTexture("depthSampler",b._depthTexture);b._firstUpdate&&a.setArray("samplerOffsets",d)};this._blurVPostProcess=new c.PostProcess("BlurV",
"ssao",["outSize","samplerOffsets"],["depthSampler"],a,null,c.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define SAMPLES 16");this._blurVPostProcess.onApply=function(a){a.setFloat("outSize",b._ssaoCombinePostProcess.height);a.setTexture("depthSampler",b._depthTexture);b._firstUpdate&&(a.setArray("samplerOffsets",d),b._firstUpdate=!1)}},f.prototype._createSSAOPostProcess=function(a){var b=this,d=[0.5381,0.1856,-0.4319,0.1379,0.2486,0.443,0.3371,0.5679,-0.0057,
-0.6999,-0.0451,-0.0019,0.0689,-0.1598,-0.8547,0.056,0.0069,-0.1843,-0.0146,0.1402,0.0762,0.01,-0.1924,-0.0344,-0.3577,-0.5301,-0.4358,-0.3169,0.1063,0.0158,0.0103,-0.5869,0.0046,-0.0897,-0.494,0.3287,0.7119,-0.0154,-0.0918,-0.0533,0.0596,-0.5411,0.0352,-0.0631,0.546,-0.4776,0.2847,-0.0271];this._ssaoPostProcess=new c.PostProcess("ssao","ssao","sampleSphere samplesFactor randTextureTiles totalStrength radius area fallOff base range viewport".split(" "),["randomSampler"],a,null,c.Texture.BILINEAR_SAMPLINGMODE,
this._scene.getEngine(),!1,"#define SAMPLES 16\n#define SSAO");new c.Vector2(0,0);this._ssaoPostProcess.onApply=function(a){b._firstUpdate&&(a.setArray3("sampleSphere",d),a.setFloat("samplesFactor",0.0625),a.setFloat("randTextureTiles",4));a.setFloat("totalStrength",b.totalStrength);a.setFloat("radius",b.radius);a.setFloat("area",b.area);a.setFloat("fallOff",b.fallOff);a.setFloat("base",b.base);a.setTexture("textureSampler",b._depthTexture);a.setTexture("randomSampler",b._randomTexture)}},f.prototype._createSSAOCombinePostProcess=
function(a){var b=this;this._ssaoCombinePostProcess=new c.PostProcess("ssaoCombine","ssaoCombine",[],["originalColor"],a,null,c.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1);this._ssaoCombinePostProcess.onApply=function(a){a.setTextureFromPostProcess("originalColor",b._originalColorPostProcess)}},f.prototype._createRandomTexture=function(){this._randomTexture=new c.DynamicTexture("SSAORandomTexture",512,this._scene,!1,c.Texture.TRILINEAR_SAMPLINGMODE);this._randomTexture.wrapU=c.Texture.WRAP_ADDRESSMODE;
this._randomTexture.wrapV=c.Texture.WRAP_ADDRESSMODE;for(var a=this._randomTexture.getContext(),b=c.Vector3.Zero(),d=0;512>d;d++)for(var e=0;512>e;e++)b.x=Math.floor(255*(2*Math.random()+-1)),b.y=Math.floor(255*(2*Math.random()+-1)),b.z=Math.floor(255*(2*Math.random()+-1)),a.fillStyle="rgb("+b.x+", "+b.y+", "+b.z+")",a.fillRect(d,e,1,1);this._randomTexture.update(!1)},__decorate([c.serialize()],f.prototype,"totalStrength",void 0),__decorate([c.serialize()],f.prototype,"radius",void 0),__decorate([c.serialize()],
f.prototype,"area",void 0),__decorate([c.serialize()],f.prototype,"fallOff",void 0),__decorate([c.serialize()],f.prototype,"base",void 0),__decorate([c.serialize()],f.prototype,"_ratio",void 0),f);c.SSAORenderingPipeline=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.PostProcess,a=function(b,d,f,g,h,m,l,k,n){var q=this;void 0===h&&(h=100);void 0===m&&(m=c.Texture.BILINEAR_SAMPLINGMODE);e.call(this,b,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],d.postProcessRatio||d,f,m,l,k,"#define NUM_SAMPLES "+h);this._screenCoordinates=c.Vector2.Zero();this.customMeshPosition=c.Vector3.Zero();this.useCustomMeshPosition=!1;this.invert=!0;this.excludedMeshes=[];this.exposure=0.3;this.decay=
0.96815;this.weight=0.58767;this.density=0.926;n=null===f?n:f.getScene();l=n.getEngine();this._viewPort=(new c.Viewport(0,0,1,1)).toGlobal(l.getRenderWidth(),l.getRenderHeight());this.mesh=null!==g?g:a.CreateDefaultMesh("VolumetricLightScatteringMesh",n);this._createPass(n,d.passRatio||d);this.onActivate=function(a){q.isSupported||q.dispose(a);q.onActivate=null};this.onApplyObservable.add(function(a){q._updateMeshScreenCoordinates(n);a.setTexture("lightScatteringSampler",q._volumetricLightScatteringRTT);
a.setFloat("exposure",q.exposure);a.setFloat("decay",q.decay);a.setFloat("weight",q.weight);a.setFloat("density",q.density);a.setVector2("meshPositionOnScreen",q._screenCoordinates)})};f=(__extends(a,e),Object.defineProperty(a.prototype,"useDiffuseColor",{get:function(){return c.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"),!1},set:function(){c.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead")},
enumerable:!0,configurable:!0}),a.prototype.isReady=function(a,d){var e=a.getMesh();if(e===this.mesh)return e.material.isReady(e);var g=[],f=[c.VertexBuffer.PositionKind],m=a.getMaterial();m&&(m.needAlphaTesting()&&g.push("#define ALPHATEST"),e.isVerticesDataPresent(c.VertexBuffer.UVKind)&&(f.push(c.VertexBuffer.UVKind),g.push("#define UV1")),e.isVerticesDataPresent(c.VertexBuffer.UV2Kind)&&(f.push(c.VertexBuffer.UV2Kind),g.push("#define UV2")));e.useBones&&e.computeBonesUsingShaders?(f.push(c.VertexBuffer.MatricesIndicesKind),
f.push(c.VertexBuffer.MatricesWeightsKind),g.push("#define NUM_BONE_INFLUENCERS "+e.numBoneInfluencers),g.push("#define BonesPerMesh "+(e.skeleton.bones.length+1))):g.push("#define NUM_BONE_INFLUENCERS 0");d&&(g.push("#define INSTANCES"),f.push("world0"),f.push("world1"),f.push("world2"),f.push("world3"));g=g.join("\n");return this._cachedDefines!==g&&(this._cachedDefines=g,this._volumetricLightScatteringPass=e.getScene().getEngine().createEffect({vertexElement:"depth",fragmentElement:"volumetricLightScatteringPass"},
f,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],g)),this._volumetricLightScatteringPass.isReady()},a.prototype.setCustomMeshPosition=function(a){this.customMeshPosition=a},a.prototype.getCustomMeshPosition=function(){return this.customMeshPosition},a.prototype.dispose=function(a){var c=a.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==c&&a.getScene().customRenderTargets.splice(c,1);this._volumetricLightScatteringRTT.dispose();e.prototype.dispose.call(this,
a)},a.prototype.getPass=function(){return this._volumetricLightScatteringRTT},a.prototype._meshExcluded=function(a){return 0<this.excludedMeshes.length&&-1!==this.excludedMeshes.indexOf(a)},a.prototype._createPass=function(a,d){var e=this,g=a.getEngine();this._volumetricLightScatteringRTT=new c.RenderTargetTexture("volumetricLightScatteringMap",{width:g.getRenderWidth()*d,height:g.getRenderHeight()*d},a,!1,!0,c.Engine.TEXTURETYPE_UNSIGNED_INT);this._volumetricLightScatteringRTT.wrapU=c.Texture.CLAMP_ADDRESSMODE;
this._volumetricLightScatteringRTT.wrapV=c.Texture.CLAMP_ADDRESSMODE;this._volumetricLightScatteringRTT.renderList=null;this._volumetricLightScatteringRTT.renderParticles=!1;a.customRenderTargets.push(this._volumetricLightScatteringRTT);var f,m=function(a){var b=a.getRenderingMesh();if(!e._meshExcluded(b)){var d=b.getScene(),g=d.getEngine();g.setState(a.getMaterial().backFaceCulling);var f=b._getInstancesRenderList(a._id);if(!f.mustReturn){var h=null!==g.getCaps().instancedArrays&&null!==f.visibleInstances[a._id];
if(e.isReady(a,h)){var l=e._volumetricLightScatteringPass;if(b===e.mesh&&(l=a.getMaterial().getEffect()),g.enableEffect(l),b._bind(a,l,c.Material.TriangleFillMode),b===e.mesh)a.getMaterial().bind(b.getWorldMatrix(),b);else{g=a.getMaterial();if(e._volumetricLightScatteringPass.setMatrix("viewProjection",d.getTransformMatrix()),g&&g.needAlphaTesting())d=g.getAlphaTestTexture(),e._volumetricLightScatteringPass.setTexture("diffuseSampler",d),d&&e._volumetricLightScatteringPass.setMatrix("diffuseMatrix",
d.getTextureMatrix());b.useBones&&b.computeBonesUsingShaders&&e._volumetricLightScatteringPass.setMatrices("mBones",b.skeleton.getTransformMatrices(b))}b._processRendering(a,e._volumetricLightScatteringPass,c.Material.TriangleFillMode,f,h,function(a,b){return l.setMatrix("world",b)})}}}},l=new c.Color4(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRenderObservable.add(function(){f=a.clearColor;a.clearColor=l});this._volumetricLightScatteringRTT.onAfterRenderObservable.add(function(){a.clearColor=
f});this._volumetricLightScatteringRTT.customRenderFunction=function(d,e,g){var f,h=a.getEngine();for(f=0;f<d.length;f++)m(d.data[f]);h.setAlphaTesting(!0);for(f=0;f<e.length;f++)m(e.data[f]);if(h.setAlphaTesting(!1),g.length){for(f=0;f<g.length;f++)d=g.data[f],d._alphaIndex=d.getMesh().alphaIndex,d._distanceToCamera=d.getBoundingInfo().boundingSphere.centerWorld.subtract(a.activeCamera.position).length();g=g.data.slice(0,g.length);g.sort(function(a,b){return a._alphaIndex>b._alphaIndex?1:a._alphaIndex<
b._alphaIndex?-1:a._distanceToCamera<b._distanceToCamera?1:a._distanceToCamera>b._distanceToCamera?-1:0});h.setAlphaMode(c.Engine.ALPHA_COMBINE);for(f=0;f<g.length;f++)m(g[f]);h.setAlphaMode(c.Engine.ALPHA_DISABLE)}}},a.prototype._updateMeshScreenCoordinates=function(a){var d=a.getTransformMatrix();a=this.useCustomMeshPosition?this.customMeshPosition:this.attachedNode?this.attachedNode.position:this.mesh.parent?this.mesh.getAbsolutePosition():this.mesh.position;a=c.Vector3.Project(a,c.Matrix.Identity(),
d,this._viewPort);this._screenCoordinates.x=a.x/this._viewPort.width;this._screenCoordinates.y=a.y/this._viewPort.height;this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},a.CreateDefaultMesh=function(a,d){var e=c.Mesh.CreatePlane(a,1,d);e.billboardMode=c.AbstractMesh.BILLBOARDMODE_ALL;var g=new c.StandardMaterial(a+"Material",d);return g.emissiveColor=new c.Color3(1,1,1),e.material=g,e},__decorate([c.serializeAsVector3()],a.prototype,"customMeshPosition",void 0),__decorate([c.serialize()],
a.prototype,"useCustomMeshPosition",void 0),__decorate([c.serialize()],a.prototype,"invert",void 0),__decorate([c.serializeAsMeshReference()],a.prototype,"mesh",void 0),__decorate([c.serialize()],a.prototype,"excludedMeshes",void 0),__decorate([c.serialize()],a.prototype,"exposure",void 0),__decorate([c.serialize()],a.prototype,"decay",void 0),__decorate([c.serialize()],a.prototype,"weight",void 0),__decorate([c.serialize()],a.prototype,"density",void 0),a);c.VolumetricLightScatteringPostProcess=
f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.PostProcessRenderPipeline;f=function(a,b,d,f,g){var h=this;void 0===f&&(f=1);e.call(this,d.getEngine(),a);this.LensChromaticAberrationEffect="LensChromaticAberrationEffect";this.HighlightsEnhancingEffect="HighlightsEnhancingEffect";this.LensDepthOfFieldEffect="LensDepthOfFieldEffect";this._scene=d;this._depthTexture=d.enableDepthRenderer().getDepthMap();b.grain_texture?this._grainTexture=b.grain_texture:this._createGrainTexture();this._edgeBlur=b.edge_blur?b.edge_blur:0;this._grainAmount=
b.grain_amount?b.grain_amount:0;this._chromaticAberration=b.chromatic_aberration?b.chromatic_aberration:0;this._distortion=b.distortion?b.distortion:0;this._highlightsGain=void 0!==b.dof_gain?b.dof_gain:-1;this._highlightsThreshold=b.dof_threshold?b.dof_threshold:1;this._dofDistance=void 0!==b.dof_focus_distance?b.dof_focus_distance:-1;this._dofAperture=b.dof_aperture?b.dof_aperture:1;this._dofDarken=b.dof_darken?b.dof_darken:0;this._dofPentagon=void 0!==b.dof_pentagon?b.dof_pentagon:!0;this._blurNoise=
void 0!==b.blur_noise?b.blur_noise:!0;this._createChromaticAberrationPostProcess(f);this._createHighlightsPostProcess(f);this._createDepthOfFieldPostProcess(f/4);this.addEffect(new c.PostProcessRenderEffect(d.getEngine(),this.LensChromaticAberrationEffect,function(){return h._chromaticAberrationPostProcess},!0));this.addEffect(new c.PostProcessRenderEffect(d.getEngine(),this.HighlightsEnhancingEffect,function(){return h._highlightsPostProcess},!0));this.addEffect(new c.PostProcessRenderEffect(d.getEngine(),
this.LensDepthOfFieldEffect,function(){return h._depthOfFieldPostProcess},!0));-1===this._highlightsGain&&this._disableEffect(this.HighlightsEnhancingEffect,null);d.postProcessRenderPipelineManager.addPipeline(this);g&&d.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(a,g)};f=(__extends(f,e),f.prototype.setEdgeBlur=function(a){this._edgeBlur=a},f.prototype.disableEdgeBlur=function(){this._edgeBlur=0},f.prototype.setGrainAmount=function(a){this._grainAmount=a},f.prototype.disableGrain=
function(){this._grainAmount=0},f.prototype.setChromaticAberration=function(a){this._chromaticAberration=a},f.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},f.prototype.setEdgeDistortion=function(a){this._distortion=a},f.prototype.disableEdgeDistortion=function(){this._distortion=0},f.prototype.setFocusDistance=function(a){this._dofDistance=a},f.prototype.disableDepthOfField=function(){this._dofDistance=-1},f.prototype.setAperture=function(a){this._dofAperture=a},f.prototype.setDarkenOutOfFocus=
function(a){this._dofDarken=a},f.prototype.enablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect("#define PENTAGON\n")},f.prototype.disablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect()},f.prototype.enableNoiseBlur=function(){this._blurNoise=!0},f.prototype.disableNoiseBlur=function(){this._blurNoise=!1},f.prototype.setHighlightsGain=function(a){this._highlightsGain=a},f.prototype.setHighlightsThreshold=function(a){-1===this._highlightsGain&&(this._highlightsGain=
1);this._highlightsThreshold=a},f.prototype.disableHighlights=function(){this._highlightsGain=-1},f.prototype.dispose=function(a){void 0===a&&(a=!1);this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras);this._depthOfFieldPostProcess=this._highlightsPostProcess=this._chromaticAberrationPostProcess=void 0;this._grainTexture.dispose();a&&this._scene.disableDepthRenderer()},f.prototype._createChromaticAberrationPostProcess=function(a){var b=this;
this._chromaticAberrationPostProcess=new c.PostProcess("LensChromaticAberration","chromaticAberration",["chromatic_aberration","screen_width","screen_height"],[],a,null,c.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1);this._chromaticAberrationPostProcess.onApply=function(a){a.setFloat("chromatic_aberration",b._chromaticAberration);a.setFloat("screen_width",b._scene.getEngine().getRenderingCanvas().width);a.setFloat("screen_height",b._scene.getEngine().getRenderingCanvas().height)}},f.prototype._createHighlightsPostProcess=
function(a){var b=this;this._highlightsPostProcess=new c.PostProcess("LensHighlights","lensHighlights",["gain","threshold","screen_width","screen_height"],[],a,null,c.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon?"#define PENTAGON\n":"");this._highlightsPostProcess.onApply=function(a){a.setFloat("gain",b._highlightsGain);a.setFloat("threshold",b._highlightsThreshold);a.setTextureFromPostProcess("textureSampler",b._chromaticAberrationPostProcess);a.setFloat("screen_width",
b._scene.getEngine().getRenderingCanvas().width);a.setFloat("screen_height",b._scene.getEngine().getRenderingCanvas().height)}},f.prototype._createDepthOfFieldPostProcess=function(a){var b=this;this._depthOfFieldPostProcess=new c.PostProcess("LensDepthOfField","depthOfField","grain_amount blur_noise screen_width screen_height distortion dof_enabled screen_distance aperture darken edge_blur highlights near far".split(" "),["depthSampler","grainSampler","highlightsSampler"],a,null,c.Texture.TRILINEAR_SAMPLINGMODE,
this._scene.getEngine(),!1);this._depthOfFieldPostProcess.onApply=function(a){a.setTexture("depthSampler",b._depthTexture);a.setTexture("grainSampler",b._grainTexture);a.setTextureFromPostProcess("textureSampler",b._highlightsPostProcess);a.setTextureFromPostProcess("highlightsSampler",b._depthOfFieldPostProcess);a.setFloat("grain_amount",b._grainAmount);a.setBool("blur_noise",b._blurNoise);a.setFloat("screen_width",b._scene.getEngine().getRenderingCanvas().width);a.setFloat("screen_height",b._scene.getEngine().getRenderingCanvas().height);
a.setFloat("distortion",b._distortion);a.setBool("dof_enabled",-1!==b._dofDistance);a.setFloat("screen_distance",1/(0.1-1/b._dofDistance));a.setFloat("aperture",b._dofAperture);a.setFloat("darken",b._dofDarken);a.setFloat("edge_blur",b._edgeBlur);a.setBool("highlights",-1!==b._highlightsGain);a.setFloat("near",b._scene.activeCamera.minZ);a.setFloat("far",b._scene.activeCamera.maxZ)}},f.prototype._createGrainTexture=function(){this._grainTexture=new c.DynamicTexture("LensNoiseTexture",512,this._scene,
!1,c.Texture.BILINEAR_SAMPLINGMODE);this._grainTexture.wrapU=c.Texture.WRAP_ADDRESSMODE;this._grainTexture.wrapV=c.Texture.WRAP_ADDRESSMODE;for(var a,b=this._grainTexture.getContext(),d=0;512>d;d++)for(var e=0;512>e;e++)a=Math.floor(255*(Math.random()*(0.58-0.42)+0.42)),b.fillStyle="rgb("+a+", "+a+", "+a+")",b.fillRect(d,e,1,1);this._grainTexture.update(!1)},f);c.LensRenderingPipeline=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.PostProcess;f=function(a,b,d,f,g,h,m){var l=this;e.call(this,a,"colorCorrection",null,["colorTable"],d,f,g,h,m);this._colorTableTexture=new c.Texture(b,f.getScene(),!0,!1,c.Texture.TRILINEAR_SAMPLINGMODE);this._colorTableTexture.anisotropicFilteringLevel=1;this._colorTableTexture.wrapU=c.Texture.CLAMP_ADDRESSMODE;this._colorTableTexture.wrapV=c.Texture.CLAMP_ADDRESSMODE;this.onApply=function(a){a.setTexture("colorTable",l._colorTableTexture)}};f=(__extends(f,e),f);c.ColorCorrectionPostProcess=
f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.FreeCamera;f=function(a,b,d,g){e.call(this,a,b,g);this.interaxialDistance=d;this.setCameraRigMode(c.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:d})};f=(__extends(f,e),f.prototype.getTypeName=function(){return"AnaglyphFreeCamera"},f);c.AnaglyphFreeCamera=f;var a=c.ArcRotateCamera;f=function(b,d,e,g,f,h,j){a.call(this,b,d,e,g,f,j);this.interaxialDistance=h;this.setCameraRigMode(c.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:h})};f=(__extends(f,a),f.prototype.getTypeName=
function(){return"AnaglyphArcRotateCamera"},f);c.AnaglyphArcRotateCamera=f;var b=c.GamepadCamera;f=function(a,d,e,g){b.call(this,a,d,g);this.interaxialDistance=e;this.setCameraRigMode(c.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:e})};f=(__extends(f,b),f.prototype.getTypeName=function(){return"AnaglyphGamepadCamera"},f);c.AnaglyphGamepadCamera=f;var d=c.UniversalCamera;f=function(a,b,e,g){d.call(this,a,b,g);this.interaxialDistance=e;this.setCameraRigMode(c.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,
{interaxialDistance:e})};f=(__extends(f,d),f.prototype.getTypeName=function(){return"AnaglyphUniversalCamera"},f);c.AnaglyphUniversalCamera=f;var j=c.FreeCamera;f=function(a,b,d,e,g){j.call(this,a,b,g);this.interaxialDistance=d;this.isStereoscopicSideBySide=e;this.setCameraRigMode(e?c.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:c.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:d})};f=(__extends(f,j),f.prototype.getTypeName=function(){return"StereoscopicFreeCamera"},f);c.StereoscopicFreeCamera=
f;var g=c.ArcRotateCamera;f=function(a,b,d,e,f,h,j,m){g.call(this,a,b,d,e,f,m);this.interaxialDistance=h;this.isStereoscopicSideBySide=j;this.setCameraRigMode(j?c.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:c.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:h})};f=(__extends(f,g),f.prototype.getTypeName=function(){return"StereoscopicArcRotateCamera"},f);c.StereoscopicArcRotateCamera=f;var h=c.GamepadCamera;f=function(a,b,d,e,g){h.call(this,a,b,g);this.interaxialDistance=d;this.isStereoscopicSideBySide=
e;this.setCameraRigMode(e?c.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:c.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:d})};f=(__extends(f,h),f.prototype.getTypeName=function(){return"StereoscopicGamepadCamera"},f);c.StereoscopicGamepadCamera=f;var m=c.UniversalCamera;f=function(a,b,d,e,g){m.call(this,a,b,g);this.interaxialDistance=d;this.isStereoscopicSideBySide=e;this.setCameraRigMode(e?c.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:c.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,
{interaxialDistance:d})};f=(__extends(f,m),f.prototype.getTypeName=function(){return"StereoscopicUniversalCamera"},f);c.StereoscopicUniversalCamera=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.PostProcessRenderPipeline,a=function(b,d,f,g,h){var m=this;void 0===g&&(g=null);e.call(this,d.getEngine(),b);this.gaussCoeff=0.3;this.gaussMean=1;this.gaussStandDev=0.8;this.gaussMultiplier=4;this.minimumLuminance=this.exposure=1;this.maximumLuminance=1E20;this.luminanceDecreaseRate=this.luminanceIncreaserate=0.5;this.brightThreshold=0.8;this._needUpdate=!0;this._scene=d;this._createBrightPassPostProcess(d,f);this._createDownSampleX4PostProcess(d,f);this._createGaussianBlurPostProcess(d,
f);this._createTextureAdderPostProcess(d,f);this._createLuminanceGeneratorPostProcess(d);this._createHDRPostProcess(d,f);null===g?this._originalPostProcess=new c.PassPostProcess("hdr",f,null,c.Texture.BILINEAR_SAMPLINGMODE,d.getEngine(),!1):this._originalPostProcess=g;this.addEffect(new c.PostProcessRenderEffect(d.getEngine(),"HDRPassPostProcess",function(){return m._originalPostProcess},!0));this.addEffect(new c.PostProcessRenderEffect(d.getEngine(),"HDRBrightPass",function(){return m._brightPassPostProcess},
!0));this.addEffect(new c.PostProcessRenderEffect(d.getEngine(),"HDRDownSampleX4",function(){return m._downSampleX4PostProcess},!0));this.addEffect(new c.PostProcessRenderEffect(d.getEngine(),"HDRGaussianBlurH",function(){return m._guassianBlurHPostProcess},!0));this.addEffect(new c.PostProcessRenderEffect(d.getEngine(),"HDRGaussianBlurV",function(){return m._guassianBlurVPostProcess},!0));this.addEffect(new c.PostProcessRenderEffect(d.getEngine(),"HDRTextureAdder",function(){return m._textureAdderPostProcess},
!0));f=function(a){m.addEffect(new c.PostProcessRenderEffect(d.getEngine(),"HDRDownSampler"+a,function(){return m._downSamplePostProcesses[a]},!0))};for(g=a.LUM_STEPS-1;0<=g;g--)f(g);this.addEffect(new c.PostProcessRenderEffect(d.getEngine(),"HDR",function(){return m._hdrPostProcess},!0));d.postProcessRenderPipelineManager.addPipeline(this);null!==h&&d.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(b,h);this.update()};f=(__extends(a,e),a.prototype.update=function(){this._needUpdate=
!0},a.prototype.getCurrentLuminance=function(){return this._hdrCurrentLuminance},a.prototype.getOutputLuminance=function(){return this._hdrOutputLuminance},a.prototype.dispose=function(){this._textureAdderPostProcess=this._guassianBlurVPostProcess=this._guassianBlurHPostProcess=this._downSampleX4PostProcess=this._brightPassPostProcess=this._originalPostProcess=void 0;for(var b=a.LUM_STEPS-1;0<=b;b--)this._downSamplePostProcesses[b]=void 0;this._hdrPostProcess=void 0;this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,
this._scene.cameras)},a.prototype._createHDRPostProcess=function(a,d){var e=this,g=0;this._hdrOutputLuminance=-1;this._hdrCurrentLuminance=1;this._hdrPostProcess=new c.PostProcess("hdr","hdr",["exposure","avgLuminance"],["otherSampler"],d,null,c.Texture.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,"#define HDR");this._hdrPostProcess.onApply=function(d){if(0>e._hdrOutputLuminance)e._hdrOutputLuminance=e._hdrCurrentLuminance;else{var f=(g-(g+a.getEngine().getDeltaTime()))/1E3;e._hdrCurrentLuminance<e._hdrOutputLuminance+
e.luminanceDecreaseRate*f?e._hdrOutputLuminance+=e.luminanceDecreaseRate*f:e._hdrCurrentLuminance>e._hdrOutputLuminance-e.luminanceIncreaserate*f?e._hdrOutputLuminance-=e.luminanceIncreaserate*f:e._hdrOutputLuminance=e._hdrCurrentLuminance}e._hdrOutputLuminance=c.MathTools.Clamp(e._hdrOutputLuminance,e.minimumLuminance,e.maximumLuminance);g+=a.getEngine().getDeltaTime();d.setTextureFromPostProcess("textureSampler",e._textureAdderPostProcess);d.setTextureFromPostProcess("otherSampler",e._originalPostProcess);
d.setFloat("exposure",e.exposure);d.setFloat("avgLuminance",e._hdrOutputLuminance);e._needUpdate=!1}},a.prototype._createTextureAdderPostProcess=function(a,d){var e=this;this._textureAdderPostProcess=new c.PostProcess("hdr","hdr",[],["otherSampler"],d,null,c.Texture.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,"#define TEXTURE_ADDER");this._textureAdderPostProcess.onApply=function(a){a.setTextureFromPostProcess("otherSampler",e._originalPostProcess)}},a.prototype._createDownSampleX4PostProcess=function(a,
d){var e=this,g=Array(32);this._downSampleX4PostProcess=new c.PostProcess("hdr","hdr",["dsOffsets"],[],d/4,null,c.Texture.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,"#define DOWN_SAMPLE_X4");this._downSampleX4PostProcess.onApply=function(a){if(e._needUpdate)for(var b=0,c=-2;2>c;c++)for(var d=-2;2>d;d++)g[b]=(c+0.5)*(1/e._downSampleX4PostProcess.width),g[b+1]=(d+0.5)*(1/e._downSampleX4PostProcess.height),b+=2;a.setArray2("dsOffsets",g)}},a.prototype._createBrightPassPostProcess=function(a,d){var e=this,
g=Array(8);this._brightPassPostProcess=new c.PostProcess("hdr","hdr",["dsOffsets","brightThreshold"],[],d,null,c.Texture.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,"#define BRIGHT_PASS");this._brightPassPostProcess.onApply=function(a){if(e._needUpdate){var b=1/e._brightPassPostProcess.width,c=1/e._brightPassPostProcess.height;g[0]=-0.5*b;g[1]=0.5*c;g[2]=0.5*b;g[3]=0.5*c;g[4]=-0.5*b;g[5]=-0.5*c;g[6]=0.5*b;g[7]=-0.5*c}a.setArray2("dsOffsets",g);a.setFloat("brightThreshold",e.brightThreshold)}},a.prototype._createLuminanceGeneratorPostProcess=
function(b){var d,e=this,g=a.LUM_STEPS,f=Array(8),m=Array(18);this._downSamplePostProcesses=Array(g);var l=function(a,b){var c=1/a,d=1/b;f[0]=-0.5*c;f[1]=0.5*d;f[2]=0.5*c;f[3]=0.5*d;f[4]=-0.5*c;f[5]=-0.5*d;f[6]=0.5*c;f[7]=-0.5*d},k=function(a){return function(b){l(e._downSamplePostProcesses[a].width,e._downSamplePostProcesses[a].height);for(var c=e._downSamplePostProcesses[a].width,g=e._downSamplePostProcesses[a].height,f=0,h=-1;2>h;h++)for(var k=-1;2>k;k++)m[f]=h/c,m[f+1]=k/g,f+=2;d=0.5/e._downSamplePostProcesses[a].width;
b.setTextureFromPostProcess("textureSampler",e._downSamplePostProcesses[a+1]);b.setFloat("halfDestPixelSize",d);b.setArray2("dsOffsets",m)}},n=function(){var a=b.getEngine().readPixels(0,0,1,1),d=new c.Vector4(1/16581375,1/65025,1/255,1);e._hdrCurrentLuminance=(a[0]*d.x+a[1]*d.y+a[2]*d.z+a[3]*d.w)/100},q={width:Math.pow(3,g-1),height:Math.pow(3,g-1)};this._downSamplePostProcesses[g-1]=new c.PostProcess("hdr","hdr",["lumOffsets"],[],q,null,c.Texture.NEAREST_SAMPLINGMODE,b.getEngine(),!1,"#define LUMINANCE_GENERATOR",
c.Engine.TEXTURETYPE_FLOAT);this._downSamplePostProcesses[g-1].onApply=function(a){e._needUpdate&&l(e._textureAdderPostProcess.width,e._textureAdderPostProcess.height);a.setTextureFromPostProcess("textureSampler",e._textureAdderPostProcess);a.setArray2("lumOffsets",f)};for(g-=2;0<=g;g--){var q=Math.pow(3,g),q={width:q,height:q},p="#define DOWN_SAMPLE\n";0===g&&(p+="#define FINAL_DOWN_SAMPLE\n");this._downSamplePostProcesses[g]=new c.PostProcess("hdr","hdr",["dsOffsets","halfDestPixelSize"],[],q,null,
c.Texture.NEAREST_SAMPLINGMODE,b.getEngine(),!1,p,c.Engine.TEXTURETYPE_FLOAT);this._downSamplePostProcesses[g].onApply=k(g);0===g&&(this._downSamplePostProcesses[g].onAfterRender=n)}},a.prototype._createGaussianBlurPostProcess=function(a,d){var e=this,g=Array(9),f=Array(9),m=Array(9),l=["blurOffsets","blurWeights","multiplier"],k=function(c){return function(d){if(e._needUpdate){for(var k=0,l=0;9>l;l++)k=(l-4)/4,m[l]=e.gaussCoeff*(1/Math.sqrt(2*Math.PI*e.gaussStandDev))*Math.exp(-((k-e.gaussMean)*
(k-e.gaussMean))/(2*e.gaussStandDev*e.gaussStandDev));for(var k=a.getEngine().getRenderWidth(),l=a.getEngine().getRenderHeight(),t=0;9>t;t++){var s=(t-4)*(1/(!0===c?l:k));c?f[t]=s:g[t]=s}}d.setArray("blurOffsets",c?f:g);d.setArray("blurWeights",m);d.setFloat("multiplier",e.gaussMultiplier)}};this._guassianBlurHPostProcess=new c.PostProcess("hdr","hdr",l,[],d/4,null,c.Texture.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,"#define GAUSSIAN_BLUR_H");this._guassianBlurHPostProcess.onApply=k(!1);this._guassianBlurVPostProcess=
new c.PostProcess("hdr","hdr",l,[],d/4,null,c.Texture.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,"#define GAUSSIAN_BLUR_V");this._guassianBlurVPostProcess.onApply=k(!0)},a.LUM_STEPS=6,a);c.HDRRenderingPipeline=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(){this.edges=[];this.edgesConnectedCount=0};var e;e=function(a,b,c){void 0===b&&(b=0.95);void 0===c&&(c=!1);this.edgesWidthScalerForOrthographic=1E3;this.edgesWidthScalerForPerspective=50;this._linesPositions=[];this._linesNormals=[];this._linesIndices=[];this._buffers={};this._checkVerticesInsteadOfIndices=!1;this._source=a;this._checkVerticesInsteadOfIndices=c;this._epsilon=b;this._prepareRessources();this._generateEdgesLines()};e=(e.prototype._prepareRessources=function(){this._lineShader||
(this._lineShader=new c.ShaderMaterial("lineShader",this._source.getScene(),"line",{attributes:["position","normal"],uniforms:["worldViewProjection","color","width","aspectRatio"]}),this._lineShader.disableDepthWrite=!0,this._lineShader.backFaceCulling=!1)},e.prototype.dispose=function(){var a=this._buffers[c.VertexBuffer.PositionKind];a&&(a.dispose(),this._buffers[c.VertexBuffer.PositionKind]=null);(a=this._buffers[c.VertexBuffer.NormalKind])&&(a.dispose(),this._buffers[c.VertexBuffer.NormalKind]=
null);this._source.getScene().getEngine()._releaseBuffer(this._ib);this._lineShader.dispose()},e.prototype._processEdgeForAdjacencies=function(a,b,c,e,g){return a===c&&b===e||a===e&&b===c?0:a===e&&b===g||a===g&&b===e?1:a===g&&b===c||a===c&&b===g?2:-1},e.prototype._processEdgeForAdjacenciesWithVertices=function(a,b,c,e,g){return a.equalsWithEpsilon(c)&&b.equalsWithEpsilon(e)||a.equalsWithEpsilon(e)&&b.equalsWithEpsilon(c)?0:a.equalsWithEpsilon(e)&&b.equalsWithEpsilon(g)||a.equalsWithEpsilon(g)&&b.equalsWithEpsilon(e)?
1:a.equalsWithEpsilon(g)&&b.equalsWithEpsilon(c)||a.equalsWithEpsilon(c)&&b.equalsWithEpsilon(g)?2:-1},e.prototype._checkEdge=function(a,b,d,e,g){if(void 0===b||c.Vector3.Dot(d[a],d[b])<this._epsilon)a=this._linesPositions.length/3,e.subtract(g).normalize(),this._linesPositions.push(e.x),this._linesPositions.push(e.y),this._linesPositions.push(e.z),this._linesPositions.push(e.x),this._linesPositions.push(e.y),this._linesPositions.push(e.z),this._linesPositions.push(g.x),this._linesPositions.push(g.y),
this._linesPositions.push(g.z),this._linesPositions.push(g.x),this._linesPositions.push(g.y),this._linesPositions.push(g.z),this._linesNormals.push(g.x),this._linesNormals.push(g.y),this._linesNormals.push(g.z),this._linesNormals.push(-1),this._linesNormals.push(g.x),this._linesNormals.push(g.y),this._linesNormals.push(g.z),this._linesNormals.push(1),this._linesNormals.push(e.x),this._linesNormals.push(e.y),this._linesNormals.push(e.z),this._linesNormals.push(-1),this._linesNormals.push(e.x),this._linesNormals.push(e.y),
this._linesNormals.push(e.z),this._linesNormals.push(1),this._linesIndices.push(a),this._linesIndices.push(a+1),this._linesIndices.push(a+2),this._linesIndices.push(a),this._linesIndices.push(a+2),this._linesIndices.push(a+3)},e.prototype._generateEdgesLines=function(){var a,b,d=this._source.getVerticesData(c.VertexBuffer.PositionKind),e=this._source.getIndices(),g=[],h=[];for(a=0;a<e.length;a+=3){b=new f;var m=e[a],l=e[a+1],k=e[a+2];b.p0=new c.Vector3(d[3*m],d[3*m+1],d[3*m+2]);b.p1=new c.Vector3(d[3*
l],d[3*l+1],d[3*l+2]);b.p2=new c.Vector3(d[3*k],d[3*k+1],d[3*k+2]);m=c.Vector3.Cross(b.p1.subtract(b.p0),b.p2.subtract(b.p1));m.normalize();h.push(m);g.push(b)}for(a=0;a<g.length;a++){b=g[a];for(d=a+1;d<g.length;d++){m=g[d];if(3===b.edgesConnectedCount)break;if(3!==m.edgesConnectedCount)for(var l=e[3*d],k=e[3*d+1],n=e[3*d+2],q=0;3>q;q++){var p;if(void 0===b.edges[q]){switch(q){case 0:p=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(b.p0,b.p1,m.p0,m.p1,m.p2):this._processEdgeForAdjacencies(e[3*
a],e[3*a+1],l,k,n);break;case 1:p=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(b.p1,b.p2,m.p0,m.p1,m.p2):this._processEdgeForAdjacencies(e[3*a+1],e[3*a+2],l,k,n);break;case 2:p=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(b.p2,b.p0,m.p0,m.p1,m.p2):this._processEdgeForAdjacencies(e[3*a+2],e[3*a],l,k,n)}if(-1!==p&&(b.edges[q]=d,m.edges[p]=a,b.edgesConnectedCount++,m.edgesConnectedCount++,3===b.edgesConnectedCount))break}}}}for(a=
0;a<g.length;a++)b=g[a],this._checkEdge(a,b.edges[0],h,b.p0,b.p1),this._checkEdge(a,b.edges[1],h,b.p1,b.p2),this._checkEdge(a,b.edges[2],h,b.p2,b.p0);a=this._source.getScene().getEngine();this._buffers[c.VertexBuffer.PositionKind]=new c.VertexBuffer(a,this._linesPositions,c.VertexBuffer.PositionKind,!1);this._buffers[c.VertexBuffer.NormalKind]=new c.VertexBuffer(a,this._linesNormals,c.VertexBuffer.NormalKind,!1,!1,4);this._ib=a.createIndexBuffer(this._linesIndices);this._indicesCount=this._linesIndices.length},
e.prototype.render=function(){if(this._lineShader.isReady()){var a=this._source.getScene(),b=a.getEngine();this._lineShader._preBind();b.bindBuffers(this._buffers,this._ib,this._lineShader.getEffect());a.resetCachedMaterial();this._lineShader.setColor4("color",this._source.edgesColor);a.activeCamera.mode===c.Camera.ORTHOGRAPHIC_CAMERA?this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForOrthographic):this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForPerspective);
this._lineShader.setFloat("aspectRatio",b.getAspectRatio(a.activeCamera));this._lineShader.bind(this._source.getWorldMatrix());b.draw(!0,0,this._indicesCount);this._lineShader.unbind();b.setDepthWrite(!0)}},e);c.EdgesRenderer=e}(BABYLON||(BABYLON={}));
!function(c){var f=c.TonemappingOperator||(c.TonemappingOperator={});f[f.Hable=0]="Hable";f[f.Reinhard=1]="Reinhard";f[f.HejiDawson=2]="HejiDawson";f[f.Photographic=3]="Photographic";!0;var e=c.TonemappingOperator,a=c.PostProcess,f=function(b,d,f,g,h,m,l){var k=this;void 0===h&&(h=c.Texture.BILINEAR_SAMPLINGMODE);void 0===l&&(l=c.Engine.TEXTURETYPE_UNSIGNED_INT);a.call(this,b,"tonemap",["_ExposureAdjustment"],null,1,g,h,m,!0,n,l);this._operator=d;this.exposureAdjustment=f;var n="#define ";this._operator===
e.Hable?n+="HABLE_TONEMAPPING":this._operator===e.Reinhard?n+="REINHARD_TONEMAPPING":this._operator===e.HejiDawson?n+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":this._operator===e.Photographic&&(n+="PHOTOGRAPHIC_TONEMAPPING");this.updateEffect(n);this.onApply=function(a){a.setFloat("_ExposureAdjustment",k.exposureAdjustment)}},f=(__extends(f,a),f);c.TonemapPostProcess=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(e,a,b,d){var f=this;void 0===d&&(d=!0);this.name=e;this._viewMatrix=c.Matrix.Identity();this._target=c.Vector3.Zero();this._add=c.Vector3.Zero();this.invertYAxis=!1;this.position=c.Vector3.Zero();this._scene=b;this._scene.reflectionProbes.push(this);this._renderTargetTexture=new c.RenderTargetTexture(e,a,b,d,!0,c.Engine.TEXTURETYPE_UNSIGNED_INT,!0);this._renderTargetTexture.onBeforeRenderObservable.add(function(a){switch(a){case 0:f._add.copyFromFloats(1,0,0);break;case 1:f._add.copyFromFloats(-1,
0,0);break;case 2:f._add.copyFromFloats(0,f.invertYAxis?1:-1,0);break;case 3:f._add.copyFromFloats(0,f.invertYAxis?-1:1,0);break;case 4:f._add.copyFromFloats(0,0,1);break;case 5:f._add.copyFromFloats(0,0,-1)}f._attachedMesh&&f.position.copyFrom(f._attachedMesh.getAbsolutePosition());f.position.addToRef(f._add,f._target);c.Matrix.LookAtLHToRef(f.position,f._target,c.Vector3.Up(),f._viewMatrix);b.setTransformMatrix(f._viewMatrix,f._projectionMatrix)});this._renderTargetTexture.onAfterUnbindObservable.add(function(){b.updateTransformMatrix(!0)});
this._projectionMatrix=c.Matrix.PerspectiveFovLH(Math.PI/2,1,b.activeCamera.minZ,b.activeCamera.maxZ)};f=(Object.defineProperty(f.prototype,"refreshRate",{get:function(){return this._renderTargetTexture.refreshRate},set:function(c){this._renderTargetTexture.refreshRate=c},enumerable:!0,configurable:!0}),f.prototype.getScene=function(){return this._scene},Object.defineProperty(f.prototype,"cubeTexture",{get:function(){return this._renderTargetTexture},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,
"renderList",{get:function(){return this._renderTargetTexture.renderList},enumerable:!0,configurable:!0}),f.prototype.attachToMesh=function(c){this._attachedMesh=c},f.prototype.dispose=function(){var c=this._scene.reflectionProbes.indexOf(this);-1!==c&&this._scene.reflectionProbes.splice(c,1);this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null)},f);c.ReflectionProbe=f}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(e,a,b,d,f){this.color=new c.Color4(1,1,1,1);this.position=c.Vector3.Zero();this.rotation=c.Vector3.Zero();this.scaling=new c.Vector3(1,1,1);this.uvs=new c.Vector4(0,0,1,1);this.velocity=c.Vector3.Zero();this.isVisible=this.alive=!0;this.idx=e;this._pos=a;this._model=b;this.shapeId=d;this.idxInShape=f};f=(Object.defineProperty(f.prototype,"scale",{get:function(){return this.scaling},set:function(c){this.scaling=c},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,
"quaternion",{get:function(){return this.rotationQuaternion},set:function(c){this.rotationQuaternion=c},enumerable:!0,configurable:!0}),f);c.SolidParticle=f;c.ModelShape=function(c,a,b,d,f){this.shapeID=c;this._shape=a;this._shapeUV=b;this._positionFunction=d;this._vertexFunction=f}}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(e,a,b){this.particles=[];this.nbParticles=0;this.billboard=!1;this.counter=0;this.vars={};this._positions=[];this._indices=[];this._normals=[];this._colors=[];this._uvs=[];this._index=0;this._updatable=!0;this._alwaysVisible=this._isVisibilityBoxLocked=this._pickable=!1;this._shapeCounter=0;this._copy=new c.SolidParticle(null,null,null,null,null);this._color=new c.Color4(0,0,0,0);this._computeParticleRotation=this._computeParticleTexture=this._computeParticleColor=!0;
this._computeBoundingBox=this._computeParticleVertex=!1;this._cam_axisZ=c.Vector3.Zero();this._cam_axisY=c.Vector3.Zero();this._cam_axisX=c.Vector3.Zero();this._axisX=c.Axis.X;this._axisY=c.Axis.Y;this._axisZ=c.Axis.Z;this._fakeCamPos=c.Vector3.Zero();this._rotMatrix=new c.Matrix;this._invertMatrix=new c.Matrix;this._rotated=c.Vector3.Zero();this._quaternion=new c.Quaternion;this._vertex=c.Vector3.Zero();this._normal=c.Vector3.Zero();this._w=this._cosYaw=this._sinYaw=this._cosPitch=this._sinPitch=
this._cosRoll=this._sinRoll=this._halfyaw=this._halfpitch=this._halfroll=this._roll=this._pitch=this._yaw=0;this._minimum=c.Tmp.Vector3[0];this._maximum=c.Tmp.Vector3[1];this.name=e;this._scene=a;this._camera=a.activeCamera;this._pickable=b?b.isPickable:!1;b&&b.updatable?this._updatable=b.updatable:this._updatable=!0;this._pickable&&(this.pickedParticles=[])};f=(f.prototype.buildMesh=function(){if(0===this.nbParticles){var e=c.MeshBuilder.CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(e,
1);e.dispose()}this._positions32=new Float32Array(this._positions);this._uvs32=new Float32Array(this._uvs);this._colors32=new Float32Array(this._colors);c.VertexData.ComputeNormals(this._positions32,this._indices,this._normals);this._normals32=new Float32Array(this._normals);this._fixedNormal32=new Float32Array(this._normals);e=new c.VertexData;e.set(this._positions32,c.VertexBuffer.PositionKind);e.indices=this._indices;e.set(this._normals32,c.VertexBuffer.NormalKind);this._uvs32&&e.set(this._uvs32,
c.VertexBuffer.UVKind);this._colors32&&e.set(this._colors32,c.VertexBuffer.ColorKind);var a=new c.Mesh(this.name,this._scene);return e.applyToMesh(a,this._updatable),this.mesh=a,this.mesh.isPickable=this._pickable,this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0),a},f.prototype.digest=function(e,a){var b=a&&a.facetNb||1,d=a&&a.number,f=a&&a.delta||0,g=e.getVerticesData(c.VertexBuffer.PositionKind),h=e.getIndices(),m=e.getVerticesData(c.VertexBuffer.UVKind),
l=e.getVerticesData(c.VertexBuffer.ColorKind),k=0,n=h.length/3;d?(d=d>n?n:d,b=Math.round(n/d),f=0):b=b>n?n:b;for(var d=[],q=[],p=[],r=[],t=c.Tmp.Vector3[0],s=b;n>k;){b=s+Math.floor((1+f)*Math.random());k>n-b&&(b=n-k);d.length=0;q.length=0;p.length=0;for(var u=r.length=0,v=3*k;3*(k+b)>v;v++){q.push(u);var w=h[v];d.push(g[3*w],g[3*w+1],g[3*w+2]);m&&p.push(m[2*w],m[2*w+1]);l&&r.push(l[4*w],l[4*w+1],l[4*w+2],l[4*w+3]);u++}for(var u=this.nbParticles,v=this._posToShape(d),x=this._uvsToShapeUV(p),w=0;w<
v.length;w++)t.addInPlace(v[w]);t.scaleInPlace(1/v.length);for(w=0;w<v.length;w++)v[w].subtractInPlace(t);w=new c.ModelShape(this._shapeCounter,v,x,null,null);this._meshBuilder(this._index,v,this._positions,q,this._indices,p,this._uvs,r,this._colors,u,0,null);this._addParticle(u,this._positions.length,w,this._shapeCounter,0);this.particles[this.nbParticles].position.addInPlace(t);this._index+=v.length;this.nbParticles++;this._shapeCounter++;k+=b}return this},f.prototype._resetCopy=function(){this._copy.position.x=
0;this._copy.position.y=0;this._copy.position.z=0;this._copy.rotation.x=0;this._copy.rotation.y=0;this._copy.rotation.z=0;this._copy.rotationQuaternion=null;this._copy.scaling.x=1;this._copy.scaling.y=1;this._copy.scaling.z=1;this._copy.uvs.x=0;this._copy.uvs.y=0;this._copy.uvs.z=1;this._copy.uvs.w=1;this._copy.color=null},f.prototype._meshBuilder=function(e,a,b,d,f,g,h,m,l,k,n,q){var p=0,r=0;this._resetCopy();q&&q.positionFunction&&q.positionFunction(this._copy,k,n);this._copy.rotationQuaternion?
this._quaternion.copyFrom(this._copy.rotationQuaternion):(this._yaw=this._copy.rotation.y,this._pitch=this._copy.rotation.x,this._roll=this._copy.rotation.z,this._quaternionRotationYPR());this._quaternionToRotationMatrix();for(n=0;n<a.length;n++)this._vertex.x=a[n].x,this._vertex.y=a[n].y,this._vertex.z=a[n].z,q&&q.vertexFunction&&q.vertexFunction(this._copy,this._vertex,n),this._vertex.x*=this._copy.scaling.x,this._vertex.y*=this._copy.scaling.y,this._vertex.z*=this._copy.scaling.z,c.Vector3.TransformCoordinatesToRef(this._vertex,
this._rotMatrix,this._rotated),b.push(this._copy.position.x+this._rotated.x,this._copy.position.y+this._rotated.y,this._copy.position.z+this._rotated.z),g&&(h.push((this._copy.uvs.z-this._copy.uvs.x)*g[p]+this._copy.uvs.x,(this._copy.uvs.w-this._copy.uvs.y)*g[p+1]+this._copy.uvs.y),p+=2),this._copy.color?this._color=this._copy.color:m&&m[r]?(this._color.r=m[r],this._color.g=m[r+1],this._color.b=m[r+2],this._color.a=m[r+3]):(this._color.r=1,this._color.g=1,this._color.b=1,this._color.a=1),l.push(this._color.r,
this._color.g,this._color.b,this._color.a),r+=4;for(n=0;n<d.length;n++)f.push(e+d[n]);if(this._pickable){e=d.length/3;for(n=0;e>n;n++)this.pickedParticles.push({idx:k,faceId:n})}},f.prototype._posToShape=function(e){for(var a=[],b=0;b<e.length;b+=3)a.push(new c.Vector3(e[b],e[b+1],e[b+2]));return a},f.prototype._uvsToShapeUV=function(c){var a=[];if(c)for(var b=0;b<c.length;b++)a.push(c[b]);return a},f.prototype._addParticle=function(e,a,b,d,f){this.particles.push(new c.SolidParticle(e,a,b,d,f))},
f.prototype.addShape=function(e,a,b){var d=e.getVerticesData(c.VertexBuffer.PositionKind),f=e.getIndices(),g=e.getVerticesData(c.VertexBuffer.UVKind);e=e.getVerticesData(c.VertexBuffer.ColorKind);for(var d=this._posToShape(d),h=this._uvsToShapeUV(g),h=new c.ModelShape(this._shapeCounter,d,h,b?b.positionFunction:null,b?b.vertexFunction:null),m=this.nbParticles,l=0;a>l;l++)this._meshBuilder(this._index,d,this._positions,f,this._indices,g,this._uvs,e,this._colors,m,l,b),this._updatable&&this._addParticle(m,
this._positions.length,h,this._shapeCounter,l),this._index+=d.length,m++;return this.nbParticles+=a,this._shapeCounter++,this._shapeCounter-1},f.prototype._rebuildParticle=function(e){this._resetCopy();e._model._positionFunction&&e._model._positionFunction(this._copy,e.idx,e.idxInShape);this._copy.rotationQuaternion?this._quaternion.copyFrom(this._copy.rotationQuaternion):(this._yaw=this._copy.rotation.y,this._pitch=this._copy.rotation.x,this._roll=this._copy.rotation.z,this._quaternionRotationYPR());
this._quaternionToRotationMatrix();this._shape=e._model._shape;for(var a=0;a<this._shape.length;a++)this._vertex.x=this._shape[a].x,this._vertex.y=this._shape[a].y,this._vertex.z=this._shape[a].z,e._model._vertexFunction&&e._model._vertexFunction(this._copy,this._vertex,a),this._vertex.x*=this._copy.scaling.x,this._vertex.y*=this._copy.scaling.y,this._vertex.z*=this._copy.scaling.z,c.Vector3.TransformCoordinatesToRef(this._vertex,this._rotMatrix,this._rotated),this._positions32[e._pos+3*a]=this._copy.position.x+
this._rotated.x,this._positions32[e._pos+3*a+1]=this._copy.position.y+this._rotated.y,this._positions32[e._pos+3*a+2]=this._copy.position.z+this._rotated.z;e.position.x=0;e.position.y=0;e.position.z=0;e.rotation.x=0;e.rotation.y=0;e.rotation.z=0;e.rotationQuaternion=null;e.scaling.x=1;e.scaling.y=1;e.scaling.z=1},f.prototype.rebuildMesh=function(){for(var e=0;e<this.particles.length;e++)this._rebuildParticle(this.particles[e]);this.mesh.updateVerticesData(c.VertexBuffer.PositionKind,this._positions32,
!1,!1)},f.prototype.setParticles=function(e,a,b){if(void 0===e&&(e=0),void 0===a&&(a=this.nbParticles-1),void 0===b&&(b=!0),this._updatable){this.beforeUpdateParticles(e,a,b);this._cam_axisX.x=1;this._cam_axisX.y=0;this._cam_axisX.z=0;this._cam_axisY.x=0;this._cam_axisY.y=1;this._cam_axisY.z=0;this._cam_axisZ.x=0;this._cam_axisZ.y=0;this._cam_axisZ.z=1;this.billboard&&(this._yaw=this.mesh.rotation.y,this._pitch=this.mesh.rotation.x,this._roll=this.mesh.rotation.z,this._quaternionRotationYPR(),this._quaternionToRotationMatrix(),
this._rotMatrix.invertToRef(this._invertMatrix),c.Vector3.TransformCoordinatesToRef(this._camera.globalPosition,this._invertMatrix,this._fakeCamPos),this._fakeCamPos.subtractToRef(this.mesh.position,this._cam_axisZ),c.Vector3.CrossToRef(this._cam_axisZ,this._axisX,this._cam_axisY),c.Vector3.CrossToRef(this._cam_axisZ,this._cam_axisY,this._cam_axisX),this._cam_axisY.normalize(),this._cam_axisX.normalize(),this._cam_axisZ.normalize());c.Matrix.IdentityToRef(this._rotMatrix);var d=0,f=0,g=0,h=0,m=0,
l=0,k=0;this._computeBoundingBox&&(c.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this._minimum),c.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this._maximum));a=a>this.nbParticles-1?this.nbParticles-1:a;for(var n=e;a>=n;n++){if(this._particle=this.particles[n],this._shape=this._particle._model._shape,this._shapeUV=this._particle._model._shapeUV,this.updateParticle(this._particle),this._particle.isVisible){this.billboard&&(this._particle.rotation.x=
0,this._particle.rotation.y=0);this._computeParticleRotation&&(this._particle.rotationQuaternion?this._quaternion.copyFrom(this._particle.rotationQuaternion):(this._yaw=this._particle.rotation.y,this._pitch=this._particle.rotation.x,this._roll=this._particle.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix());for(k=0;k<this._shape.length;k++)d=f+3*k,g=h+4*k,m=l+2*k,this._vertex.x=this._shape[k].x,this._vertex.y=this._shape[k].y,this._vertex.z=this._shape[k].z,this._computeParticleVertex&&
this.updateParticleVertex(this._particle,this._vertex,k),this._vertex.x*=this._particle.scaling.x,this._vertex.y*=this._particle.scaling.y,this._vertex.z*=this._particle.scaling.z,this._w=this._vertex.x*this._rotMatrix.m[3]+this._vertex.y*this._rotMatrix.m[7]+this._vertex.z*this._rotMatrix.m[11]+this._rotMatrix.m[15],this._rotated.x=(this._vertex.x*this._rotMatrix.m[0]+this._vertex.y*this._rotMatrix.m[4]+this._vertex.z*this._rotMatrix.m[8]+this._rotMatrix.m[12])/this._w,this._rotated.y=(this._vertex.x*
this._rotMatrix.m[1]+this._vertex.y*this._rotMatrix.m[5]+this._vertex.z*this._rotMatrix.m[9]+this._rotMatrix.m[13])/this._w,this._rotated.z=(this._vertex.x*this._rotMatrix.m[2]+this._vertex.y*this._rotMatrix.m[6]+this._vertex.z*this._rotMatrix.m[10]+this._rotMatrix.m[14])/this._w,this._positions32[d]=this._particle.position.x+this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,this._positions32[d+1]=this._particle.position.y+this._cam_axisX.y*this._rotated.x+
this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,this._positions32[d+2]=this._particle.position.z+this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z,this._computeBoundingBox&&(this._positions32[d]<this._minimum.x&&(this._minimum.x=this._positions32[d]),this._positions32[d]>this._maximum.x&&(this._maximum.x=this._positions32[d]),this._positions32[d+1]<this._minimum.y&&(this._minimum.y=this._positions32[d+1]),this._positions32[d+
1]>this._maximum.y&&(this._maximum.y=this._positions32[d+1]),this._positions32[d+2]<this._minimum.z&&(this._minimum.z=this._positions32[d+2]),this._positions32[d+2]>this._maximum.z&&(this._maximum.z=this._positions32[d+2])),this._computeParticleVertex||this.billboard||(this._normal.x=this._fixedNormal32[d],this._normal.y=this._fixedNormal32[d+1],this._normal.z=this._fixedNormal32[d+2],this._w=this._normal.x*this._rotMatrix.m[3]+this._normal.y*this._rotMatrix.m[7]+this._normal.z*this._rotMatrix.m[11]+
this._rotMatrix.m[15],this._rotated.x=(this._normal.x*this._rotMatrix.m[0]+this._normal.y*this._rotMatrix.m[4]+this._normal.z*this._rotMatrix.m[8]+this._rotMatrix.m[12])/this._w,this._rotated.y=(this._normal.x*this._rotMatrix.m[1]+this._normal.y*this._rotMatrix.m[5]+this._normal.z*this._rotMatrix.m[9]+this._rotMatrix.m[13])/this._w,this._rotated.z=(this._normal.x*this._rotMatrix.m[2]+this._normal.y*this._rotMatrix.m[6]+this._normal.z*this._rotMatrix.m[10]+this._rotMatrix.m[14])/this._w,this._normals32[d]=
this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,this._normals32[d+1]=this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,this._normals32[d+2]=this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z),this._computeParticleColor&&(this._colors32[g]=this._particle.color.r,this._colors32[g+1]=this._particle.color.g,this._colors32[g+2]=this._particle.color.b,
this._colors32[g+3]=this._particle.color.a),this._computeParticleTexture&&(this._uvs32[m]=this._shapeUV[2*k]*(this._particle.uvs.z-this._particle.uvs.x)+this._particle.uvs.x,this._uvs32[m+1]=this._shapeUV[2*k+1]*(this._particle.uvs.w-this._particle.uvs.y)+this._particle.uvs.y)}else for(k=0;k<this._shape.length;k++)d=f+3*k,g=h+4*k,m=l+2*k,this._positions32[d]=this._camera.position.x,this._positions32[d+1]=this._camera.position.y,this._positions32[d+2]=this._camera.position.z,this._normals32[d]=0,this._normals32[d+
1]=0,this._normals32[d+2]=0,this._computeParticleColor&&(this._colors32[g]=this._particle.color.r,this._colors32[g+1]=this._particle.color.g,this._colors32[g+2]=this._particle.color.b,this._colors32[g+3]=this._particle.color.a),this._computeParticleTexture&&(this._uvs32[m]=this._shapeUV[2*k]*(this._particle.uvs.z-this._particle.uvs.x)+this._particle.uvs.x,this._uvs32[m+1]=this._shapeUV[2*k+1]*(this._particle.uvs.w-this._particle.uvs.y)+this._particle.uvs.y);f=d+3;h=g+4;l=m+2}if(b&&(this._computeParticleColor&&
this.mesh.updateVerticesData(c.VertexBuffer.ColorKind,this._colors32,!1,!1),this._computeParticleTexture&&this.mesh.updateVerticesData(c.VertexBuffer.UVKind,this._uvs32,!1,!1),this.mesh.updateVerticesData(c.VertexBuffer.PositionKind,this._positions32,!1,!1),!this.mesh.areNormalsFrozen)){if(this._computeParticleVertex||this.billboard){c.VertexData.ComputeNormals(this._positions32,this._indices,this._normals32);for(d=0;d<this._normals32.length;d++)this._fixedNormal32[d]=this._normals32[d]}this.mesh.updateVerticesData(c.VertexBuffer.NormalKind,
this._normals32,!1,!1)}this._computeBoundingBox&&(this.mesh._boundingInfo=new c.BoundingInfo(this._minimum,this._maximum),this.mesh._boundingInfo.update(this.mesh._worldMatrix));this.afterUpdateParticles(e,a,b)}},f.prototype._quaternionRotationYPR=function(){this._halfroll=0.5*this._roll;this._halfpitch=0.5*this._pitch;this._halfyaw=0.5*this._yaw;this._sinRoll=Math.sin(this._halfroll);this._cosRoll=Math.cos(this._halfroll);this._sinPitch=Math.sin(this._halfpitch);this._cosPitch=Math.cos(this._halfpitch);
this._sinYaw=Math.sin(this._halfyaw);this._cosYaw=Math.cos(this._halfyaw);this._quaternion.x=this._cosYaw*this._sinPitch*this._cosRoll+this._sinYaw*this._cosPitch*this._sinRoll;this._quaternion.y=this._sinYaw*this._cosPitch*this._cosRoll-this._cosYaw*this._sinPitch*this._sinRoll;this._quaternion.z=this._cosYaw*this._cosPitch*this._sinRoll-this._sinYaw*this._sinPitch*this._cosRoll;this._quaternion.w=this._cosYaw*this._cosPitch*this._cosRoll+this._sinYaw*this._sinPitch*this._sinRoll},f.prototype._quaternionToRotationMatrix=
function(){this._rotMatrix.m[0]=1-2*(this._quaternion.y*this._quaternion.y+this._quaternion.z*this._quaternion.z);this._rotMatrix.m[1]=2*(this._quaternion.x*this._quaternion.y+this._quaternion.z*this._quaternion.w);this._rotMatrix.m[2]=2*(this._quaternion.z*this._quaternion.x-this._quaternion.y*this._quaternion.w);this._rotMatrix.m[3]=0;this._rotMatrix.m[4]=2*(this._quaternion.x*this._quaternion.y-this._quaternion.z*this._quaternion.w);this._rotMatrix.m[5]=1-2*(this._quaternion.z*this._quaternion.z+
this._quaternion.x*this._quaternion.x);this._rotMatrix.m[6]=2*(this._quaternion.y*this._quaternion.z+this._quaternion.x*this._quaternion.w);this._rotMatrix.m[7]=0;this._rotMatrix.m[8]=2*(this._quaternion.z*this._quaternion.x+this._quaternion.y*this._quaternion.w);this._rotMatrix.m[9]=2*(this._quaternion.y*this._quaternion.z-this._quaternion.x*this._quaternion.w);this._rotMatrix.m[10]=1-2*(this._quaternion.y*this._quaternion.y+this._quaternion.x*this._quaternion.x);this._rotMatrix.m[11]=0;this._rotMatrix.m[12]=
0;this._rotMatrix.m[13]=0;this._rotMatrix.m[14]=0;this._rotMatrix.m[15]=1},f.prototype.dispose=function(){this.mesh.dispose();this.pickedParticles=this._colors32=this._uvs32=this._fixedNormal32=this._normals32=this._positions32=this._colors=this._uvs=this._normals=this._indices=this._positions=this.vars=null},f.prototype.refreshVisibleSize=function(){this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo()},f.prototype.setVisibilityBox=function(e){e/=2;this.mesh._boundingInfo=new c.BoundingInfo(new c.Vector3(-e,
-e,-e),new c.Vector3(e,e,e))},Object.defineProperty(f.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(c){this._alwaysVisible=c;this.mesh.alwaysSelectAsActiveMesh=c},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(c){this._isVisibilityBoxLocked=c;this.mesh.getBoundingInfo().isLocked=c},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"computeParticleRotation",
{get:function(){return this._computeParticleRotation},set:function(c){this._computeParticleRotation=c},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(c){this._computeParticleColor=c},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(c){this._computeParticleTexture=c},enumerable:!0,configurable:!0}),
Object.defineProperty(f.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(c){this._computeParticleVertex=c},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(c){this._computeBoundingBox=c},enumerable:!0,configurable:!0}),f.prototype.initParticles=function(){},f.prototype.recycleParticle=function(c){return c},f.prototype.updateParticle=function(c){return c},
f.prototype.updateParticleVertex=function(c,a){return a},f.prototype.beforeUpdateParticles=function(){},f.prototype.afterUpdateParticles=function(){},f);c.SolidParticleSystem=f}(BABYLON||(BABYLON={}));
!function(c){var f=c.Internals||(c.Internals={}),e=function(a,c,e,g){this.name=a;this.worldAxisForNormal=c;this.worldAxisForFileX=e;this.worldAxisForFileY=g},a=function(){},e=(a.ConvertCubeMapToSphericalPolynomial=function(a){for(var d=new c.SphericalHarmonics,e=0,g=2/a.size,f=0.5*g-1,m=0;6>m;m++)for(var l=this.FileFaces[m],k=a[l.name],n=f,q=0;q<a.size;q++){for(var p=f,r=0;r<a.size;r++){var t=l.worldAxisForFileX.scale(p).add(l.worldAxisForFileY.scale(n)).add(l.worldAxisForNormal);t.normalize();var s,
u=Math.pow(1+p*p+n*n,-1.5);s=new c.Color3(k[3*q*a.size+3*r+0],k[3*q*a.size+3*r+1],k[3*q*a.size+3*r+2]);d.addLight(t,s,u);e+=u;p+=g}n+=g}return d.scale(4*Math.PI/e),d.scale(1/Math.PI),c.SphericalPolynomial.getSphericalPolynomialFromHarmonics(d)},a.FileFaces=[new e("right",new c.Vector3(1,0,0),new c.Vector3(0,0,-1),new c.Vector3(0,-1,0)),new e("left",new c.Vector3(-1,0,0),new c.Vector3(0,0,1),new c.Vector3(0,-1,0)),new e("up",new c.Vector3(0,1,0),new c.Vector3(1,0,0),new c.Vector3(0,0,1)),new e("down",
new c.Vector3(0,-1,0),new c.Vector3(1,0,0),new c.Vector3(0,0,-1)),new e("front",new c.Vector3(0,0,1),new c.Vector3(1,0,0),new c.Vector3(0,-1,0)),new e("back",new c.Vector3(0,0,-1),new c.Vector3(-1,0,0),new c.Vector3(0,-1,0))],a);f.CubeMapToSphericalPolynomialTools=e;!0}(BABYLON||(BABYLON={}));
!function(c){var f=c.Internals||(c.Internals={}),e=function(){};c=(e.ConvertPanoramaToCubemap=function(a,b,c,e){if(!a)throw"ConvertPanoramaToCubemap: input cannot be null";if(a.length!=3*b*c)throw"ConvertPanoramaToCubemap: input size is wrong";var g=this.CreateCubemapTexture(e,this.FACE_FRONT,a,b,c),f=this.CreateCubemapTexture(e,this.FACE_BACK,a,b,c),m=this.CreateCubemapTexture(e,this.FACE_LEFT,a,b,c),l=this.CreateCubemapTexture(e,this.FACE_RIGHT,a,b,c),k=this.CreateCubemapTexture(e,this.FACE_UP,
a,b,c);a=this.CreateCubemapTexture(e,this.FACE_DOWN,a,b,c);return{front:g,back:f,left:m,right:l,up:k,down:a,size:e}},e.CreateCubemapTexture=function(a,b,c,e,g){for(var f=new ArrayBuffer(12*a*a),f=new Float32Array(f),m=b[1].subtract(b[0]).scale(1/a),l=b[3].subtract(b[2]).scale(1/a),k=1/a,n=0,q=0;a>q;q++){for(var p=b[0],r=b[2],t=0;a>t;t++){var s=r.subtract(p).scale(n).add(p);s.normalize();s=this.CalcProjectionSpherical(s,c,e,g);f[3*q*a+3*t+0]=s.r;f[3*q*a+3*t+1]=s.g;f[3*q*a+3*t+2]=s.b;p=p.add(m);r=r.add(l)}n+=
k}return f},e.CalcProjectionSpherical=function(a,b,c,e){var g=Math.atan2(a.z,a.x);for(a=Math.acos(a.y);g<-Math.PI;)g+=2*Math.PI;for(;g>Math.PI;)g-=2*Math.PI;g/=Math.PI;a/=Math.PI;g=Math.round((0.5*g+0.5)*c);0>g?g=0:g>=c&&(g=c-1);a=Math.round(a*e);0>a?a=0:a>=e&&(a=e-1);e=e-a-1;return{r:b[3*e*c+3*g+0],g:b[3*e*c+3*g+1],b:b[3*e*c+3*g+2]}},e.FACE_FRONT=[new c.Vector3(-1,-1,-1),new c.Vector3(1,-1,-1),new c.Vector3(-1,1,-1),new c.Vector3(1,1,-1)],e.FACE_BACK=[new c.Vector3(1,-1,1),new c.Vector3(-1,-1,1),
new c.Vector3(1,1,1),new c.Vector3(-1,1,1)],e.FACE_RIGHT=[new c.Vector3(1,-1,-1),new c.Vector3(1,-1,1),new c.Vector3(1,1,-1),new c.Vector3(1,1,1)],e.FACE_LEFT=[new c.Vector3(-1,-1,1),new c.Vector3(-1,-1,-1),new c.Vector3(-1,1,1),new c.Vector3(-1,1,-1)],e.FACE_DOWN=[new c.Vector3(-1,1,-1),new c.Vector3(1,1,-1),new c.Vector3(-1,1,1),new c.Vector3(1,1,1)],e.FACE_UP=[new c.Vector3(-1,-1,1),new c.Vector3(1,-1,1),new c.Vector3(-1,-1,-1),new c.Vector3(1,-1,-1)],e);f.PanoramaToCubeMapTools=c;!0}(BABYLON||
(BABYLON={}));
!function(c){var f=c.Internals||(c.Internals={});c=function(){};c=(c.Ldexp=function(c,a){return 1023<a?c*Math.pow(2,1023)*Math.pow(2,a-1023):-1074>a?c*Math.pow(2,-1074)*Math.pow(2,a+1074):c*Math.pow(2,a)},c.Rgbe2float=function(c,a,b,d,f,g){0<f?(f=this.Ldexp(1,f-136),c[g+0]=a*f,c[g+1]=b*f,c[g+2]=d*f):(c[g+0]=0,c[g+1]=0,c[g+2]=0)},c.readStringLine=function(c,a){for(var b="",d="",f=a;f<c.length-a&&(d=String.fromCharCode(c[f]),"\n"!=d);f++)b+=d;return b},c.RGBE_ReadHeader=function(c){var a=0,b=0,d=this.readStringLine(c,
0);if("#"!=d[0]||"?"!=d[1])throw"Bad HDR Format.";var f=a=!1,g=0;do g+=d.length+1,d=this.readStringLine(c,g),"FORMAT=32-bit_rle_rgbe"==d?f=!0:0==d.length&&(a=!0);while(!a);if(!f)throw"HDR Bad header format, unsupported FORMAT";g+=d.length+1;d=this.readStringLine(c,g);c=/^\-Y (.*) \+X (.*)$/g.exec(d);if(3>c.length)throw"HDR Bad header format, no size";if(b=parseInt(c[2]),a=parseInt(c[1]),8>b||32767<b)throw"HDR Bad header format, unsupported size";return g+=d.length+1,{height:a,width:b,dataPosition:g}},
c.GetCubeMapTextureData=function(c,a){var b=new Uint8Array(c),d=this.RGBE_ReadHeader(b),b=this.RGBE_ReadPixels_RLE(b,d);return f.PanoramaToCubeMapTools.ConvertPanoramaToCubemap(b,d.width,d.height,a)},c.RGBE_ReadPixels=function(c,a){return this.RGBE_ReadPixels_RLE(c,a)},c.RGBE_ReadPixels_RLE=function(c,a){for(var b,d,f,g,h,m=a.height,l=a.width,k=a.dataPosition,n=g=0,q=0,p=new ArrayBuffer(4*l),p=new Uint8Array(p),q=new ArrayBuffer(12*a.width*a.height),r=new Float32Array(q);0<m;){if(b=c[k++],d=c[k++],
f=c[k++],g=c[k++],2!=b||2!=d||128&f)throw"HDR Bad header format, not RLE";if((f<<8|g)!=l)throw"HDR Bad header format, wrong scan line width";for(q=g=0;4>q;q++)for(n=(q+1)*l;n>g;)if(b=c[k++],d=c[k++],128<b){if(h=b-128,0==h||h>n-g)throw"HDR Bad Format, bad scanline data (run)";for(;0<h--;)p[g++]=d}else{if(h=b,0==h||h>n-g)throw"HDR Bad Format, bad scanline data (non-run)";if(p[g++]=d,0<--h)for(var t=0;h>t;t++)p[g++]=c[k++]}for(q=0;l>q;q++)b=p[q],d=p[q+l],f=p[q+2*l],g=p[q+3*l],this.Rgbe2float(r,b,d,f,
g,3*(a.height-m)*l+3*q);m--}return r},c);f.HDRTools=c;!0}(BABYLON||(BABYLON={}));
!function(c){var f=c.Internals||(c.Internals={}),e,a=function(){this.min=new c.Vector3(0,0,0);this.max=new c.Vector3(0,0,0);this.clear()};e=(a.prototype.clear=function(){this.min.x=a.MAX;this.min.y=a.MAX;this.min.z=a.MAX;this.max.x=a.MIN;this.max.y=a.MIN;this.max.z=a.MIN},a.prototype.augment=function(a,b,c){this.min.x=Math.min(this.min.x,a);this.min.y=Math.min(this.min.y,b);this.min.z=Math.min(this.min.z,c);this.max.x=Math.max(this.max.x,a);this.max.y=Math.max(this.max.y,b);this.max.z=Math.max(this.max.z,
c)},a.prototype.clampMin=function(a,b,c){this.min.x=Math.max(this.min.x,a);this.min.y=Math.max(this.min.y,b);this.min.z=Math.max(this.min.z,c)},a.prototype.clampMax=function(a,b,c){this.max.x=Math.min(this.max.x,a);this.max.y=Math.min(this.max.y,b);this.max.z=Math.min(this.max.z,c)},a.prototype.empty=function(){return this.min.x>this.max.y||this.min.y>this.max.y||this.min.z>this.max.y},a.MAX=Number.MAX_VALUE,a.MIN=Number.MIN_VALUE,a);var b,d=function(a,b,c,d,e,f,n,q,p,r){this.input=a;this.inputSize=
b;this.outputSize=c;this.maxNumMipLevels=d;this.numChannels=e;this.isFloat=f;this.specularPower=n;this.cosinePowerDropPerMip=q;this.excludeBase=p;this.fixup=r;this._outputSurface=[];this._numMipLevels=0};b=(d.prototype.filterCubeMap=function(){return this.init(),this.filterCubeMapMipChain(),this._outputSurface},d.prototype.init=function(){var a,b,c;0==this.maxNumMipLevels&&(this.maxNumMipLevels=d.CP_MAX_MIPLEVELS);c=this.outputSize;for(b=0;b<this.maxNumMipLevels;b++){this._outputSurface.length++;
this._outputSurface[b]=[];for(a=0;6>a;a++)this._outputSurface[b].length++,this.isFloat?this._outputSurface[b][a]=new Float32Array(c*c*this.numChannels):this._outputSurface[b][a]=new Uint32Array(c*c*this.numChannels);if(c>>=1,this._numMipLevels++,0==c)return void(this.maxNumMipLevels=b)}},d.prototype.filterCubeMapMipChain=function(){var a=this.specularPower;this.precomputeFilterLookupTables(this.inputSize);for(var b=0;b<this._numMipLevels;b++){this.excludeBase&&0==b&&(a=1E5);var c=this.input,d=this._outputSurface[b],
e=this.outputSize>>b,f=this.getBaseFilterAngle(a);this.filterCubeSurfaces(c,this.inputSize,d,e,f,a);this.fixup&&this.fixupCubeEdges(d,e);this.excludeBase&&0==b&&(a=this.specularPower);a*=this.cosinePowerDropPerMip}},d.prototype.getBaseFilterAngle=function(a){var b=180;return b=Math.acos(Math.pow(1E-6,1/a)),b*=180/Math.PI,2*b},d.prototype.precomputeFilterLookupTables=function(a){this._normCubeMap=[];this.buildNormalizerSolidAngleCubemap(a)},d.prototype.buildNormalizerSolidAngleCubemap=function(a){var b,
c,d;for(b=0;6>b;b++){this._normCubeMap.push(new Float32Array(4*a*a));this.input[b];for(d=0;a>d;d++)for(c=0;a>c;c++){var e=this.texelCoordToVect(b,c,d,a,this.fixup);this._normCubeMap[b][4*(d*a+c)+0]=e.x;this._normCubeMap[b][4*(d*a+c)+1]=e.y;this._normCubeMap[b][4*(d*a+c)+2]=e.z;e=this.texelCoordSolidAngle(b,c,d,a);this._normCubeMap[b][4*(d*a+c)+4]=e}}},d.prototype.texelCoordToVect=function(a,b,c,e,f){if(b=2*(b+0.5)/e-1,c=2*(c+0.5)/e-1,f&&1<e)e=Math.pow(e,2)/Math.pow(e-1,3),b=e*Math.pow(b,3)+b,c=e*
Math.pow(c,3)+c;e=d._sgFace2DMapping[a][d.CP_UDIR];d._vectorTemp.x=e[0]*b;d._vectorTemp.y=e[1]*b;d._vectorTemp.z=e[2]*b;b=d._sgFace2DMapping[a][d.CP_VDIR];d._vectorTemp.x+=b[0]*c;d._vectorTemp.y+=b[1]*c;d._vectorTemp.z+=b[2]*c;a=d._sgFace2DMapping[a][d.CP_FACEAXIS];return d._vectorTemp.x+=a[0],d._vectorTemp.y+=a[1],d._vectorTemp.z+=a[2],d._vectorTemp.normalize(),d._vectorTemp},d.prototype.vectToTexelCoord=function(a,b,c,e){var f,k,n=Math.abs(a),q=Math.abs(b),p=Math.abs(c);n>=q&&n>=p?(f=n,k=0<=a?d.CP_FACE_X_POS:
d.CP_FACE_X_NEG):q>=n&&q>=p?(f=q,k=0<=b?d.CP_FACE_Y_POS:d.CP_FACE_Y_NEG):(f=p,k=0<=c?d.CP_FACE_Z_POS:d.CP_FACE_Z_NEG);f=1/f;a*=f;b*=f;c*=f;f=d._sgFace2DMapping[k][d.CP_UDIR];n=f[0]*a+f[1]*b+f[2]*c;f=d._sgFace2DMapping[k][d.CP_VDIR];n=Math.floor(0.5*(e-1)*(n+1));a=Math.floor(0.5*(e-1)*(f[0]*a+f[1]*b+f[2]*c+1));return d._vectorTemp.x=k,d._vectorTemp.y=n,d._vectorTemp.z=a,d._vectorTemp},d.prototype.areaElement=function(a,b){return Math.atan2(a*b,Math.sqrt(a*a+b*b+1))},d.prototype.texelCoordSolidAngle=
function(a,b,c,d){b=2*(b+0.5)/d-1;c=2*(c+0.5)/d-1;var e=1/d;a=b-e;d=c-e;b+=e;c+=e;return this.areaElement(a,d)-this.areaElement(a,c)-this.areaElement(b,d)+this.areaElement(b,c)},d.prototype.filterCubeSurfaces=function(a,b,c,d,f,k){var n,q,p,r=[];for(n=0;6>n;n++)r.push(new e);n=180/Math.PI*Math.atan2(1,b);q=f/2;n>q&&(q=n);90<q&&(q=90);f=Math.ceil(q/n);1>f&&(f=1);var t=Math.cos(Math.PI/180*q);for(n=0;6>n;n++)for(p=0;d>p;p++)for(q=0;d>q;q++){var s=this.texelCoordToVect(n,q,p,d,this.fixup).clone();this.clearFilterExtents(r);
this.determineFilterExtents(s,b,f,r);s=this.processFilterExtents(s,t,r,a,b,k);c[n][(p*d+q)*this.numChannels+0]=s.x;c[n][(p*d+q)*this.numChannels+1]=s.y;c[n][(p*d+q)*this.numChannels+2]=s.z}},d.prototype.clearFilterExtents=function(a){for(var b=0;6>b;b++)a[b].clear()},d.prototype.determineFilterExtents=function(a,b,c,e){var f,k,n=[0,0,0,0],q=[0,0,0,0],p=[0,0,0,0],r=this.vectToTexelCoord(a.x,a.y,a.z,b);a=r.x;var t=r.y,r=r.z;e[a].augment(t-c,r-c,0);e[a].augment(t+c,r+c,0);e[a].clampMin(0,0,0);e[a].clampMax(b-
1,b-1,0);var s=e[a].min.x,u=e[a].min.y,v=e[a].max.x,w=e[a].max.y;n[0]=c-t;q[0]=u;p[0]=w;n[1]=t+c-(b-1);q[1]=u;p[1]=w;n[2]=c-r;q[2]=s;p[2]=v;n[3]=r+c-(b-1);q[3]=s;p[3]=v;for(t=0;4>t;t++){if(0<n[t]){switch(c=d._sgCubeNgh[a][t][0],f=d._sgCubeNgh[a][t][1],t!=f&&3!=t+f||(q[t]=b-1-q[t],p[t]=b-1-p[t]),d._sgCubeNgh[a][t][1]){case d.CP_EDGE_LEFT:e[c].augment(0,q[t],0);e[c].augment(n[t],p[t],0);break;case d.CP_EDGE_RIGHT:e[c].augment(b-1,q[t],0);e[c].augment(b-1-n[t],p[t],0);break;case d.CP_EDGE_TOP:e[c].augment(q[t],
0,0);e[c].augment(p[t],n[t],0);break;case d.CP_EDGE_BOTTOM:e[c].augment(q[t],b-1,0),e[c].augment(p[t],b-1-n[t],0)}e[c].clampMin(0,0,0);e[c].clampMax(b-1,b-1,0)}if(n[t]>b){switch(a){case d.CP_FACE_X_POS:k=d.CP_FACE_X_NEG;break;case d.CP_FACE_X_NEG:k=d.CP_FACE_X_POS;break;case d.CP_FACE_Y_POS:k=d.CP_FACE_Y_NEG;break;case d.CP_FACE_Y_NEG:k=d.CP_FACE_Y_POS;break;case d.CP_FACE_Z_POS:k=d.CP_FACE_Z_NEG;break;case d.CP_FACE_Z_NEG:k=d.CP_FACE_Z_POS}e[k].augment(0,0,0);e[k].augment(b-1,b-1,0)}}},d.prototype.processFilterExtents=
function(a,b,c,e,f,k){for(var n=[0,0,0,0],q=0,p=0,r=this.numChannels,t=4*f,s=f*this.numChannels,u=0;6>u;u++)if(!c[u].empty())for(var v=c[u].min.x,w=c[u].min.y,x=c[u].max.x,B=c[u].max.y,y=4*(w*f+v),C=this.numChannels*(w*f+v);B>=w;w++){for(var D=0,A=0,I=v;x>=I;I++){p=this._normCubeMap[u][y+D+0]*a.x+this._normCubeMap[u][y+D+1]*a.y+this._normCubeMap[u][y+D+2]*a.z;if(p>=b&&0<p){for(var z=this._normCubeMap[u][y+D+3],z=z*Math.pow(p,k+1),p=0;r>p;p++)n[p]+=z*e[u][C+A],A++;q+=z}else A+=r;D+=4}y+=t;C+=s}0!=
q?(d._vectorTemp.x=n[0]/q,d._vectorTemp.y=n[1]/q,d._vectorTemp.z=n[2]/q,3<this.numChannels&&(d._vectorTemp.w=n[3]/q)):(a=this.vectToTexelCoord(a.x,a.y,a.z,f).clone(),d._vectorTemp.x=e[a.x][this.numChannels*(a.z*f+a.y)+0],d._vectorTemp.y=e[a.x][this.numChannels*(a.z*f+a.y)+1],d._vectorTemp.z=e[a.x][this.numChannels*(a.z*f+a.y)+2],3<this.numChannels&&(d._vectorTemp.z=e[a.x][this.numChannels*(a.z*f+a.y)+3]));return d._vectorTemp},d.prototype.fixupCubeEdges=function(a,b){var c,e,f,k=0;c=[0,0,0,0,0,0,
0,0];var n=[[],[],[],[]],q=[[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]]];if(!(1>b))if(1!=b){for(f=0;6>f;f++){n[0]=[f,0];n[1]=[f,(b-1)*this.numChannels];n[2]=[f,b*(b-1)*this.numChannels];n[3]=[f,(b*(b-1)+(b-1))*this.numChannels];for(k=0;4>k;k++){var p=d._sgCubeCornerList[f][k];q[p][c[p]]=n[k];c[p]++}}for(k=0;8>k;k++)for(c=0;c<this.numChannels;c++){for(f=n=0;3>f;f++)n+=a[q[k][f][0]][q[k][f][1]+c];n*=1/3;for(f=0;3>f;f++)a[q[k][f][0]][q[k][f][1]+c]=n}for(f=
0;12>f;f++){k=d._sgCubeEdgeList[f][0];c=d._sgCubeEdgeList[f][1];q=d._sgCubeNgh[k][c][0];e=d._sgCubeNgh[k][c][1];var r=p=n=0,t=0;switch(c){case d.CP_EDGE_LEFT:r=this.numChannels*b;break;case d.CP_EDGE_RIGHT:n+=(b-1)*this.numChannels;r=this.numChannels*b;break;case d.CP_EDGE_TOP:r=this.numChannels;break;case d.CP_EDGE_BOTTOM:n+=b*(b-1)*this.numChannels,r=this.numChannels}if(c==e||3==c+e)switch(e){case d.CP_EDGE_LEFT:p+=(b-1)*b*this.numChannels;t=-(this.numChannels*b);break;case d.CP_EDGE_RIGHT:p+=((b-
1)*b+(b-1))*this.numChannels;t=-(this.numChannels*b);break;case d.CP_EDGE_TOP:p+=(b-1)*this.numChannels;t=-this.numChannels;break;case d.CP_EDGE_BOTTOM:p+=((b-1)*b+(b-1))*this.numChannels,t=-this.numChannels}else switch(e){case d.CP_EDGE_LEFT:t=this.numChannels*b;break;case d.CP_EDGE_RIGHT:p+=(b-1)*this.numChannels;t=this.numChannels*b;break;case d.CP_EDGE_TOP:t=this.numChannels;break;case d.CP_EDGE_BOTTOM:p+=b*(b-1)*this.numChannels,t=this.numChannels}n+=r;p+=t;for(e=1;b-1>e;e++){for(c=0;c<this.numChannels;c++){var s=
0.5*(a[k][n+c]+a[q][p+c]);a[k][n+c]=s;a[q][p+c]=s}n+=r;p+=t}}}else for(c=0;c<this.numChannels;c++){for(f=k=0;6>f;f++)k+=a[f][c];k/=6;for(f=0;6>f;f++)a[f][c]=k}},d.CP_MAX_MIPLEVELS=16,d.CP_UDIR=0,d.CP_VDIR=1,d.CP_FACEAXIS=2,d.CP_FACE_X_POS=0,d.CP_FACE_X_NEG=1,d.CP_FACE_Y_POS=2,d.CP_FACE_Y_NEG=3,d.CP_FACE_Z_POS=4,d.CP_FACE_Z_NEG=5,d.CP_EDGE_LEFT=0,d.CP_EDGE_RIGHT=1,d.CP_EDGE_TOP=2,d.CP_EDGE_BOTTOM=3,d.CP_CORNER_NNN=0,d.CP_CORNER_NNP=1,d.CP_CORNER_NPN=2,d.CP_CORNER_NPP=3,d.CP_CORNER_PNN=4,d.CP_CORNER_PNP=
5,d.CP_CORNER_PPN=6,d.CP_CORNER_PPP=7,d._vectorTemp=new c.Vector4(0,0,0,0),d._sgFace2DMapping=[[[0,0,-1],[0,-1,0],[1,0,0]],[[0,0,1],[0,-1,0],[-1,0,0]],[[1,0,0],[0,0,1],[0,1,0]],[[1,0,0],[0,0,-1],[0,-1,0]],[[1,0,0],[0,-1,0],[0,0,1]],[[-1,0,0],[0,-1,0],[0,0,-1]]],d._sgCubeNgh=[[[d.CP_FACE_Z_POS,d.CP_EDGE_RIGHT],[d.CP_FACE_Z_NEG,d.CP_EDGE_LEFT],[d.CP_FACE_Y_POS,d.CP_EDGE_RIGHT],[d.CP_FACE_Y_NEG,d.CP_EDGE_RIGHT]],[[d.CP_FACE_Z_NEG,d.CP_EDGE_RIGHT],[d.CP_FACE_Z_POS,d.CP_EDGE_LEFT],[d.CP_FACE_Y_POS,d.CP_EDGE_LEFT],
[d.CP_FACE_Y_NEG,d.CP_EDGE_LEFT]],[[d.CP_FACE_X_NEG,d.CP_EDGE_TOP],[d.CP_FACE_X_POS,d.CP_EDGE_TOP],[d.CP_FACE_Z_NEG,d.CP_EDGE_TOP],[d.CP_FACE_Z_POS,d.CP_EDGE_TOP]],[[d.CP_FACE_X_NEG,d.CP_EDGE_BOTTOM],[d.CP_FACE_X_POS,d.CP_EDGE_BOTTOM],[d.CP_FACE_Z_POS,d.CP_EDGE_BOTTOM],[d.CP_FACE_Z_NEG,d.CP_EDGE_BOTTOM]],[[d.CP_FACE_X_NEG,d.CP_EDGE_RIGHT],[d.CP_FACE_X_POS,d.CP_EDGE_LEFT],[d.CP_FACE_Y_POS,d.CP_EDGE_BOTTOM],[d.CP_FACE_Y_NEG,d.CP_EDGE_TOP]],[[d.CP_FACE_X_POS,d.CP_EDGE_RIGHT],[d.CP_FACE_X_NEG,d.CP_EDGE_LEFT],
[d.CP_FACE_Y_POS,d.CP_EDGE_TOP],[d.CP_FACE_Y_NEG,d.CP_EDGE_BOTTOM]]],d._sgCubeEdgeList=[[d.CP_FACE_X_POS,d.CP_EDGE_LEFT],[d.CP_FACE_X_POS,d.CP_EDGE_RIGHT],[d.CP_FACE_X_POS,d.CP_EDGE_TOP],[d.CP_FACE_X_POS,d.CP_EDGE_BOTTOM],[d.CP_FACE_X_NEG,d.CP_EDGE_LEFT],[d.CP_FACE_X_NEG,d.CP_EDGE_RIGHT],[d.CP_FACE_X_NEG,d.CP_EDGE_TOP],[d.CP_FACE_X_NEG,d.CP_EDGE_BOTTOM],[d.CP_FACE_Z_POS,d.CP_EDGE_TOP],[d.CP_FACE_Z_POS,d.CP_EDGE_BOTTOM],[d.CP_FACE_Z_NEG,d.CP_EDGE_TOP],[d.CP_FACE_Z_NEG,d.CP_EDGE_BOTTOM]],d._sgCubeCornerList=
[[d.CP_CORNER_PPP,d.CP_CORNER_PPN,d.CP_CORNER_PNP,d.CP_CORNER_PNN],[d.CP_CORNER_NPN,d.CP_CORNER_NPP,d.CP_CORNER_NNN,d.CP_CORNER_NNP],[d.CP_CORNER_NPN,d.CP_CORNER_PPN,d.CP_CORNER_NPP,d.CP_CORNER_PPP],[d.CP_CORNER_NNP,d.CP_CORNER_PNP,d.CP_CORNER_NNN,d.CP_CORNER_PNN],[d.CP_CORNER_NPP,d.CP_CORNER_PPP,d.CP_CORNER_NNP,d.CP_CORNER_PNP],[d.CP_CORNER_PPN,d.CP_CORNER_NPN,d.CP_CORNER_PNN,d.CP_CORNER_NNN]],d);f.PMREMGenerator=b;!0}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.BaseTexture,a=function(a,d,f,g,h,m,l){void 0===g&&(g=!1);void 0===m&&(m=!1);void 0===l&&(l=!1);e.call(this,d);this._useInGammaSpace=!1;this._generateHarmonics=!0;this._isBABYLONPreprocessed=!1;this.coordinatesMode=c.Texture.CUBIC_MODE;this.sphericalPolynomial=null;this.isPMREM=!1;a&&(this.name=a,this.url=a,this.hasAlpha=!1,this.isCube=!0,this._textureMatrix=c.Matrix.Identity(),f?(this._isBABYLONPreprocessed=!1,this._noMipmap=g,this._size=f,this._useInGammaSpace=m,this._usePMREMGenerator=
l&&d.getEngine().getCaps().textureLOD&&this.getScene().getEngine().getCaps().textureFloat&&!this._useInGammaSpace):(this._isBABYLONPreprocessed=!0,this._noMipmap=!1,this._useInGammaSpace=!1,this._usePMREMGenerator=d.getEngine().getCaps().textureLOD&&this.getScene().getEngine().getCaps().textureFloat&&!this._useInGammaSpace),this.isPMREM=this._usePMREMGenerator,this._texture=this._getFromCache(a,this._noMipmap),this._texture||(d.useDelayedTextureLoading?this.delayLoadState=c.Engine.DELAYLOADSTATE_NOTLOADED:
this.loadTexture()))};f=(__extends(a,e),a.prototype.loadBabylonTexture=function(){var a=this,d=0,e=null,f=!this._useInGammaSpace&&this.getScene().getEngine().getCaps().textureFloat?function(){for(var c=[],f=30,g=0;d>g;g++){c.push([]);for(var k=3*Math.pow(a._size>>g,2),n=0;6>n;n++){var q=e.subarray(f,f+k);c[g].push(q);f+=k}}return c}:null;this._texture=this.getScene().getEngine().createRawCubeTexture(this.url,this.getScene(),this._size,c.Engine.TEXTUREFORMAT_RGB,this.getScene().getEngine().getCaps().textureFloat?
c.Engine.TEXTURETYPE_FLOAT:c.Engine.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,function(h){var m=new Int32Array(h);e=new Float32Array(h);m[0];a._size=m[1];a.getScene().getEngine().updateTextureSize(a._texture,a._size,a._size);a.sphericalPolynomial=new c.SphericalPolynomial;a.sphericalPolynomial.x.copyFromFloats(e[2],e[3],e[4]);a.sphericalPolynomial.y.copyFromFloats(e[5],e[6],e[7]);a.sphericalPolynomial.z.copyFromFloats(e[8],e[9],e[10]);a.sphericalPolynomial.xx.copyFromFloats(e[11],e[12],e[13]);a.sphericalPolynomial.yy.copyFromFloats(e[14],
e[15],e[16]);a.sphericalPolynomial.zz.copyFromFloats(e[17],e[18],e[19]);a.sphericalPolynomial.xy.copyFromFloats(e[20],e[21],e[22]);a.sphericalPolynomial.yz.copyFromFloats(e[23],e[24],e[25]);a.sphericalPolynomial.zx.copyFromFloats(e[26],e[27],e[28]);d=m[29];var l=30;h=[];for(var m=3*Math.pow(a._size,2),k=0;6>k;k++)h.push(e.subarray(l,l+m)),l+=m;for(var l=[],n=null,k=0;6>k;k++){var q=null;if(f)q=h[k];else{if(q=h[[0,2,4,1,3,5][k]],!a.getScene().getEngine().getCaps().textureFloat)n=new ArrayBuffer(m),
n=new Uint8Array(n);for(var p=0;p<a._size*a._size;p++)if(a._useInGammaSpace&&(q[3*p+0]=Math.pow(q[3*p+0],c.ToGammaSpace),q[3*p+1]=Math.pow(q[3*p+1],c.ToGammaSpace),q[3*p+2]=Math.pow(q[3*p+2],c.ToGammaSpace)),n){var r=Math.max(255*q[3*p+0],0),t=Math.max(255*q[3*p+1],0),s=Math.max(255*q[3*p+2],0),u=Math.max(Math.max(r,t),s);255<u&&(u=255/u,r*=u,t*=u,s*=u);n[3*p+0]=r;n[3*p+1]=t;n[3*p+2]=s}}n?l.push(n):l.push(q)}return l},f)},a.prototype.loadHDRTexture=function(){var b=this,d=null;!this._noMipmap&&this._usePMREMGenerator&&
(d=function(a){return(new c.Internals.PMREMGenerator(a,b._size,b._size,0,3,b.getScene().getEngine().getCaps().textureFloat,2048,0.25,!1,!0)).filterCubeMap()});this._texture=this.getScene().getEngine().createRawCubeTexture(this.url,this.getScene(),this._size,c.Engine.TEXTUREFORMAT_RGB,this.getScene().getEngine().getCaps().textureFloat?c.Engine.TEXTURETYPE_FLOAT:c.Engine.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,function(d){d=c.Internals.HDRTools.GetCubeMapTextureData(d,b._size);b._generateHarmonics&&
(b.sphericalPolynomial=c.Internals.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial(d));for(var e=[],f=null,m=0;6>m;m++){b.getScene().getEngine().getCaps().textureFloat||(f=new ArrayBuffer(3*b._size*b._size),f=new Uint8Array(f));var l=d[a._facesMapping[m]];if(b._useInGammaSpace||f)for(var k=0;k<b._size*b._size;k++)if(b._useInGammaSpace&&(l[3*k+0]=Math.pow(l[3*k+0],c.ToGammaSpace),l[3*k+1]=Math.pow(l[3*k+1],c.ToGammaSpace),l[3*k+2]=Math.pow(l[3*k+2],c.ToGammaSpace)),f){var n=Math.max(255*
l[3*k+0],0),q=Math.max(255*l[3*k+1],0),p=Math.max(255*l[3*k+2],0),r=Math.max(Math.max(n,q),p);255<r&&(r=255/r,n*=r,q*=r,p*=r);f[3*k+0]=n;f[3*k+1]=q;f[3*k+2]=p}f?e.push(f):e.push(l)}return e},d)},a.prototype.loadTexture=function(){this._isBABYLONPreprocessed?this.loadBabylonTexture():this.loadHDRTexture()},a.prototype.clone=function(){var b=this._isBABYLONPreprocessed?null:this._size,b=new a(this.url,this.getScene(),b,this._noMipmap,this._generateHarmonics,this._useInGammaSpace,this._usePMREMGenerator);
return b.level=this.level,b.wrapU=this.wrapU,b.wrapV=this.wrapV,b.coordinatesIndex=this.coordinatesIndex,b.coordinatesMode=this.coordinatesMode,b},a.prototype.delayLoad=function(){this.delayLoadState===c.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=c.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this.loadTexture())},a.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},a.Parse=function(a,d,e){var f=null;a.name&&
!a.isRenderTarget&&(f=new c.HDRCubeTexture(e+a.name,d,a.isBABYLONPreprocessed?null:a.size,f.generateHarmonics,f.useInGammaSpace,f.usePMREMGenerator),f.name=a.name,f.hasAlpha=a.hasAlpha,f.level=a.level,f.coordinatesMode=a.coordinatesMode);return f},a.prototype.serialize=function(){if(!this.name)return null;var a={};return a.name=this.name,a.hasAlpha=this.hasAlpha,a.isCube=!0,a.level=this.level,a.size=this._size,a.coordinatesMode=this.coordinatesMode,a.useInGammaSpace=this._useInGammaSpace,a.generateHarmonics=
this._generateHarmonics,a.usePMREMGenerator=this._usePMREMGenerator,a.isBABYLONPreprocessed=this._isBABYLONPreprocessed,a},a.generateBabylonHDROnDisk=function(b,c,e){void 0===e&&(e=null);a.generateBabylonHDR(b,c,function(a){a=new Blob([a],{type:"application/octet-stream"});a=window.URL.createObjectURL(a);var b=document.createElement("a");document.body.appendChild(b);b.style.display="none";b.href=a;b.download="envmap.babylon.hdr";b.click()},e)},a.generateBabylonHDR=function(a,d,e,f){if((void 0===f&&
(f=null),!a)||!c.Tools.IsExponentOfTwo(d))return null;c.Tools.LoadFile(a,function(a){a=c.Internals.HDRTools.GetCubeMapTextureData(a,d);var b=c.Internals.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial(a),f=[];f.push(a.right);f.push(a.left);f.push(a.up);f.push(a.down);f.push(a.front);f.push(a.back);a=(new c.Internals.PMREMGenerator(f,d,d,0,3,!0,2048,0.25,!1,!0)).filterCubeMap();var g;g=116;g+=4;for(f=0;f<a.length;f++){var n=d>>f;g+=12*6*n*n}g=new ArrayBuffer(g);f=new Int32Array(g);
n=new Float32Array(g);f[0]=1;f[1]=d;b.x.toArray(n,2);b.y.toArray(n,5);b.z.toArray(n,8);b.xx.toArray(n,11);b.yy.toArray(n,14);b.zz.toArray(n,17);b.xy.toArray(n,20);b.yz.toArray(n,23);b.zx.toArray(n,26);f[29]=a.length;b=30;for(f=0;f<a.length;f++)for(var q=3*Math.pow(d>>f,2),p=0;6>p;p++)n.set(a[f][p],b),b+=q;e(g)},null,null,!0,f)},a._facesMapping="right up front left down back".split(" "),a);c.HDRCubeTexture=f}(BABYLON||(BABYLON={}));
!function(c){var f=c.Debug||(c.Debug={}),e;e=function(a,b,d,e,f){void 0===e&&(e=!0);void 0===f&&(f=1);this.skeleton=a;this.mesh=b;this.autoUpdateBonesMatrices=e;this.renderingGroupId=f;this.color=c.Color3.White();this._debugLines=[];this._isEnabled=!1;this._scene=d;this.update();this._renderFunction=this.update.bind(this)};e=(Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(a){this._isEnabled!==a&&(this._isEnabled=a,a?this._scene.registerBeforeRender(this._renderFunction):
this._scene.unregisterBeforeRender(this._renderFunction))},enumerable:!0,configurable:!0}),e.prototype._getBonePosition=function(a,b,d,e,f,h){void 0===e&&(e=0);void 0===f&&(f=0);void 0===h&&(h=0);var m=c.Tmp.Matrix[0],l=b.getParent();if(m.copyFrom(b.getLocalMatrix()),0!==e||0!==f||0!==h)b=c.Tmp.Matrix[1],c.Matrix.IdentityToRef(b),b.m[12]=e,b.m[13]=f,b.m[14]=h,b.multiplyToRef(m,m);l&&m.multiplyToRef(l.getAbsoluteTransform(),m);m.multiplyToRef(d,m);a.x=m.m[12];a.y=m.m[13];a.z=m.m[14]},e.prototype._getLinesForBonesWithLength=
function(a,b){for(var d=a.length,e=0;d>e;e++){var f=a[e],h=this._debugLines[e];h||(h=[c.Vector3.Zero(),c.Vector3.Zero()],this._debugLines[e]=h);this._getBonePosition(h[0],f,b);this._getBonePosition(h[1],f,b,0,f.length,0)}},e.prototype._getLinesForBonesNoLength=function(a,b){for(var d=0,e=a.length-1;0<=e;e--){var f=a[e],h=f.getParent();if(h){var m=this._debugLines[d];m||(m=[c.Vector3.Zero(),c.Vector3.Zero()],this._debugLines[d]=m);this._getBonePosition(m[0],f,b);this._getBonePosition(m[1],h,b);d++}}},
e.prototype.update=function(){this.autoUpdateBonesMatrices&&this._updateBoneMatrix(this.skeleton.bones[0]);void 0===this.skeleton.bones[0].length?this._getLinesForBonesNoLength(this.skeleton.bones,this.mesh.getWorldMatrix()):this._getLinesForBonesWithLength(this.skeleton.bones,this.mesh.getWorldMatrix());this._debugMesh?c.MeshBuilder.CreateLineSystem(null,{lines:this._debugLines,updatable:!0,instance:this._debugMesh},this._scene):(this._debugMesh=c.MeshBuilder.CreateLineSystem(null,{lines:this._debugLines,
updatable:!0},this._scene),this._debugMesh.renderingGroupId=this.renderingGroupId);this._debugMesh.color=this.color},e.prototype._updateBoneMatrix=function(a){a.getParent()&&a.getLocalMatrix().multiplyToRef(a.getParent().getAbsoluteTransform(),a.getAbsoluteTransform());a=a.children;for(var b=a.length,c=0;b>c;c++)this._updateBoneMatrix(a[c])},e.prototype.dispose=function(){this._debugMesh&&(this.isEnabled=!1,this._debugMesh.dispose(),this._debugMesh=null)},e);f.SkeletonViewer=e;!0}(BABYLON||(BABYLON=
{}));
!function(c){var f,e=function(){this._dirty=!0;this._tempColor=new c.Color4(0,0,0,0);this._globalCurve=new c.Color4(0,0,0,0);this._highlightsCurve=new c.Color4(0,0,0,0);this._midtonesCurve=new c.Color4(0,0,0,0);this._shadowsCurve=new c.Color4(0,0,0,0);this._positiveCurve=new c.Color4(0,0,0,0);this._negativeCurve=new c.Color4(0,0,0,0);this._globalHue=30;this._globalExposure=this._globalSaturation=this._globalDensity=0;this._highlightsHue=30;this._highlightsExposure=this._highlightsSaturation=this._highlightsDensity=
0;this._midtonesHue=30;this._midtonesExposure=this._midtonesSaturation=this._midtonesDensity=0;this._shadowsHue=30;this._shadowsExposure=this._shadowsSaturation=this._shadowsDensity=0};f=(Object.defineProperty(e.prototype,"GlobalHue",{get:function(){return this._globalHue},set:function(a){this._globalHue=a;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"GlobalDensity",{get:function(){return this._globalDensity},set:function(a){this._globalDensity=a;this._dirty=!0},
enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"GlobalSaturation",{get:function(){return this._globalSaturation},set:function(a){this._globalSaturation=a;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HighlightsHue",{get:function(){return this._highlightsHue},set:function(a){this._highlightsHue=a;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HighlightsDensity",{get:function(){return this._highlightsDensity},
set:function(a){this._highlightsDensity=a;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HighlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(a){this._highlightsSaturation=a;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HighlightsExposure",{get:function(){return this._highlightsExposure},set:function(a){this._highlightsExposure=a;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,
"MidtonesHue",{get:function(){return this._midtonesHue},set:function(a){this._midtonesHue=a;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"MidtonesDensity",{get:function(){return this._midtonesDensity},set:function(a){this._midtonesDensity=a;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"MidtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(a){this._midtonesSaturation=a;this._dirty=!0},enumerable:!0,
configurable:!0}),Object.defineProperty(e.prototype,"MidtonesExposure",{get:function(){return this._midtonesExposure},set:function(a){this._midtonesExposure=a;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ShadowsHue",{get:function(){return this._shadowsHue},set:function(a){this._shadowsHue=a;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ShadowsDensity",{get:function(){return this._shadowsDensity},set:function(a){this._shadowsDensity=
a;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ShadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(a){this._shadowsSaturation=a;this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ShadowsExposure",{get:function(){return this._shadowsExposure},set:function(a){this._shadowsExposure=a;this._dirty=!0},enumerable:!0,configurable:!0}),e.Bind=function(a,b){a._dirty&&(a._dirty=!1,a.getColorGradingDataToRef(a._globalHue,
a._globalDensity,a._globalSaturation,a._globalExposure,a._globalCurve),a.getColorGradingDataToRef(a._highlightsHue,a._highlightsDensity,a._highlightsSaturation,a._highlightsExposure,a._tempColor),a._tempColor.multiplyToRef(a._globalCurve,a._highlightsCurve),a.getColorGradingDataToRef(a._midtonesHue,a._midtonesDensity,a._midtonesSaturation,a._midtonesExposure,a._tempColor),a._tempColor.multiplyToRef(a._globalCurve,a._midtonesCurve),a.getColorGradingDataToRef(a._shadowsHue,a._shadowsDensity,a._shadowsSaturation,
a._shadowsExposure,a._tempColor),a._tempColor.multiplyToRef(a._globalCurve,a._shadowsCurve),a._highlightsCurve.subtractToRef(a._midtonesCurve,a._positiveCurve),a._midtonesCurve.subtractToRef(a._shadowsCurve,a._negativeCurve));b.setFloat4("vCameraColorCurvePositive",a._positiveCurve.r,a._positiveCurve.g,a._positiveCurve.b,a._positiveCurve.a);b.setFloat4("vCameraColorCurveNeutral",a._midtonesCurve.r,a._midtonesCurve.g,a._midtonesCurve.b,a._midtonesCurve.a);b.setFloat4("vCameraColorCurveNegative",a._negativeCurve.r,
a._negativeCurve.g,a._negativeCurve.b,a._negativeCurve.a)},e.PrepareUniforms=function(a){a.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},e.prototype.getColorGradingDataToRef=function(a,b,c,f,g){null!=a&&(a=e.clamp(a,0,360),b=e.clamp(b,-100,100),c=e.clamp(c,-100,100),f=e.clamp(f,-100,100),b=e.applyColorGradingSliderNonlinear(b),b*=0.5,f=e.applyColorGradingSliderNonlinear(f),0>b&&(b*=-1,a=(a+180)%360),e.fromHSBToRef(a,b,50+0.25*f,g),g.scaleToRef(2,g),g.a=
1+0.01*c)},e.applyColorGradingSliderNonlinear=function(a){a/=100;var b=Math.abs(a);return b=Math.pow(b,2),0>a&&(b*=-1),100*b},e.fromHSBToRef=function(a,b,c,f){var g=e.clamp(a,0,360);b=e.clamp(b/100,0,1);c=e.clamp(c/100,0,1);if(0===b)f.r=c,f.g=c,f.b=c;else{g/=60;a=Math.floor(g);var h=g-a,g=c*(1-b),m=c*(1-b*h);b=c*(1-b*(1-h));switch(a){case 0:f.r=c;f.g=b;f.b=g;break;case 1:f.r=m;f.g=c;f.b=g;break;case 2:f.r=g;f.g=c;f.b=b;break;case 3:f.r=g;f.g=m;f.b=c;break;case 4:f.r=b;f.g=g;f.b=c;break;default:f.r=
c,f.g=g,f.b=m}}f.a=1},e.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)},e.prototype.clone=function(){return c.SerializationHelper.Clone(function(){return new e},this)},e.prototype.serialize=function(){return c.SerializationHelper.Serialize(this)},e.Parse=function(a){return c.SerializationHelper.Parse(function(){return new e},a,null,null)},__decorate([c.serialize()],e.prototype,"_globalHue",void 0),__decorate([c.serialize()],e.prototype,"_globalDensity",void 0),__decorate([c.serialize()],e.prototype,
"_globalSaturation",void 0),__decorate([c.serialize()],e.prototype,"_globalExposure",void 0),__decorate([c.serialize()],e.prototype,"_highlightsHue",void 0),__decorate([c.serialize()],e.prototype,"_highlightsDensity",void 0),__decorate([c.serialize()],e.prototype,"_highlightsSaturation",void 0),__decorate([c.serialize()],e.prototype,"_highlightsExposure",void 0),__decorate([c.serialize()],e.prototype,"_midtonesHue",void 0),__decorate([c.serialize()],e.prototype,"_midtonesDensity",void 0),__decorate([c.serialize()],
e.prototype,"_midtonesSaturation",void 0),__decorate([c.serialize()],e.prototype,"_midtonesExposure",void 0),e);c.ColorCurves=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.BaseTexture,a=function(a,d){e.call(this,d);a&&(this._textureMatrix=c.Matrix.Identity(),this.name=a,this.url=a,this.hasAlpha=!1,this.isCube=!1,this.wrapU=c.Texture.CLAMP_ADDRESSMODE,this.wrapV=c.Texture.CLAMP_ADDRESSMODE,this.anisotropicFilteringLevel=1,this._texture=this._getFromCache(a,!0),this._texture||(d.useDelayedTextureLoading?this.delayLoadState=c.Engine.DELAYLOADSTATE_NOTLOADED:this.loadTexture()))};f=(__extends(a,e),a.prototype.getTextureMatrix=function(){return this._textureMatrix},
a.prototype.load3dlTexture=function(){var b=this,d=this.getScene().getEngine().createRawTexture(null,1,1,c.Engine.TEXTUREFORMAT_RGBA,!1,!1,c.Texture.BILINEAR_SAMPLINGMODE);this._texture=d;return c.Tools.LoadFile(this.url,function(e){var f,h,m;e=e.split("\n");for(var l=0,k=0,n=0,q=0,p=0,r=0;r<e.length;r++)if(m=e[r],a._noneEmptyLineRegex.test(m)&&0!==m.indexOf("#")){var t=m.split(" ");if(0!==l){if(0!=l){var s=Math.max(parseInt(t[0]),0),u=Math.max(parseInt(t[1]),0),t=Math.max(parseInt(t[2]),0),p=Math.max(s,
p),p=Math.max(u,p),p=Math.max(t,p),v=4*(k+q*l+n*l*l);h[v+0]=s;h[v+1]=u;h[v+2]=t;h[v+3]=0;q++;0==q%l&&(n++,q=0,0==n%l&&(k++,n=0))}}else l=t.length,f=new Uint8Array(4*l*l*l),h=new Float32Array(4*l*l*l)}for(r=0;r<h.length;r++)f[r]=255*(h[r]/p);b.getScene().getEngine().updateTextureSize(d,l*l,l);b.getScene().getEngine().updateRawTexture(d,f,c.Engine.TEXTUREFORMAT_RGBA,!1)}),this._texture},a.prototype.loadTexture=function(){this.url&&this.url.toLocaleLowerCase().indexOf(".3dl")==this.url.length-4&&this.load3dlTexture()},
a.prototype.clone=function(){var b=new a(this.url,this.getScene());return b.level=this.level,b},a.prototype.delayLoad=function(){this.delayLoadState===c.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=c.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,!0),this._texture||this.loadTexture())},a.Parse=function(a,d){var e=null;return a.name&&!a.isRenderTarget&&(e=new c.ColorGradingTexture(a.name,d),e.name=a.name,e.level=a.level),e},a.prototype.serialize=function(){if(!this.name)return null;
var a={};return a.name=this.name,a.level=this.level,a},a._noneEmptyLineRegex=/\S+/,a);c.ColorGradingTexture=f}(BABYLON||(BABYLON={}));
!function(c){var f,e=c.MaterialDefines,a=function(){e.call(this);this.VERTEXALPHA=this.VERTEXCOLOR=this.UV2=this.UV1=this.NORMAL=this.FRESNEL=this.EMISSIVEFRESNEL=this.OPACITYFRESNEL=this.SPECULARTERM=this.FOG=this.POINTSIZE=this.ALPHAFROMALBEDO=this.ALPHATEST=this.CLIPPLANE=this.SPECULAROVERALPHA=this.PARALLAXOCCLUSION=this.PARALLAX=this.BUMP=this.REFLECTIVITY=this.EMISSIVE=this.REFLECTION=this.OPACITYRGB=this.OPACITY=this.AMBIENT=this.ALBEDO=!1;this.BonesPerMesh=this.NUM_BONE_INFLUENCERS=0;this.INVERTNORMALMAPY=
this.INVERTNORMALMAPX=this.OPENGLNORMALMAP=this.USEPMREMREFRACTION=this.USEPMREMREFLECTION=this.RADIANCEOVERALPHA=this.USEPHYSICALLIGHTFALLOFF=this.LODBASEDMICROSFURACE=this.REFRACTIONMAPINLINEARSPACE=this.LINKREFRACTIONTOTRANSPARENCY=this.REFRACTIONMAP_3D=this.REFRACTION=this.USESPHERICALFROMREFLECTIONMAP=this.OVERLOADEDSHADOWVALUES=this.OVERLOADEDVALUES=this.CAMERACOLORCURVES=this.CAMERACOLORGRADING=this.CAMERACONTRAST=this.CAMERATONEMAP=this.LOGARITHMICDEPTH=this.INVERTCUBICMAP=this.REFLECTIONMAP_EQUIRECTANGULAR=
this.REFLECTIONMAP_EXPLICIT=this.REFLECTIONMAP_SKYBOX=this.REFLECTIONMAP_PROJECTION=this.REFLECTIONMAP_CUBIC=this.REFLECTIONMAP_PLANAR=this.REFLECTIONMAP_SPHERICAL=this.REFLECTIONMAP_3D=this.USELIGHTMAPASSHADOWMAP=this.LIGHTMAP=this.LINKEMISSIVEWITHALBEDO=this.EMISSIVEASILLUMINATION=this.MICROSURFACEAUTOMATIC=this.MICROSURFACEFROMREFLECTIVITYMAP=this.INSTANCES=!1;this.rebuild()};f=(__extends(a,e),a);var b=c.Material,d=function(a,d){var e=this;b.call(this,a,d);this.specularIntensity=this.environmentIntensity=
this.emissiveIntensity=this.directIntensity=1;this._lightingInfos=new c.Vector4(this.directIntensity,this.emissiveIntensity,this.environmentIntensity,this.specularIntensity);this.disableBumpMap=!1;this.overloadedShadeIntensity=this.overloadedShadowIntensity=1;this._overloadedShadowInfos=new c.Vector4(this.overloadedShadowIntensity,this.overloadedShadeIntensity,0,0);this.cameraContrast=this.cameraExposure=1;this.cameraColorGradingTexture=null;this._cameraColorGradingScaleOffset=new c.Vector4(1,1,0,
0);this._cameraColorGradingInfos=new c.Vector4(1,1,0,0);this.cameraColorCurves=null;this._cameraInfos=new c.Vector4(1,1,0,0);this._microsurfaceTextureLods=new c.Vector2(0,0);this.overloadedAmbient=c.Color3.White();this.overloadedAmbientIntensity=0;this.overloadedAlbedo=c.Color3.White();this.overloadedAlbedoIntensity=0;this.overloadedReflectivity=new c.Color3(0.3,0.3,0.3);this.overloadedReflectivityIntensity=0;this.overloadedEmissive=c.Color3.White();this.overloadedEmissiveIntensity=0;this._overloadedIntensity=
new c.Vector4(this.overloadedAmbientIntensity,this.overloadedAlbedoIntensity,this.overloadedReflectivityIntensity,this.overloadedEmissiveIntensity);this.overloadedReflection=c.Color3.White();this.overloadedMicroSurfaceIntensity=this.overloadedMicroSurface=this.overloadedReflectionIntensity=0;this._overloadedMicroSurface=new c.Vector3(this.overloadedMicroSurface,this.overloadedMicroSurfaceIntensity,this.overloadedReflectionIntensity);this.ambientColor=new c.Color3(0,0,0);this.albedoColor=new c.Color3(1,
1,1);this.reflectivityColor=new c.Color3(1,1,1);this.reflectionColor=new c.Color3(0.5,0.5,0.5);this.emissiveColor=new c.Color3(0,0,0);this.microSurface=0.9;this.indexOfRefraction=0.66;this.useAlphaFromAlbedoTexture=this.useEmissiveAsIllumination=this.useLightmapAsShadowmap=this.linkEmissiveWithAlbedo=this.linkRefractionWithTransparency=this.invertRefractionY=!1;this.useSpecularOverAlpha=!0;this.useScalarInLinearSpace=this.useAutoMicroSurfaceFromReflectivityMap=this.useMicroSurfaceFromReflectivityMapAlpha=
!1;this.useRadianceOverAlpha=this.usePhysicalLightFalloff=!0;this.useParallaxOcclusion=this.useParallax=!1;this.parallaxScaleBias=0.05;this.disableLighting=!1;this.maxSimultaneousLights=4;this.invertNormalMapY=this.invertNormalMapX=!1;this._renderTargets=new c.SmartArray(16);this._worldViewProjectionMatrix=c.Matrix.Zero();this._globalAmbientColor=new c.Color3(0,0,0);this._tempColor=new c.Color3;this._defines=new f;this._cachedDefines=new f;this._myShadowGenerator=this._myScene=null;this._cachedDefines.BonesPerMesh=
-1;this.getRenderTargetTextures=function(){return e._renderTargets.reset(),e.reflectionTexture&&e.reflectionTexture.isRenderTarget&&e._renderTargets.push(e.reflectionTexture),e.refractionTexture&&e.refractionTexture.isRenderTarget&&e._renderTargets.push(e.refractionTexture),e._renderTargets}},a=(__extends(d,b),Object.defineProperty(d.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(a){this._useLogarithmicDepth=a&&this.getScene().getEngine().getCaps().fragmentDepthSupported},
enumerable:!0,configurable:!0}),d.prototype.needAlphaBlending=function(){return this.linkRefractionWithTransparency?!1:1>this.alpha||null!=this.opacityTexture||this._shouldUseAlphaFromAlbedoTexture()||this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled},d.prototype.needAlphaTesting=function(){return this.linkRefractionWithTransparency?!1:null!=this.albedoTexture&&this.albedoTexture.hasAlpha},d.prototype._shouldUseAlphaFromAlbedoTexture=function(){return null!=this.albedoTexture&&
this.albedoTexture.hasAlpha&&this.useAlphaFromAlbedoTexture},d.prototype.getAlphaTestTexture=function(){return this.albedoTexture},d.prototype._checkCache=function(a,b,c){return b?this._defines.INSTANCES!==c?!1:!(!b._materialDefines||!b._materialDefines.isEqual(this._defines)):!0},d.prototype.convertColorToLinearSpaceToRef=function(a,b){d.convertColorToLinearSpaceToRef(a,b,this.useScalarInLinearSpace)},d.convertColorToLinearSpaceToRef=function(a,b,c){c?(b.r=a.r,b.g=a.g,b.b=a.b):a.toLinearSpaceToRef(b)},
d.BindLights=function(a,b,e,f,l,k,n){for(var q=0,p=!1,r=0;r<a.lights.length;r++){var t=a.lights[r];if(t.isEnabled()&&t.canAffectMesh(b)&&(c.MaterialHelper.BindLightProperties(t,e,q),this.convertColorToLinearSpaceToRef(t.diffuse,d._scaledAlbedo,l),d._scaledAlbedo.scaleToRef(t.intensity,d._scaledAlbedo),e.setColor4("vLightDiffuse"+q,d._scaledAlbedo,n?t.radius:t.range),f.SPECULARTERM&&(this.convertColorToLinearSpaceToRef(t.specular,d._scaledReflectivity,l),d._scaledReflectivity.scaleToRef(t.intensity,
d._scaledReflectivity),e.setColor3("vLightSpecular"+q,d._scaledReflectivity)),a.shadowsEnabled&&(p=c.MaterialHelper.BindLightShadow(t,a,b,q,e,p)),q++,q===k))break}},d.prototype.isReady=function(a,b){if(this.checkReadyOnlyOnce&&this._wasPreviouslyReady)return!0;var d=this.getScene();if(!this.checkReadyOnEveryCall&&this._renderId===d.getRenderId()&&this._checkCache(d,a,b))return!0;var e=d.getEngine(),l=!1,k=!1;if(this._defines.reset(),d.texturesEnabled){if(d.texturesEnabled){if(d.getEngine().getCaps().textureLOD&&
(this._defines.LODBASEDMICROSFURACE=!0),this.albedoTexture&&c.StandardMaterial.DiffuseTextureEnabled){if(!this.albedoTexture.isReady())return!1;k=!0;this._defines.ALBEDO=!0}if(this.ambientTexture&&c.StandardMaterial.AmbientTextureEnabled){if(!this.ambientTexture.isReady())return!1;k=!0;this._defines.AMBIENT=!0}if(this.opacityTexture&&c.StandardMaterial.OpacityTextureEnabled){if(!this.opacityTexture.isReady())return!1;k=!0;this._defines.OPACITY=!0;this.opacityTexture.getAlphaFromRGB&&(this._defines.OPACITYRGB=
!0)}if(this.reflectionTexture&&c.StandardMaterial.ReflectionTextureEnabled){if(!this.reflectionTexture.isReady())return!1;switch(l=!0,this._defines.REFLECTION=!0,this.reflectionTexture.coordinatesMode===c.Texture.INVCUBIC_MODE&&(this._defines.INVERTCUBICMAP=!0),this._defines.REFLECTIONMAP_3D=this.reflectionTexture.isCube,this.reflectionTexture.coordinatesMode){case c.Texture.CUBIC_MODE:case c.Texture.INVCUBIC_MODE:this._defines.REFLECTIONMAP_CUBIC=!0;break;case c.Texture.EXPLICIT_MODE:this._defines.REFLECTIONMAP_EXPLICIT=
!0;break;case c.Texture.PLANAR_MODE:this._defines.REFLECTIONMAP_PLANAR=!0;break;case c.Texture.PROJECTION_MODE:this._defines.REFLECTIONMAP_PROJECTION=!0;break;case c.Texture.SKYBOX_MODE:this._defines.REFLECTIONMAP_SKYBOX=!0;break;case c.Texture.SPHERICAL_MODE:this._defines.REFLECTIONMAP_SPHERICAL=!0;break;case c.Texture.EQUIRECTANGULAR_MODE:this._defines.REFLECTIONMAP_EQUIRECTANGULAR=!0}this.reflectionTexture instanceof c.HDRCubeTexture&&this.reflectionTexture&&(this._defines.USESPHERICALFROMREFLECTIONMAP=
!0,l=!0,this.reflectionTexture.isPMREM&&(this._defines.USEPMREMREFLECTION=!0))}if(this.lightmapTexture&&c.StandardMaterial.LightmapTextureEnabled){if(!this.lightmapTexture.isReady())return!1;k=!0;this._defines.LIGHTMAP=!0;this._defines.USELIGHTMAPASSHADOWMAP=this.useLightmapAsShadowmap}if(this.emissiveTexture&&c.StandardMaterial.EmissiveTextureEnabled){if(!this.emissiveTexture.isReady())return!1;k=!0;this._defines.EMISSIVE=!0}if(this.reflectivityTexture&&c.StandardMaterial.SpecularTextureEnabled){if(!this.reflectivityTexture.isReady())return!1;
k=!0;this._defines.REFLECTIVITY=!0;this._defines.MICROSURFACEFROMREFLECTIVITYMAP=this.useMicroSurfaceFromReflectivityMapAlpha;this._defines.MICROSURFACEAUTOMATIC=this.useAutoMicroSurfaceFromReflectivityMap}}if(d.getEngine().getCaps().standardDerivatives&&this.bumpTexture&&c.StandardMaterial.BumpTextureEnabled&&!this.disableBumpMap){if(!this.bumpTexture.isReady())return!1;k=!0;this._defines.BUMP=!0;this.useParallax&&(this._defines.PARALLAX=!0,this.useParallaxOcclusion&&(this._defines.PARALLAXOCCLUSION=
!0));this.invertNormalMapX&&(this._defines.INVERTNORMALMAPX=!0);this.invertNormalMapY&&(this._defines.INVERTNORMALMAPY=!0)}if(this.refractionTexture&&c.StandardMaterial.RefractionTextureEnabled){if(!this.refractionTexture.isReady())return!1;k=!0;this._defines.REFRACTION=!0;this._defines.REFRACTIONMAP_3D=this.refractionTexture.isCube;this.linkRefractionWithTransparency&&(this._defines.LINKREFRACTIONTOTRANSPARENCY=!0);this.refractionTexture instanceof c.HDRCubeTexture&&(this._defines.REFRACTIONMAPINLINEARSPACE=
!0,this.refractionTexture.isPMREM&&(this._defines.USEPMREMREFRACTION=!0))}if(this.cameraColorGradingTexture){if(!this.cameraColorGradingTexture.isReady())return!1;this._defines.CAMERACOLORGRADING=!0}}if(d.clipPlane&&(this._defines.CLIPPLANE=!0),e.getAlphaTesting()&&(this._defines.ALPHATEST=!0),this._shouldUseAlphaFromAlbedoTexture()&&(this._defines.ALPHAFROMALBEDO=!0),this.useEmissiveAsIllumination&&(this._defines.EMISSIVEASILLUMINATION=!0),this.linkEmissiveWithAlbedo&&(this._defines.LINKEMISSIVEWITHALBEDO=
!0),this.useLogarithmicDepth&&(this._defines.LOGARITHMICDEPTH=!0),1!=this.cameraContrast&&(this._defines.CAMERACONTRAST=!0),1!=this.cameraExposure&&(this._defines.CAMERATONEMAP=!0),this.cameraColorCurves&&(this._defines.CAMERACOLORCURVES=!0),1==this.overloadedShadeIntensity&&1==this.overloadedShadowIntensity||(this._defines.OVERLOADEDSHADOWVALUES=!0),(0<this.overloadedMicroSurfaceIntensity||0<this.overloadedEmissiveIntensity||0<this.overloadedReflectivityIntensity||0<this.overloadedAlbedoIntensity||
0<this.overloadedAmbientIntensity||0<this.overloadedReflectionIntensity)&&(this._defines.OVERLOADEDVALUES=!0),(this.pointsCloud||d.forcePointsCloud)&&(this._defines.POINTSIZE=!0),d.fogEnabled&&a&&a.applyFog&&d.fogMode!==c.Scene.FOGMODE_NONE&&this.fogEnabled&&(this._defines.FOG=!0),d.lightsEnabled&&!this.disableLighting&&(l=c.MaterialHelper.PrepareDefinesForLights(d,a,this._defines,this.maxSimultaneousLights)||l),c.StandardMaterial.FresnelEnabled&&(this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled||
this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled)&&(this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&(this._defines.OPACITYFRESNEL=!0),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._defines.EMISSIVEFRESNEL=!0),l=!0,this._defines.FRESNEL=!0),this._defines.SPECULARTERM&&this.useSpecularOverAlpha&&(this._defines.SPECULAROVERALPHA=!0),this.usePhysicalLightFalloff&&(this._defines.USEPHYSICALLIGHTFALLOFF=!0),this.useRadianceOverAlpha&&
(this._defines.RADIANCEOVERALPHA=!0),a&&(l&&a.isVerticesDataPresent(c.VertexBuffer.NormalKind)&&(this._defines.NORMAL=!0),k&&(a.isVerticesDataPresent(c.VertexBuffer.UVKind)&&(this._defines.UV1=!0),a.isVerticesDataPresent(c.VertexBuffer.UV2Kind)&&(this._defines.UV2=!0)),a.useVertexColors&&a.isVerticesDataPresent(c.VertexBuffer.ColorKind)&&(this._defines.VERTEXCOLOR=!0,a.hasVertexAlpha&&(this._defines.VERTEXALPHA=!0)),a.useBones&&a.computeBonesUsingShaders&&(this._defines.NUM_BONE_INFLUENCERS=a.numBoneInfluencers,
this._defines.BonesPerMesh=a.skeleton.bones.length+1),b&&(this._defines.INSTANCES=!0)),!this._defines.isEqual(this._cachedDefines)){this._defines.cloneTo(this._cachedDefines);d.resetCachedMaterial();e=new c.EffectFallbacks;this._defines.REFLECTION&&e.addFallback(0,"REFLECTION");this._defines.REFRACTION&&e.addFallback(0,"REFRACTION");this._defines.REFLECTIVITY&&e.addFallback(0,"REFLECTIVITY");this._defines.BUMP&&e.addFallback(0,"BUMP");this._defines.PARALLAX&&e.addFallback(1,"PARALLAX");this._defines.PARALLAXOCCLUSION&&
e.addFallback(0,"PARALLAXOCCLUSION");this._defines.SPECULAROVERALPHA&&e.addFallback(0,"SPECULAROVERALPHA");this._defines.FOG&&e.addFallback(1,"FOG");this._defines.POINTSIZE&&e.addFallback(0,"POINTSIZE");this._defines.LOGARITHMICDEPTH&&e.addFallback(0,"LOGARITHMICDEPTH");c.MaterialHelper.HandleFallbacksForShadows(this._defines,e,this.maxSimultaneousLights);this._defines.SPECULARTERM&&e.addFallback(0,"SPECULARTERM");this._defines.OPACITYFRESNEL&&e.addFallback(1,"OPACITYFRESNEL");this._defines.EMISSIVEFRESNEL&&
e.addFallback(2,"EMISSIVEFRESNEL");this._defines.FRESNEL&&e.addFallback(3,"FRESNEL");0<this._defines.NUM_BONE_INFLUENCERS&&e.addCPUSkinningFallback(0,a);l=[c.VertexBuffer.PositionKind];this._defines.NORMAL&&l.push(c.VertexBuffer.NormalKind);this._defines.UV1&&l.push(c.VertexBuffer.UVKind);this._defines.UV2&&l.push(c.VertexBuffer.UV2Kind);this._defines.VERTEXCOLOR&&l.push(c.VertexBuffer.ColorKind);c.MaterialHelper.PrepareAttributesForBones(l,a,this._defines,e);c.MaterialHelper.PrepareAttributesForInstances(l,
this._defines);k="pbr";d.getEngine().getCaps().standardDerivatives||(k="legacypbr");var n=this._defines.toString(),q="world view viewProjection vEyePosition vLightsType vAmbientColor vAlbedoColor vReflectivityColor vEmissiveColor vReflectionColor vFogInfos vFogColor pointSize vAlbedoInfos vAmbientInfos vOpacityInfos vReflectionInfos vEmissiveInfos vReflectivityInfos vBumpInfos vLightmapInfos vRefractionInfos mBones vClipPlane albedoMatrix ambientMatrix opacityMatrix reflectionMatrix emissiveMatrix reflectivityMatrix bumpMatrix lightmapMatrix refractionMatrix depthValues opacityParts emissiveLeftColor emissiveRightColor vLightingIntensity vOverloadedShadowIntensity vOverloadedIntensity vOverloadedAlbedo vOverloadedReflection vOverloadedReflectivity vOverloadedEmissive vOverloadedMicroSurface logarithmicDepthConstant vSphericalX vSphericalY vSphericalZ vSphericalXX vSphericalYY vSphericalZZ vSphericalXY vSphericalYZ vSphericalZX vMicrosurfaceTextureLods vCameraInfos vCameraColorGradingInfos vCameraColorGradingScaleOffset".split(" "),
p="albedoSampler ambientSampler opacitySampler reflectionCubeSampler reflection2DSampler emissiveSampler reflectivitySampler bumpSampler lightmapSampler refractionCubeSampler refraction2DSampler cameraColorGrading2DSampler".split(" ");c.ColorCurves.PrepareUniforms(q);c.MaterialHelper.PrepareUniformsAndSamplersList(q,p,this._defines,this.maxSimultaneousLights);this._effect=d.getEngine().createEffect(k,l,q,p,n,e,this.onCompiled,this.onError,{maxSimultaneousLights:this.maxSimultaneousLights})}return this._effect.isReady()?
(this._renderId=d.getRenderId(),this._wasPreviouslyReady=!0,a&&(a._materialDefines||(a._materialDefines=new f),this._defines.cloneTo(a._materialDefines)),!0):!1},d.prototype.unbind=function(){this.reflectionTexture&&this.reflectionTexture.isRenderTarget&&this._effect.setTexture("reflection2DSampler",null);this.refractionTexture&&this.refractionTexture.isRenderTarget&&this._effect.setTexture("refraction2DSampler",null);b.prototype.unbind.call(this)},d.prototype.bindOnlyWorldMatrix=function(a){this._effect.setMatrix("world",
a)},d.prototype.bind=function(a,e){if(this._myScene=this.getScene(),this.bindOnlyWorldMatrix(a),c.MaterialHelper.BindBonesParameters(e,this._effect),this._myScene.getCachedMaterial()!==this){if(this._effect.setMatrix("viewProjection",this._myScene.getTransformMatrix()),c.StandardMaterial.FresnelEnabled&&(this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&this._effect.setColor4("opacityParts",new c.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),
this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._effect.setColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),this._effect.setColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),this._myScene.texturesEnabled){if(this.albedoTexture&&c.StandardMaterial.DiffuseTextureEnabled&&(this._effect.setTexture("albedoSampler",
this.albedoTexture),this._effect.setFloat2("vAlbedoInfos",this.albedoTexture.coordinatesIndex,this.albedoTexture.level),this._effect.setMatrix("albedoMatrix",this.albedoTexture.getTextureMatrix())),this.ambientTexture&&c.StandardMaterial.AmbientTextureEnabled&&(this._effect.setTexture("ambientSampler",this.ambientTexture),this._effect.setFloat2("vAmbientInfos",this.ambientTexture.coordinatesIndex,this.ambientTexture.level),this._effect.setMatrix("ambientMatrix",this.ambientTexture.getTextureMatrix())),
this.opacityTexture&&c.StandardMaterial.OpacityTextureEnabled&&(this._effect.setTexture("opacitySampler",this.opacityTexture),this._effect.setFloat2("vOpacityInfos",this.opacityTexture.coordinatesIndex,this.opacityTexture.level),this._effect.setMatrix("opacityMatrix",this.opacityTexture.getTextureMatrix())),this.reflectionTexture&&c.StandardMaterial.ReflectionTextureEnabled&&(this._microsurfaceTextureLods.x=Math.round(Math.log(this.reflectionTexture.getSize().width)*Math.LOG2E),this.reflectionTexture.isCube?
this._effect.setTexture("reflectionCubeSampler",this.reflectionTexture):this._effect.setTexture("reflection2DSampler",this.reflectionTexture),this._effect.setMatrix("reflectionMatrix",this.reflectionTexture.getReflectionTextureMatrix()),this._effect.setFloat2("vReflectionInfos",this.reflectionTexture.level,0),this._defines.USESPHERICALFROMREFLECTIONMAP&&(this._effect.setFloat3("vSphericalX",this.reflectionTexture.sphericalPolynomial.x.x,this.reflectionTexture.sphericalPolynomial.x.y,this.reflectionTexture.sphericalPolynomial.x.z),
this._effect.setFloat3("vSphericalY",this.reflectionTexture.sphericalPolynomial.y.x,this.reflectionTexture.sphericalPolynomial.y.y,this.reflectionTexture.sphericalPolynomial.y.z),this._effect.setFloat3("vSphericalZ",this.reflectionTexture.sphericalPolynomial.z.x,this.reflectionTexture.sphericalPolynomial.z.y,this.reflectionTexture.sphericalPolynomial.z.z),this._effect.setFloat3("vSphericalXX",this.reflectionTexture.sphericalPolynomial.xx.x,this.reflectionTexture.sphericalPolynomial.xx.y,this.reflectionTexture.sphericalPolynomial.xx.z),
this._effect.setFloat3("vSphericalYY",this.reflectionTexture.sphericalPolynomial.yy.x,this.reflectionTexture.sphericalPolynomial.yy.y,this.reflectionTexture.sphericalPolynomial.yy.z),this._effect.setFloat3("vSphericalZZ",this.reflectionTexture.sphericalPolynomial.zz.x,this.reflectionTexture.sphericalPolynomial.zz.y,this.reflectionTexture.sphericalPolynomial.zz.z),this._effect.setFloat3("vSphericalXY",this.reflectionTexture.sphericalPolynomial.xy.x,this.reflectionTexture.sphericalPolynomial.xy.y,this.reflectionTexture.sphericalPolynomial.xy.z),
this._effect.setFloat3("vSphericalYZ",this.reflectionTexture.sphericalPolynomial.yz.x,this.reflectionTexture.sphericalPolynomial.yz.y,this.reflectionTexture.sphericalPolynomial.yz.z),this._effect.setFloat3("vSphericalZX",this.reflectionTexture.sphericalPolynomial.zx.x,this.reflectionTexture.sphericalPolynomial.zx.y,this.reflectionTexture.sphericalPolynomial.zx.z))),this.emissiveTexture&&c.StandardMaterial.EmissiveTextureEnabled&&(this._effect.setTexture("emissiveSampler",this.emissiveTexture),this._effect.setFloat2("vEmissiveInfos",
this.emissiveTexture.coordinatesIndex,this.emissiveTexture.level),this._effect.setMatrix("emissiveMatrix",this.emissiveTexture.getTextureMatrix())),this.lightmapTexture&&c.StandardMaterial.LightmapTextureEnabled&&(this._effect.setTexture("lightmapSampler",this.lightmapTexture),this._effect.setFloat2("vLightmapInfos",this.lightmapTexture.coordinatesIndex,this.lightmapTexture.level),this._effect.setMatrix("lightmapMatrix",this.lightmapTexture.getTextureMatrix())),this.reflectivityTexture&&c.StandardMaterial.SpecularTextureEnabled&&
(this._effect.setTexture("reflectivitySampler",this.reflectivityTexture),this._effect.setFloat2("vReflectivityInfos",this.reflectivityTexture.coordinatesIndex,this.reflectivityTexture.level),this._effect.setMatrix("reflectivityMatrix",this.reflectivityTexture.getTextureMatrix())),this.bumpTexture&&this._myScene.getEngine().getCaps().standardDerivatives&&c.StandardMaterial.BumpTextureEnabled&&!this.disableBumpMap&&(this._effect.setTexture("bumpSampler",this.bumpTexture),this._effect.setFloat3("vBumpInfos",
this.bumpTexture.coordinatesIndex,1/this.bumpTexture.level,this.parallaxScaleBias),this._effect.setMatrix("bumpMatrix",this.bumpTexture.getTextureMatrix())),this.refractionTexture&&c.StandardMaterial.RefractionTextureEnabled){this._microsurfaceTextureLods.y=Math.round(Math.log(this.refractionTexture.getSize().width)*Math.LOG2E);var f=1;this.refractionTexture.isCube?this._effect.setTexture("refractionCubeSampler",this.refractionTexture):(this._effect.setTexture("refraction2DSampler",this.refractionTexture),
this._effect.setMatrix("refractionMatrix",this.refractionTexture.getReflectionTextureMatrix()),this.refractionTexture.depth&&(f=this.refractionTexture.depth));this._effect.setFloat4("vRefractionInfos",this.refractionTexture.level,this.indexOfRefraction,f,this.invertRefractionY?-1:1)}if((this.reflectionTexture||this.refractionTexture)&&this._effect.setFloat2("vMicrosurfaceTextureLods",this._microsurfaceTextureLods.x,this._microsurfaceTextureLods.y),this.cameraColorGradingTexture){this._effect.setTexture("cameraColorGrading2DSampler",
this.cameraColorGradingTexture);this._cameraColorGradingInfos.x=this.cameraColorGradingTexture.level;this._cameraColorGradingInfos.y=this.cameraColorGradingTexture.getSize().height;this._cameraColorGradingInfos.z=this._cameraColorGradingInfos.y-1;this._cameraColorGradingInfos.w=1/this._cameraColorGradingInfos.y;this._effect.setFloat4("vCameraColorGradingInfos",this._cameraColorGradingInfos.x,this._cameraColorGradingInfos.y,this._cameraColorGradingInfos.z,this._cameraColorGradingInfos.w);var f=this._cameraColorGradingInfos.w/
this._cameraColorGradingInfos.y,m=1/this._cameraColorGradingInfos.y;this._cameraColorGradingScaleOffset.x=this._cameraColorGradingInfos.z*f;this._cameraColorGradingScaleOffset.y=this._cameraColorGradingInfos.z/this._cameraColorGradingInfos.y;this._cameraColorGradingScaleOffset.z=0.5*f;this._cameraColorGradingScaleOffset.w=0.5*m;this._effect.setFloat4("vCameraColorGradingScaleOffset",this._cameraColorGradingScaleOffset.x,this._cameraColorGradingScaleOffset.y,this._cameraColorGradingScaleOffset.z,this._cameraColorGradingScaleOffset.w)}}c.MaterialHelper.BindClipPlane(this._effect,
this._myScene);this.pointsCloud&&this._effect.setFloat("pointSize",this.pointSize);this._myScene.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor);this.convertColorToLinearSpaceToRef(this.reflectivityColor,d._scaledReflectivity);this._effect.setVector3("vEyePosition",this._myScene._mirroredCameraPosition?this._myScene._mirroredCameraPosition:this._myScene.activeCamera.position);this._effect.setColor3("vAmbientColor",this._globalAmbientColor);this._effect.setColor4("vReflectivityColor",
d._scaledReflectivity,this.microSurface);this.convertColorToLinearSpaceToRef(this.emissiveColor,d._scaledEmissive);this._effect.setColor3("vEmissiveColor",d._scaledEmissive);this.convertColorToLinearSpaceToRef(this.reflectionColor,d._scaledReflection);this._effect.setColor3("vReflectionColor",d._scaledReflection)}this._myScene.getCachedMaterial()===this&&this.isFrozen||(this.convertColorToLinearSpaceToRef(this.albedoColor,d._scaledAlbedo),this._effect.setColor4("vAlbedoColor",d._scaledAlbedo,this.alpha*
e.visibility),this._myScene.lightsEnabled&&!this.disableLighting&&d.BindLights(this._myScene,e,this._effect,this._defines,this.useScalarInLinearSpace,this.maxSimultaneousLights,this.usePhysicalLightFalloff),(this._myScene.fogEnabled&&e.applyFog&&this._myScene.fogMode!==c.Scene.FOGMODE_NONE||this.reflectionTexture)&&this._effect.setMatrix("view",this._myScene.getViewMatrix()),c.MaterialHelper.BindFogParameters(this._myScene,e,this._effect),this._lightingInfos.x=this.directIntensity,this._lightingInfos.y=
this.emissiveIntensity,this._lightingInfos.z=this.environmentIntensity,this._lightingInfos.w=this.specularIntensity,this._effect.setVector4("vLightingIntensity",this._lightingInfos),this._overloadedShadowInfos.x=this.overloadedShadowIntensity,this._overloadedShadowInfos.y=this.overloadedShadeIntensity,this._effect.setVector4("vOverloadedShadowIntensity",this._overloadedShadowInfos),this._cameraInfos.x=this.cameraExposure,this._cameraInfos.y=this.cameraContrast,this._effect.setVector4("vCameraInfos",
this._cameraInfos),this.cameraColorCurves&&c.ColorCurves.Bind(this.cameraColorCurves,this._effect),this._overloadedIntensity.x=this.overloadedAmbientIntensity,this._overloadedIntensity.y=this.overloadedAlbedoIntensity,this._overloadedIntensity.z=this.overloadedReflectivityIntensity,this._overloadedIntensity.w=this.overloadedEmissiveIntensity,this._effect.setVector4("vOverloadedIntensity",this._overloadedIntensity),this.convertColorToLinearSpaceToRef(this.overloadedAmbient,this._tempColor),this._effect.setColor3("vOverloadedAmbient",
this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedAlbedo,this._tempColor),this._effect.setColor3("vOverloadedAlbedo",this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedReflectivity,this._tempColor),this._effect.setColor3("vOverloadedReflectivity",this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedEmissive,this._tempColor),this._effect.setColor3("vOverloadedEmissive",this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedReflection,this._tempColor),
this._effect.setColor3("vOverloadedReflection",this._tempColor),this._overloadedMicroSurface.x=this.overloadedMicroSurface,this._overloadedMicroSurface.y=this.overloadedMicroSurfaceIntensity,this._overloadedMicroSurface.z=this.overloadedReflectionIntensity,this._effect.setVector3("vOverloadedMicroSurface",this._overloadedMicroSurface),c.MaterialHelper.BindLogDepth(this._defines,this._effect,this._myScene));b.prototype.bind.call(this,a,e);this._myScene=null},d.prototype.getAnimatables=function(){var a=
[];return this.albedoTexture&&this.albedoTexture.animations&&0<this.albedoTexture.animations.length&&a.push(this.albedoTexture),this.ambientTexture&&this.ambientTexture.animations&&0<this.ambientTexture.animations.length&&a.push(this.ambientTexture),this.opacityTexture&&this.opacityTexture.animations&&0<this.opacityTexture.animations.length&&a.push(this.opacityTexture),this.reflectionTexture&&this.reflectionTexture.animations&&0<this.reflectionTexture.animations.length&&a.push(this.reflectionTexture),
this.emissiveTexture&&this.emissiveTexture.animations&&0<this.emissiveTexture.animations.length&&a.push(this.emissiveTexture),this.reflectivityTexture&&this.reflectivityTexture.animations&&0<this.reflectivityTexture.animations.length&&a.push(this.reflectivityTexture),this.bumpTexture&&this.bumpTexture.animations&&0<this.bumpTexture.animations.length&&a.push(this.bumpTexture),this.lightmapTexture&&this.lightmapTexture.animations&&0<this.lightmapTexture.animations.length&&a.push(this.lightmapTexture),
this.refractionTexture&&this.refractionTexture.animations&&0<this.refractionTexture.animations.length&&a.push(this.refractionTexture),this.cameraColorGradingTexture&&this.cameraColorGradingTexture.animations&&0<this.cameraColorGradingTexture.animations.length&&a.push(this.cameraColorGradingTexture),a},d.prototype.dispose=function(a,c){c&&(this.albedoTexture&&this.albedoTexture.dispose(),this.ambientTexture&&this.ambientTexture.dispose(),this.opacityTexture&&this.opacityTexture.dispose(),this.reflectionTexture&&
this.reflectionTexture.dispose(),this.emissiveTexture&&this.emissiveTexture.dispose(),this.reflectivityTexture&&this.reflectivityTexture.dispose(),this.bumpTexture&&this.bumpTexture.dispose(),this.lightmapTexture&&this.lightmapTexture.dispose(),this.refractionTexture&&this.refractionTexture.dispose(),this.cameraColorGradingTexture&&this.cameraColorGradingTexture.dispose());b.prototype.dispose.call(this,a,c)},d.prototype.clone=function(a){var b=this;return c.SerializationHelper.Clone(function(){return new d(a,
b.getScene())},this)},d.prototype.serialize=function(){var a=c.SerializationHelper.Serialize(this);return a.customType="BABYLON.PBRMaterial",a},d.Parse=function(a,b,e){return c.SerializationHelper.Parse(function(){return new d(a.name,b)},a,b,e)},d._scaledAlbedo=new c.Color3,d._scaledReflectivity=new c.Color3,d._scaledEmissive=new c.Color3,d._scaledReflection=new c.Color3,__decorate([c.serialize()],d.prototype,"directIntensity",void 0),__decorate([c.serialize()],d.prototype,"emissiveIntensity",void 0),
__decorate([c.serialize()],d.prototype,"environmentIntensity",void 0),__decorate([c.serialize()],d.prototype,"specularIntensity",void 0),__decorate([c.serialize()],d.prototype,"disableBumpMap",void 0),__decorate([c.serialize()],d.prototype,"overloadedShadowIntensity",void 0),__decorate([c.serialize()],d.prototype,"overloadedShadeIntensity",void 0),__decorate([c.serialize()],d.prototype,"cameraExposure",void 0),__decorate([c.serialize()],d.prototype,"cameraContrast",void 0),__decorate([c.serializeAsTexture()],
d.prototype,"cameraColorGradingTexture",void 0),__decorate([c.serializeAsColorCurves()],d.prototype,"cameraColorCurves",void 0),__decorate([c.serializeAsColor3()],d.prototype,"overloadedAmbient",void 0),__decorate([c.serialize()],d.prototype,"overloadedAmbientIntensity",void 0),__decorate([c.serializeAsColor3()],d.prototype,"overloadedAlbedo",void 0),__decorate([c.serialize()],d.prototype,"overloadedAlbedoIntensity",void 0),__decorate([c.serializeAsColor3()],d.prototype,"overloadedReflectivity",void 0),
__decorate([c.serialize()],d.prototype,"overloadedReflectivityIntensity",void 0),__decorate([c.serializeAsColor3()],d.prototype,"overloadedEmissive",void 0),__decorate([c.serialize()],d.prototype,"overloadedEmissiveIntensity",void 0),__decorate([c.serializeAsColor3()],d.prototype,"overloadedReflection",void 0),__decorate([c.serialize()],d.prototype,"overloadedReflectionIntensity",void 0),__decorate([c.serialize()],d.prototype,"overloadedMicroSurface",void 0),__decorate([c.serialize()],d.prototype,
"overloadedMicroSurfaceIntensity",void 0),__decorate([c.serializeAsTexture()],d.prototype,"albedoTexture",void 0),__decorate([c.serializeAsTexture()],d.prototype,"ambientTexture",void 0),__decorate([c.serializeAsTexture()],d.prototype,"opacityTexture",void 0),__decorate([c.serializeAsTexture()],d.prototype,"reflectionTexture",void 0),__decorate([c.serializeAsTexture()],d.prototype,"emissiveTexture",void 0),__decorate([c.serializeAsTexture()],d.prototype,"reflectivityTexture",void 0),__decorate([c.serializeAsTexture()],
d.prototype,"bumpTexture",void 0),__decorate([c.serializeAsTexture()],d.prototype,"lightmapTexture",void 0),__decorate([c.serializeAsTexture()],d.prototype,"refractionTexture",void 0),__decorate([c.serializeAsColor3("ambient")],d.prototype,"ambientColor",void 0),__decorate([c.serializeAsColor3("albedo")],d.prototype,"albedoColor",void 0),__decorate([c.serializeAsColor3("reflectivity")],d.prototype,"reflectivityColor",void 0),__decorate([c.serializeAsColor3("reflection")],d.prototype,"reflectionColor",
void 0),__decorate([c.serializeAsColor3("emissive")],d.prototype,"emissiveColor",void 0),__decorate([c.serialize()],d.prototype,"microSurface",void 0),__decorate([c.serialize()],d.prototype,"indexOfRefraction",void 0),__decorate([c.serialize()],d.prototype,"invertRefractionY",void 0),__decorate([c.serializeAsFresnelParameters()],d.prototype,"opacityFresnelParameters",void 0),__decorate([c.serializeAsFresnelParameters()],d.prototype,"emissiveFresnelParameters",void 0),__decorate([c.serialize()],d.prototype,
"linkRefractionWithTransparency",void 0),__decorate([c.serialize()],d.prototype,"linkEmissiveWithAlbedo",void 0),__decorate([c.serialize()],d.prototype,"useLightmapAsShadowmap",void 0),__decorate([c.serialize()],d.prototype,"useEmissiveAsIllumination",void 0),__decorate([c.serialize()],d.prototype,"useAlphaFromAlbedoTexture",void 0),__decorate([c.serialize()],d.prototype,"useSpecularOverAlpha",void 0),__decorate([c.serialize()],d.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),__decorate([c.serialize()],
d.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),__decorate([c.serialize()],d.prototype,"useScalarInLinearSpace",void 0),__decorate([c.serialize()],d.prototype,"usePhysicalLightFalloff",void 0),__decorate([c.serialize()],d.prototype,"useRadianceOverAlpha",void 0),__decorate([c.serialize()],d.prototype,"useParallax",void 0),__decorate([c.serialize()],d.prototype,"useParallaxOcclusion",void 0),__decorate([c.serialize()],d.prototype,"parallaxScaleBias",void 0),__decorate([c.serialize()],
d.prototype,"disableLighting",void 0),__decorate([c.serialize()],d.prototype,"maxSimultaneousLights",void 0),__decorate([c.serialize()],d.prototype,"invertNormalMapX",void 0),__decorate([c.serialize()],d.prototype,"invertNormalMapY",void 0),__decorate([c.serialize()],d.prototype,"useLogarithmicDepth",null),d);c.PBRMaterial=a}(BABYLON||(BABYLON={}));
!function(c){var f;f=function(e){var a=this;this._transformationMatrix=c.Matrix.Identity();this._labelsEnabled=this._enabled=!1;this._displayStatistics=!0;this._displayLogs=this._displayTree=!1;this._skeletonViewers=[];this._identityMatrix=c.Matrix.Identity();this.axisRatio=0.02;this.accentColor="orange";this._scene=e;this._syncPositions=function(){var b=a._scene.getEngine(),c=b.getRenderingCanvasClientRect();a._showUI&&(a._statsDiv.style.left=c.width-410+"px",a._statsDiv.style.top=c.height-290+"px",
a._statsDiv.style.width="400px",a._statsDiv.style.height="auto",a._statsSubsetDiv.style.maxHeight="240px",a._optionsDiv.style.left="0px",a._optionsDiv.style.top="10px",a._optionsDiv.style.width="200px",a._optionsDiv.style.height="auto",a._optionsSubsetDiv.style.maxHeight=c.height-225+"px",a._logDiv.style.left="0px",a._logDiv.style.top=c.height-170+"px",a._logDiv.style.width="600px",a._logDiv.style.height="160px",a._treeDiv.style.left=c.width-310+"px",a._treeDiv.style.top="10px",a._treeDiv.style.width=
"300px",a._treeDiv.style.height="auto",a._treeSubsetDiv.style.maxHeight=c.height-340+"px");a._globalDiv.style.left=c.left+"px";a._globalDiv.style.top=c.top+"px";a._drawingCanvas.style.left="0px";a._drawingCanvas.style.top="0px";a._drawingCanvas.style.width=b.getRenderWidth()+"px";a._drawingCanvas.style.height=b.getRenderHeight()+"px";c=a._drawingContext;a._ratio=(window.devicePixelRatio||1)/(c.webkitBackingStorePixelRatio||c.mozBackingStorePixelRatio||c.msBackingStorePixelRatio||c.oBackingStorePixelRatio||
c.backingStorePixelRatio||1);a._drawingCanvas.width=b.getRenderWidth()*a._ratio;a._drawingCanvas.height=b.getRenderHeight()*a._ratio};this._onCanvasClick=function(b){a._clickPosition={x:b.clientX*a._ratio,y:b.clientY*a._ratio}};this._syncUI=function(){a._showUI&&(a._displayStatistics?(a._displayStats(),a._statsDiv.style.display=""):a._statsDiv.style.display="none",a._displayLogs?a._logDiv.style.display="":a._logDiv.style.display="none",a._displayTree?(a._treeDiv.style.display="",a._needToRefreshMeshesTree&&
(a._needToRefreshMeshesTree=!1,a._refreshMeshesTreeContent())):a._treeDiv.style.display="none")};this._syncData=function(){if(a._labelsEnabled||!a._showUI){a._camera.getViewMatrix().multiplyToRef(a._camera.getProjectionMatrix(),a._transformationMatrix);a._drawingContext.clearRect(0,0,a._drawingCanvas.width,a._drawingCanvas.height);var b,d,e=a._scene.getEngine(),f=a._camera.viewport.toGlobal(e.getRenderWidth(),e.getRenderHeight()),h=a._camera.getActiveMeshes();for(b=0;b<h.length;b++){var m=h.data[b];
d=m.getBoundingInfo().boundingSphere.center;d=c.Vector3.Project(d,m.getWorldMatrix(),a._transformationMatrix,f);(m.renderOverlay||a.shouldDisplayAxis&&a.shouldDisplayAxis(m))&&a._renderAxis(d,m,f);a.shouldDisplayLabel&&!a.shouldDisplayLabel(m)||a._renderLabel(m.name,d,12,function(){m.renderOverlay=!m.renderOverlay},function(){return m.renderOverlay?"red":"black"})}h=a._scene.cameras;for(b=0;b<h.length;b++){var l=h[b];l!==a._camera&&(d=c.Vector3.Project(c.Vector3.Zero(),l.getWorldMatrix(),a._transformationMatrix,
f),a.shouldDisplayLabel&&!a.shouldDisplayLabel(l)||a._renderLabel(l.name,d,12,function(){a._camera.detachControl(e.getRenderingCanvas());a._camera=l;a._camera.attachControl(e.getRenderingCanvas())},function(){return"purple"}))}h=a._scene.lights;for(b=0;b<h.length;b++){var k=h[b];k.position&&(d=c.Vector3.Project(k.getAbsolutePosition(),a._identityMatrix,a._transformationMatrix,f),a.shouldDisplayLabel&&!a.shouldDisplayLabel(k)||a._renderLabel(k.name,d,-20,function(){k.setEnabled(!k.isEnabled())},function(){return k.isEnabled()?
"orange":"gray"}))}}a._clickPosition=void 0}};f=(f.prototype._refreshMeshesTreeContent=function(){for(;this._treeSubsetDiv.hasChildNodes();)this._treeSubsetDiv.removeChild(this._treeSubsetDiv.lastChild);var c=this._scene.meshes.slice(0,this._scene.meshes.length);c.sort(function(a,b){return a.name===b.name?0:a.name>b.name?1:-1});for(var a=0;a<c.length;a++){var b=c[a];b.isEnabled()&&this._generateAdvancedCheckBox(this._treeSubsetDiv,b.name,b.getTotalVertices()+" verts",b.isVisible,function(a,b){b.isVisible=
a.checked},b)}},f.prototype._renderSingleAxis=function(c,a,b,d,f){this._drawingContext.beginPath();this._drawingContext.moveTo(c.x,c.y);this._drawingContext.lineTo(a.x,a.y);this._drawingContext.strokeStyle=f;this._drawingContext.lineWidth=4;this._drawingContext.stroke();this._drawingContext.font="normal 14px Segoe UI";this._drawingContext.fillStyle=f;this._drawingContext.fillText(d,b.x,b.y)},f.prototype._renderAxis=function(e,a,b){var d=a.getBoundingInfo().boundingSphere.center;a=a.getWorldMatrix();
var f=c.Vector3.UnprojectFromTransform(e.add(new c.Vector3(this._drawingCanvas.width*this.axisRatio,0,0)),b.width,b.height,a,this._transformationMatrix).subtract(d).length(),g=c.Vector3.Project(d.add(new c.Vector3(f,0,0)),a,this._transformationMatrix,b),h=c.Vector3.Project(d.add(new c.Vector3(1.5*f,0,0)),a,this._transformationMatrix,b);this._renderSingleAxis(e,g,h,"x","#FF0000");g=c.Vector3.Project(d.add(new c.Vector3(0,f,0)),a,this._transformationMatrix,b);h=c.Vector3.Project(d.add(new c.Vector3(0,
1.5*f,0)),a,this._transformationMatrix,b);this._renderSingleAxis(e,g,h,"y","#00FF00");g=c.Vector3.Project(d.add(new c.Vector3(0,0,f)),a,this._transformationMatrix,b);b=c.Vector3.Project(d.add(new c.Vector3(0,0,1.5*f)),a,this._transformationMatrix,b);this._renderSingleAxis(e,g,b,"z","#0000FF")},f.prototype._renderLabel=function(c,a,b,d,f){if(0<a.z&&1>a.z){this._drawingContext.font="normal 12px Segoe UI";var g=this._drawingContext.measureText(c),h=a.x-g.width/2,m=a.y,l=this._drawingCanvas.getBoundingClientRect();
this._showUI&&this._isClickInsideRect(l.left*this._ratio+h-5,l.top*this._ratio+m-b-12,g.width+10,17)&&d();this._drawingContext.beginPath();this._drawingContext.rect(h-5,m-b-12,g.width+10,17);this._drawingContext.fillStyle=f();this._drawingContext.globalAlpha=0.5;this._drawingContext.fill();this._drawingContext.globalAlpha=1;this._drawingContext.strokeStyle="#FFFFFF";this._drawingContext.lineWidth=1;this._drawingContext.stroke();this._drawingContext.fillStyle="#FFFFFF";this._drawingContext.fillText(c,
h,m-b);this._drawingContext.beginPath();this._drawingContext.arc(a.x,m,5,0,2*Math.PI,!1);this._drawingContext.fill()}},f.prototype._isClickInsideRect=function(c,a,b,d){return this._clickPosition?this._clickPosition.x<c||this._clickPosition.x>c+b?!1:!(this._clickPosition.y<a||this._clickPosition.y>a+d):!1},f.prototype.isVisible=function(){return this._enabled},f.prototype.hide=function(){if(this._enabled){this._enabled=!1;var e=this._scene.getEngine();this._scene.unregisterBeforeRender(this._syncData);
this._scene.unregisterAfterRender(this._syncUI);this._rootElement.removeChild(this._globalDiv);this._scene.forceShowBoundingBoxes=!1;this._scene.forceWireframe=!1;c.StandardMaterial.DiffuseTextureEnabled=!0;c.StandardMaterial.AmbientTextureEnabled=!0;c.StandardMaterial.SpecularTextureEnabled=!0;c.StandardMaterial.EmissiveTextureEnabled=!0;c.StandardMaterial.BumpTextureEnabled=!0;c.StandardMaterial.OpacityTextureEnabled=!0;c.StandardMaterial.ReflectionTextureEnabled=!0;c.StandardMaterial.LightmapTextureEnabled=
!0;c.StandardMaterial.RefractionTextureEnabled=!0;this._scene.shadowsEnabled=!0;this._scene.particlesEnabled=!0;this._scene.postProcessesEnabled=!0;this._scene.collisionsEnabled=!0;this._scene.lightsEnabled=!0;this._scene.texturesEnabled=!0;this._scene.lensFlaresEnabled=!0;this._scene.proceduralTexturesEnabled=!0;this._scene.renderTargetsEnabled=!0;this._scene.probesEnabled=!0;e.getRenderingCanvas().removeEventListener("click",this._onCanvasClick);this._clearSkeletonViewers()}},f.prototype._clearSkeletonViewers=
function(){for(var c=0;c<this._skeletonViewers.length;c++)this._skeletonViewers[c].dispose();this._skeletonViewers=[]},f.prototype.show=function(c,a,b){if(void 0===c&&(c=!0),void 0===a&&(a=null),void 0===b&&(b=null),!this._enabled)this._enabled=!0,a?this._camera=a:this._camera=this._scene.activeCamera,this._showUI=c,c=this._scene.getEngine(),this._globalDiv=document.createElement("div"),this._rootElement=b||document.body,this._rootElement.appendChild(this._globalDiv),this._generateDOMelements(),c.getRenderingCanvas().addEventListener("click",
this._onCanvasClick),this._syncPositions(),this._scene.registerBeforeRender(this._syncData),this._scene.registerAfterRender(this._syncUI)},f.prototype._clearLabels=function(){this._drawingContext.clearRect(0,0,this._drawingCanvas.width,this._drawingCanvas.height);for(var c=0;c<this._scene.meshes.length;c++)this._scene.meshes[c].renderOverlay=!1},f.prototype._generateheader=function(c,a){var b=document.createElement("div");b.innerHTML=a+"&nbsp;";b.style.textAlign="right";b.style.width="100%";b.style.color=
"white";b.style.backgroundColor="Black";b.style.padding="5px 5px 4px 0px";b.style.marginLeft="-5px";b.style.fontWeight="bold";c.appendChild(b)},f.prototype._generateTexBox=function(c,a,b){var d=document.createElement("label");d.style.display="inline";d.innerHTML=a;d.style.color=b;c.appendChild(d);c.appendChild(document.createElement("br"))},f.prototype._generateAdvancedCheckBox=function(c,a,b,d,f,g){void 0===g&&(g=null);var h=document.createElement("label");h.style.display="inline";var m=document.createElement("input");
m.type="checkbox";m.checked=d;m.style.display="inline";m.style.margin="0px 5px 0px 0px";m.style.verticalAlign="sub";m.addEventListener("change",function(a){f(a.target,g)});h.appendChild(m);d=document.createElement("span");var m=document.createElement("span"),l=document.createElement("span");l.style.cssFloat="right";m.innerHTML=a;l.innerHTML=b;l.style.fontSize="12px";l.style.maxWidth="200px";d.appendChild(m);d.appendChild(l);h.appendChild(d);c.appendChild(h);c.appendChild(document.createElement("br"))},
f.prototype._generateCheckBox=function(c,a,b,d,f){void 0===f&&(f=null);var g=document.createElement("label");g.style.display="inline";var h=document.createElement("input");h.type="checkbox";h.checked=b;h.style.display="inline";h.style.margin="0px 5px 0px 0px";h.style.verticalAlign="sub";h.addEventListener("change",function(a){d(a.target,f)});g.appendChild(h);g.appendChild(document.createTextNode(a));c.appendChild(g);c.appendChild(document.createElement("br"))},f.prototype._generateButton=function(c,
a,b,d){void 0===d&&(d=null);var f=document.createElement("button");f.innerHTML=a;f.style.height="24px";f.style.width="150px";f.style.marginBottom="5px";f.style.color="#444444";f.style.border="1px solid white";f.className="debugLayerButton";f.addEventListener("click",function(a){b(a.target,d)});c.appendChild(f);c.appendChild(document.createElement("br"))},f.prototype._generateRadio=function(c,a,b,d,f,g){void 0===g&&(g=null);var h=document.createElement("label");h.style.display="inline";var m=document.createElement("input");
m.type="radio";m.name=b;m.checked=d;m.style.display="inline";m.style.margin="0px 5px 0px 0px";m.style.verticalAlign="sub";m.addEventListener("change",function(a){f(a.target,g)});h.appendChild(m);h.appendChild(document.createTextNode(a));c.appendChild(h);c.appendChild(document.createElement("br"))},f.prototype._generateDOMelements=function(){var e=this;if(this._globalDiv.id="DebugLayer",this._globalDiv.style.position="absolute",this._globalDiv.style.fontFamily="Segoe UI, Arial",this._globalDiv.style.fontSize=
"14px",this._globalDiv.style.color="white",this._drawingCanvas=document.createElement("canvas"),this._drawingCanvas.id="DebugLayerDrawingCanvas",this._drawingCanvas.style.position="absolute",this._drawingCanvas.style.pointerEvents="none",this._drawingCanvas.style.backgroundColor="transparent",this._drawingContext=this._drawingCanvas.getContext("2d"),this._globalDiv.appendChild(this._drawingCanvas),this._showUI)this._statsDiv=document.createElement("div"),this._statsDiv.id="DebugLayerStats",this._statsDiv.style.border=
"rgb(180, 180, 180) solid 1px",this._statsDiv.style.position="absolute",this._statsDiv.style.background="rgba(128, 128, 128, 0.4)",this._statsDiv.style.padding="0px 0px 0px 5px",this._generateheader(this._statsDiv,"STATISTICS"),this._statsSubsetDiv=document.createElement("div"),this._statsSubsetDiv.style.paddingTop="5px",this._statsSubsetDiv.style.paddingBottom="5px",this._statsSubsetDiv.style.overflowY="auto",this._statsDiv.appendChild(this._statsSubsetDiv),this._treeDiv=document.createElement("div"),
this._treeDiv.id="DebugLayerTree",this._treeDiv.style.border="rgb(180, 180, 180) solid 1px",this._treeDiv.style.position="absolute",this._treeDiv.style.background="rgba(128, 128, 128, 0.4)",this._treeDiv.style.padding="0px 0px 0px 5px",this._treeDiv.style.display="none",this._generateheader(this._treeDiv,"MESHES TREE"),this._treeSubsetDiv=document.createElement("div"),this._treeSubsetDiv.style.paddingTop="5px",this._treeSubsetDiv.style.paddingRight="5px",this._treeSubsetDiv.style.overflowY="auto",
this._treeSubsetDiv.style.maxHeight="300px",this._treeDiv.appendChild(this._treeSubsetDiv),this._needToRefreshMeshesTree=!0,this._logDiv=document.createElement("div"),this._logDiv.style.border="rgb(180, 180, 180) solid 1px",this._logDiv.id="DebugLayerLogs",this._logDiv.style.position="absolute",this._logDiv.style.background="rgba(128, 128, 128, 0.4)",this._logDiv.style.padding="0px 0px 0px 5px",this._logDiv.style.display="none",this._generateheader(this._logDiv,"LOGS"),this._logSubsetDiv=document.createElement("div"),
this._logSubsetDiv.style.height="127px",this._logSubsetDiv.style.paddingTop="5px",this._logSubsetDiv.style.overflowY="auto",this._logSubsetDiv.style.fontSize="12px",this._logSubsetDiv.style.fontFamily="consolas",this._logSubsetDiv.innerHTML=c.Tools.LogCache,this._logDiv.appendChild(this._logSubsetDiv),c.Tools.OnNewCacheEntry=function(a){e._logSubsetDiv.innerHTML=a+e._logSubsetDiv.innerHTML},this._optionsDiv=document.createElement("div"),this._optionsDiv.id="DebugLayerOptions",this._optionsDiv.style.border=
"rgb(180, 180, 180) solid 1px",this._optionsDiv.style.position="absolute",this._optionsDiv.style.background="rgba(128, 128, 128, 0.4)",this._optionsDiv.style.padding="0px 0px 0px 5px",this._optionsDiv.style.overflowY="auto",this._generateheader(this._optionsDiv,"OPTIONS"),this._optionsSubsetDiv=document.createElement("div"),this._optionsSubsetDiv.style.paddingTop="5px",this._optionsSubsetDiv.style.paddingBottom="5px",this._optionsSubsetDiv.style.overflowY="auto",this._optionsSubsetDiv.style.maxHeight=
"200px",this._optionsDiv.appendChild(this._optionsSubsetDiv),this._generateTexBox(this._optionsSubsetDiv,"<b>Windows:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Statistics",this._displayStatistics,function(a){e._displayStatistics=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Logs",this._displayLogs,function(a){e._displayLogs=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Meshes tree",this._displayTree,function(a){e._displayTree=a.checked;e._needToRefreshMeshesTree=
!0}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>General:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Bounding boxes",this._scene.forceShowBoundingBoxes,function(a){e._scene.forceShowBoundingBoxes=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Clickable labels",this._labelsEnabled,function(a){e._labelsEnabled=a.checked;e._labelsEnabled||e._clearLabels()}),this._generateCheckBox(this._optionsSubsetDiv,
"Generate user marks (F12)",c.Tools.PerformanceLogLevel===c.Tools.PerformanceUserMarkLogLevel,function(a){a.checked?c.Tools.PerformanceLogLevel=c.Tools.PerformanceUserMarkLogLevel:c.Tools.PerformanceLogLevel=c.Tools.PerformanceNoneLogLevel}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Rendering mode:</b>",this.accentColor),this._generateRadio(this._optionsSubsetDiv,"Solid","renderMode",!this._scene.forceWireframe&&!this._scene.forcePointsCloud,
function(a){a.checked&&(e._scene.forceWireframe=!1,e._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,"Wireframe","renderMode",this._scene.forceWireframe,function(a){a.checked&&(e._scene.forceWireframe=!0,e._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,"Point","renderMode",this._scene.forcePointsCloud,function(a){a.checked&&(e._scene.forceWireframe=!1,e._scene.forcePointsCloud=!0)}),this._optionsSubsetDiv.appendChild(document.createElement("br")),
this._generateTexBox(this._optionsSubsetDiv,"<b>Texture channels:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Diffuse",c.StandardMaterial.DiffuseTextureEnabled,function(a){c.StandardMaterial.DiffuseTextureEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Ambient",c.StandardMaterial.AmbientTextureEnabled,function(a){c.StandardMaterial.AmbientTextureEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Specular",c.StandardMaterial.SpecularTextureEnabled,
function(a){c.StandardMaterial.SpecularTextureEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Emissive",c.StandardMaterial.EmissiveTextureEnabled,function(a){c.StandardMaterial.EmissiveTextureEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Bump",c.StandardMaterial.BumpTextureEnabled,function(a){c.StandardMaterial.BumpTextureEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Opacity",c.StandardMaterial.OpacityTextureEnabled,function(a){c.StandardMaterial.OpacityTextureEnabled=
a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Reflection",c.StandardMaterial.ReflectionTextureEnabled,function(a){c.StandardMaterial.ReflectionTextureEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Refraction",c.StandardMaterial.RefractionTextureEnabled,function(a){c.StandardMaterial.RefractionTextureEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Lightmap",c.StandardMaterial.LightmapTextureEnabled,function(a){c.StandardMaterial.LightmapTextureEnabled=
a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Fresnel",c.StandardMaterial.FresnelEnabled,function(a){c.StandardMaterial.FresnelEnabled=a.checked}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Options:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Animations",this._scene.animationsEnabled,function(a){e._scene.animationsEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Collisions",
this._scene.collisionsEnabled,function(a){e._scene.collisionsEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Fog",this._scene.fogEnabled,function(a){e._scene.fogEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Lens flares",this._scene.lensFlaresEnabled,function(a){e._scene.lensFlaresEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Lights",this._scene.lightsEnabled,function(a){e._scene.lightsEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,
"Particles",this._scene.particlesEnabled,function(a){e._scene.particlesEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Post-processes",this._scene.postProcessesEnabled,function(a){e._scene.postProcessesEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Probes",this._scene.probesEnabled,function(a){e._scene.probesEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Procedural textures",this._scene.proceduralTexturesEnabled,function(a){e._scene.proceduralTexturesEnabled=
a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Render targets",this._scene.renderTargetsEnabled,function(a){e._scene.renderTargetsEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Shadows",this._scene.shadowsEnabled,function(a){e._scene.shadowsEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Skeletons",this._scene.skeletonsEnabled,function(a){e._scene.skeletonsEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Sprites",this._scene.spritesEnabled,
function(a){e._scene.spritesEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Textures",this._scene.texturesEnabled,function(a){e._scene.texturesEnabled=a.checked}),c.AudioEngine&&c.Engine.audioEngine.canUseWebAudio&&(this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Audio:</b>",this.accentColor),this._generateRadio(this._optionsSubsetDiv,"Headphones","panningModel",this._scene.headphone,function(a){a.checked&&(e._scene.headphone=
!0)}),this._generateRadio(this._optionsSubsetDiv,"Normal Speakers","panningModel",!this._scene.headphone,function(a){a.checked&&(e._scene.headphone=!1)}),this._generateCheckBox(this._optionsSubsetDiv,"Disable audio",!this._scene.audioEnabled,function(a){e._scene.audioEnabled=!a.checked})),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Viewers:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Skeletons",!1,function(a){if(!a.checked)return void e._clearSkeletonViewers();
for(a=0;a<e._scene.meshes.length;a++){var b=e._scene.meshes[a];if(b.skeleton){for(var d=!1,f=0;f<e._skeletonViewers.length;f++)if(e._skeletonViewers[f].skeleton===b.skeleton){d=!0;break}d||(b=new c.Debug.SkeletonViewer(b.skeleton,b,e._scene),b.isEnabled=!0,e._skeletonViewers.push(b))}}}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Tools:</b>",this.accentColor),this._generateButton(this._optionsSubsetDiv,"Dump rendertargets",function(){e._scene.dumpNextRenderTargets=
!0}),this._generateButton(this._optionsSubsetDiv,"Run SceneOptimizer",function(){c.SceneOptimizer.OptimizeAsync(e._scene)}),this._generateButton(this._optionsSubsetDiv,"Log camera object",function(){e._camera?console.log(e._camera):console.warn("No camera defined, or debug layer created before camera creation!")}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._globalDiv.appendChild(this._statsDiv),this._globalDiv.appendChild(this._logDiv),this._globalDiv.appendChild(this._optionsDiv),
this._globalDiv.appendChild(this._treeDiv)},f.prototype._displayStats=function(){var e=this._scene,a=e.getEngine(),b=a.getGlInfo();this._statsSubsetDiv.innerHTML="Babylon.js v"+c.Engine.Version+" - <b>"+c.Tools.Format(a.getFps(),0)+" fps</b><br><br><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Count</b><br>Total meshes: "+e.meshes.length+"<br>Total lights: "+e.lights.length+"<br>Total vertices: "+e.getTotalVertices()+"<br>Total materials: "+e.materials.length+"<br>Total textures: "+
e.textures.length+"<br>Active meshes: "+e.getActiveMeshes().length+"<br>Active indices: "+e.getActiveIndices()+"<br>Active bones: "+e.getActiveBones()+"<br>Active particles: "+e.getActiveParticles()+"<br><b>Draw calls: "+a.drawCalls+"</b><br><br><b>Duration</b><br>Meshes selection:</i> "+c.Tools.Format(e.getEvaluateActiveMeshesDuration())+" ms<br>Render Targets: "+c.Tools.Format(e.getRenderTargetsDuration())+" ms<br>Particles: "+c.Tools.Format(e.getParticlesDuration())+" ms<br>Sprites: "+c.Tools.Format(e.getSpritesDuration())+
" ms<br><br>Render: <b>"+c.Tools.Format(e.getRenderDuration())+" ms</b><br>Frame: "+c.Tools.Format(e.getLastFrameDuration())+" ms<br>Potential FPS: "+c.Tools.Format(1E3/e.getLastFrameDuration(),0)+"<br>Resolution: "+a.getRenderWidth()+"x"+a.getRenderHeight()+"<br><br></div><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Extensions</b><br>Std derivatives: "+(a.getCaps().standardDerivatives?"Yes":"No")+"<br>Compressed textures: "+(a.getCaps().s3tc?"Yes":"No")+"<br>Hardware instances: "+
(a.getCaps().instancedArrays?"Yes":"No")+"<br>Texture float: "+(a.getCaps().textureFloat?"Yes":"No")+"<br><br>32bits indices: "+(a.getCaps().uintIndices?"Yes":"No")+"<br>Fragment depth: "+(a.getCaps().fragmentDepthSupported?"Yes":"No")+"<br>High precision shaders: "+(a.getCaps().highPrecisionShaderSupported?"Yes":"No")+"<br>Draw buffers: "+(a.getCaps().drawBuffersExtension?"Yes":"No")+"<br></div><br><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Caps.</b><br>Max textures units: "+
a.getCaps().maxTexturesImageUnits+"<br>Max textures size: "+a.getCaps().maxTextureSize+"<br>Max anisotropy: "+a.getCaps().maxAnisotropy+"<br><b>Info</b><br>WebGL feature level: "+a.webGLVersion+"<br>"+b.version+"<br></div><br>"+b.renderer+"<br>";this.customStatsFunction&&(this._statsSubsetDiv.innerHTML+=this.customStatsFunction())},f);c.DebugLayer=f}(BABYLON||(BABYLON={}));
BABYLON.Effect.ShadersStore={anaglyphPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D leftSampler;\nvoid main(void)\n{\nvec4 leftFrag=texture2D(leftSampler,vUV);\nleftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);\nvec4 rightFrag=texture2D(textureSampler,vUV);\nrightFrag=vec4(rightFrag.r,1.0,1.0,1.0);\ngl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);\n}",blackAndWhitePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void) \n{\nfloat luminance=dot(texture2D(textureSampler,vUV).rgb,vec3(0.3,0.59,0.11));\ngl_FragColor=vec4(luminance,luminance,luminance,1.0);\n}",
blurPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nuniform vec2 direction;\nuniform float blurWidth;\nvoid main(void)\n{\nfloat weights[7];\nweights[0]=0.05;\nweights[1]=0.1;\nweights[2]=0.2;\nweights[3]=0.3;\nweights[4]=0.2;\nweights[5]=0.1;\nweights[6]=0.05;\nvec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);\nvec2 texelStep=texelSize*direction*blurWidth;\nvec2 start=vUV-3.0*texelStep;\nvec4 baseColor=vec4(0.,0.,0.,0.);\nvec2 texelOffset=vec2(0.,0.);\nfor (int i=0; i<7; i++)\n{\nbaseColor+=texture2D(textureSampler,start+texelOffset)*weights[i];\ntexelOffset+=texelStep;\n}\ngl_FragColor=baseColor;\n}",
chromaticAberrationPixelShader:"\nuniform sampler2D textureSampler; \n\nuniform float chromatic_aberration;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\nvoid main(void)\n{\nvec2 centered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nfloat radius2=centered_screen_pos.x*centered_screen_pos.x\n+centered_screen_pos.y*centered_screen_pos.y;\nfloat radius=sqrt(radius2);\nvec4 original=texture2D(textureSampler,vUV);\nif (chromatic_aberration>0.0) {\n\nvec3 ref_indices=vec3(-0.3,0.0,0.3);\nfloat ref_shiftX=chromatic_aberration*radius*17.0/screen_width;\nfloat ref_shiftY=chromatic_aberration*radius*17.0/screen_height;\n\nvec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);\nvec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);\nvec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);\noriginal.r=texture2D(textureSampler,ref_coords_r).r;\noriginal.g=texture2D(textureSampler,ref_coords_g).g;\noriginal.b=texture2D(textureSampler,ref_coords_b).b;\n}\ngl_FragColor=original;\n}",
colorPixelShader:"uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}",colorVertexShader:"\nattribute vec3 position;\n\nuniform mat4 worldViewProjection;\nvoid main(void) {\ngl_Position=worldViewProjection*vec4(position,1.0);\n}",colorCorrectionPixelShader:"\nuniform sampler2D textureSampler; \nuniform sampler2D colorTable; \n\nvarying vec2 vUV;\n\nconst float SLICE_COUNT=16.0; \n\nvec4 sampleAs3DTexture(sampler2D texture,vec3 uv,float width) {\nfloat sliceSize=1.0/width; \nfloat slicePixelSize=sliceSize/width; \nfloat sliceInnerSize=slicePixelSize*(width-1.0); \nfloat zSlice0=min(floor(uv.z*width),width-1.0);\nfloat zSlice1=min(zSlice0+1.0,width-1.0);\nfloat xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;\nfloat s0=xOffset+(zSlice0*sliceSize);\nfloat s1=xOffset+(zSlice1*sliceSize);\nvec4 slice0Color=texture2D(texture,vec2(s0,uv.y));\nvec4 slice1Color=texture2D(texture,vec2(s1,uv.y));\nfloat zOffset=mod(uv.z*width,1.0);\nvec4 result=mix(slice0Color,slice1Color,zOffset);\nreturn result;\n}\nvoid main(void)\n{\nvec4 screen_color=texture2D(textureSampler,vUV);\ngl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);\n}",
convolutionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform float kernel[9];\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 colorSum =\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];\nfloat kernelWeight =\nkernel[0] +\nkernel[1] +\nkernel[2] +\nkernel[3] +\nkernel[4] +\nkernel[5] +\nkernel[6] +\nkernel[7] +\nkernel[8];\nif (kernelWeight<=0.0) {\nkernelWeight=1.0;\n}\ngl_FragColor=vec4((colorSum/kernelWeight).rgb,1);\n}",
defaultPixelShader:"#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<lightFragmentDeclaration>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform sampler2D lightmapSampler;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform sampler2D specularSampler;\n#endif\n\n#include<fresnelFunction>\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\nuniform mat4 reflectionMatrix;\n#endif\n#endif\n#include<reflectionFunction>\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef DIFFUSE\nvec2 diffuseUV=vDiffuseUV;\n#endif\n#include<bumpFragment>\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,diffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#endif\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0)\n{\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb*vRefractionInfos.x;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb*vRefractionInfos.x;\n#endif\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb*vReflectionInfos.x;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb*vReflectionInfos.x;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb*vReflectionInfos.x;\n#endif\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV).rgb*vLightmapInfos.y;\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n}",
defaultVertexShader:"\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#include<pointCloudVertexDeclaration>\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<shadowsVertexDeclaration>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=position;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef LIGHTMAP\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n}",
depthPixelShader:"#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nuniform float far;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\nfloat depth=(gl_FragCoord.z/gl_FragCoord.w)/far;\ngl_FragColor=vec4(depth,depth*depth,0.0,1.0);\n}",depthVertexShader:"\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",
depthBoxBlurPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nvoid main(void)\n{\nvec4 colorDepth=vec4(0.0);\nfor (int x=-OFFSET; x<=OFFSET; x++)\nfor (int y=-OFFSET; y<=OFFSET; y++)\ncolorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);\ngl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));\n}",depthOfFieldPixelShader:"\n\n\n\n\nuniform sampler2D textureSampler;\nuniform sampler2D highlightsSampler;\nuniform sampler2D depthSampler;\nuniform sampler2D grainSampler;\n\nuniform float grain_amount;\nuniform bool blur_noise;\nuniform float screen_width;\nuniform float screen_height;\nuniform float distortion;\nuniform bool dof_enabled;\n\nuniform float screen_distance; \nuniform float aperture;\nuniform float darken;\nuniform float edge_blur;\nuniform bool highlights;\n\nuniform float near;\nuniform float far;\n\nvarying vec2 vUV;\n\n#define PI 3.14159265\n#define TWOPI 6.28318530\n#define inverse_focal_length 0.1 \n\nvec2 centered_screen_pos;\nvec2 distorted_coords;\nfloat radius2;\nfloat radius;\n\nvec2 rand(vec2 co)\n{\nfloat noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));\nfloat noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));\nreturn clamp(vec2(noise1,noise2),0.0,1.0);\n}\n\nvec2 getDistortedCoords(vec2 coords) {\nif (distortion == 0.0) { return coords; }\nvec2 direction=1.0*normalize(centered_screen_pos);\nvec2 dist_coords=vec2(0.5,0.5);\ndist_coords.x=0.5+direction.x*radius2*1.0;\ndist_coords.y=0.5+direction.y*radius2*1.0;\nfloat dist_amount=clamp(distortion*0.23,0.0,1.0);\ndist_coords=mix(coords,dist_coords,dist_amount);\nreturn dist_coords;\n}\n\nfloat sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {\n\nvec2 coords=distorted_coords;\nfloat angle=rand(coords*100.0).x*TWOPI;\ncoords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));\ncolor+=texture2D(textureSampler,coords)*weight;\nreturn weight;\n}\n\nfloat getBlurLevel(float size) {\nreturn min(3.0,ceil(size/1.0));\n}\n\nvec4 getBlurColor(float size) {\nvec4 col=texture2D(textureSampler,distorted_coords);\nif (size == 0.0) { return col; }\n\n\nfloat blur_level=getBlurLevel(size);\nfloat w=(size/screen_width);\nfloat h=(size/screen_height);\nfloat total_weight=1.0;\nvec2 sample_coords;\ntotal_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);\ntotal_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);\ntotal_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);\ntotal_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);\ntotal_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);\ntotal_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);\ntotal_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);\ntotal_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);\ntotal_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);\nif (blur_level>1.0) {\ntotal_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);\ntotal_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);\ntotal_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);\ntotal_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);\ntotal_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);\ntotal_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);\ntotal_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);\ntotal_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);\ntotal_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);\n}\nif (blur_level>2.0) {\ntotal_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);\ntotal_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);\ntotal_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);\ntotal_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);\ntotal_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);\ntotal_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);\ntotal_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);\ntotal_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);\ntotal_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);\n}\ncol/=total_weight; \n\nif (darken>0.0) {\ncol.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);\n}\n\n\n\n\nreturn col;\n}\nvoid main(void)\n{\n\ncentered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nradius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;\nradius=sqrt(radius2);\ndistorted_coords=getDistortedCoords(vUV); \nvec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height); \nfloat depth=texture2D(depthSampler,distorted_coords).r; \nfloat distance=near+(far-near)*depth; \nvec4 color=texture2D(textureSampler,vUV); \n\n\nfloat coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));\n\nif (dof_enabled == false || coc<0.07) { coc=0.0; }\n\nfloat edge_blur_amount=0.0;\nif (edge_blur>0.0) {\nedge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;\n}\n\nfloat blur_amount=max(edge_blur_amount,coc);\n\nif (blur_amount == 0.0) {\ngl_FragColor=texture2D(textureSampler,distorted_coords);\n}\nelse {\n\ngl_FragColor=getBlurColor(blur_amount*1.7);\n\nif (highlights) {\ngl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;\n}\nif (blur_noise) {\n\nvec2 noise=rand(distorted_coords)*0.01*blur_amount;\nvec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);\ngl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;\n}\n}\n\nif (grain_amount>0.0) {\nvec4 grain_color=texture2D(grainSampler,texels_coords*0.003);\ngl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;\n}\n}\n",
displayPassPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D passSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(passSampler,vUV);\n}",ellipse2dPixelShader:"varying vec4 vColor;\nvoid main(void) {\ngl_FragColor=vColor;\n}",ellipse2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\nattribute float index;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n#ifdef Border\natt float borderThickness;\n#endif\n#ifdef FillSolid\natt vec4 fillSolidColor;\n#endif\n#ifdef BorderSolid\natt vec4 borderSolidColor;\n#endif\n#ifdef FillGradient\natt vec4 fillGradientColor1;\natt vec4 fillGradientColor2;\natt vec4 fillGradientTY;\n#endif\n#ifdef BorderGradient\natt vec4 borderGradientColor1;\natt vec4 borderGradientColor2;\natt vec4 borderGradientTY;\n#endif\n\natt vec3 properties;\n#define TWOPI 6.28318530\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n#ifdef Border\nfloat w=properties.x;\nfloat h=properties.y;\nfloat ms=properties.z;\nvec2 borderOffset=vec2(1.0,1.0);\nfloat segi=index;\nif (index<ms) {\nborderOffset=vec2(1.0-(borderThickness*2.0/w),1.0-(borderThickness*2.0/h));\n}\nelse {\nsegi-=ms;\n}\nfloat angle=TWOPI*segi/ms;\npos2.x=(cos(angle)/2.0)+0.5;\npos2.y=(sin(angle)/2.0)+0.5;\npos2.x=((pos2.x-0.5)*borderOffset.x)+0.5;\npos2.y=((pos2.y-0.5)*borderOffset.y)+0.5;\n#else\nif (index == 0.0) {\npos2=vec2(0.5,0.5);\n}\nelse {\nfloat ms=properties.z;\nfloat angle=TWOPI*(index-1.0)/ms;\npos2.x=(cos(angle)/2.0)+0.5;\npos2.y=(sin(angle)/2.0)+0.5;\n}\n#endif\n#ifdef FillSolid\nvColor=fillSolidColor;\n#endif\n#ifdef BorderSolid\nvColor=borderSolidColor;\n#endif\n#ifdef FillGradient\nfloat v=dot(vec4(pos2.xy,1,1),fillGradientTY);\nvColor=mix(fillGradientColor2,fillGradientColor1,v); \n#endif\n#ifdef BorderGradient\nfloat v=dot(vec4(pos2.xy,1,1),borderGradientTY);\nvColor=mix(borderGradientColor2,borderGradientColor1,v); \n#endif\nvec4 pos;\npos.xy=pos2.xy*properties.xy;\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",
filterPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform mat4 kernelMatrix;\nvoid main(void)\n{\nvec3 baseColor=texture2D(textureSampler,vUV).rgb;\nvec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;\ngl_FragColor=vec4(updatedColor,1.0);\n}",fxaaPixelShader:"#define FXAA_REDUCE_MIN (1.0/128.0)\n#define FXAA_REDUCE_MUL (1.0/8.0)\n#define FXAA_SPAN_MAX 8.0\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 texelSize;\nvoid main(){\nvec2 localTexelSize=texelSize;\nvec4 rgbNW=texture2D(textureSampler,(vUV+vec2(-1.0,-1.0)*localTexelSize));\nvec4 rgbNE=texture2D(textureSampler,(vUV+vec2(1.0,-1.0)*localTexelSize));\nvec4 rgbSW=texture2D(textureSampler,(vUV+vec2(-1.0,1.0)*localTexelSize));\nvec4 rgbSE=texture2D(textureSampler,(vUV+vec2(1.0,1.0)*localTexelSize));\nvec4 rgbM=texture2D(textureSampler,vUV);\nvec4 luma=vec4(0.299,0.587,0.114,1.0);\nfloat lumaNW=dot(rgbNW,luma);\nfloat lumaNE=dot(rgbNE,luma);\nfloat lumaSW=dot(rgbSW,luma);\nfloat lumaSE=dot(rgbSE,luma);\nfloat lumaM=dot(rgbM,luma);\nfloat lumaMin=min(lumaM,min(min(lumaNW,lumaNE),min(lumaSW,lumaSE)));\nfloat lumaMax=max(lumaM,max(max(lumaNW,lumaNE),max(lumaSW,lumaSE)));\nvec2 dir=vec2(-((lumaNW+lumaNE)-(lumaSW+lumaSE)),((lumaNW+lumaSW)-(lumaNE+lumaSE)));\nfloat dirReduce=max(\n(lumaNW+lumaNE+lumaSW+lumaSE)*(0.25*FXAA_REDUCE_MUL),\nFXAA_REDUCE_MIN);\nfloat rcpDirMin=1.0/(min(abs(dir.x),abs(dir.y))+dirReduce);\ndir=min(vec2(FXAA_SPAN_MAX,FXAA_SPAN_MAX),\nmax(vec2(-FXAA_SPAN_MAX,-FXAA_SPAN_MAX),\ndir*rcpDirMin))*localTexelSize;\nvec4 rgbA=0.5*(\ntexture2D(textureSampler,vUV+dir*(1.0/3.0-0.5)) +\ntexture2D(textureSampler,vUV+dir*(2.0/3.0-0.5)));\nvec4 rgbB=rgbA*0.5+0.25*(\ntexture2D(textureSampler,vUV+dir*-0.5) +\ntexture2D(textureSampler,vUV+dir*0.5));\nfloat lumaB=dot(rgbB,luma);\nif ((lumaB<lumaMin) || (lumaB>lumaMax)) {\ngl_FragColor=rgbA;\n}\nelse {\ngl_FragColor=rgbB;\n}\n}",
hdrPixelShader:"uniform sampler2D textureSampler;\nvarying vec2 vUV;\n#if defined(GAUSSIAN_BLUR_H) || defined(GAUSSIAN_BLUR_V)\nuniform float blurOffsets[9];\nuniform float blurWeights[9];\nuniform float multiplier;\nvoid main(void) {\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfor (int i=0; i<9; i++) {\n#ifdef GAUSSIAN_BLUR_H\ncolor+=(texture2D(textureSampler,vUV+vec2(blurOffsets[i]*multiplier,0.0))*blurWeights[i]);\n#else\ncolor+=(texture2D(textureSampler,vUV+vec2(0.0,blurOffsets[i]*multiplier))*blurWeights[i]);\n#endif\n}\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n#if defined(TEXTURE_ADDER)\nuniform sampler2D otherSampler;\nvoid main() {\nvec4 sum=texture2D(textureSampler,vUV)+texture2D(otherSampler,vUV);\nsum.a=clamp(sum.a,0.0,1.0);\ngl_FragColor=sum;\n}\n#endif\n#if defined(LUMINANCE_GENERATOR)\nuniform vec2 lumOffsets[4];\nvoid main() {\nfloat average=0.0;\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfloat maximum=-1e20;\nfor (int i=0; i<4; i++) {\ncolor=texture2D(textureSampler,vUV+lumOffsets[i]);\nfloat GreyValue=length(color.rgb);\nmaximum=max(maximum,GreyValue);\naverage+=(0.25*log(1e-5+GreyValue));\n}\naverage=exp(average);\ngl_FragColor=vec4(average,maximum,0.0,1.0);\n}\n#endif\n#if defined(DOWN_SAMPLE)\nuniform vec2 dsOffsets[9];\nuniform float halfDestPixelSize;\n#ifdef FINAL_DOWN_SAMPLE\nvec4 pack(float value) {\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(value*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvoid main() {\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfloat average=0.0;\nfor (int i=0; i<9; i++) {\ncolor=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);\naverage+=color.r;\n}\naverage/=9.0;\n#ifndef FINAL_DOWN_SAMPLE\ngl_FragColor=vec4(average,average,0.0,1.0);\n#else\ngl_FragColor=pack(average);\n#endif\n}\n#endif\n#if defined(BRIGHT_PASS)\nuniform vec2 dsOffsets[4];\nuniform float brightThreshold;\nvoid main() {\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));\naverage*=0.25;\nfloat luminance=length(average.rgb);\nif (luminance<brightThreshold) {\naverage=vec4(0.0,0.0,0.0,1.0);\n}\ngl_FragColor=average;\n}\n#endif\n#if defined(DOWN_SAMPLE_X4)\nuniform vec2 dsOffsets[16];\nvoid main() {\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+dsOffsets[0]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[1]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[2]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[3]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[4]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[5]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[6]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[7]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[8]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[9]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[10]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[11]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[12]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[13]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[14]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[15]);\naverage/=16.0;\ngl_FragColor=average;\n}\n#endif\n#if defined(HDR)\nuniform sampler2D otherSampler;\nuniform float exposure;\nuniform float avgLuminance;\nvoid main() {\nvec4 color=texture2D(textureSampler,vUV)+texture2D(otherSampler,vUV);\nvec4 adjustedColor=color/avgLuminance*exposure;\ncolor=adjustedColor;\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n",
layerPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=baseColor*color;\n}",layerVertexShader:"\nattribute vec2 position;\n\nuniform vec2 scale;\nuniform vec2 offset;\nuniform mat4 textureMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvec2 shiftedPosition=position*scale+offset;\nvUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));\ngl_Position=vec4(shiftedPosition,0.0,1.0);\n}",
legacydefaultPixelShader:"#define MAP_PROJECTION 4.\n\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<lightFragmentDeclaration>[0..3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef REFLECTION\nvarying vec3 vReflectionUVW;\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\nuniform vec2 vReflectionInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform sampler2D specularSampler;\n#endif\n\n#include<fresnelFunction>\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 normalW=normalize(vNormalW);\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\nglossiness=vSpecularColor.a;\n#endif\nfloat shadow=1.;\n#include<lightFragment>[0..3]\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb*vReflectionInfos.x;\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb*vReflectionInfos.x;\n#endif\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n\nfloat alpha=vDiffuseColor.a;\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef SPECULARTERM\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nspecularColor=texture2D(specularSampler,vSpecularUV).rgb*vSpecularInfos.y;\n#endif\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}",
legacydefaultVertexShader:"\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec2 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<shadowsVertexDeclaration>[0..maxSimultaneousLights]\n#ifdef REFLECTION\nuniform vec3 vEyePosition;\nvarying vec3 vReflectionUVW;\nuniform mat4 reflectionMatrix;\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 coords=vec3(view*vec4(worldNormal,0.0));\nreturn vec3(reflectionMatrix*vec4(coords,1.0));\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef INVERTCUBICMAP\ncoords.y=1.0-coords.y;\n#endif\nreturn vec3(reflectionMatrix*vec4(coords,0));\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn position;\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}\n#endif\nvoid main(void) {\nmat4 finalWorld=world;\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef REFLECTION\nvReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),vNormalW);\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n}",
legacypbrPixelShader:"precision mediump float;\n\n#define RECIPROCAL_PI2 0.15915494\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vAlbedoColor;\nuniform vec3 vReflectionColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vCameraInfos;\n#ifdef OVERLOADEDVALUES\nuniform vec4 vOverloadedIntensity;\nuniform vec3 vOverloadedAmbient;\nuniform vec3 vOverloadedAlbedo;\nuniform vec3 vOverloadedReflectivity;\nuniform vec3 vOverloadedEmissive;\nuniform vec3 vOverloadedReflection;\nuniform vec3 vOverloadedMicroSurface;\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nuniform vec4 vOverloadedShadowIntensity;\n#endif\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<lightFragmentDeclaration>[0..maxSimultaneousLights]\n\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform sampler2D albedoSampler;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform sampler2D lightmapSampler;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform sampler2D reflectivitySampler;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#ifdef CAMERACOLORGRADING\nuniform sampler2D cameraColorGrading2DSampler;\nuniform vec4 vCameraColorGradingInfos;\nuniform vec4 vCameraColorGradingScaleOffset;\n#endif\n\n#include<pbrFunctions>\n#include<harmonicsFunctions>\n#include<pbrLightFunctions>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 surfaceAlbedo=vec4(1.,1.,1.,1.);\nvec3 surfaceAlbedoContribution=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nsurfaceAlbedo=texture2D(albedoSampler,vAlbedoUV);\nsurfaceAlbedo=vec4(toLinearSpace(surfaceAlbedo.rgb),surfaceAlbedo.a);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#ifdef ALPHAFROMALBEDO\nalpha*=surfaceAlbedo.a;\n#endif\nsurfaceAlbedo.rgb*=vAlbedoInfos.y;\n#else\n\nsurfaceAlbedo.rgb=surfaceAlbedoContribution;\nsurfaceAlbedoContribution=vec3(1.,1.,1.);\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceAlbedo.rgb=mix(surfaceAlbedo.rgb,vOverloadedAlbedo,vOverloadedIntensity.y);\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nvec3 ambientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nambientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#ifdef OVERLOADEDVALUES\nambientColor.rgb=mix(ambientColor.rgb,vOverloadedAmbient,vOverloadedIntensity.x);\n#endif\n#endif\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor.rgb=mix(surfaceReflectivityColor.rgb,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV);\nsurfaceReflectivityColor=surfaceReflectivityColorMap.rgb;\nsurfaceReflectivityColor=toLinearSpace(surfaceReflectivityColor);\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor=mix(surfaceReflectivityColor,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface=surfaceReflectivityColorMap.a;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDVALUES\nmicroSurface=mix(microSurface,vOverloadedMicroSurface.x,vOverloadedMicroSurface.y);\n#endif\n\nfloat NdotV=max(0.00000000001,dot(normalW,viewDirectionW));\n\nmicroSurface=clamp(microSurface,0.,1.)*0.98;\n\nfloat roughness=clamp(1.-microSurface,0.000001,1.0);\n\nvec3 lightDiffuseContribution=vec3(0.,0.,0.);\n#ifdef OVERLOADEDSHADOWVALUES\nvec3 shadowedOnlyLightDiffuseContribution=vec3(1.,1.,1.);\n#endif\n#ifdef SPECULARTERM\nvec3 lightSpecularContribution= vec3(0.,0.,0.);\n#endif\nfloat notShadowLevel=1.; \nfloat NdotL=-1.;\nlightingInfo info;\n#include<pbrLightFunctionsCall>[0..maxSimultaneousLights]\n#ifdef SPECULARTERM\nlightSpecularContribution*=vLightingIntensity.w;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n\nvec3 environmentRadiance=vReflectionColor.rgb;\nvec3 environmentIrradiance=vReflectionColor.rgb;\n#ifdef OVERLOADEDVALUES\nenvironmentIrradiance=mix(environmentIrradiance,vOverloadedReflection,vOverloadedMicroSurface.z);\nenvironmentRadiance=mix(environmentRadiance,vOverloadedReflection,vOverloadedMicroSurface.z);\n#endif\nenvironmentRadiance*=vLightingIntensity.z;\nenvironmentIrradiance*=vLightingIntensity.z;\n\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0);\nvec3 specularEnvironmentReflectance=FresnelSchlickEnvironmentGGX(clamp(NdotV,0.,1.),specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\nenvironmentRadiance*=specularEnvironmentReflectance;\n\nvec3 surfaceEmissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV).rgb;\nsurfaceEmissiveColor=toLinearSpace(emissiveColorTex.rgb)*surfaceEmissiveColor*vEmissiveInfos.y;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceEmissiveColor=mix(surfaceEmissiveColor,vOverloadedEmissive,vOverloadedIntensity.w);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\n#ifdef LINKEMISSIVEWITHALBEDO\nvec3 finalDiffuse=max((lightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max((shadowedOnlyLightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nfinalDiffuse=mix(finalDiffuse,shadowedOnlyLightDiffuseContribution,(1.0-vOverloadedShadowIntensity.y));\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=lightSpecularContribution*surfaceReflectivityColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+getLuminance(finalSpecular),0.,1.);\n#endif\n#ifdef RADIANCEOVERALPHA\nalpha=clamp(alpha+getLuminance(environmentRadiance),0.,1.);\n#endif\n\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance+surfaceEmissiveColor*vLightingIntensity.y,alpha);\n#else\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance,alpha);\n#endif\nfinalColor=max(finalColor,0.0);\n#ifdef CAMERATONEMAP\nfinalColor.rgb=toneMaps(finalColor.rgb);\n#endif\nfinalColor.rgb=toGammaSpace(finalColor.rgb);\n#ifdef CAMERACONTRAST\nfinalColor=contrasts(finalColor);\n#endif\nfinalColor.rgb=clamp(finalColor.rgb,0.,1.);\n#ifdef CAMERACOLORGRADING\nfinalColor=colorGrades(finalColor,cameraColorGrading2DSampler,vCameraColorGradingInfos,vCameraColorGradingScaleOffset);\n#endif\ngl_FragColor=finalColor;\n}",
legacypbrVertexShader:"precision mediump float;\n\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\nvoid main(void) {\nmat4 finalWorld=world;\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef ALBEDO\nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY)\nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n}",
lensFlarePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\ngl_FragColor=baseColor*color;\n}",lensFlareVertexShader:"\nattribute vec2 position;\n\nuniform mat4 viewportMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=position*madd+madd;\ngl_Position=viewportMatrix*vec4(position,0.0,1.0);\n}",lensHighlightsPixelShader:"\nuniform sampler2D textureSampler; \n\nuniform float gain;\nuniform float threshold;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\n\nvec4 highlightColor(vec4 color) {\nvec4 highlight=color;\nfloat luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));\nfloat lum_threshold;\nif (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }\nelse { lum_threshold=0.5+0.44*threshold; }\nluminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);\nhighlight*=luminance*gain;\nhighlight.a=1.0;\nreturn highlight;\n}\nvoid main(void)\n{\nvec4 original=texture2D(textureSampler,vUV);\n\nif (gain == -1.0) {\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nreturn;\n}\nfloat w=2.0/screen_width;\nfloat h=2.0/screen_height;\nfloat weight=1.0;\n\nvec4 blurred=vec4(0.0,0.0,0.0,0.0);\n#ifdef PENTAGON\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));\n#else\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));\n#endif\nblurred/=39.0;\ngl_FragColor=blurred;\n\n}",
linePixelShader:"uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}",lineVertexShader:"\nattribute vec3 position;\nattribute vec4 normal;\n\nuniform mat4 worldViewProjection;\nuniform float width;\nuniform float aspectRatio;\nvoid main(void) {\nvec4 viewPosition=worldViewProjection*vec4(position,1.0);\nvec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);\nvec2 currentScreen=viewPosition.xy/viewPosition.w;\nvec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;\ncurrentScreen.x*=aspectRatio;\nnextScreen.x*=aspectRatio;\nvec2 dir=normalize(nextScreen-currentScreen);\nvec2 normalDir=vec2(-dir.y,dir.x);\nnormalDir*=width/2.0;\nnormalDir.x/=aspectRatio;\nvec4 offset=vec4(normalDir*normal.w,0.0,0.0);\ngl_Position=viewPosition+offset;\n}",
lines2dPixelShader:"varying vec4 vColor;\nvoid main(void) {\ngl_FragColor=vColor;\n}",lines2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\nattribute vec2 position;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n#ifdef FillSolid\natt vec4 fillSolidColor;\n#endif\n#ifdef BorderSolid\natt vec4 borderSolidColor;\n#endif\n#ifdef FillGradient\natt vec2 boundingMin;\natt vec2 boundingMax;\natt vec4 fillGradientColor1;\natt vec4 fillGradientColor2;\natt vec4 fillGradientTY;\n#endif\n#ifdef BorderGradient\natt vec4 borderGradientColor1;\natt vec4 borderGradientColor2;\natt vec4 borderGradientTY;\n#endif\n#define TWOPI 6.28318530\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\n#ifdef FillSolid\nvColor=fillSolidColor;\n#endif\n#ifdef BorderSolid\nvColor=borderSolidColor;\n#endif\n#ifdef FillGradient\nfloat v=dot(vec4((position.xy-boundingMin)/(boundingMax-boundingMin),1,1),fillGradientTY);\nvColor=mix(fillGradientColor2,fillGradientColor1,v); \n#endif\n#ifdef BorderGradient\nfloat v=dot(vec4((position.xy-boundingMin)/(boundingMax-boundingMin),1,1),borderGradientTY);\nvColor=mix(borderGradientColor2,borderGradientColor1,v); \n#endif\nvec4 pos;\npos.xy=position.xy;\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",
outlinePixelShader:"uniform vec4 color;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void) {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragColor=color;\n}",outlineVertexShader:"\nattribute vec3 position;\nattribute vec3 normal;\n#include<bonesDeclaration>\n\nuniform float offset;\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\nvec3 offsetPosition=position+normal*offset;\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}\n",
particlesPixelShader:"\nvarying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\nvoid main(void) {\n#ifdef CLIPPLANE\nif (fClipDistance>0.0)\ndiscard;\n#endif\nvec4 baseColor=texture2D(diffuseSampler,vUV);\ngl_FragColor=(baseColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n}",particlesVertexShader:"\nattribute vec3 position;\nattribute vec4 color;\nattribute vec4 options;\n\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nuniform mat4 invView;\nvarying float fClipDistance;\n#endif\nvoid main(void) { \nvec3 viewPos=(view*vec4(position,1.0)).xyz; \nvec3 cornerPos;\nfloat size=options.y;\nfloat angle=options.x;\nvec2 offset=options.zw;\ncornerPos=vec3(offset.x-0.5,offset.y-0.5,0.)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \nvColor=color;\nvUV=offset;\n\n#ifdef CLIPPLANE\nvec4 worldPos=invView*vec4(viewPos,1.0);\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n}",
passPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void) \n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}",pbrPixelShader:"#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vCameraInfos;\n#ifdef OVERLOADEDVALUES\nuniform vec4 vOverloadedIntensity;\nuniform vec3 vOverloadedAmbient;\nuniform vec3 vOverloadedAlbedo;\nuniform vec3 vOverloadedReflectivity;\nuniform vec3 vOverloadedEmissive;\nuniform vec3 vOverloadedReflection;\nuniform vec3 vOverloadedMicroSurface;\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nuniform vec4 vOverloadedShadowIntensity;\n#endif\n#if defined(REFLECTION) || defined(REFRACTION)\nuniform vec2 vMicrosurfaceTextureLods;\n#endif\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<lightFragmentDeclaration>[0..maxSimultaneousLights]\n\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform sampler2D albedoSampler;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform sampler2D lightmapSampler;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform sampler2D reflectivitySampler;\n#endif\n\n#include<fresnelFunction>\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\nuniform mat4 refractionMatrix;\n#endif\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\nuniform mat4 reflectionMatrix;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#ifdef CAMERACOLORGRADING\n#include<colorGradingDefinition>\n#endif\n#ifdef CAMERACOLORCURVES\n#include<colorCurvesDefinition>\n#endif\n\n#include<pbrShadowFunctions>\n#include<pbrFunctions>\n#ifdef CAMERACOLORGRADING\n#include<colorGrading>\n#endif\n#ifdef CAMERACOLORCURVES\n#include<colorCurves>\n#endif\n#include<harmonicsFunctions>\n#include<pbrLightFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 surfaceAlbedo=vec4(1.,1.,1.,1.);\nvec3 surfaceAlbedoContribution=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nsurfaceAlbedo=texture2D(albedoSampler,vAlbedoUV);\nsurfaceAlbedo=vec4(toLinearSpace(surfaceAlbedo.rgb),surfaceAlbedo.a);\n#ifndef LINKREFRACTIONTOTRANSPARENCY\n#ifdef ALPHATEST\nif (surfaceAlbedo.a<0.4)\ndiscard;\n#endif\n#endif\n#ifdef ALPHAFROMALBEDO\nalpha*=surfaceAlbedo.a;\n#endif\nsurfaceAlbedo.rgb*=vAlbedoInfos.y;\n#else\n\nsurfaceAlbedo.rgb=surfaceAlbedoContribution;\nsurfaceAlbedoContribution=vec3(1.,1.,1.);\n#endif\n#ifdef VERTEXCOLOR\nsurfaceAlbedo.rgb*=vColor.rgb;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceAlbedo.rgb=mix(surfaceAlbedo.rgb,vOverloadedAlbedo,vOverloadedIntensity.y);\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#include<bumpFragment>\n\nvec3 ambientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nambientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#ifdef OVERLOADEDVALUES\nambientColor.rgb=mix(ambientColor.rgb,vOverloadedAmbient,vOverloadedIntensity.x);\n#endif\n#endif\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor.rgb=mix(surfaceReflectivityColor.rgb,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV);\nsurfaceReflectivityColor=surfaceReflectivityColorMap.rgb;\nsurfaceReflectivityColor=toLinearSpace(surfaceReflectivityColor);\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor=mix(surfaceReflectivityColor,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface=surfaceReflectivityColorMap.a;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDVALUES\nmicroSurface=mix(microSurface,vOverloadedMicroSurface.x,vOverloadedMicroSurface.y);\n#endif\n\nfloat NdotV=max(0.00000000001,dot(normalW,viewDirectionW));\n\nmicroSurface=clamp(microSurface,0.,1.)*0.98;\n\nfloat roughness=clamp(1.-microSurface,0.000001,1.0);\n\nvec3 lightDiffuseContribution=vec3(0.,0.,0.);\n#ifdef OVERLOADEDSHADOWVALUES\nvec3 shadowedOnlyLightDiffuseContribution=vec3(1.,1.,1.);\n#endif\n#ifdef SPECULARTERM\nvec3 lightSpecularContribution=vec3(0.,0.,0.);\n#endif\nfloat notShadowLevel=1.; \nfloat NdotL=-1.;\nlightingInfo info;\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\n\n\nfloat reflectance90=clamp(reflectance*25.0,0.0,1.0);\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;\n#include<pbrLightFunctionsCall>[0..maxSimultaneousLights]\n#ifdef SPECULARTERM\nlightSpecularContribution*=vLightingIntensity.w;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 surfaceRefractionColor=vec3(0.,0.,0.);\n\n#ifdef LODBASEDMICROSFURACE\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\n#endif\n#ifdef REFRACTION\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFRACTION\nfloat lodRefraction=getMipMapIndexFromAverageSlopeWithPMREM(vMicrosurfaceTextureLods.y,alphaG);\n#else\nfloat lodRefraction=getMipMapIndexFromAverageSlope(vMicrosurfaceTextureLods.y,alphaG);\n#endif\n#else\nfloat biasRefraction=(vMicrosurfaceTextureLods.y+2.)*(1.0-microSurface);\n#endif\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0)\n{\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFRACTION\n\nif ((vMicrosurfaceTextureLods.y-lodRefraction)>4.0)\n{\n\nfloat scaleRefraction=1.-exp2(lodRefraction)/exp2(vMicrosurfaceTextureLods.y); \nfloat maxRefraction=max(max(abs(refractionVector.x),abs(refractionVector.y)),abs(refractionVector.z));\nif (abs(refractionVector.x) != maxRefraction) refractionVector.x*=scaleRefraction;\nif (abs(refractionVector.y) != maxRefraction) refractionVector.y*=scaleRefraction;\nif (abs(refractionVector.z) != maxRefraction) refractionVector.z*=scaleRefraction;\n}\n#endif\nsurfaceRefractionColor=textureCubeLodEXT(refractionCubeSampler,refractionVector,lodRefraction).rgb*vRefractionInfos.x;\n#else\nsurfaceRefractionColor=textureCube(refractionCubeSampler,refractionVector,biasRefraction).rgb*vRefractionInfos.x;\n#endif\n}\n#ifndef REFRACTIONMAPINLINEARSPACE\nsurfaceRefractionColor=toLinearSpace(surfaceRefractionColor.rgb);\n#endif\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#ifdef LODBASEDMICROSFURACE\nsurfaceRefractionColor=texture2DLodEXT(refraction2DSampler,refractionCoords,lodRefraction).rgb*vRefractionInfos.x;\n#else\nsurfaceRefractionColor=texture2D(refraction2DSampler,refractionCoords,biasRefraction).rgb*vRefractionInfos.x;\n#endif \nsurfaceRefractionColor=toLinearSpace(surfaceRefractionColor.rgb);\n#endif\n#endif\n\nvec3 environmentRadiance=vReflectionColor.rgb;\nvec3 environmentIrradiance=vReflectionColor.rgb;\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFLECTION\nfloat lodReflection=getMipMapIndexFromAverageSlopeWithPMREM(vMicrosurfaceTextureLods.x,alphaG);\n#else\nfloat lodReflection=getMipMapIndexFromAverageSlope(vMicrosurfaceTextureLods.x,alphaG);\n#endif\n#else\nfloat biasReflection=(vMicrosurfaceTextureLods.x+2.)*(1.0-microSurface);\n#endif\n#ifdef REFLECTIONMAP_3D\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFLECTION\n\nif ((vMicrosurfaceTextureLods.y-lodReflection)>4.0)\n{\n\nfloat scaleReflection=1.-exp2(lodReflection)/exp2(vMicrosurfaceTextureLods.x); \nfloat maxReflection=max(max(abs(vReflectionUVW.x),abs(vReflectionUVW.y)),abs(vReflectionUVW.z));\nif (abs(vReflectionUVW.x) != maxReflection) vReflectionUVW.x*=scaleReflection;\nif (abs(vReflectionUVW.y) != maxReflection) vReflectionUVW.y*=scaleReflection;\nif (abs(vReflectionUVW.z) != maxReflection) vReflectionUVW.z*=scaleReflection;\n}\n#endif\nenvironmentRadiance=textureCubeLodEXT(reflectionCubeSampler,vReflectionUVW,lodReflection).rgb*vReflectionInfos.x;\n#else\nenvironmentRadiance=textureCube(reflectionCubeSampler,vReflectionUVW,biasReflection).rgb*vReflectionInfos.x;\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifndef REFLECTIONMAP_SKYBOX\nvec3 normalEnvironmentSpace=(reflectionMatrix*vec4(normalW,1)).xyz;\nenvironmentIrradiance=EnvironmentIrradiance(normalEnvironmentSpace);\n#endif\n#else\nenvironmentRadiance=toLinearSpace(environmentRadiance.rgb);\nenvironmentIrradiance=textureCube(reflectionCubeSampler,normalW,20.).rgb*vReflectionInfos.x;\nenvironmentIrradiance=toLinearSpace(environmentIrradiance.rgb);\nenvironmentIrradiance*=0.2; \n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\n#ifdef LODBASEDMICROSFURACE\nenvironmentRadiance=texture2DLodEXT(reflection2DSampler,coords,lodReflection).rgb*vReflectionInfos.x;\n#else\nenvironmentRadiance=texture2D(reflection2DSampler,coords,biasReflection).rgb*vReflectionInfos.x;\n#endif\nenvironmentRadiance=toLinearSpace(environmentRadiance.rgb);\nenvironmentIrradiance=texture2D(reflection2DSampler,coords,20.).rgb*vReflectionInfos.x;\nenvironmentIrradiance=toLinearSpace(environmentIrradiance.rgb);\n#endif\n#endif\n#ifdef OVERLOADEDVALUES\nenvironmentIrradiance=mix(environmentIrradiance,vOverloadedReflection,vOverloadedMicroSurface.z);\nenvironmentRadiance=mix(environmentRadiance,vOverloadedReflection,vOverloadedMicroSurface.z);\n#endif\nenvironmentRadiance*=vLightingIntensity.z;\nenvironmentIrradiance*=vLightingIntensity.z;\n\nvec3 specularEnvironmentReflectance=FresnelSchlickEnvironmentGGX(clamp(NdotV,0.,1.),specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n\nvec3 refractance=vec3(0.0,0.0,0.0);\n#ifdef REFRACTION\nvec3 transmission=vec3(1.0,1.0,1.0);\n#ifdef LINKREFRACTIONTOTRANSPARENCY\n\ntransmission*=(1.0-alpha);\n\n\nvec3 mixedAlbedo=surfaceAlbedoContribution.rgb*surfaceAlbedo.rgb;\nfloat maxChannel=max(max(mixedAlbedo.r,mixedAlbedo.g),mixedAlbedo.b);\nvec3 tint=clamp(maxChannel*mixedAlbedo,0.0,1.0);\n\nsurfaceAlbedoContribution*=alpha;\n\nenvironmentIrradiance*=alpha;\n\nsurfaceRefractionColor*=tint;\n\nalpha=1.0;\n#endif\n\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\nspecularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,alpha);\n\ntransmission*=1.0-specularEnvironmentReflectance;\n\nrefractance=surfaceRefractionColor*transmission;\n#endif\n\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\nrefractance*=vLightingIntensity.z;\nenvironmentRadiance*=specularEnvironmentReflectance;\n\nvec3 surfaceEmissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV).rgb;\nsurfaceEmissiveColor=toLinearSpace(emissiveColorTex.rgb)*surfaceEmissiveColor*vEmissiveInfos.y;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceEmissiveColor=mix(surfaceEmissiveColor,vOverloadedEmissive,vOverloadedIntensity.w);\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nsurfaceEmissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\n#ifdef LINKEMISSIVEWITHALBEDO\nvec3 finalDiffuse=max((lightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max((shadowedOnlyLightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nfinalDiffuse=mix(finalDiffuse,shadowedOnlyLightDiffuseContribution,(1.0-vOverloadedShadowIntensity.y));\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=lightSpecularContribution*surfaceReflectivityColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+getLuminance(finalSpecular),0.,1.);\n#endif\n#ifdef RADIANCEOVERALPHA\nalpha=clamp(alpha+getLuminance(environmentRadiance),0.,1.);\n#endif\n\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance+surfaceEmissiveColor*vLightingIntensity.y+refractance,alpha);\n#else\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance+refractance,alpha);\n#endif\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV).rgb*vLightmapInfos.y;\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor;\n#else\nfinalColor.rgb+=lightmapColor;\n#endif\n#endif\nfinalColor=max(finalColor,0.0);\n#ifdef CAMERATONEMAP\nfinalColor.rgb=toneMaps(finalColor.rgb);\n#endif\nfinalColor.rgb=toGammaSpace(finalColor.rgb);\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#ifdef CAMERACONTRAST\nfinalColor=contrasts(finalColor);\n#endif\nfinalColor.rgb=clamp(finalColor.rgb,0.,1.);\n#ifdef CAMERACOLORGRADING\nfinalColor=colorGrades(finalColor);\n#endif\n#ifdef CAMERACOLORCURVES\nfinalColor.rgb=applyColorCurves(finalColor.rgb);\n#endif\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ngl_FragColor=finalColor;\n}",
pbrVertexShader:"precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<shadowsVertexDeclaration>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=position;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef ALBEDO\nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef LIGHTMAP\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY)\nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n\n#include<logDepthVertex>\n}",
postprocessVertexShader:"\nattribute vec2 position;\nuniform vec2 scale;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n}",proceduralVertexShader:"\nattribute vec2 position;\n\nvarying vec2 vPosition;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvPosition=position;\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}",rect2dPixelShader:"varying vec4 vColor;\nvoid main(void) {\ngl_FragColor=vColor;\n}",
rect2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\nattribute float index;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n#ifdef Border\natt float borderThickness;\n#endif\n#ifdef FillSolid\natt vec4 fillSolidColor;\n#endif\n#ifdef BorderSolid\natt vec4 borderSolidColor;\n#endif\n#ifdef FillGradient\natt vec4 fillGradientColor1;\natt vec4 fillGradientColor2;\natt vec4 fillGradientTY;\n#endif\n#ifdef BorderGradient\natt vec4 borderGradientColor1;\natt vec4 borderGradientColor2;\natt vec4 borderGradientTY;\n#endif\n\natt vec3 properties;\n\n#define rsub0 17.0\n#define rsub1 33.0\n#define rsub2 49.0\n#define rsub3 65.0\n#define rsub 64.0\n#define TWOPI 6.28318530\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n\nif (properties.z == 0.0) {\n#ifdef Border\nfloat w=properties.x;\nfloat h=properties.y;\nvec2 borderOffset=vec2(1.0,1.0);\nfloat segi=index;\nif (index<4.0) {\nborderOffset=vec2(1.0-(borderThickness*2.0/w),1.0-(borderThickness*2.0/h));\n}\nelse {\nsegi-=4.0;\n}\nif (segi == 0.0) {\npos2=vec2(1.0,1.0);\n} \nelse if (segi == 1.0) {\npos2=vec2(1.0,0.0);\n}\nelse if (segi == 2.0) {\npos2=vec2(0.0,0.0);\n} \nelse {\npos2=vec2(0.0,1.0);\n}\npos2.x=((pos2.x-0.5)*borderOffset.x)+0.5;\npos2.y=((pos2.y-0.5)*borderOffset.y)+0.5;\n#else\nif (index == 0.0) {\npos2=vec2(0.5,0.5);\n}\nelse if (index == 1.0) {\npos2=vec2(1.0,1.0);\n}\nelse if (index == 2.0) {\npos2=vec2(1.0,0.0);\n}\nelse if (index == 3.0) {\npos2=vec2(0.0,0.0);\n}\nelse {\npos2=vec2(0.0,1.0);\n}\n#endif\n}\nelse\n{\n#ifdef Border\nfloat w=properties.x;\nfloat h=properties.y;\nfloat r=properties.z;\nfloat nru=r/w;\nfloat nrv=r/h;\nvec2 borderOffset=vec2(1.0,1.0);\nfloat segi=index;\nif (index<rsub) {\nborderOffset=vec2(1.0-(borderThickness*2.0/w),1.0-(borderThickness*2.0/h));\n}\nelse {\nsegi-=rsub;\n}\n\nif (segi<rsub0) {\npos2=vec2(1.0-nru,nrv);\n}\n\nelse if (segi<rsub1) {\npos2=vec2(nru,nrv);\n}\n\nelse if (segi<rsub2) {\npos2=vec2(nru,1.0-nrv);\n}\n\nelse {\npos2=vec2(1.0-nru,1.0-nrv);\n}\nfloat angle=TWOPI-((index-1.0)*TWOPI/(rsub-0.5));\npos2.x+=cos(angle)*nru;\npos2.y+=sin(angle)*nrv;\npos2.x=((pos2.x-0.5)*borderOffset.x)+0.5;\npos2.y=((pos2.y-0.5)*borderOffset.y)+0.5;\n#else\nif (index == 0.0) {\npos2=vec2(0.5,0.5);\n}\nelse {\nfloat w=properties.x;\nfloat h=properties.y;\nfloat r=properties.z;\nfloat nru=r/w;\nfloat nrv=r/h;\n\nif (index<rsub0) {\npos2=vec2(1.0-nru,nrv);\n}\n\nelse if (index<rsub1) {\npos2=vec2(nru,nrv);\n}\n\nelse if (index<rsub2) {\npos2=vec2(nru,1.0-nrv);\n}\n\nelse {\npos2=vec2(1.0-nru,1.0-nrv);\n}\nfloat angle=TWOPI-((index-1.0)*TWOPI/(rsub-0.5));\npos2.x+=cos(angle)*nru;\npos2.y+=sin(angle)*nrv;\n}\n#endif\n}\n#ifdef FillSolid\nvColor=fillSolidColor;\n#endif\n#ifdef BorderSolid\nvColor=borderSolidColor;\n#endif\n#ifdef FillGradient\nfloat v=dot(vec4(pos2.xy,1,1),fillGradientTY);\nvColor=mix(fillGradientColor2,fillGradientColor1,v); \n#endif\n#ifdef BorderGradient\nfloat v=dot(vec4(pos2.xy,1,1),borderGradientTY);\nvColor=mix(borderGradientColor2,borderGradientColor1,v); \n#endif\nvec4 pos;\npos.xy=pos2.xy*properties.xy;\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",
refractionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D refractionSampler;\n\nuniform vec3 baseColor;\nuniform float depth;\nuniform float colorLevel;\nvoid main() {\nfloat ref=1.0-texture2D(refractionSampler,vUV).r;\nvec2 uv=vUV-vec2(0.5);\nvec2 offset=uv*depth*ref;\nvec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;\ngl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);\n}",shadowMapPixelShader:"vec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n\nvec2 packHalf(float depth) \n{ \nconst vec2 bitOffset=vec2(1.0/255.,0.);\nvec2 color=vec2(depth,fract(depth*255.));\nreturn color-(color.yy*bitOffset);\n}\nvarying vec4 vPosition;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef CUBEMAP\nuniform vec3 lightPosition;\nuniform vec2 depthValues;\n#endif\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#ifdef CUBEMAP\nvec3 directionToLight=vPosition.xyz-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\n#else\nfloat depth=vPosition.z/vPosition.w;\ndepth=depth*0.5+0.5;\n#endif\n#ifdef VSM\nfloat moment1=depth;\nfloat moment2=moment1*moment1;\ngl_FragColor=vec4(packHalf(moment1),packHalf(moment2));\n#else\ngl_FragColor=pack(depth);\n#endif\n}",
shadowMapVertexShader:"\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nvarying vec4 vPosition;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef CUBEMAP\nvPosition=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#else\nvPosition=viewProjection*finalWorld*vec4(position,1.0);\ngl_Position=vPosition;\n#endif\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",
sprite2dPixelShader:"varying vec2 vUV;\nuniform sampler2D diffuseSampler;\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (color.a == 0.05) {\ndiscard;\n}\ngl_FragColor=color;\n}",sprite2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\n\nattribute float index;\natt vec2 topLeftUV;\natt vec2 sizeUV;\natt vec2 textureSize;\n\natt vec3 properties;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n\nvec2 off=vec2(0.0,0.0);\nfloat frame=properties.x;\nfloat invertY=properties.y;\nfloat alignToPixel=properties.z;\n\nif (index == 0.0) {\npos2=vec2(0.0,0.0);\nvUV=vec2(topLeftUV.x+(frame*sizeUV.x)+off.x,topLeftUV.y-off.y);\n}\n\nelse if (index == 1.0) {\npos2=vec2(0.0,1.0);\nvUV=vec2(topLeftUV.x+(frame*sizeUV.x)+off.x,(topLeftUV.y+sizeUV.y));\n}\n\nelse if (index == 2.0) {\npos2=vec2( 1.0,1.0);\nvUV=vec2(topLeftUV.x+sizeUV.x+(frame*sizeUV.x),(topLeftUV.y+sizeUV.y));\n}\n\nelse if (index == 3.0) {\npos2=vec2( 1.0,0.0);\nvUV=vec2(topLeftUV.x+sizeUV.x+(frame*sizeUV.x),topLeftUV.y-off.y);\n}\nif (invertY == 1.0) {\nvUV.y=1.0-vUV.y;\n}\nvec4 pos;\nif (alignToPixel == 1.0)\n{\npos.xy=floor(pos2.xy*sizeUV*textureSize);\n} else {\npos.xy=pos2.xy*sizeUV*textureSize;\n}\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n} ",
spritesPixelShader:"uniform bool alphaTest;\nvarying vec4 vColor;\n\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (alphaTest) \n{\nif (color.a<0.95)\ndiscard;\n}\ncolor*=vColor;\n#include<fogFragment>\ngl_FragColor=color;\n}",spritesVertexShader:"\nattribute vec4 position;\nattribute vec4 options;\nattribute vec4 cellInfo;\nattribute vec4 color;\n\nuniform vec2 textureInfos;\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#include<fogVertexDeclaration>\nvoid main(void) { \nvec3 viewPos=(view*vec4(position.xyz,1.0)).xyz; \nvec2 cornerPos;\nfloat angle=position.w;\nvec2 size=vec2(options.x,options.y);\nvec2 offset=options.zw;\nvec2 uvScale=textureInfos.xy;\ncornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \n\nvColor=color;\n\nvec2 uvOffset=vec2(abs(offset.x-cellInfo.x),1.0-abs(offset.y-cellInfo.y));\nvUV=(uvOffset+cellInfo.zw)*uvScale;\n\n#ifdef FOG\nfFogDistance=viewPos.z;\n#endif\n}",
ssaoPixelShader:"\nuniform sampler2D textureSampler;\nvarying vec2 vUV;\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float radius;\nuniform float area;\nuniform float fallOff;\nuniform float base;\nvec3 normalFromDepth(float depth,vec2 coords)\n{\nvec2 offset1=vec2(0.0,radius);\nvec2 offset2=vec2(radius,0.0);\nfloat depth1=texture2D(textureSampler,coords+offset1).r;\nfloat depth2=texture2D(textureSampler,coords+offset2).r;\nvec3 p1=vec3(offset1,depth1-depth);\nvec3 p2=vec3(offset2,depth2-depth);\nvec3 normal=cross(p1,p2);\nnormal.z=-normal.z;\nreturn normalize(normal);\n}\nvoid main()\n{\nvec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);\nfloat depth=texture2D(textureSampler,vUV).r;\nvec3 position=vec3(vUV,depth);\nvec3 normal=normalFromDepth(depth,vUV);\nfloat radiusDepth=radius/depth;\nfloat occlusion=0.0;\nvec3 ray;\nvec3 hemiRay;\nfloat occlusionDepth;\nfloat difference;\nfor (int i=0; i<SAMPLES; i++)\n{\nray=radiusDepth*reflect(sampleSphere[i],random);\nhemiRay=position+sign(dot(ray,normal))*ray;\nocclusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;\ndifference=depth-occlusionDepth;\nocclusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));\n}\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor.r=result;\ngl_FragColor.g=result;\ngl_FragColor.b=result;\ngl_FragColor.a=1.0;\n}\n#endif\n#ifdef BILATERAL_BLUR\nuniform sampler2D depthSampler;\nuniform float outSize;\nuniform float samplerOffsets[SAMPLES];\nvoid main()\n{\nfloat texelsize=1.0/outSize;\nfloat compareDepth=texture2D(depthSampler,vUV).r;\nfloat result=0.0;\nfloat weightSum=0.0;\nfor (int i=0; i<SAMPLES; ++i)\n{\n#ifdef BILATERAL_BLUR_H\nvec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);\n#else\nvec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);\n#endif\nvec2 samplePos=vUV+sampleOffset;\nfloat sampleDepth=texture2D(depthSampler,samplePos).r;\nfloat weight=(1.0/(0.0001+abs(compareDepth-sampleDepth)));\nresult+=texture2D(textureSampler,samplePos).r*weight;\nweightSum+=weight;\n}\nresult/=weightSum;\ngl_FragColor.rgb=vec3(result);\ngl_FragColor.a=1.0;\n}\n#endif\n",
ssaoCombinePixelShader:"uniform sampler2D textureSampler;\nuniform sampler2D originalColor;\nvarying vec2 vUV;\nvoid main(void) {\nvec4 ssaoColor=texture2D(textureSampler,vUV);\nvec4 sceneColor=texture2D(originalColor,vUV);\ngl_FragColor=sceneColor*ssaoColor;\n}\n",stereoscopicInterlacePixelShader:"const vec3 TWO=vec3(2.0,2.0,2.0);\nvarying vec2 vUV;\nuniform sampler2D camASampler;\nuniform sampler2D textureSampler;\nuniform vec2 stepSize;\nvoid main(void)\n{\nbool useCamB;\nvec2 texCoord1;\nvec2 texCoord2;\nvec3 frag1;\nvec3 frag2;\n#ifdef IS_STEREOSCOPIC_HORIZ\nuseCamB=vUV.x>0.5;\ntexCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);\ntexCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);\n#else\nuseCamB=vUV.y>0.5;\ntexCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);\ntexCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);\n#endif\n\nif (useCamB){\nfrag1=texture2D(textureSampler,texCoord1).rgb;\nfrag2=texture2D(textureSampler,texCoord2).rgb;\n}else{\nfrag1=texture2D(camASampler ,texCoord1).rgb;\nfrag2=texture2D(camASampler ,texCoord2).rgb;\n}\ngl_FragColor=vec4((frag1+frag2)/TWO,1.0);\n}",
text2dPixelShader:"varying vec4 vColor;\nvarying vec2 vUV;\n\nuniform sampler2D diffuseSampler;\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (color.a<0.05)\ndiscard;\ngl_FragColor=color*vColor;\n}",text2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\n\nattribute float index;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\natt vec2 topLeftUV;\natt vec2 sizeUV;\natt vec2 textureSize;\natt vec4 color;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n\nif (index == 0.0) {\npos2=vec2(0.0,0.0);\nvUV=vec2(topLeftUV.x,topLeftUV.y+sizeUV.y);\n}\n\nelse if (index == 1.0) {\npos2=vec2(0.0,1.0);\nvUV=vec2(topLeftUV.x,topLeftUV.y);\n}\n\nelse if (index == 2.0) {\npos2=vec2(1.0,1.0);\nvUV=vec2(topLeftUV.x+sizeUV.x,topLeftUV.y);\n}\n\nelse if (index == 3.0) {\npos2=vec2(1.0,0.0);\nvUV=vec2(topLeftUV.x+sizeUV.x,topLeftUV.y+sizeUV.y);\n}\n\nvUV=(floor(vUV*textureSize)+vec2(0.0,0.0))/textureSize;\nvColor=color;\nvec4 pos;\npos.xy=floor(pos2.xy*sizeUV*textureSize); \npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",
tonemapPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform float _ExposureAdjustment;\n#if defined(HABLE_TONEMAPPING)\nconst float A=0.15;\nconst float B=0.50;\nconst float C=0.10;\nconst float D=0.20;\nconst float E=0.02;\nconst float F=0.30;\nconst float W=11.2;\n#endif\nfloat Luminance(vec3 c)\n{\nreturn dot(c,vec3(0.22,0.707,0.071));\n}\nvoid main(void) \n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\n#if defined(REINHARD_TONEMAPPING)\nfloat lum=Luminance(colour.rgb); \nfloat lumTm=lum*_ExposureAdjustment;\nfloat scale=lumTm/(1.0+lumTm); \ncolour*=scale/lum;\n#elif defined(HABLE_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nconst float ExposureBias=2.0;\nvec3 x=ExposureBias*colour;\nvec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\nx=vec3(W,W,W);\nvec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);\ncolour=curr*whiteScale;\n#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\n#elif defined(PHOTOGRAPHIC_TONEMAPPING)\ncolour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);\n#endif\ngl_FragColor=vec4(colour.rgb,1.0);\n}",
volumetricLightScatteringPixelShader:"uniform sampler2D textureSampler;\nuniform sampler2D lightScatteringSampler;\nuniform float decay;\nuniform float exposure;\nuniform float weight;\nuniform float density;\nuniform vec2 meshPositionOnScreen;\nvarying vec2 vUV;\nvoid main(void) {\nvec2 tc=vUV;\nvec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);\ndeltaTexCoord*=1.0/float(NUM_SAMPLES)*density;\nfloat illuminationDecay=1.0;\nvec4 color=texture2D(lightScatteringSampler,tc)*0.4;\nfor(int i=0; i<NUM_SAMPLES; i++) {\ntc-=deltaTexCoord;\nvec4 sample=texture2D(lightScatteringSampler,tc)*0.4;\nsample*=illuminationDecay*weight;\ncolor+=sample;\nilluminationDecay*=decay;\n}\nvec4 realColor=texture2D(textureSampler,vUV);\ngl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));\n}\n",
volumetricLightScatteringPassPixelShader:"#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\n#endif\n#if defined(ALPHATEST)\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void)\n{\n#if defined(ALPHATEST)\nvec4 diffuseColor=texture2D(diffuseSampler,vUV);\nif (diffuseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\n}\n",vrDistortionCorrectionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 LensCenter;\nuniform vec2 Scale;\nuniform vec2 ScaleIn;\nuniform vec4 HmdWarpParam;\nvec2 HmdWarp(vec2 in01) {\nvec2 theta=(in01-LensCenter)*ScaleIn; \nfloat rSq=theta.x*theta.x+theta.y*theta.y;\nvec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);\nreturn LensCenter+Scale*rvector;\n}\nvoid main(void)\n{\nvec2 tc=HmdWarp(vUV);\nif (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nelse{\ngl_FragColor=vec4(texture2D(textureSampler,tc).rgb,1.0);\n}\n}"};
BABYLON.Effect.IncludesShadersStore={bonesDeclaration:"#if NUM_BONE_INFLUENCERS>0\nuniform mat4 mBones[BonesPerMesh];\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#endif",bonesVertex:"#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif \n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif \nfinalWorld=finalWorld*influence;\n#endif",
bumpFragment:"#ifdef BUMP\nvec2 bumpUV=vBumpUV;\n#endif\n#if defined(BUMP) || defined(PARALLAX)\nmat3 TBN=cotangent_frame(normalW*vBumpInfos.y,-viewDirectionW,bumpUV);\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nvec2 uvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,bumpUV,vBumpInfos.z);\n#else\nvec2 uvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\ndiffuseUV+=uvOffset;\nbumpUV+=uvOffset;\n#endif\n#ifdef BUMP\nnormalW=perturbNormal(viewDirectionW,TBN,bumpUV);\n#endif",
bumpFragmentFunctions:"#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform sampler2D bumpSampler;\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));\nreturn mat3(tangent*invmax,binormal*invmax,normal);\n}\nvec3 perturbNormal(vec3 viewDir,mat3 cotangentFrame,vec2 uv)\n{\nvec3 map=texture2D(bumpSampler,uv).xyz;\n#ifdef INVERTNORMALMAPX\nmap.x=1.0-map.x;\n#endif\n#ifdef INVERTNORMALMAPY\nmap.y=1.0-map.y;\n#endif\nmap=map*255./127.-128./127.;\nreturn normalize(cotangentFrame*map);\n}\n#ifdef PARALLAX\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\n\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\n\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;\n\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\n\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\n\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif\n#endif",
clipPlaneFragment:"#ifdef CLIPPLANE\nif (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif",clipPlaneFragmentDeclaration:"#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif",clipPlaneVertex:"#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif",clipPlaneVertexDeclaration:"#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif",colorCurves:"const vec3 HDTVRec709_RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);\nvec3 applyColorCurves(vec3 original) {\nvec3 result=original;\n\n\n\nfloat luma=dot(result.rgb,HDTVRec709_RGBLuminanceCoefficients);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0,0.0),vec2(1.0,1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma,luma,luma),result.rgb,colorCurve.a);\nreturn result;\n}",
colorCurvesDefinition:"uniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\nuniform vec4 vCameraColorCurveNegative;",colorGrading:"vec4 colorGrades(vec4 color) \n{ \n\nfloat sliceContinuous=color.z*vCameraColorGradingInfos.z;\nfloat sliceInteger=floor(sliceContinuous);\n\n\nfloat sliceFraction=sliceContinuous-sliceInteger; \n\nvec2 sliceUV=color.xy*vCameraColorGradingScaleOffset.xy+vCameraColorGradingScaleOffset.zw;\n\n\nsliceUV.x+=sliceInteger*vCameraColorGradingInfos.w;\nvec4 slice0Color=texture2D(cameraColorGrading2DSampler,sliceUV);\nsliceUV.x+=vCameraColorGradingInfos.w;\nvec4 slice1Color=texture2D(cameraColorGrading2DSampler,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\ncolor.rgb=mix(color.rgb,result,vCameraColorGradingInfos.x);\nreturn color;\n}",
colorGradingDefinition:"uniform sampler2D cameraColorGrading2DSampler;\nuniform vec4 vCameraColorGradingInfos;\nuniform vec4 vCameraColorGradingScaleOffset;",fogFragment:"#ifdef FOG\nfloat fog=CalcFogFactor();\ncolor.rgb=fog*color.rgb+(1.0-fog)*vFogColor;\n#endif",fogFragmentDeclaration:"#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying float fFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nif (FOGMODE_LINEAR == vFogInfos.x)\n{\nfogCoeff=(fogEnd-fFogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fFogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2 == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fFogDistance*fFogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif",
fogVertex:"#ifdef FOG\nfFogDistance=(view*worldPos).z;\n#endif",fogVertexDeclaration:"#ifdef FOG\nvarying float fFogDistance;\n#endif",fresnelFunction:"#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif",harmonicsFunctions:"#ifdef USESPHERICALFROMREFLECTIONMAP\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX;\nuniform vec3 vSphericalYY;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\nvec3 EnvironmentIrradiance(vec3 normal)\n{\n\n\n\nvec3 result =\nvSphericalX*normal.x +\nvSphericalY*normal.y +\nvSphericalZ*normal.z +\nvSphericalXX*normal.x*normal.x +\nvSphericalYY*normal.y*normal.y +\nvSphericalZZ*normal.z*normal.z +\nvSphericalYZ*normal.y*normal.z +\nvSphericalZX*normal.z*normal.x +\nvSphericalXY*normal.x*normal.y;\nreturn result.rgb;\n}\n#endif",
helperFunctions:"mat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}",instancesDeclaration:"#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif",instancesVertex:"#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#else\nmat4 finalWorld=world;\n#endif",
lightFragment:"#ifdef LIGHT{X}\n#ifndef SPECULARTERM\nvec3 vLightSpecular{X}=vec3(0.);\n#endif\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,vLightData{X},vLightDirection{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,glossiness);\n#endif\n#ifdef HEMILIGHT{X}\ninfo=computeHemisphericLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightGround{X},glossiness);\n#endif\n#if defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,glossiness);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWVSM{X}\nshadow=computeShadowWithVSM(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\n#ifdef SHADOWPCF{X}\n#if defined(POINTLIGHT{X})\nshadow=computeShadowWithPCFCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\nshadow=computeShadowWithPCF(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#endif\n#else\n#if defined(POINTLIGHT{X})\nshadow=computeShadowCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#else\nshadow=computeShadow(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#endif\n#endif\n#endif\n#else\nshadow=1.;\n#endif\ndiffuseBase+=info.diffuse*shadow;\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#endif",
lightFragmentDeclaration:"#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec3 vLightSpecular{X};\n#endif\n#ifdef SHADOW{X}\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nvarying vec4 vPositionFromLight{X};\nuniform sampler2D shadowSampler{X};\n#else\nuniform samplerCube shadowSampler{X};\n#endif\nuniform vec3 shadowsInfo{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\n#endif\n#ifdef HEMILIGHT{X}\nuniform vec3 vLightGround{X};\n#endif\n#endif",
lightsFragmentFunctions:"\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w == 0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\n\nfloat cosAngle=max(0.,dot(-lightDirection.xyz,lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\n\nfloat ndl=max(0.,dot(vNormal,-lightDirection.xyz));\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW-lightDirection.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\n\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\n",
logDepthDeclaration:"#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif",logDepthFragment:"#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif",logDepthVertex:"#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif",pbrFunctions:"\n#define RECIPROCAL_PI2 0.15915494\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n\nconst float kPi=3.1415926535897932384626433832795;\nconst float kRougnhessToAlphaScale=0.1;\nconst float kRougnhessToAlphaOffset=0.29248125;\nfloat Square(float value)\n{\nreturn value*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,vec3(0.2126,0.7152,0.0722)),0.,1.);\n}\nfloat convertRoughnessToAverageSlope(float roughness)\n{\n\nconst float kMinimumVariance=0.0005;\nfloat alphaG=Square(roughness)+kMinimumVariance;\nreturn alphaG;\n}\n\nfloat getMipMapIndexFromAverageSlope(float maxMipLevel,float alpha)\n{\n\n\n\n\n\n\n\nfloat mip=kRougnhessToAlphaOffset+maxMipLevel+(maxMipLevel*kRougnhessToAlphaScale*log2(alpha));\nreturn clamp(mip,0.,maxMipLevel);\n}\nfloat getMipMapIndexFromAverageSlopeWithPMREM(float maxMipLevel,float alphaG)\n{\nfloat specularPower=clamp(2./alphaG-2.,0.000001,2048.);\n\nreturn clamp(- 0.5*log2(specularPower)+5.5,0.,maxMipLevel);\n}\n\nfloat smithVisibilityG1_TrowbridgeReitzGGX(float dot,float alphaG)\n{\nfloat tanSquared=(1.0-dot*dot)/(dot*dot);\nreturn 2.0/(1.0+sqrt(1.0+alphaG*alphaG*tanSquared));\n}\nfloat smithVisibilityG_TrowbridgeReitzGGX_Walter(float NdotL,float NdotV,float alphaG)\n{\nreturn smithVisibilityG1_TrowbridgeReitzGGX(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGX(NdotV,alphaG);\n}\n\n\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\n\n\n\nfloat a2=Square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(kPi*d*d);\n}\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow(clamp(1.0-VdotH,0.,1.),5.0);\n}\nvec3 FresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow(clamp(1.0-VdotN,0.,1.),5.0);\n}\n\nvec3 computeSpecularTerm(float NdotH,float NdotL,float NdotV,float VdotH,float roughness,vec3 specularColor,vec3 reflectance90)\n{\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\nfloat visibility=smithVisibilityG_TrowbridgeReitzGGX_Walter(NdotL,NdotV,alphaG);\nvisibility/=(4.0*NdotL*NdotV); \nvec3 fresnel=fresnelSchlickGGX(VdotH,specularColor,reflectance90);\nfloat specTerm=max(0.,visibility*distribution)*NdotL;\nreturn fresnel*specTerm*kPi; \n}\nfloat computeDiffuseTerm(float NdotL,float NdotV,float VdotH,float roughness)\n{\n\n\nfloat diffuseFresnelNV=pow(clamp(1.0-NdotL,0.000001,1.),5.0);\nfloat diffuseFresnelNL=pow(clamp(1.0-NdotV,0.000001,1.),5.0);\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat diffuseFresnelTerm =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn diffuseFresnelTerm*NdotL;\n\n\n}\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\n\nfloat lightRoughness=lightRadius/lightDistance;\n\nfloat totalRoughness=clamp(lightRoughness+roughness,0.,1.);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nfloat kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn vec3(pow(color.r,2.2),pow(color.g,2.2),pow(color.b,2.2));\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn vec3(pow(color.r,1.0/2.2),pow(color.g,1.0/2.2),pow(color.b,1.0/2.2));\n}\n#ifdef CAMERATONEMAP\nvec3 toneMaps(vec3 color)\n{\ncolor=max(color,0.0);\n\ncolor.rgb=color.rgb*vCameraInfos.x;\nfloat tuning=1.5; \n\n\nvec3 tonemapped=1.0-exp2(-color.rgb*tuning); \ncolor.rgb=mix(color.rgb,tonemapped,1.0);\nreturn color;\n}\n#endif\n#ifdef CAMERACONTRAST\nvec4 contrasts(vec4 color)\n{\ncolor=clamp(color,0.0,1.0);\nvec3 resultHighContrast=color.rgb*color.rgb*(3.0-2.0*color.rgb);\nfloat contrast=vCameraInfos.y;\nif (contrast<1.0)\n{\n\ncolor.rgb=mix(vec3(0.5,0.5,0.5),color.rgb,contrast);\n}\nelse\n{\n\ncolor.rgb=mix(color.rgb,resultHighContrast,contrast-1.0);\n}\nreturn color;\n}\n#endif",
pbrLightFunctions:"\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n};\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range)\n{ \n#ifdef USEPHYSICALLIGHTFALLOFF\nfloat lightDistanceFalloff=1.0/((lightDistanceSquared+0.0001));\n#else\nfloat lightDistanceFalloff=max(0.,1.0-length(lightOffset)/range);\n#endif\nreturn lightDistanceFalloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngle,float exponent)\n{\nfloat falloff=0.0;\n#ifdef USEPHYSICALLIGHTFALLOFF\nfloat cosHalfAngle=cos(lightAngle*0.5);\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977; \n\n\n\n\n\nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\n\n\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfalloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\n#else\nfloat cosAngle=max(0.000000000000001,dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=lightAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\n#endif\nreturn falloff;\n}\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float rangeRadius,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\nvec3 lightDirection;\nfloat attenuation=1.0;\nfloat lightDistance;\n\nif (lightData.w == 0.)\n{\nvec3 lightOffset=lightData.xyz-vPositionW;\nfloat lightDistanceSquared=dot(lightOffset,lightOffset);\nattenuation=computeDistanceLightFalloff(lightOffset,lightDistanceSquared,rangeRadius);\nlightDistance=sqrt(lightDistanceSquared);\nlightDirection=normalize(lightOffset);\n}\n\nelse\n{\nlightDistance=length(-lightData.xyz);\nlightDirection=normalize(-lightData.xyz);\n}\n\nroughness=adjustRoughnessFromLightProperties(roughness,rangeRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+lightDirection);\nNdotL=max(0.00000000001,dot(vNormal,lightDirection));\nfloat VdotH=clamp(0.00000000001,1.0,dot(viewDirectionW,H));\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float rangeRadius,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\nvec3 lightOffset=lightData.xyz-vPositionW;\nvec3 directionToLightCenterW=normalize(lightOffset);\n\nfloat lightDistanceSquared=dot(lightOffset,lightOffset);\nfloat attenuation=computeDistanceLightFalloff(lightOffset,lightDistanceSquared,rangeRadius);\n\nfloat directionalAttenuation=computeDirectionalLightFalloff(lightDirection.xyz,directionToLightCenterW,lightDirection.w,lightData.w);\nattenuation*=directionalAttenuation;\n\nfloat lightDistance=sqrt(lightDistanceSquared);\nroughness=adjustRoughnessFromLightProperties(roughness,rangeRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW-lightDirection.xyz);\nNdotL=max(0.00000000001,dot(vNormal,-lightDirection.xyz));\nfloat VdotH=clamp(dot(viewDirectionW,H),0.00000000001,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\n\n\n\nNdotL=dot(vNormal,lightData.xyz)*0.5+0.5;\nresult.diffuse=mix(groundColor,diffuseColor,NdotL);\n#ifdef SPECULARTERM\n\nvec3 lightVectorW=normalize(lightData.xyz);\nvec3 H=normalize(viewDirectionW+lightVectorW);\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nNdotL=max(0.00000000001,NdotL);\nfloat VdotH=clamp(0.00000000001,1.0,dot(viewDirectionW,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm;\n#endif\nreturn result;\n}",
pbrLightFunctionsCall:"#ifdef LIGHT{X}\n#ifndef SPECULARTERM\nvec3 vLightSpecular{X}=vec3(0.0);\n#endif\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,vLightData{X},vLightDirection{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#ifdef HEMILIGHT{X}\ninfo=computeHemisphericLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightGround{X},roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#if defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWVSM{X}\nnotShadowLevel=computeShadowWithVSM(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\n#ifdef SHADOWPCF{X}\n#if defined(POINTLIGHT{X})\nnotShadowLevel=computeShadowWithPCFCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\nnotShadowLevel=computeShadowWithPCF(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#endif\n#else\n#if defined(POINTLIGHT{X})\nnotShadowLevel=computeShadowCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#else\nnotShadowLevel=computeShadow(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#endif\n#endif\n#endif\n#else\nnotShadowLevel=1.;\n#endif\nlightDiffuseContribution+=info.diffuse*notShadowLevel;\n#ifdef OVERLOADEDSHADOWVALUES\nif (NdotL<0.000000000011)\n{\nnotShadowLevel=1.;\n}\nshadowedOnlyLightDiffuseContribution*=notShadowLevel;\n#endif\n#ifdef SPECULARTERM\nlightSpecularContribution+=info.specular*notShadowLevel;\n#endif\n#endif",
pbrShadowFunctions:"\n#ifdef SHADOWS\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\nuniform vec2 depthValues;\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float bias)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y =-directionToLight.y;\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight))+bias;\nif (depth>shadow)\n{\n#ifdef OVERLOADEDSHADOWVALUES\nreturn mix(1.0,darkness,vOverloadedShadowIntensity.x);\n#else\nreturn darkness;\n#endif\n}\nreturn 1.0;\n}\nfloat computeShadowWithPCFCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\nfloat biasedDepth=depth-bias;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,visibility+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,visibility+darkness);\n#endif\n}\nfloat computeShadow(vec4 vPositionFromLight,sampler2D shadowSampler,float darkness,float bias)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadow=unpack(texture2D(shadowSampler,uv))+bias;\nif (depth.z>shadow)\n{\n#ifdef OVERLOADEDSHADOWVALUES\nreturn mix(1.0,darkness,vOverloadedShadowIntensity.x);\n#else\nreturn darkness;\n#endif\n}\nreturn 1.;\n}\nfloat computeShadowWithPCF(vec4 vPositionFromLight,sampler2D shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\nfloat biasedDepth=depth.z-bias;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,visibility+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,visibility+darkness);\n#endif\n}\n\nfloat unpackHalf(vec2 color)\n{\nreturn color.x+(color.y/255.0);\n}\nfloat linstep(float low,float high,float v) {\nreturn clamp((v-low)/(high-low),0.0,1.0);\n}\nfloat ChebychevInequality(vec2 moments,float compare,float bias)\n{\nfloat p=smoothstep(compare-bias,compare,moments.x);\nfloat variance=max(moments.y-moments.x*moments.x,0.02);\nfloat d=compare-moments.x;\nfloat p_max=linstep(0.2,1.0,variance/(variance+d*d));\nreturn clamp(max(p,p_max),0.0,1.0);\n}\nfloat computeShadowWithVSM(vec4 vPositionFromLight,sampler2D shadowSampler,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0 || depth.z>=1.0)\n{\nreturn 1.0;\n}\nvec4 texel=texture2D(shadowSampler,uv);\nvec2 moments=vec2(unpackHalf(texel.xy),unpackHalf(texel.zw));\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness);\n#endif\n}\n#endif",
pointCloudVertex:"#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif",pointCloudVertexDeclaration:"#ifdef POINTSIZE\nuniform float pointSize;\n#endif",reflectionFunction:"vec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nfloat t=clamp(direction.y*-0.5+0.5,0.,1.0);\nfloat s=atan(direction.z,direction.x)*RECIPROCAL_PI2+0.5;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nvec3 cameraToVertex=normalize(worldPos.xyz-vEyePosition);\nvec3 r=reflect(cameraToVertex,worldNormal);\nfloat t=clamp(r.y*-0.5+0.5,0.,1.0);\nfloat s=atan(r.z,r.x)*RECIPROCAL_PI2+0.5;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef INVERTCUBICMAP\ncoords.y=1.0-coords.y;\n#endif\nreturn vec3(reflectionMatrix*vec4(coords,0));\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}",
shadowsFragmentFunctions:"#ifdef SHADOWS\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\nuniform vec2 depthValues;\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float bias)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight))+bias;\nif (depth>shadow)\n{\nreturn darkness;\n}\nreturn 1.0;\n}\nfloat computeShadowWithPCFCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\nfloat biasedDepth=depth-bias;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\nreturn min(1.0,visibility+darkness);\n}\nfloat computeShadow(vec4 vPositionFromLight,sampler2D shadowSampler,float darkness,float bias)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadow=unpack(texture2D(shadowSampler,uv))+bias;\nif (depth.z>shadow)\n{\nreturn darkness;\n}\nreturn 1.;\n}\nfloat computeShadowWithPCF(vec4 vPositionFromLight,sampler2D shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\nfloat biasedDepth=depth.z-bias;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\nreturn min(1.0,visibility+darkness);\n}\n\nfloat unpackHalf(vec2 color)\n{\nreturn color.x+(color.y/255.0);\n}\nfloat linstep(float low,float high,float v) {\nreturn clamp((v-low)/(high-low),0.0,1.0);\n}\nfloat ChebychevInequality(vec2 moments,float compare,float bias)\n{\nfloat p=smoothstep(compare-bias,compare,moments.x);\nfloat variance=max(moments.y-moments.x*moments.x,0.02);\nfloat d=compare-moments.x;\nfloat p_max=linstep(0.2,1.0,variance/(variance+d*d));\nreturn clamp(max(p,p_max),0.0,1.0);\n}\nfloat computeShadowWithVSM(vec4 vPositionFromLight,sampler2D shadowSampler,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0 || depth.z>=1.0)\n{\nreturn 1.0;\n}\nvec4 texel=texture2D(shadowSampler,uv);\nvec2 moments=vec2(unpackHalf(texel.xy),unpackHalf(texel.zw));\nreturn min(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness);\n}\n#endif",
shadowsVertex:"#ifdef SHADOWS\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\n#endif\n#endif",shadowsVertexDeclaration:"#ifdef SHADOWS\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nuniform mat4 lightMatrix{X};\nvarying vec4 vPositionFromLight{X};\n#endif\n#endif\n"};BABYLON.CollisionWorker='var BABYLON;!function(t){var e=function(t,e,o,i){return t.x>o.x+i?!1:o.x-i>e.x?!1:t.y>o.y+i?!1:o.y-i>e.y?!1:t.z>o.z+i?!1:!(o.z-i>e.z)},o=function(t,e,o,i){var s=e*e-4*t*o,r={root:0,found:!1};if(0>s)return r;var n=Math.sqrt(s),c=(-e-n)/(2*t),h=(-e+n)/(2*t);if(c>h){var a=h;h=c,c=a}return c>0&&i>c?(r.root=c,r.found=!0,r):h>0&&i>h?(r.root=h,r.found=!0,r):r},i=function(){function i(){this.radius=new t.Vector3(1,1,1),this.retry=0,this.basePointWorld=t.Vector3.Zero(),this.velocityWorld=t.Vector3.Zero(),this.normalizedVelocity=t.Vector3.Zero(),this._collisionPoint=t.Vector3.Zero(),this._planeIntersectionPoint=t.Vector3.Zero(),this._tempVector=t.Vector3.Zero(),this._tempVector2=t.Vector3.Zero(),this._tempVector3=t.Vector3.Zero(),this._tempVector4=t.Vector3.Zero(),this._edge=t.Vector3.Zero(),this._baseToVertex=t.Vector3.Zero(),this._destinationPoint=t.Vector3.Zero(),this._slidePlaneNormal=t.Vector3.Zero(),this._displacementVector=t.Vector3.Zero()}return i.prototype._initialize=function(e,o,i){this.velocity=o,t.Vector3.NormalizeToRef(o,this.normalizedVelocity),this.basePoint=e,e.multiplyToRef(this.radius,this.basePointWorld),o.multiplyToRef(this.radius,this.velocityWorld),this.velocityWorldLength=this.velocityWorld.length(),this.epsilon=i,this.collisionFound=!1},i.prototype._checkPointInTriangle=function(e,o,i,s,r){o.subtractToRef(e,this._tempVector),i.subtractToRef(e,this._tempVector2),t.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var n=t.Vector3.Dot(this._tempVector4,r);return 0>n?!1:(s.subtractToRef(e,this._tempVector3),t.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),0>n?!1:(t.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),n>=0))},i.prototype._canDoCollision=function(o,i,s,r){var n=t.Vector3.Distance(this.basePointWorld,o),c=Math.max(this.radius.x,this.radius.y,this.radius.z);return n>this.velocityWorldLength+c+i?!1:!!e(s,r,this.basePointWorld,this.velocityWorldLength+c)},i.prototype._testTriangle=function(e,i,s,r,n,c){var h,a=!1;i||(i=[]),i[e]||(i[e]=new t.Plane(0,0,0,0),i[e].copyFromPoints(s,r,n));var l=i[e];if(c||l.isFrontFacingTo(this.normalizedVelocity,0)){var _=l.signedDistanceTo(this.basePoint),d=t.Vector3.Dot(l.normal,this.velocity);if(0==d){if(Math.abs(_)>=1)return;a=!0,h=0}else{h=(-1-_)/d;var V=(1-_)/d;if(h>V){var u=V;V=h,h=u}if(h>1||0>V)return;0>h&&(h=0),h>1&&(h=1)}this._collisionPoint.copyFromFloats(0,0,0);var P=!1,p=1;if(a||(this.basePoint.subtractToRef(l.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(h,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,s,r,n,l.normal)&&(P=!0,p=h,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!P){var m=this.velocity.lengthSquared(),f=m;this.basePoint.subtractToRef(s,this._tempVector);var T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p);y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(s)),this.basePoint.subtractToRef(r,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(r)),this.basePoint.subtractToRef(n,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(n)),r.subtractToRef(s,this._edge),s.subtractToRef(this.basePoint,this._baseToVertex);var g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex);if(f=g*-m+v*v,T=g*(2*t.Vector3.Dot(this.velocity,this._baseToVertex))-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found){var D=(v*y.root-R)/g;D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),s.addToRef(this._edge,this._collisionPoint))}n.subtractToRef(r,this._edge),r.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=g*(2*t.Vector3.Dot(this.velocity,this._baseToVertex))-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),r.addToRef(this._edge,this._collisionPoint))),s.subtractToRef(n,this._edge),n.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=g*(2*t.Vector3.Dot(this.velocity,this._baseToVertex))-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),n.addToRef(this._edge,this._collisionPoint)))}if(P){var x=p*this.velocity.length();(!this.collisionFound||x<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=x,this.collisionFound=!0)}}},i.prototype._collide=function(t,e,o,i,s,r,n){for(var c=i;s>c;c+=3){var h=e[o[c]-r],a=e[o[c+1]-r],l=e[o[c+2]-r];this._testTriangle(c,t,l,a,h,n)}},i.prototype._getResponse=function(e,o){e.addToRef(o,this._destinationPoint),o.scaleInPlace(this.nearestDistance/o.length()),this.basePoint.addToRef(o,e),e.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector),e.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(t.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,o)},i}();t.Collider=i}(BABYLON||(BABYLON={}));var BABYLON;!function(o){o.WorkerIncluded=!0;var e=function(){function o(){this._meshes={},this._geometries={}}return o.prototype.getMeshes=function(){return this._meshes},o.prototype.getGeometries=function(){return this._geometries},o.prototype.getMesh=function(o){return this._meshes[o]},o.prototype.addMesh=function(o){this._meshes[o.uniqueId]=o},o.prototype.removeMesh=function(o){delete this._meshes[o]},o.prototype.getGeometry=function(o){return this._geometries[o]},o.prototype.addGeometry=function(o){this._geometries[o.id]=o},o.prototype.removeGeometry=function(o){delete this._geometries[o]},o}();o.CollisionCache=e;var i=function(){function e(e,i,r){this.collider=e,this._collisionCache=i,this.finalPosition=r,this.collisionsScalingMatrix=o.Matrix.Zero(),this.collisionTranformationMatrix=o.Matrix.Zero()}return e.prototype.collideWithWorld=function(o,e,i,r){var t=.01;if(this.collider.retry>=i)return void this.finalPosition.copyFrom(o);this.collider._initialize(o,e,t);for(var s,l=this._collisionCache.getMeshes(),n=Object.keys(l),a=n.length,c=0;a>c;++c)if(s=n[c],parseInt(s)!=r){var d=l[s];d.checkCollisions&&this.checkCollision(d)}return this.collider.collisionFound?(0===e.x&&0===e.y&&0===e.z||this.collider._getResponse(o,e),e.length()<=t?void this.finalPosition.copyFrom(o):(this.collider.retry++,void this.collideWithWorld(o,e,i,r))):void o.addToRef(e,this.finalPosition)},e.prototype.checkCollision=function(e){if(this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))){o.Matrix.ScalingToRef(1/this.collider.radius.x,1/this.collider.radius.y,1/this.collider.radius.z,this.collisionsScalingMatrix);var i=o.Matrix.FromArray(e.worldMatrixFromCache);i.multiplyToRef(this.collisionsScalingMatrix,this.collisionTranformationMatrix),this.processCollisionsForSubMeshes(this.collisionTranformationMatrix,e)}},e.prototype.processCollisionsForSubMeshes=function(o,e){var i=e.subMeshes,r=i.length;if(!e.geometryId)return void console.log("no mesh geometry id");var t=this._collisionCache.getGeometry(e.geometryId);if(!t)return void console.log("couldn\'t find geometry",e.geometryId);for(var s=0;r>s;s++){var l=i[s];r>1&&!this.checkSubmeshCollision(l)||(this.collideForSubMesh(l,o,t),this.collider.collisionFound&&(this.collider.collidedMesh=e.uniqueId))}},e.prototype.collideForSubMesh=function(e,i,r){if(!r.positionsArray){r.positionsArray=[];for(var t=0,s=r.positions.length;s>t;t+=3){var l=o.Vector3.FromArray([r.positions[t],r.positions[t+1],r.positions[t+2]]);r.positionsArray.push(l)}}if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(i)){e._lastColliderTransformMatrix=i.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var n=e.verticesStart,a=e.verticesStart+e.verticesCount,t=n;a>t;t++)e._lastColliderWorldVertices.push(o.Vector3.TransformCoordinates(r.positionsArray[t],i))}this.collider._collide(e._trianglePlanes,e._lastColliderWorldVertices,r.indices,e.indexStart,e.indexStart+e.indexCount,e.verticesStart,e.hasMaterial)},e.prototype.checkSubmeshCollision=function(e){return this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))},e}();o.CollideWorker=i;var r=function(){function r(){}return r.prototype.onInit=function(i){this._collisionCache=new e;var r={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.INIT};postMessage(r,void 0)},r.prototype.onUpdate=function(e){var i=this,r={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.UPDATE};try{for(var t in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(t)&&this._collisionCache.addGeometry(e.updatedGeometries[t]);for(var s in e.updatedMeshes)e.updatedMeshes.hasOwnProperty(s)&&this._collisionCache.addMesh(e.updatedMeshes[s]);e.removedGeometries.forEach(function(o){i._collisionCache.removeGeometry(o)}),e.removedMeshes.forEach(function(o){i._collisionCache.removeMesh(o)})}catch(l){r.error=o.WorkerReplyType.UNKNOWN_ERROR}postMessage(r,void 0)},r.prototype.onCollision=function(e){var r=o.Vector3.Zero(),t=new o.Collider;t.radius=o.Vector3.FromArray(e.collider.radius);var s=new i(t,this._collisionCache,r);s.collideWithWorld(o.Vector3.FromArray(e.collider.position),o.Vector3.FromArray(e.collider.velocity),e.maximumRetry,e.excludedMeshUniqueId);var l={collidedMeshUniqueId:t.collidedMesh,collisionId:e.collisionId,newPosition:r.asArray()},n={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.COLLIDE,payload:l};postMessage(n,void 0)},r}();o.CollisionDetectorTransferable=r;try{if(self&&self instanceof WorkerGlobalScope){window={},o.Collider||(importScripts("./babylon.collisionCoordinator.js"),importScripts("./babylon.collider.js"),importScripts("../Math/babylon.math.js"));var t=new r,s=function(e){var i=e.data;switch(i.taskType){case o.WorkerTaskType.INIT:t.onInit(i.payload);break;case o.WorkerTaskType.COLLIDE:t.onCollision(i.payload);break;case o.WorkerTaskType.UPDATE:t.onUpdate(i.payload)}};self.onmessage=s}}catch(l){console.log("single worker init")}}(BABYLON||(BABYLON={}));var BABYLON;!function(e){e.CollisionWorker="",function(e){e[e.INIT=0]="INIT",e[e.UPDATE=1]="UPDATE",e[e.COLLIDE=2]="COLLIDE"}(e.WorkerTaskType||(e.WorkerTaskType={}));var o=e.WorkerTaskType;!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.UNKNOWN_ERROR=1]="UNKNOWN_ERROR"}(e.WorkerReplyType||(e.WorkerReplyType={}));var i=e.WorkerReplyType,t=function(){function t(){var r=this;this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this.onMeshUpdated=function(e){r._addUpdateMeshesList[e.uniqueId]=t.SerializeMesh(e)},this.onGeometryUpdated=function(e){r._addUpdateGeometriesList[e.id]=t.SerializeGeometry(e)},this._afterRender=function(){if(r._init&&!(0==r._toRemoveGeometryArray.length&&0==r._toRemoveMeshesArray.length&&0==Object.keys(r._addUpdateGeometriesList).length&&0==Object.keys(r._addUpdateMeshesList).length||r._runningUpdated>4)){++r._runningUpdated;var e={updatedMeshes:r._addUpdateMeshesList,updatedGeometries:r._addUpdateGeometriesList,removedGeometries:r._toRemoveGeometryArray,removedMeshes:r._toRemoveMeshesArray},i={payload:e,taskType:o.UPDATE},t=[];for(var s in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(s)&&(t.push(i.payload.updatedGeometries[s].indices.buffer),t.push(i.payload.updatedGeometries[s].normals.buffer),t.push(i.payload.updatedGeometries[s].positions.buffer));r._worker.postMessage(i,t),r._addUpdateMeshesList={},r._addUpdateGeometriesList={},r._toRemoveGeometryArray=[],r._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(t){var s=t.data;if(s.error!=i.SUCCESS)return void e.Tools.Warn("error returned from worker!");switch(s.taskType){case o.INIT:r._init=!0,r._scene.meshes.forEach(function(e){r.onMeshAdded(e)}),r._scene.getGeometries().forEach(function(e){r.onGeometryAdded(e)});break;case o.UPDATE:r._runningUpdated--;break;case o.COLLIDE:r._runningCollisionTask=!1;var n=s.payload;if(!r._collisionsCallbackArray[n.collisionId])return;r._collisionsCallbackArray[n.collisionId](n.collisionId,e.Vector3.FromArray(n.newPosition),r._scene.getMeshByUniqueID(n.collidedMeshUniqueId)),r._collisionsCallbackArray[n.collisionId]=void 0}},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._runningCollisionTask=!1,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return t.prototype.getNewPosition=function(e,i,t,r,s,n,a){if(this._init&&!this._collisionsCallbackArray[a]&&!this._collisionsCallbackArray[a+1e5]){e.divideToRef(t.radius,this._scaledPosition),i.divideToRef(t.radius,this._scaledVelocity),this._collisionsCallbackArray[a]=n;var d={collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:t.radius.asArray()},collisionId:a,excludedMeshUniqueId:s?s.uniqueId:null,maximumRetry:r},l={payload:d,taskType:o.COLLIDE};this._worker.postMessage(l)}},t.prototype.init=function(i){this._scene=i,this._scene.registerAfterRender(this._afterRender);var t=e.WorkerIncluded?e.Engine.CodeRepository+"Collisions/babylon.collisionWorker.js":URL.createObjectURL(new Blob([e.CollisionWorker],{type:"application/javascript"}));this._worker=new Worker(t),this._worker.onmessage=this._onMessageFromWorker;var r={payload:{},taskType:o.INIT};this._worker.postMessage(r)},t.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},t.prototype.onMeshAdded=function(e){e.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(e)},t.prototype.onMeshRemoved=function(e){this._toRemoveMeshesArray.push(e.uniqueId)},t.prototype.onGeometryAdded=function(e){e.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(e)},t.prototype.onGeometryDeleted=function(e){this._toRemoveGeometryArray.push(e.id)},t.SerializeMesh=function(o){var i=[];o.subMeshes&&(i=o.subMeshes.map(function(e,o){return{position:o,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount,hasMaterial:!!e.getMaterial(),sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray()}}));var t=null;return o instanceof e.Mesh?t=o.geometry?o.geometry.id:null:o instanceof e.InstancedMesh&&(t=o.sourceMesh&&o.sourceMesh.geometry?o.sourceMesh.geometry.id:null),{uniqueId:o.uniqueId,id:o.id,name:o.name,geometryId:t,sphereCenter:o.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:o.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:o.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:o.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:o.worldMatrixFromCache.asArray(),subMeshes:i,checkCollisions:o.checkCollisions}},t.SerializeGeometry=function(o){return{id:o.id,positions:new Float32Array(o.getVerticesData(e.VertexBuffer.PositionKind)||[]),normals:new Float32Array(o.getVerticesData(e.VertexBuffer.NormalKind)||[]),indices:new Int32Array(o.getIndices()||[])}},t}();e.CollisionCoordinatorWorker=t;var r=function(){function o(){this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this._finalPosition=e.Vector3.Zero()}return o.prototype.getNewPosition=function(e,o,i,t,r,s,n){e.divideToRef(i.radius,this._scaledPosition),o.divideToRef(i.radius,this._scaledVelocity),i.collidedMesh=null,i.retry=0,i.initialVelocity=this._scaledVelocity,i.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,t,this._finalPosition,r),this._finalPosition.multiplyInPlace(i.radius),s(n,this._finalPosition,i.collidedMesh)},o.prototype.init=function(e){this._scene=e},o.prototype.destroy=function(){},o.prototype.onMeshAdded=function(e){},o.prototype.onMeshUpdated=function(e){},o.prototype.onMeshRemoved=function(e){},o.prototype.onGeometryAdded=function(e){},o.prototype.onGeometryUpdated=function(e){},o.prototype.onGeometryDeleted=function(e){},o.prototype._collideWithWorld=function(o,i,t,r,s,n){void 0===n&&(n=null);var a=10*e.Engine.CollisionsEpsilon;if(t.retry>=r)return void s.copyFrom(o);t._initialize(o,i,a);for(var d=0;d<this._scene.meshes.length;d++){var l=this._scene.meshes[d];l.isEnabled()&&l.checkCollisions&&l.subMeshes&&l!==n&&l._checkCollision(t)}return t.collisionFound?(0===i.x&&0===i.y&&0===i.z||t._getResponse(o,i),i.length()<=a?void s.copyFrom(o):(t.retry++,void this._collideWithWorld(o,i,t,r,s,n))):void o.addToRef(i,s)},o}();e.CollisionCoordinatorLegacy=r}(BABYLON||(BABYLON={}));var BABYLON;!function(t){t.ToGammaSpace=1/2.2,t.ToLinearSpace=2.2,t.Epsilon=.001;var i=function(){function t(){}return t.WithinEpsilon=function(t,i,n){void 0===n&&(n=1.401298e-45);var r=t-i;return r>=-n&&n>=r},t.ToHex=function(t){var i=t.toString(16);return 15>=t?("0"+i).toUpperCase():i.toUpperCase()},t.Sign=function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1},t.Clamp=function(t,i,n){return void 0===i&&(i=0),void 0===n&&(n=1),Math.min(n,Math.max(i,t))},t}();t.MathTools=i;var n=function(){function n(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this.r=t,this.g=i,this.b=n}return n.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},n.prototype.getClassName=function(){return"Color3"},n.prototype.getHashCode=function(){var t=this.r||0;return t=397*t^(this.g||0),t=397*t^(this.b||0)},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,this},n.prototype.toColor4=function(t){return void 0===t&&(t=1),new r(this.r,this.g,this.b,t)},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},n.prototype.multiply=function(t){return new n(this.r*t.r,this.g*t.g,this.b*t.b)},n.prototype.multiplyToRef=function(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,this},n.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},n.prototype.equalsFloats=function(t,i,n){return this.r===t&&this.g===i&&this.b===n},n.prototype.scale=function(t){return new n(this.r*t,this.g*t,this.b*t)},n.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,this},n.prototype.add=function(t){return new n(this.r+t.r,this.g+t.g,this.b+t.b)},n.prototype.addToRef=function(t,i){return i.r=this.r+t.r,i.g=this.g+t.g,i.b=this.b+t.b,this},n.prototype.subtract=function(t){return new n(this.r-t.r,this.g-t.g,this.b-t.b)},n.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,this},n.prototype.clone=function(){return new n(this.r,this.g,this.b)},n.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},n.prototype.copyFromFloats=function(t,i,n){return this.r=t,this.g=i,this.b=n,this},n.prototype.toHexString=function(){var t=255*this.r|0,n=255*this.g|0,r=255*this.b|0;return"#"+i.ToHex(t)+i.ToHex(n)+i.ToHex(r)},n.prototype.toLinearSpace=function(){var t=new n;return this.toLinearSpaceToRef(t),t},n.prototype.toLinearSpaceToRef=function(i){return i.r=Math.pow(this.r,t.ToLinearSpace),i.g=Math.pow(this.g,t.ToLinearSpace),i.b=Math.pow(this.b,t.ToLinearSpace),this},n.prototype.toGammaSpace=function(){var t=new n;return this.toGammaSpaceToRef(t),t},n.prototype.toGammaSpaceToRef=function(i){return i.r=Math.pow(this.r,t.ToGammaSpace),i.g=Math.pow(this.g,t.ToGammaSpace),i.b=Math.pow(this.b,t.ToGammaSpace),this},n.FromHexString=function(t){if("#"!==t.substring(0,1)||7!==t.length)return new n(0,0,0);var i=parseInt(t.substring(1,3),16),r=parseInt(t.substring(3,5),16),o=parseInt(t.substring(5,7),16);return n.FromInts(i,r,o)},n.FromArray=function(t,i){return void 0===i&&(i=0),new n(t[i],t[i+1],t[i+2])},n.FromInts=function(t,i,r){return new n(t/255,i/255,r/255)},n.Lerp=function(t,i,r){var o=t.r+(i.r-t.r)*r,s=t.g+(i.g-t.g)*r,e=t.b+(i.b-t.b)*r;return new n(o,s,e)},n.Red=function(){return new n(1,0,0)},n.Green=function(){return new n(0,1,0)},n.Blue=function(){return new n(0,0,1)},n.Black=function(){return new n(0,0,0)},n.White=function(){return new n(1,1,1)},n.Purple=function(){return new n(.5,0,.5)},n.Magenta=function(){return new n(1,0,1)},n.Yellow=function(){return new n(1,1,0)},n.Gray=function(){return new n(.5,.5,.5)},n}();t.Color3=n;var r=function(){function t(t,i,n,r){this.r=t,this.g=i,this.b=n,this.a=r}return t.prototype.addInPlace=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},t.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t[i+3]=this.a,this},t.prototype.add=function(i){return new t(this.r+i.r,this.g+i.g,this.b+i.b,this.a+i.a)},t.prototype.subtract=function(i){return new t(this.r-i.r,this.g-i.g,this.b-i.b,this.a-i.a)},t.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,i.a=this.a-t.a,this},t.prototype.scale=function(i){return new t(this.r*i,this.g*i,this.b*i,this.a*i)},t.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,i.a=this.a*t,this},t.prototype.multiply=function(i){return new t(this.r*i.r,this.g*i.g,this.b*i.b,this.a*i.a)},t.prototype.multiplyToRef=function(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,i.a=this.a*t.a,i},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},t.prototype.getClassName=function(){return"Color4"},t.prototype.getHashCode=function(){var t=this.r||0;return t=397*t^(this.g||0),t=397*t^(this.b||0),t=397*t^(this.a||0)},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.toHexString=function(){var t=255*this.r|0,n=255*this.g|0,r=255*this.b|0,o=255*this.a|0;return"#"+i.ToHex(t)+i.ToHex(n)+i.ToHex(r)+i.ToHex(o)},t.FromHexString=function(i){if("#"!==i.substring(0,1)||9!==i.length)return new t(0,0,0,0);var n=parseInt(i.substring(1,3),16),r=parseInt(i.substring(3,5),16),o=parseInt(i.substring(5,7),16),s=parseInt(i.substring(7,9),16);return t.FromInts(n,r,o,s)},t.Lerp=function(i,n,r){var o=new t(0,0,0,0);return t.LerpToRef(i,n,r,o),o},t.LerpToRef=function(t,i,n,r){r.r=t.r+(i.r-t.r)*n,r.g=t.g+(i.g-t.g)*n,r.b=t.b+(i.b-t.b)*n,r.a=t.a+(i.a-t.a)*n},t.FromArray=function(i,n){return void 0===n&&(n=0),new t(i[n],i[n+1],i[n+2],i[n+3])},t.FromInts=function(i,n,r,o){return new t(i/255,n/255,r/255,o/255)},t.CheckColors4=function(t,i){if(t.length===3*i){for(var n=[],r=0;r<t.length;r+=3){var o=r/3*4;n[o]=t[r],n[o+1]=t[r+1],n[o+2]=t[r+2],n[o+3]=1}return n}return t},t}();t.Color4=r;var o=function(){function n(t,i){this.x=t,this.y=i}return n.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},n.prototype.getClassName=function(){return"Vector2"},n.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0)},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,this},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},n.prototype.copyFromFloats=function(t,i){return this.x=t,this.y=i,this},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,this},n.prototype.addVector3=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y)},n.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,this},n.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this},n.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this},n.prototype.multiply=function(t){return new n(this.x*t.x,this.y*t.y)},n.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,this},n.prototype.multiplyByFloats=function(t,i){return new n(this.x*t,this.y*i)},n.prototype.divide=function(t){return new n(this.x/t.x,this.y/t.y)},n.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,this},n.prototype.negate=function(){return new n(-this.x,-this.y)},n.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this},n.prototype.scale=function(t){return new n(this.x*t,this.y*t)},n.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y},n.prototype.equalsWithEpsilon=function(n,r){return void 0===r&&(r=t.Epsilon),n&&i.WithinEpsilon(this.x,n.x,r)&&i.WithinEpsilon(this.y,n.y,r)},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},n.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this},n.prototype.clone=function(){return new n(this.x,this.y)},n.Zero=function(){return new n(0,0)},n.FromArray=function(t,i){return void 0===i&&(i=0),new n(t[i],t[i+1])},n.FromArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1]},n.CatmullRom=function(t,i,r,o,s){var e=s*s,h=s*e,a=.5*(2*i.x+(-t.x+r.x)*s+(2*t.x-5*i.x+4*r.x-o.x)*e+(-t.x+3*i.x-3*r.x+o.x)*h),u=.5*(2*i.y+(-t.y+r.y)*s+(2*t.y-5*i.y+4*r.y-o.y)*e+(-t.y+3*i.y-3*r.y+o.y)*h);return new n(a,u)},n.Clamp=function(t,i,r){var o=t.x;o=o>r.x?r.x:o,o=o<i.x?i.x:o;var s=t.y;return s=s>r.y?r.y:s,s=s<i.y?i.y:s,new n(o,s)},n.Hermite=function(t,i,r,o,s){var e=s*s,h=s*e,a=2*h-3*e+1,u=-2*h+3*e,m=h-2*e+s,y=h-e,c=t.x*a+r.x*u+i.x*m+o.x*y,p=t.y*a+r.y*u+i.y*m+o.y*y;return new n(c,p)},n.Lerp=function(t,i,r){var o=t.x+(i.x-t.x)*r,s=t.y+(i.y-t.y)*r;return new n(o,s)},n.Dot=function(t,i){return t.x*i.x+t.y*i.y},n.Normalize=function(t){var i=t.clone();return i.normalize(),i},n.Minimize=function(t,i){var r=t.x<i.x?t.x:i.x,o=t.y<i.y?t.y:i.y;return new n(r,o)},n.Maximize=function(t,i){var r=t.x>i.x?t.x:i.x,o=t.y>i.y?t.y:i.y;return new n(r,o)},n.Transform=function(t,i){var r=n.Zero();return n.TransformToRef(t,i,r),r},n.TransformToRef=function(t,i,n){var r=t.x*i.m[0]+t.y*i.m[4]+i.m[12],o=t.x*i.m[1]+t.y*i.m[5]+i.m[13];n.x=r,n.y=o},n.PointInTriangle=function(t,i,n,r){var o=.5*(-n.y*r.x+i.y*(-n.x+r.x)+i.x*(n.y-r.y)+n.x*r.y),s=0>o?-1:1,e=(i.y*r.x-i.x*r.y+(r.y-i.y)*t.x+(i.x-r.x)*t.y)*s,h=(i.x*n.y-i.y*n.x+(i.y-n.y)*t.x+(n.x-i.x)*t.y)*s;return e>0&&h>0&&2*o*s>e+h},n.Distance=function(t,i){return Math.sqrt(n.DistanceSquared(t,i))},n.DistanceSquared=function(t,i){var n=t.x-i.x,r=t.y-i.y;return n*n+r*r},n.DistanceOfPointFromSegment=function(t,i,r){var o=n.DistanceSquared(i,r);if(0===o)return n.Distance(t,i);var s=r.subtract(i),e=Math.max(0,Math.min(1,n.Dot(t.subtract(i),s)/o)),h=i.add(s.multiplyByFloats(e,e));return n.Distance(t,h)},n}();t.Vector2=o;var s=function(){function n(t,i,n){this.x=t,this.y=i,this.z=n}return n.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},n.prototype.getClassName=function(){return"Vector3"},n.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0),t=397*t^(this.z||0)},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,this},n.prototype.toQuaternion=function(){var t=new a(0,0,0,1),i=Math.cos(.5*(this.x+this.z)),n=Math.sin(.5*(this.x+this.z)),r=Math.cos(.5*(this.z-this.x)),o=Math.sin(.5*(this.z-this.x)),s=Math.cos(.5*this.y),e=Math.sin(.5*this.y);return t.x=r*e,t.y=-o*e,t.z=n*s,t.w=i*s,t},n.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z)},n.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,this},n.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z)},n.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,this},n.prototype.subtractFromFloats=function(t,i,r){return new n(this.x-t,this.y-i,this.z-r)},n.prototype.subtractFromFloatsToRef=function(t,i,n,r){return r.x=this.x-t,r.y=this.y-i,r.z=this.z-n,this},n.prototype.negate=function(){return new n(-this.x,-this.y,-this.z)},n.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this},n.prototype.scale=function(t){return new n(this.x*t,this.y*t,this.z*t)},n.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t},n.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},n.prototype.equalsWithEpsilon=function(n,r){return void 0===r&&(r=t.Epsilon),n&&i.WithinEpsilon(this.x,n.x,r)&&i.WithinEpsilon(this.y,n.y,r)&&i.WithinEpsilon(this.z,n.z,r)},n.prototype.equalsToFloats=function(t,i,n){return this.x===t&&this.y===i&&this.z===n},n.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},n.prototype.multiply=function(t){return new n(this.x*t.x,this.y*t.y,this.z*t.z)},n.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,this},n.prototype.multiplyByFloats=function(t,i,r){return new n(this.x*t,this.y*i,this.z*r)},n.prototype.divide=function(t){return new n(this.x/t.x,this.y/t.y,this.z/t.z)},n.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,this},n.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),this},n.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),this},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},n.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},n.prototype.normalize=function(){var t=this.length();if(0===t||1===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this},n.prototype.clone=function(){return new n(this.x,this.y,this.z)},n.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},n.prototype.copyFromFloats=function(t,i,n){return this.x=t,this.y=i,this.z=n,this},n.GetClipFactor=function(t,i,r,o){var s=n.Dot(t,r)-o,e=n.Dot(i,r)-o,h=s/(s-e);return h},n.FromArray=function(t,i){return i||(i=0),new n(t[i],t[i+1],t[i+2])},n.FromFloatArray=function(t,i){return i||(i=0),new n(t[i],t[i+1],t[i+2])},n.FromArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2]},n.FromFloatArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2]},n.FromFloatsToRef=function(t,i,n,r){r.x=t,r.y=i,r.z=n},n.Zero=function(){return new n(0,0,0)},n.Up=function(){return new n(0,1,0)},n.TransformCoordinates=function(t,i){var r=n.Zero();return n.TransformCoordinatesToRef(t,i,r),r},n.TransformCoordinatesToRef=function(t,i,n){var r=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8]+i.m[12],o=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9]+i.m[13],s=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]+i.m[14],e=t.x*i.m[3]+t.y*i.m[7]+t.z*i.m[11]+i.m[15];n.x=r/e,n.y=o/e,n.z=s/e},n.TransformCoordinatesFromFloatsToRef=function(t,i,n,r,o){var s=t*r.m[0]+i*r.m[4]+n*r.m[8]+r.m[12],e=t*r.m[1]+i*r.m[5]+n*r.m[9]+r.m[13],h=t*r.m[2]+i*r.m[6]+n*r.m[10]+r.m[14],a=t*r.m[3]+i*r.m[7]+n*r.m[11]+r.m[15];o.x=s/a,o.y=e/a,o.z=h/a},n.TransformNormal=function(t,i){var r=n.Zero();return n.TransformNormalToRef(t,i,r),r},n.TransformNormalToRef=function(t,i,n){n.x=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8],n.y=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9],n.z=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]},n.TransformNormalFromFloatsToRef=function(t,i,n,r,o){o.x=t*r.m[0]+i*r.m[4]+n*r.m[8],o.y=t*r.m[1]+i*r.m[5]+n*r.m[9],o.z=t*r.m[2]+i*r.m[6]+n*r.m[10]},n.CatmullRom=function(t,i,r,o,s){var e=s*s,h=s*e,a=.5*(2*i.x+(-t.x+r.x)*s+(2*t.x-5*i.x+4*r.x-o.x)*e+(-t.x+3*i.x-3*r.x+o.x)*h),u=.5*(2*i.y+(-t.y+r.y)*s+(2*t.y-5*i.y+4*r.y-o.y)*e+(-t.y+3*i.y-3*r.y+o.y)*h),m=.5*(2*i.z+(-t.z+r.z)*s+(2*t.z-5*i.z+4*r.z-o.z)*e+(-t.z+3*i.z-3*r.z+o.z)*h);return new n(a,u,m)},n.Clamp=function(t,i,r){var o=t.x;o=o>r.x?r.x:o,o=o<i.x?i.x:o;var s=t.y;s=s>r.y?r.y:s,s=s<i.y?i.y:s;var e=t.z;return e=e>r.z?r.z:e,e=e<i.z?i.z:e,new n(o,s,e)},n.Hermite=function(t,i,r,o,s){var e=s*s,h=s*e,a=2*h-3*e+1,u=-2*h+3*e,m=h-2*e+s,y=h-e,c=t.x*a+r.x*u+i.x*m+o.x*y,p=t.y*a+r.y*u+i.y*m+o.y*y,f=t.z*a+r.z*u+i.z*m+o.z*y;return new n(c,p,f)},n.Lerp=function(t,i,r){var o=t.x+(i.x-t.x)*r,s=t.y+(i.y-t.y)*r,e=t.z+(i.z-t.z)*r;return new n(o,s,e)},n.Dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},n.Cross=function(t,i){var r=n.Zero();return n.CrossToRef(t,i,r),r},n.CrossToRef=function(t,i,n){M.Vector3[0].x=t.y*i.z-t.z*i.y,M.Vector3[0].y=t.z*i.x-t.x*i.z,M.Vector3[0].z=t.x*i.y-t.y*i.x,n.copyFrom(M.Vector3[0])},n.Normalize=function(t){var i=n.Zero();return n.NormalizeToRef(t,i),i},n.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},n.Project=function(t,i,r,o){var s=o.width,e=o.height,h=o.x,a=o.y,m=u.FromValues(s/2,0,0,0,0,-e/2,0,0,0,0,1,0,h+s/2,e/2+a,0,1),y=i.multiply(r).multiply(m);return n.TransformCoordinates(t,y)},n.UnprojectFromTransform=function(t,r,o,s,e){var h=s.multiply(e);h.invert(),t.x=t.x/r*2-1,t.y=-(t.y/o*2-1);var a=n.TransformCoordinates(t,h),u=t.x*h.m[3]+t.y*h.m[7]+t.z*h.m[11]+h.m[15];return i.WithinEpsilon(u,1)&&(a=a.scale(1/u)),a},n.Unproject=function(t,r,o,s,e,h){var a=s.multiply(e).multiply(h);a.invert();var u=new n(t.x/r*2-1,-(t.y/o*2-1),t.z),m=n.TransformCoordinates(u,a),y=u.x*a.m[3]+u.y*a.m[7]+u.z*a.m[11]+a.m[15];return i.WithinEpsilon(y,1)&&(m=m.scale(1/y)),m},n.Minimize=function(t,i){var n=t.clone();return n.MinimizeInPlace(i),n},n.Maximize=function(t,i){var n=t.clone();return n.MaximizeInPlace(i),n},n.Distance=function(t,i){return Math.sqrt(n.DistanceSquared(t,i))},n.DistanceSquared=function(t,i){var n=t.x-i.x,r=t.y-i.y,o=t.z-i.z;return n*n+r*r+o*o},n.Center=function(t,i){var n=t.add(i);return n.scaleInPlace(.5),n},n.RotationFromAxis=function(t,i,r){var o=n.Zero();return n.RotationFromAxisToRef(t,i,r,o),o},n.RotationFromAxisToRef=function(r,o,s,e){var h=r.normalize(),a=s.normalize(),u=p.X,m=p.Y,y=0,c=0,f=0,l=0,x=0,z=0,w=0,v=-1,d=0,g=M.Vector3[0],T=0,R=M.Vector3[1];i.WithinEpsilon(a.z,0,t.Epsilon)?z=1:i.WithinEpsilon(a.x,0,t.Epsilon)?l=1:(w=a.z/a.x,l=-w*Math.sqrt(1/(1+w*w)),z=Math.sqrt(1/(1+w*w))),R.x=l,R.y=x,R.z=z,R.normalize(),n.CrossToRef(h,R,g),g.normalize(),n.Dot(a,g)<0&&(v=1),T=n.Dot(h,R),T=Math.min(1,Math.max(-1,T)),f=Math.acos(T)*v,n.Dot(R,u)<0&&(f=Math.PI+f,R=R.scaleInPlace(-1),d++);var _=M.Vector3[2],b=M.Vector3[3];l=0,x=0,z=0,v=-1,i.WithinEpsilon(a.z,0,t.Epsilon)?l=1:(w=R.z/R.x,l=-w*Math.sqrt(1/(1+w*w)),z=Math.sqrt(1/(1+w*w))),_.x=l,_.y=x,_.z=z,_.normalize(),n.CrossToRef(_,R,b),b.normalize(),n.CrossToRef(a,_,g),g.normalize(),n.Dot(R,g)<0&&(v=1),T=n.Dot(a,_),T=Math.min(1,Math.max(-1,T)),c=Math.acos(T)*v,n.Dot(b,m)<0&&(c=Math.PI+c,d++),v=-1,n.CrossToRef(u,R,g),g.normalize(),n.Dot(g,m)<0&&(v=1),T=n.Dot(R,u),T=Math.min(1,Math.max(-1,T)),y=-Math.acos(T)*v,0>T&&2>d&&(y=Math.PI+y),e.x=c,e.y=y,e.z=f},n}();t.Vector3=s;var e=function(){function n(t,i,n,r){this.x=t,this.y=i,this.z=n,this.w=r}return n.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"W:"+this.w+"}"},n.prototype.getClassName=function(){return"Vector4"},n.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0),t=397*t^(this.z||0),t=397*t^(this.w||0)},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,this},n.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},n.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,i.w=this.w+t.w,this},n.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},n.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,i.w=this.w-t.w,this},n.prototype.subtractFromFloats=function(t,i,r,o){return new n(this.x-t,this.y-i,this.z-r,this.w-o)},n.prototype.subtractFromFloatsToRef=function(t,i,n,r,o){return o.x=this.x-t,o.y=this.y-i,o.z=this.z-n,o.w=this.w-r,this},n.prototype.negate=function(){return new n(-this.x,-this.y,-this.z,-this.w)},n.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.prototype.scale=function(t){return new n(this.x*t,this.y*t,this.z*t,this.w*t)},n.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t,i.w=this.w*t},n.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},n.prototype.equalsWithEpsilon=function(n,r){return void 0===r&&(r=t.Epsilon),n&&i.WithinEpsilon(this.x,n.x,r)&&i.WithinEpsilon(this.y,n.y,r)&&i.WithinEpsilon(this.z,n.z,r)&&i.WithinEpsilon(this.w,n.w,r)},n.prototype.equalsToFloats=function(t,i,n,r){return this.x===t&&this.y===i&&this.z===n&&this.w===r},n.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},n.prototype.multiply=function(t){return new n(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},n.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,i.w=this.w*t.w,this},n.prototype.multiplyByFloats=function(t,i,r,o){return new n(this.x*t,this.y*i,this.z*r,this.w*o)},n.prototype.divide=function(t){return new n(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},n.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,i.w=this.w/t.w,this},n.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},n.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},n.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},n.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this},n.prototype.toVector3=function(){return new s(this.x,this.y,this.z)},n.prototype.clone=function(){return new n(this.x,this.y,this.z,this.w)},n.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},n.prototype.copyFromFloats=function(t,i,n,r){return this.x=t,this.y=i,this.z=n,this.w=r,this},n.FromArray=function(t,i){return i||(i=0),new n(t[i],t[i+1],t[i+2],t[i+3])},n.FromArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2],n.w=t[i+3]},n.FromFloatArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2],n.w=t[i+3]},n.FromFloatsToRef=function(t,i,n,r,o){o.x=t,o.y=i,o.z=n,o.w=r},n.Zero=function(){return new n(0,0,0,0)},n.Normalize=function(t){var i=n.Zero();return n.NormalizeToRef(t,i),i},n.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},n.Minimize=function(t,i){var n=t.clone();return n.MinimizeInPlace(i),n},n.Maximize=function(t,i){var n=t.clone();return n.MaximizeInPlace(i),n},n.Distance=function(t,i){return Math.sqrt(n.DistanceSquared(t,i))},n.DistanceSquared=function(t,i){var n=t.x-i.x,r=t.y-i.y,o=t.z-i.z,s=t.w-i.w;return n*n+r*r+o*o+s*s},n.Center=function(t,i){var n=t.add(i);return n.scaleInPlace(.5),n},n}();t.Vector4=e;var h=function(){function t(t,i){this.width=t,this.height=i}return t.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},t.prototype.getClassName=function(){return"Size"},t.prototype.getHashCode=function(){var t=this.width||0;return t=397*t^(this.height||0)},t.prototype.copyFrom=function(t){this.width=t.width,this.height=t.height},t.prototype.clone=function(){return new t(this.width,this.height)},t.prototype.equals=function(t){return t?this.width===t.width&&this.height===t.height:!1},Object.defineProperty(t.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),t.Zero=function(){return new t(0,0)},t.prototype.add=function(i){var n=new t(this.width+i.width,this.height+i.height);return n},t.prototype.substract=function(i){var n=new t(this.width-i.width,this.height-i.height);return n},t.Lerp=function(i,n,r){var o=i.width+(n.width-i.width)*r,s=i.height+(n.height-i.height)*r;return new t(o,s)},t}();t.Size=h;var a=function(){function t(t,i,n,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1),this.x=t,this.y=i,this.z=n,this.w=r}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},t.prototype.getClassName=function(){return"Quaternion"},t.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0),t=397*t^(this.z||0),t=397*t^(this.w||0)},t.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},t.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.copyFromFloats=function(t,i,n,r){return this.x=t,this.y=i,this.z=n,this.w=r,this},t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y,this.z+i.z,this.w+i.w)},t.prototype.subtract=function(i){return new t(this.x-i.x,this.y-i.y,this.z-i.z,this.w-i.w)},t.prototype.scale=function(i){return new t(this.x*i,this.y*i,this.z*i,this.w*i)},t.prototype.multiply=function(i){var n=new t(0,0,0,1);return this.multiplyToRef(i,n),n},t.prototype.multiplyToRef=function(t,i){var n=this.x*t.w+this.y*t.z-this.z*t.y+this.w*t.x,r=-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,o=this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,s=-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w;return i.copyFromFloats(n,r,o,s),this},t.prototype.multiplyInPlace=function(t){return this.multiplyToRef(t,this),this},t.prototype.conjugateToRef=function(t){return t.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},t.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.prototype.conjugate=function(){var i=new t(-this.x,-this.y,-this.z,this.w);return i},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.toEulerAngles=function(t){void 0===t&&(t="YZX");var i=s.Zero();return this.toEulerAnglesToRef(i,t),i},t.prototype.toEulerAnglesToRef=function(t,i){void 0===i&&(i="YZX");var n,r,o,s=this.x,e=this.y,h=this.z,a=this.w;switch(i){case"YZX":var u=s*e+h*a;if(u>.499&&(n=2*Math.atan2(s,a),r=Math.PI/2,o=0),-.499>u&&(n=-2*Math.atan2(s,a),r=-Math.PI/2,o=0),isNaN(n)){var m=s*s,y=e*e,c=h*h;n=Math.atan2(2*e*a-2*s*h,1-2*y-2*c),r=Math.asin(2*u),o=Math.atan2(2*s*a-2*e*h,1-2*m-2*c)}break;default:throw new Error("Euler order "+i+" not supported yet.")}return t.y=n,t.z=r,t.x=o,this},t.prototype.toRotationMatrix=function(t){var i=this.x*this.x,n=this.y*this.y,r=this.z*this.z,o=this.x*this.y,s=this.z*this.w,e=this.z*this.x,h=this.y*this.w,a=this.y*this.z,u=this.x*this.w;return t.m[0]=1-2*(n+r),t.m[1]=2*(o+s),t.m[2]=2*(e-h),t.m[3]=0,t.m[4]=2*(o-s),t.m[5]=1-2*(r+i),t.m[6]=2*(a+u),t.m[7]=0,t.m[8]=2*(e+h),t.m[9]=2*(a-u),t.m[10]=1-2*(n+i),t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0,t.m[15]=1,this},t.prototype.fromRotationMatrix=function(i){return t.FromRotationMatrixToRef(i,this),this},t.FromRotationMatrix=function(i){var n=new t;return t.FromRotationMatrixToRef(i,n),n},t.FromRotationMatrixToRef=function(t,i){var n,r=t.m,o=r[0],s=r[4],e=r[8],h=r[1],a=r[5],u=r[9],m=r[2],y=r[6],c=r[10],p=o+a+c;p>0?(n=.5/Math.sqrt(p+1),i.w=.25/n,i.x=(y-u)*n,i.y=(e-m)*n,i.z=(h-s)*n):o>a&&o>c?(n=2*Math.sqrt(1+o-a-c),i.w=(y-u)/n,i.x=.25*n,i.y=(s+h)/n,i.z=(e+m)/n):a>c?(n=2*Math.sqrt(1+a-o-c),i.w=(e-m)/n,i.x=(s+h)/n,i.y=.25*n,i.z=(u+y)/n):(n=2*Math.sqrt(1+c-o-a),i.w=(h-s)/n,i.x=(e+m)/n,i.y=(u+y)/n,i.z=.25*n)},t.Inverse=function(i){return new t(-i.x,-i.y,-i.z,i.w)},t.Identity=function(){return new t(0,0,0,1)},t.RotationAxis=function(i,n){var r=new t,o=Math.sin(n/2);return i.normalize(),r.w=Math.cos(n/2),r.x=i.x*o,r.y=i.y*o,r.z=i.z*o,r},t.FromArray=function(i,n){return n||(n=0),new t(i[n],i[n+1],i[n+2],i[n+3])},t.RotationYawPitchRoll=function(i,n,r){var o=new t;return t.RotationYawPitchRollToRef(i,n,r,o),o},t.RotationYawPitchRollToRef=function(t,i,n,r){var o=.5*n,s=.5*i,e=.5*t,h=Math.sin(o),a=Math.cos(o),u=Math.sin(s),m=Math.cos(s),y=Math.sin(e),c=Math.cos(e);r.x=c*u*a+y*m*h,r.y=y*m*a-c*u*h,r.z=c*m*h-y*u*a,r.w=c*m*a+y*u*h},t.RotationAlphaBetaGamma=function(i,n,r){var o=new t;return t.RotationAlphaBetaGammaToRef(i,n,r,o),o},t.RotationAlphaBetaGammaToRef=function(t,i,n,r){var o=.5*(n+t),s=.5*(n-t),e=.5*i;r.x=Math.cos(s)*Math.sin(e),r.y=Math.sin(s)*Math.sin(e),r.z=Math.sin(o)*Math.cos(e),r.w=Math.cos(o)*Math.cos(e)},t.Slerp=function(i,n,r){var o,s,e=r,h=i.x*n.x+i.y*n.y+i.z*n.z+i.w*n.w,a=!1;if(0>h&&(a=!0,h=-h),h>.999999)s=1-e,o=a?-e:e;else{var u=Math.acos(h),m=1/Math.sin(u);s=Math.sin((1-e)*u)*m,o=a?-Math.sin(e*u)*m:Math.sin(e*u)*m}return new t(s*i.x+o*n.x,s*i.y+o*n.y,s*i.z+o*n.z,s*i.w+o*n.w)},t}();t.Quaternion=a;var u=function(){function t(){this.m=new Float32Array(16)}return t.prototype.isIdentity=function(){return 1!==this.m[0]||1!==this.m[5]||1!==this.m[10]||1!==this.m[15]?!1:0===this.m[1]&&0===this.m[2]&&0===this.m[3]&&0===this.m[4]&&0===this.m[6]&&0===this.m[7]&&0===this.m[8]&&0===this.m[9]&&0===this.m[11]&&0===this.m[12]&&0===this.m[13]&&0===this.m[14]},t.prototype.determinant=function(){var t=this.m[10]*this.m[15]-this.m[11]*this.m[14],i=this.m[9]*this.m[15]-this.m[11]*this.m[13],n=this.m[9]*this.m[14]-this.m[10]*this.m[13],r=this.m[8]*this.m[15]-this.m[11]*this.m[12],o=this.m[8]*this.m[14]-this.m[10]*this.m[12],s=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*t-this.m[6]*i+this.m[7]*n)-this.m[1]*(this.m[4]*t-this.m[6]*r+this.m[7]*o)+this.m[2]*(this.m[4]*i-this.m[5]*r+this.m[7]*s)-this.m[3]*(this.m[4]*n-this.m[5]*o+this.m[6]*s)},t.prototype.toArray=function(){return this.m},t.prototype.asArray=function(){return this.toArray()},t.prototype.invert=function(){return this.invertToRef(this),this},t.prototype.reset=function(){for(var t=0;16>t;t++)this.m[t]=0;return this},t.prototype.add=function(i){var n=new t;return this.addToRef(i,n),n},t.prototype.addToRef=function(t,i){for(var n=0;16>n;n++)i.m[n]=this.m[n]+t.m[n];return this},t.prototype.addToSelf=function(t){for(var i=0;16>i;i++)this.m[i]+=t.m[i];return this},t.prototype.invertToRef=function(t){var i=this.m[0],n=this.m[1],r=this.m[2],o=this.m[3],s=this.m[4],e=this.m[5],h=this.m[6],a=this.m[7],u=this.m[8],m=this.m[9],y=this.m[10],c=this.m[11],p=this.m[12],f=this.m[13],l=this.m[14],x=this.m[15],z=y*x-c*l,w=m*x-c*f,v=m*l-y*f,d=u*x-c*p,g=u*l-y*p,T=u*f-m*p,R=e*z-h*w+a*v,_=-(s*z-h*d+a*g),M=s*w-e*d+a*T,b=-(s*v-e*g+h*T),F=1/(i*R+n*_+r*M+o*b),A=h*x-a*l,L=e*x-a*f,P=e*l-h*f,C=s*x-a*p,Z=s*l-h*p,S=s*f-e*p,I=h*c-a*y,q=e*c-a*m,H=e*y-h*m,N=s*c-a*u,V=s*y-h*u,D=s*m-e*u;return t.m[0]=R*F,t.m[4]=_*F,t.m[8]=M*F,t.m[12]=b*F,t.m[1]=-(n*z-r*w+o*v)*F,t.m[5]=(i*z-r*d+o*g)*F,t.m[9]=-(i*w-n*d+o*T)*F,t.m[13]=(i*v-n*g+r*T)*F,t.m[2]=(n*A-r*L+o*P)*F,t.m[6]=-(i*A-r*C+o*Z)*F,t.m[10]=(i*L-n*C+o*S)*F,t.m[14]=-(i*P-n*Z+r*S)*F,t.m[3]=-(n*I-r*q+o*H)*F,t.m[7]=(i*I-r*N+o*V)*F,t.m[11]=-(i*q-n*N+o*D)*F,t.m[15]=(i*H-n*V+r*D)*F,this},t.prototype.setTranslation=function(t){return this.m[12]=t.x,this.m[13]=t.y,this.m[14]=t.z,this},t.prototype.getTranslation=function(){return new s(this.m[12],this.m[13],this.m[14])},t.prototype.multiply=function(i){var n=new t;return this.multiplyToRef(i,n),n},t.prototype.copyFrom=function(t){for(var i=0;16>i;i++)this.m[i]=t.m[i];return this},t.prototype.copyToArray=function(t,i){void 0===i&&(i=0);for(var n=0;16>n;n++)t[i+n]=this.m[n];return this},t.prototype.multiplyToRef=function(t,i){return this.multiplyToArray(t,i.m,0),this},t.prototype.multiplyToArray=function(t,i,n){var r=this.m[0],o=this.m[1],s=this.m[2],e=this.m[3],h=this.m[4],a=this.m[5],u=this.m[6],m=this.m[7],y=this.m[8],c=this.m[9],p=this.m[10],f=this.m[11],l=this.m[12],x=this.m[13],z=this.m[14],w=this.m[15],v=t.m[0],d=t.m[1],g=t.m[2],T=t.m[3],R=t.m[4],_=t.m[5],M=t.m[6],b=t.m[7],F=t.m[8],A=t.m[9],L=t.m[10],P=t.m[11],C=t.m[12],Z=t.m[13],S=t.m[14],I=t.m[15];return i[n]=r*v+o*R+s*F+e*C,i[n+1]=r*d+o*_+s*A+e*Z,i[n+2]=r*g+o*M+s*L+e*S,i[n+3]=r*T+o*b+s*P+e*I,i[n+4]=h*v+a*R+u*F+m*C,i[n+5]=h*d+a*_+u*A+m*Z,i[n+6]=h*g+a*M+u*L+m*S,i[n+7]=h*T+a*b+u*P+m*I,i[n+8]=y*v+c*R+p*F+f*C,\ni[n+9]=y*d+c*_+p*A+f*Z,i[n+10]=y*g+c*M+p*L+f*S,i[n+11]=y*T+c*b+p*P+f*I,i[n+12]=l*v+x*R+z*F+w*C,i[n+13]=l*d+x*_+z*A+w*Z,i[n+14]=l*g+x*M+z*L+w*S,i[n+15]=l*T+x*b+z*P+w*I,this},t.prototype.equals=function(t){return t&&this.m[0]===t.m[0]&&this.m[1]===t.m[1]&&this.m[2]===t.m[2]&&this.m[3]===t.m[3]&&this.m[4]===t.m[4]&&this.m[5]===t.m[5]&&this.m[6]===t.m[6]&&this.m[7]===t.m[7]&&this.m[8]===t.m[8]&&this.m[9]===t.m[9]&&this.m[10]===t.m[10]&&this.m[11]===t.m[11]&&this.m[12]===t.m[12]&&this.m[13]===t.m[13]&&this.m[14]===t.m[14]&&this.m[15]===t.m[15]},t.prototype.clone=function(){return t.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},t.prototype.getClassName=function(){return"Matrix"},t.prototype.getHashCode=function(){for(var t=this.m[0]||0,i=1;16>i;i++)t=397*t^(this.m[i]||0);return t},t.prototype.decompose=function(n,r,o){o.x=this.m[12],o.y=this.m[13],o.z=this.m[14];var s=i.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,e=i.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,h=i.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(n.x=s*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),n.y=e*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),n.z=h*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===n.x||0===n.y||0===n.z)return r.x=0,r.y=0,r.z=0,r.w=1,!1;var u=t.FromValues(this.m[0]/n.x,this.m[1]/n.x,this.m[2]/n.x,0,this.m[4]/n.y,this.m[5]/n.y,this.m[6]/n.y,0,this.m[8]/n.z,this.m[9]/n.z,this.m[10]/n.z,0,0,0,0,1);return a.FromRotationMatrixToRef(u,r),!0},t.FromArray=function(i,n){var r=new t;return n||(n=0),t.FromArrayToRef(i,n,r),r},t.FromArrayToRef=function(t,i,n){for(var r=0;16>r;r++)n.m[r]=t[r+i]},t.FromFloat32ArrayToRefScaled=function(t,i,n,r){for(var o=0;16>o;o++)r.m[o]=t[o+i]*n},t.FromValuesToRef=function(t,i,n,r,o,s,e,h,a,u,m,y,c,p,f,l,x){x.m[0]=t,x.m[1]=i,x.m[2]=n,x.m[3]=r,x.m[4]=o,x.m[5]=s,x.m[6]=e,x.m[7]=h,x.m[8]=a,x.m[9]=u,x.m[10]=m,x.m[11]=y,x.m[12]=c,x.m[13]=p,x.m[14]=f,x.m[15]=l},t.prototype.getRow=function(t){if(0>t||t>3)return null;var i=4*t;return new e(this.m[i+0],this.m[i+1],this.m[i+2],this.m[i+3])},t.prototype.setRow=function(t,i){if(0>t||t>3)return this;var n=4*t;return this.m[n+0]=i.x,this.m[n+1]=i.y,this.m[n+2]=i.z,this.m[n+3]=i.w,this},t.FromValues=function(i,n,r,o,s,e,h,a,u,m,y,c,p,f,l,x){var z=new t;return z.m[0]=i,z.m[1]=n,z.m[2]=r,z.m[3]=o,z.m[4]=s,z.m[5]=e,z.m[6]=h,z.m[7]=a,z.m[8]=u,z.m[9]=m,z.m[10]=y,z.m[11]=c,z.m[12]=p,z.m[13]=f,z.m[14]=l,z.m[15]=x,z},t.Compose=function(i,n,r){var o=t.FromValues(i.x,0,0,0,0,i.y,0,0,0,0,i.z,0,0,0,0,1),s=t.Identity();return n.toRotationMatrix(s),o=o.multiply(s),o.setTranslation(r),o},t.Identity=function(){return t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.IdentityToRef=function(i){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,i)},t.Zero=function(){return t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},t.RotationX=function(i){var n=new t;return t.RotationXToRef(i,n),n},t.Invert=function(i){var n=new t;return i.invertToRef(n),n},t.RotationXToRef=function(t,i){var n=Math.sin(t),r=Math.cos(t);i.m[0]=1,i.m[15]=1,i.m[5]=r,i.m[10]=r,i.m[9]=-n,i.m[6]=n,i.m[1]=0,i.m[2]=0,i.m[3]=0,i.m[4]=0,i.m[7]=0,i.m[8]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},t.RotationY=function(i){var n=new t;return t.RotationYToRef(i,n),n},t.RotationYToRef=function(t,i){var n=Math.sin(t),r=Math.cos(t);i.m[5]=1,i.m[15]=1,i.m[0]=r,i.m[2]=-n,i.m[8]=n,i.m[10]=r,i.m[1]=0,i.m[3]=0,i.m[4]=0,i.m[6]=0,i.m[7]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},t.RotationZ=function(i){var n=new t;return t.RotationZToRef(i,n),n},t.RotationZToRef=function(t,i){var n=Math.sin(t),r=Math.cos(t);i.m[10]=1,i.m[15]=1,i.m[0]=r,i.m[1]=n,i.m[4]=-n,i.m[5]=r,i.m[2]=0,i.m[3]=0,i.m[6]=0,i.m[7]=0,i.m[8]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},t.RotationAxis=function(i,n){var r=t.Zero();return t.RotationAxisToRef(i,n,r),r},t.RotationAxisToRef=function(t,i,n){var r=Math.sin(-i),o=Math.cos(-i),s=1-o;t.normalize(),n.m[0]=t.x*t.x*s+o,n.m[1]=t.x*t.y*s-t.z*r,n.m[2]=t.x*t.z*s+t.y*r,n.m[3]=0,n.m[4]=t.y*t.x*s+t.z*r,n.m[5]=t.y*t.y*s+o,n.m[6]=t.y*t.z*s-t.x*r,n.m[7]=0,n.m[8]=t.z*t.x*s-t.y*r,n.m[9]=t.z*t.y*s+t.x*r,n.m[10]=t.z*t.z*s+o,n.m[11]=0,n.m[15]=1},t.RotationYawPitchRoll=function(i,n,r){var o=new t;return t.RotationYawPitchRollToRef(i,n,r,o),o},t.RotationYawPitchRollToRef=function(t,i,n,r){a.RotationYawPitchRollToRef(t,i,n,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(r)},t.Scaling=function(i,n,r){var o=t.Zero();return t.ScalingToRef(i,n,r,o),o},t.ScalingToRef=function(t,i,n,r){r.m[0]=t,r.m[1]=0,r.m[2]=0,r.m[3]=0,r.m[4]=0,r.m[5]=i,r.m[6]=0,r.m[7]=0,r.m[8]=0,r.m[9]=0,r.m[10]=n,r.m[11]=0,r.m[12]=0,r.m[13]=0,r.m[14]=0,r.m[15]=1},t.Translation=function(i,n,r){var o=t.Identity();return t.TranslationToRef(i,n,r,o),o},t.TranslationToRef=function(i,n,r,o){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,i,n,r,1,o)},t.Lerp=function(i,n,r){for(var o=t.Zero(),s=0;16>s;s++)o.m[s]=i.m[s]*(1-r)+n.m[s]*r;return o},t.DecomposeLerp=function(i,n,r){var o=new s(0,0,0),e=new a,h=new s(0,0,0);i.decompose(o,e,h);var u=new s(0,0,0),m=new a,y=new s(0,0,0);n.decompose(u,m,y);var c=s.Lerp(o,u,r),p=a.Slerp(e,m,r),f=s.Lerp(h,y,r);return t.Compose(c,p,f)},t.LookAtLH=function(i,n,r){var o=t.Zero();return t.LookAtLHToRef(i,n,r,o),o},t.LookAtLHToRef=function(i,n,r,o){n.subtractToRef(i,this._zAxis),this._zAxis.normalize(),s.CrossToRef(r,this._zAxis,this._xAxis),0===this._xAxis.lengthSquared()?this._xAxis.x=1:this._xAxis.normalize(),s.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var e=-s.Dot(this._xAxis,i),h=-s.Dot(this._yAxis,i),a=-s.Dot(this._zAxis,i);return t.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,e,h,a,1,o)},t.OrthoLH=function(i,n,r,o){var s=t.Zero();return t.OrthoLHToRef(i,n,r,o,s),s},t.OrthoLHToRef=function(i,n,r,o,s){var e=2/i,h=2/n,a=1/(o-r),u=r/(r-o);t.FromValuesToRef(e,0,0,0,0,h,0,0,0,0,a,0,0,0,u,1,s)},t.OrthoOffCenterLH=function(i,n,r,o,s,e){var h=t.Zero();return t.OrthoOffCenterLHToRef(i,n,r,o,s,e,h),h},t.OrthoOffCenterLHToRef=function(t,i,n,r,o,s,e){e.m[0]=2/(i-t),e.m[1]=e.m[2]=e.m[3]=0,e.m[5]=2/(r-n),e.m[4]=e.m[6]=e.m[7]=0,e.m[10]=-1/(o-s),e.m[8]=e.m[9]=e.m[11]=0,e.m[12]=(t+i)/(t-i),e.m[13]=(r+n)/(n-r),e.m[14]=o/(o-s),e.m[15]=1},t.PerspectiveLH=function(i,n,r,o){var s=t.Zero();return s.m[0]=2*r/i,s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2*r/n,s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-o/(r-o),s.m[8]=s.m[9]=0,s.m[11]=1,s.m[12]=s.m[13]=s.m[15]=0,s.m[14]=r*o/(r-o),s},t.PerspectiveFovLH=function(i,n,r,o){var s=t.Zero();return t.PerspectiveFovLHToRef(i,n,r,o,s),s},t.PerspectiveFovLHToRef=function(t,i,n,r,o,s){void 0===s&&(s=!0);var e=1/Math.tan(.5*t);s?o.m[0]=e/i:o.m[0]=e,o.m[1]=o.m[2]=o.m[3]=0,s?o.m[5]=e:o.m[5]=e*i,o.m[4]=o.m[6]=o.m[7]=0,o.m[8]=o.m[9]=0,o.m[10]=-r/(n-r),o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=n*r/(n-r)},t.GetFinalMatrix=function(i,n,r,o,s,e){var h=i.width,a=i.height,u=i.x,m=i.y,y=t.FromValues(h/2,0,0,0,0,-a/2,0,0,0,0,e-s,0,u+h/2,a/2+m,s,1);return n.multiply(r).multiply(o).multiply(y)},t.GetAsMatrix2x2=function(t){return new Float32Array([t.m[0],t.m[1],t.m[4],t.m[5]])},t.GetAsMatrix3x3=function(t){return new Float32Array([t.m[0],t.m[1],t.m[2],t.m[4],t.m[5],t.m[6],t.m[8],t.m[9],t.m[10]])},t.Transpose=function(i){var n=new t;return n.m[0]=i.m[0],n.m[1]=i.m[4],n.m[2]=i.m[8],n.m[3]=i.m[12],n.m[4]=i.m[1],n.m[5]=i.m[5],n.m[6]=i.m[9],n.m[7]=i.m[13],n.m[8]=i.m[2],n.m[9]=i.m[6],n.m[10]=i.m[10],n.m[11]=i.m[14],n.m[12]=i.m[3],n.m[13]=i.m[7],n.m[14]=i.m[11],n.m[15]=i.m[15],n},t.Reflection=function(i){var n=new t;return t.ReflectionToRef(i,n),n},t.ReflectionToRef=function(t,i){t.normalize();var n=t.normal.x,r=t.normal.y,o=t.normal.z,s=-2*n,e=-2*r,h=-2*o;i.m[0]=s*n+1,i.m[1]=e*n,i.m[2]=h*n,i.m[3]=0,i.m[4]=s*r,i.m[5]=e*r+1,i.m[6]=h*r,i.m[7]=0,i.m[8]=s*o,i.m[9]=e*o,i.m[10]=h*o+1,i.m[11]=0,i.m[12]=s*t.d,i.m[13]=e*t.d,i.m[14]=h*t.d,i.m[15]=1},t._tempQuaternion=new a,t._xAxis=s.Zero(),t._yAxis=s.Zero(),t._zAxis=s.Zero(),t}();t.Matrix=u;var m=function(){function t(t,i,n,r){this.normal=new s(t,i,n),this.d=r}return t.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},t.prototype.clone=function(){return new t(this.normal.x,this.normal.y,this.normal.z,this.d)},t.prototype.getClassName=function(){return"Plane"},t.prototype.getHashCode=function(){var t=this.normal.getHashCode();return t=397*t^(this.d||0)},t.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),i=0;return 0!==t&&(i=1/t),this.normal.x*=i,this.normal.y*=i,this.normal.z*=i,this.d*=i,this},t.prototype.transform=function(i){var n=u.Transpose(i),r=this.normal.x,o=this.normal.y,s=this.normal.z,e=this.d,h=r*n.m[0]+o*n.m[1]+s*n.m[2]+e*n.m[3],a=r*n.m[4]+o*n.m[5]+s*n.m[6]+e*n.m[7],m=r*n.m[8]+o*n.m[9]+s*n.m[10]+e*n.m[11],y=r*n.m[12]+o*n.m[13]+s*n.m[14]+e*n.m[15];return new t(h,a,m,y)},t.prototype.dotCoordinate=function(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d},t.prototype.copyFromPoints=function(t,i,n){var r,o=i.x-t.x,s=i.y-t.y,e=i.z-t.z,h=n.x-t.x,a=n.y-t.y,u=n.z-t.z,m=s*u-e*a,y=e*h-o*u,c=o*a-s*h,p=Math.sqrt(m*m+y*y+c*c);return r=0!==p?1/p:0,this.normal.x=m*r,this.normal.y=y*r,this.normal.z=c*r,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this},t.prototype.isFrontFacingTo=function(t,i){var n=s.Dot(this.normal,t);return i>=n},t.prototype.signedDistanceTo=function(t){return s.Dot(t,this.normal)+this.d},t.FromArray=function(i){return new t(i[0],i[1],i[2],i[3])},t.FromPoints=function(i,n,r){var o=new t(0,0,0,0);return o.copyFromPoints(i,n,r),o},t.FromPositionAndNormal=function(i,n){var r=new t(0,0,0,0);return n.normalize(),r.normal=n,r.d=-(n.x*i.x+n.y*i.y+n.z*i.z),r},t.SignedDistanceToPlaneFromPositionAndNormal=function(t,i,n){var r=-(i.x*t.x+i.y*t.y+i.z*t.z);return s.Dot(n,i)+r},t}();t.Plane=m;var y=function(){function t(t,i,n,r){this.x=t,this.y=i,this.width=n,this.height=r}return t.prototype.toGlobal=function(i,n){return new t(this.x*i,this.y*n,this.width*i,this.height*n)},t}();t.Viewport=y;var c=function(){function t(){}return t.GetPlanes=function(i){for(var n=[],r=0;6>r;r++)n.push(new m(0,0,0,0));return t.GetPlanesToRef(i,n),n},t.GetPlanesToRef=function(t,i){i[0].normal.x=t.m[3]+t.m[2],i[0].normal.y=t.m[7]+t.m[6],i[0].normal.z=t.m[11]+t.m[10],i[0].d=t.m[15]+t.m[14],i[0].normalize(),i[1].normal.x=t.m[3]-t.m[2],i[1].normal.y=t.m[7]-t.m[6],i[1].normal.z=t.m[11]-t.m[10],i[1].d=t.m[15]-t.m[14],i[1].normalize(),i[2].normal.x=t.m[3]+t.m[0],i[2].normal.y=t.m[7]+t.m[4],i[2].normal.z=t.m[11]+t.m[8],i[2].d=t.m[15]+t.m[12],i[2].normalize(),i[3].normal.x=t.m[3]-t.m[0],i[3].normal.y=t.m[7]-t.m[4],i[3].normal.z=t.m[11]-t.m[8],i[3].d=t.m[15]-t.m[12],i[3].normalize(),i[4].normal.x=t.m[3]-t.m[1],i[4].normal.y=t.m[7]-t.m[5],i[4].normal.z=t.m[11]-t.m[9],i[4].d=t.m[15]-t.m[13],i[4].normalize(),i[5].normal.x=t.m[3]+t.m[1],i[5].normal.y=t.m[7]+t.m[5],i[5].normal.z=t.m[11]+t.m[9],i[5].d=t.m[15]+t.m[13],i[5].normalize()},t}();t.Frustum=c,function(t){t[t.LOCAL=0]="LOCAL",t[t.WORLD=1]="WORLD"}(t.Space||(t.Space={}));var p=(t.Space,function(){function t(){}return t.X=new s(1,0,0),t.Y=new s(0,1,0),t.Z=new s(0,0,1),t}());t.Axis=p;var f=function(){function t(){}return t.interpolate=function(t,i,n,r,o){for(var s=1-3*r+3*i,e=3*r-6*i,h=3*i,a=t,u=0;5>u;u++){var m=a*a,y=m*a,c=s*y+e*m+h*a,p=1/(3*s*m+2*e*a+h);a-=(c-t)*p,a=Math.min(1,Math.max(0,a))}return 3*Math.pow(1-a,2)*a*n+3*(1-a)*Math.pow(a,2)*o+Math.pow(a,3)},t}();t.BezierCurve=f,function(t){t[t.CW=0]="CW",t[t.CCW=1]="CCW"}(t.Orientation||(t.Orientation={}));var l=t.Orientation,x=function(){function t(t){var i=this;this.degrees=function(){return 180*i._radians/Math.PI},this.radians=function(){return i._radians},this._radians=t,this._radians<0&&(this._radians+=2*Math.PI)}return t.BetweenTwoPoints=function(i,n){var r=n.subtract(i),o=Math.atan2(r.y,r.x);return new t(o)},t.FromRadians=function(i){return new t(i)},t.FromDegrees=function(i){return new t(i*Math.PI/180)},t}();t.Angle=x;var z=function(){function t(t,i,n){this.startPoint=t,this.midPoint=i,this.endPoint=n;var r=Math.pow(i.x,2)+Math.pow(i.y,2),s=(Math.pow(t.x,2)+Math.pow(t.y,2)-r)/2,e=(r-Math.pow(n.x,2)-Math.pow(n.y,2))/2,h=(t.x-i.x)*(i.y-n.y)-(i.x-n.x)*(t.y-i.y);this.centerPoint=new o((s*(i.y-n.y)-e*(t.y-i.y))/h,((t.x-i.x)*e-(i.x-n.x)*s)/h),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=x.BetweenTwoPoints(this.centerPoint,this.startPoint);var a=this.startAngle.degrees(),u=x.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),m=x.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();u-a>180&&(u-=360),-180>u-a&&(u+=360),m-u>180&&(m-=360),-180>m-u&&(m+=360),this.orientation=0>u-a?l.CW:l.CCW,this.angle=x.FromDegrees(this.orientation===l.CW?a-m:m-a)}return t}();t.Arc2=z;var w=function(){function t(t,i){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new o(t,i))}return t.prototype.addLineTo=function(t,i){if(closed)return this;var n=new o(t,i),r=this._points[this._points.length-1];return this._points.push(n),this._length+=n.subtract(r).length(),this},t.prototype.addArcTo=function(t,i,n,r,s){if(void 0===s&&(s=36),closed)return this;var e=this._points[this._points.length-1],h=new o(t,i),a=new o(n,r),u=new z(e,h,a),m=u.angle.radians()/s;u.orientation===l.CW&&(m*=-1);for(var y=u.startAngle.radians()+m,c=0;s>c;c++){var p=Math.cos(y)*u.radius+u.centerPoint.x,f=Math.sin(y)*u.radius+u.centerPoint.y;this.addLineTo(p,f),y+=m}return this},t.prototype.close=function(){return this.closed=!0,this},t.prototype.length=function(){var t=this._length;if(!this.closed){var i=this._points[this._points.length-1],n=this._points[0];t+=n.subtract(i).length()}return t},t.prototype.getPoints=function(){return this._points},t.prototype.getPointAtLengthPosition=function(t){if(0>t||t>1)return o.Zero();for(var i=t*this.length(),n=0,r=0;r<this._points.length;r++){var s=(r+1)%this._points.length,e=this._points[r],h=this._points[s],a=h.subtract(e),u=a.length()+n;if(i>=n&&u>=i){var m=a.normalize(),y=i-n;return new o(e.x+m.x*y,e.y+m.y*y)}n=u}return o.Zero()},t.StartingAt=function(i,n){return new t(i,n)},t}();t.Path2=w;var v=function(){function n(t,i,n){this.path=t,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var r=0;r<t.length;r++)this._curve[r]=t[r].clone();this._raw=n||!1,this._compute(i)}return n.prototype.getCurve=function(){return this._curve},n.prototype.getTangents=function(){return this._tangents},n.prototype.getNormals=function(){return this._normals},n.prototype.getBinormals=function(){return this._binormals},n.prototype.getDistances=function(){return this._distances},n.prototype.update=function(t,i){for(var n=0;n<t.length;n++)this._curve[n].x=t[n].x,this._curve[n].y=t[n].y,this._curve[n].z=t[n].z;return this._compute(i),this},n.prototype._compute=function(t){var i=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._raw||this._tangents[i-1].normalize();var n=this._tangents[0],r=this._normalVector(this._curve[0],n,t);this._normals[0]=r,this._raw||this._normals[0].normalize(),this._binormals[0]=s.Cross(n,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var o,e,h,a,u=1;i>u;u++)o=this._getLastNonNullVector(u),i-1>u&&(e=this._getFirstNonNullVector(u),this._tangents[u]=o.add(e),this._tangents[u].normalize()),this._distances[u]=this._distances[u-1]+o.length(),h=this._tangents[u],a=this._binormals[u-1],this._normals[u]=s.Cross(a,h),this._raw||this._normals[u].normalize(),this._binormals[u]=s.Cross(h,this._normals[u]),this._raw||this._binormals[u].normalize()},n.prototype._getFirstNonNullVector=function(t){for(var i=1,n=this._curve[t+i].subtract(this._curve[t]);0===n.length()&&t+i+1<this._curve.length;)i++,n=this._curve[t+i].subtract(this._curve[t]);return n},n.prototype._getLastNonNullVector=function(t){for(var i=1,n=this._curve[t].subtract(this._curve[t-i]);0===n.length()&&t>i+1;)i++,n=this._curve[t].subtract(this._curve[t-i]);return n},n.prototype._normalVector=function(n,r,o){var e;if(void 0===o||null===o){var h;i.WithinEpsilon(r.y,1,t.Epsilon)?i.WithinEpsilon(r.x,1,t.Epsilon)?i.WithinEpsilon(r.z,1,t.Epsilon)||(h=new s(0,0,1)):h=new s(1,0,0):h=new s(0,-1,0),e=s.Cross(r,h)}else e=s.Cross(r,o),s.CrossToRef(e,r,e);return e.normalize(),e},n}();t.Path3D=v;var d=function(){function t(t){this._length=0,this._points=t,this._length=this._computeLength(t)}return t.CreateQuadraticBezier=function(i,n,r,o){o=o>2?o:3;for(var e=new Array,h=function(t,i,n,r){var o=(1-t)*(1-t)*i+2*t*(1-t)*n+t*t*r;return o},a=0;o>=a;a++)e.push(new s(h(a/o,i.x,n.x,r.x),h(a/o,i.y,n.y,r.y),h(a/o,i.z,n.z,r.z)));return new t(e)},t.CreateCubicBezier=function(i,n,r,o,e){e=e>3?e:4;for(var h=new Array,a=function(t,i,n,r,o){var s=(1-t)*(1-t)*(1-t)*i+3*t*(1-t)*(1-t)*n+3*t*t*(1-t)*r+t*t*t*o;return s},u=0;e>=u;u++)h.push(new s(a(u/e,i.x,n.x,r.x,o.x),a(u/e,i.y,n.y,r.y,o.y),a(u/e,i.z,n.z,r.z,o.z)));return new t(h)},t.CreateHermiteSpline=function(i,n,r,o,e){for(var h=new Array,a=1/e,u=0;e>=u;u++)h.push(s.Hermite(i,n,r,o,u*a));return new t(h)},t.prototype.getPoints=function(){return this._points},t.prototype.length=function(){return this._length},t.prototype["continue"]=function(i){for(var n=this._points[this._points.length-1],r=this._points.slice(),o=i.getPoints(),s=1;s<o.length;s++)r.push(o[s].subtract(o[0]).add(n));var e=new t(r);return e},t.prototype._computeLength=function(t){for(var i=0,n=1;n<t.length;n++)i+=t[n].subtract(t[n-1]).length();return i},t}();t.Curve3=d;var g=function(){function t(){this.L00=s.Zero(),this.L1_1=s.Zero(),this.L10=s.Zero(),this.L11=s.Zero(),this.L2_2=s.Zero(),this.L2_1=s.Zero(),this.L20=s.Zero(),this.L21=s.Zero(),this.L22=s.Zero()}return t.prototype.addLight=function(t,i,n){var r=new s(i.r,i.g,i.b),o=r.scale(n);this.L00=this.L00.add(o.scale(.282095)),this.L1_1=this.L1_1.add(o.scale(.488603*t.y)),this.L10=this.L10.add(o.scale(.488603*t.z)),this.L11=this.L11.add(o.scale(.488603*t.x)),this.L2_2=this.L2_2.add(o.scale(1.092548*t.x*t.y)),this.L2_1=this.L2_1.add(o.scale(1.092548*t.y*t.z)),this.L21=this.L21.add(o.scale(1.092548*t.x*t.z)),this.L20=this.L20.add(o.scale(.315392*(3*t.z*t.z-1))),this.L22=this.L22.add(o.scale(.546274*(t.x*t.x-t.y*t.y)))},t.prototype.scale=function(t){this.L00=this.L00.scale(t),this.L1_1=this.L1_1.scale(t),this.L10=this.L10.scale(t),this.L11=this.L11.scale(t),this.L2_2=this.L2_2.scale(t),this.L2_1=this.L2_1.scale(t),this.L20=this.L20.scale(t),this.L21=this.L21.scale(t),this.L22=this.L22.scale(t)},t}();t.SphericalHarmonics=g;var T=function(){function t(){this.x=s.Zero(),this.y=s.Zero(),this.z=s.Zero(),this.xx=s.Zero(),this.yy=s.Zero(),this.zz=s.Zero(),this.xy=s.Zero(),this.yz=s.Zero(),this.zx=s.Zero()}return t.prototype.addAmbient=function(t){var i=new s(t.r,t.g,t.b);this.xx=this.xx.add(i),this.yy=this.yy.add(i),this.zz=this.zz.add(i)},t.getSphericalPolynomialFromHarmonics=function(i){var n=new t;return n.x=i.L11.scale(1.02333),n.y=i.L1_1.scale(1.02333),n.z=i.L10.scale(1.02333),n.xx=i.L00.scale(.886277).subtract(i.L20.scale(.247708)).add(i.L22.scale(.429043)),n.yy=i.L00.scale(.886277).subtract(i.L20.scale(.247708)).subtract(i.L22.scale(.429043)),n.zz=i.L00.scale(.886277).add(i.L20.scale(.495417)),n.yz=i.L2_1.scale(.858086),n.zx=i.L21.scale(.858086),n.xy=i.L2_2.scale(.858086),n},t}();t.SphericalPolynomial=T;var R=function(){function t(t,i){void 0===t&&(t=s.Zero()),void 0===i&&(i=s.Up()),this.position=t,this.normal=i}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone())},t}();t.PositionNormalVertex=R;var _=function(){function t(t,i,n){void 0===t&&(t=s.Zero()),void 0===i&&(i=s.Up()),void 0===n&&(n=o.Zero()),this.position=t,this.normal=i,this.uv=n}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone(),this.uv.clone())},t}();t.PositionNormalTextureVertex=_;var M=function(){function t(){}return t.Color3=[n.Black(),n.Black(),n.Black()],t.Vector2=[o.Zero(),o.Zero(),o.Zero()],t.Vector3=[s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero()],t.Vector4=[e.Zero(),e.Zero(),e.Zero()],t.Quaternion=[new a(0,0,0,0)],t.Matrix=[u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero()],t}();t.Tmp=M}(BABYLON||(BABYLON={}));';
("undefined"!=typeof window&&window.module||"undefined"!=typeof module)&&"undefined"!=typeof module.exports&&(module.exports=BABYLON);
